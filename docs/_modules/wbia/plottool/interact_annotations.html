

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>wbia.plottool.interact_annotations &mdash; wbia 2.2.4 documentation</title>















  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />


  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">


  <div class="wy-grid-for-nav">


    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">



            <a href="../../../index.html" class="icon icon-home"> wbia



          </a>




              <div class="version">
                2.2.4
              </div>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">






              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../wbia.html">wbia package</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">


      <nav class="wy-nav-top" aria-label="top navigation">

          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">wbia</a>

      </nav>


      <div class="wy-nav-content">

        <div class="rst-content">

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">

      <li><a href="../../../index.html">Docs</a> &raquo;</li>

          <li><a href="../../index.html">Module code</a> &raquo;</li>

          <li><a href="../../wbia.html">wbia</a> &raquo;</li>

          <li><a href="../plottool.html">wbia.plottool</a> &raquo;</li>

      <li>wbia.plottool.interact_annotations</li>


      <li class="wy-breadcrumbs-aside">

      </li>

  </ul>


  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <h1>Source code for wbia.plottool.interact_annotations</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Interactive tool to draw mask on an image or image-like array.</span>

<span class="sd">TODO:</span>
<span class="sd">    * need concept of subannotation</span>
<span class="sd">    * need to take options on a right click of an annotation</span>
<span class="sd">    * add support for arbitrary polygons back in .</span>
<span class="sd">    * rename species_list to label_list or category_list</span>
<span class="sd">    * Just use metadata instead of species / category / label</span>
<span class="sd">    # Need to incorporate parts into metadata</span>

<span class="sd">Notes:</span>
<span class="sd">    3. Change bounding box and update continuously to the original image the</span>
<span class="sd">    new ANNOTATIONs</span>

<span class="sd">    2. Make new window and frames inside, double click to pull up normal window</span>
<span class="sd">    with editing start with just taking in 6 images and ANNOTATIONs</span>

<span class="sd">    1. ANNOTATION ID number, then list of 4 tuples</span>

<span class="sd">    python -m utool.util_inspect check_module_usage --pat=&quot;interact_annotations.py&quot;</span>

<span class="sd">References:</span>
<span class="sd">    Adapted from matplotlib/examples/event_handling/poly_editor.py</span>
<span class="sd">    Jan 9 2014: taken from: https://gist.github.com/tonysyu/3090704</span>

<span class="sd">CommandLine:</span>
<span class="sd">    python -m wbia.plottool.interact_annotations --test-test_interact_annots --show</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">it</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">zip</span><span class="p">,</span> <span class="nb">range</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">draw_func2</span> <span class="k">as</span> <span class="n">df2</span>
<span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="k">import</span> <span class="n">abstract_interaction</span>

<span class="nb">print</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">inject2</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="n">DEFAULT_SPECIES_TAG</span> <span class="o">=</span> <span class="s1">&#39;____&#39;</span>
<span class="c1"># FIXE THESE TO BE GENERIC</span>
<span class="n">ACCEPT_SAVE_HOTKEY</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># &#39;ctrl+a&#39;</span>
<span class="n">ADD_RECTANGLE_HOTKEY</span> <span class="o">=</span> <span class="s1">&#39;ctrl+a&#39;</span>  <span class="c1"># &#39;ctrl+d&#39;</span>
<span class="n">ADD_RECTANGLE_FULL_HOTKEY</span> <span class="o">=</span> <span class="s1">&#39;ctrl+f&#39;</span>
<span class="n">DEL_RECTANGLE_HOTKEY</span> <span class="o">=</span> <span class="s1">&#39;ctrl+d&#39;</span>  <span class="c1"># &#39;ctrl+r&#39;</span>
<span class="n">TOGGLE_LABEL_HOTKEY</span> <span class="o">=</span> <span class="s1">&#39;ctrl+t&#39;</span>

<span class="n">HACK_OFF_SPECIES_TYPING</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">HACK_OFF_SPECIES_TYPING</span><span class="p">:</span>
    <span class="n">ADD_RECTANGLE_HOTKEY</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>  <span class="c1"># &#39;ctrl+d&#39;</span>
    <span class="n">ADD_RECTANGLE_FULL_HOTKEY</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span>
    <span class="n">DEL_RECTANGLE_HOTKEY</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span>  <span class="c1"># &#39;ctrl+r&#39;</span>
    <span class="n">TOGGLE_LABEL_HOTKEY</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>

<span class="n">NEXT_IMAGE_HOTKEYS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;pagedown&#39;</span><span class="p">]</span>
<span class="n">PREV_IMAGE_HOTKEYS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;pageup&#39;</span><span class="p">]</span>

<span class="n">TAU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span>


<div class="viewcode-block" id="AnnotPoly"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly">[docs]</a><span class="k">class</span> <span class="nc">AnnotPoly</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">NiceRepr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to represent an annotation polygon</span>
<span class="sd">    wbia --aidcmd=&#39;Interact image&#39; --aid=1</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.interact_annotations import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; verts = vt.verts_from_bbox([0, 0, 10, 10])</span>
<span class="sd">        &gt;&gt;&gt; poly = AnnotPoly(None, 0, verts, 0, &#39;____&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">poly</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">,</span>
        <span class="n">num</span><span class="p">,</span>
        <span class="n">verts</span><span class="p">,</span>
        <span class="n">theta</span><span class="p">,</span>
        <span class="n">species</span><span class="p">,</span>
        <span class="n">fc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">line_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">line_width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">is_orig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">valid_species</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AnnotPoly</span><span class="p">,</span> <span class="n">poly</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">animated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">fc</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">manager</span> <span class="o">=</span> <span class="n">manager</span>
        <span class="c1"># Ensure basecoords consistency</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">verts_from_bbox</span><span class="p">(</span><span class="n">vt</span><span class="o">.</span><span class="n">bbox_from_verts</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">))</span>
        <span class="c1"># poly.basecoords = poly.xy</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">is_orig</span> <span class="o">=</span> <span class="n">is_orig</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">valid_species</span> <span class="o">=</span> <span class="n">valid_species</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">tab_list</span> <span class="o">=</span> <span class="n">valid_species</span>
        <span class="c1"># put in previous text and tabcomplete list for autocompletion</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">tctext</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">tcindex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">anchor_idx</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">child_polys</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Display stuff that should be removed from constructor</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">xy</span> <span class="o">=</span> <span class="n">calc_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">_make_lines</span><span class="p">(</span><span class="n">line_color</span><span class="p">,</span> <span class="n">line_width</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">_make_handle_line</span><span class="p">()</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">axes_init</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

<div class="viewcode-block" id="AnnotPoly.axes_init"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.axes_init">[docs]</a>    <span class="k">def</span> <span class="nf">axes_init</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="n">species</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">species</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">metadata</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">LazyDict</span><span class="p">):</span>
            <span class="n">metadata_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_subset</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="o">.</span><span class="n">cached_keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metadata_</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="c1"># tagpos[0], tagpos[1],</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">species</span><span class="p">,</span>
            <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">},</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">metadata_tag</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="c1"># tagpos[0] + 5, tagpos[1] + 80,</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">metadata_</span><span class="p">,</span> <span class="n">nobr</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">},</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># ???</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>  <span class="c1"># eliminate &quot;leftover&quot; copies</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">metadata_tag</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">update_display_coords</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotPoly.move_to_back"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.move_to_back">[docs]</a>    <span class="k">def</span> <span class="nf">move_to_back</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
        <span class="c1"># FIXME: doesnt work exactly</span>
        <span class="c1"># Probalby need to do in the context of other polys</span>
        <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__nice__</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;(num=</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>

<div class="viewcode-block" id="AnnotPoly.add_to_axis"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.add_to_axis">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_axis</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">handle</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotPoly.remove_from_axis"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.remove_from_axis">[docs]</a>    <span class="k">def</span> <span class="nf">remove_from_axis</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotPoly.draw_self"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.draw_self">[docs]</a>    <span class="k">def</span> <span class="nf">draw_self</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">show_species_tags</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">editable</span> <span class="ow">and</span> <span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">get_marker</span><span class="p">():</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">set_marker</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">editable</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">get_marker</span><span class="p">():</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">set_marker</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">editable</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">handle</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">editable</span> <span class="ow">and</span> <span class="n">show_species_tags</span><span class="p">:</span>
            <span class="c1"># Hack to fix matplotlib 1.5 bug</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">metadata_tag</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">metadata_tag</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_make_lines</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">line_color</span><span class="p">,</span> <span class="n">line_width</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; verts - list of (x, y) tuples &quot;&quot;&quot;</span>
        <span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">))</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line_color</span><span class="p">)</span>
        <span class="n">marker_face_color</span> <span class="o">=</span> <span class="n">line_color</span>
        <span class="n">line_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="n">line_width</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="s1">&#39;mfc&#39;</span><span class="p">:</span> <span class="n">marker_face_color</span><span class="p">}</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
            <span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">animated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">line_kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">_make_handle_line</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
        <span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">poly</span><span class="o">.</span><span class="n">calc_handle_display_coords</span><span class="p">()))</span>
        <span class="n">line_width</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">line_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line_color</span><span class="p">)</span>
        <span class="n">marker_face_color</span> <span class="o">=</span> <span class="n">line_color</span>
        <span class="n">line_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="n">line_width</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="s1">&#39;mfc&#39;</span><span class="p">:</span> <span class="n">marker_face_color</span><span class="p">}</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
            <span class="n">_xs</span><span class="p">,</span> <span class="n">_ys</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">animated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">line_kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

<div class="viewcode-block" id="AnnotPoly.calc_tag_position"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.calc_tag_position">[docs]</a>    <span class="k">def</span> <span class="nf">calc_tag_position</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.plottool.interact_annotations --test-calc_tag_position --show</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from wbia.plottool.interact_annotations import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; poly = ut.DynStruct()</span>
<span class="sd">            &gt;&gt;&gt; poly.basecoords = vt.verts_from_bbox([0, 0, 400, 400], True)</span>
<span class="sd">            &gt;&gt;&gt; poly.theta = 0</span>
<span class="sd">            &gt;&gt;&gt; poly.xy = vt.verts_from_bbox([0, 0, 400, 400], True)</span>
<span class="sd">            &gt;&gt;&gt; tagpos = poly.calc_tag_position()</span>
<span class="sd">            &gt;&gt;&gt; print(&#39;tagpos = %r&#39; % (tagpos,))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">))[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">))[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="p">]</span>
        <span class="n">tagpos</span> <span class="o">=</span> <span class="n">rotate_points_around</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="o">*</span><span class="n">points_center</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tagpos</span></div>

<div class="viewcode-block" id="AnnotPoly.calc_handle_display_coords"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.calc_handle_display_coords">[docs]</a>    <span class="k">def</span> <span class="nf">calc_handle_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
        <span class="n">img_h</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">handle_length</span> <span class="o">=</span> <span class="n">img_h</span> <span class="o">//</span> <span class="mi">32</span>
        <span class="c1"># MIN_HANDLE_LENGTH = 25</span>
        <span class="c1"># handle_length = MIN_HANDLE_LENGTH</span>
        <span class="c1"># handle_length = max(MIN_HANDLE_LENGTH, (h / 4))</span>
        <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">points_center</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">get_pointset_extent_wh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">))</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">cx</span><span class="p">,</span> <span class="p">(</span><span class="n">cy</span> <span class="o">-</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># start at top edge</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">handle_length</span><span class="p">)</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">rotate_points_around</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pts</span></div>

<div class="viewcode-block" id="AnnotPoly.update_color"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.update_color">[docs]</a>    <span class="k">def</span> <span class="nf">update_color</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">selected</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">editing_parts</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">editing_parts</span><span class="p">:</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">PINK</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">selected</span><span class="p">:</span>
            <span class="c1"># Add selected color</span>
            <span class="n">sel_color</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">ORANGE</span> <span class="k">if</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_orig</span> <span class="k">else</span> <span class="n">df2</span><span class="o">.</span><span class="n">LIGHT_BLUE</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">sel_color</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">lines</span>
            <span class="n">line_color</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
            <span class="n">desel_color</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">WHITE</span> <span class="k">if</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_orig</span> <span class="k">else</span> <span class="n">df2</span><span class="o">.</span><span class="n">LIGHTGRAY</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">line_color</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">desel_color</span><span class="p">)):</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">desel_color</span><span class="p">))</span></div>

<div class="viewcode-block" id="AnnotPoly.update_lines"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.update_lines">[docs]</a>    <span class="k">def</span> <span class="nf">update_lines</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)))</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">poly</span><span class="o">.</span><span class="n">calc_handle_display_coords</span><span class="p">())))</span></div>

<div class="viewcode-block" id="AnnotPoly.set_species"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.set_species">[docs]</a>    <span class="k">def</span> <span class="nf">set_species</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">tctext</span> <span class="o">=</span> <span class="n">text</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotPoly.increment_species"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.increment_species">[docs]</a>    <span class="k">def</span> <span class="nf">increment_species</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">tab_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tci</span> <span class="o">=</span> <span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">tcindex</span> <span class="o">+</span> <span class="n">amount</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">tab_list</span><span class="p">)</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">tcindex</span> <span class="o">=</span> <span class="n">tci</span>
            <span class="c1"># All tab is going to do is go through the possibilities</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">tab_list</span><span class="p">[</span><span class="n">poly</span><span class="o">.</span><span class="n">tcindex</span><span class="p">])</span></div>

<div class="viewcode-block" id="AnnotPoly.resize_poly"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.resize_poly">[docs]</a>    <span class="k">def</span> <span class="nf">resize_poly</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resize a rectangle using idx as the given anchor point. Respects</span>
<span class="sd">        current rotation.</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.plottool.interact_annotations --exec-resize_poly --show</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from wbia.plottool.interact_annotations import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; (h, w) = img.shape[0:2]</span>
<span class="sd">            &gt;&gt;&gt; x1, y1 = 10, 10</span>
<span class="sd">            &gt;&gt;&gt; x2, y2 = w - 10,  h - 10</span>
<span class="sd">            &gt;&gt;&gt; coords = ((x1, y1), (x1, y2), (x2, y2), (x2, y1))</span>
<span class="sd">            &gt;&gt;&gt; x = 3 * w / 4</span>
<span class="sd">            &gt;&gt;&gt; y = 3 * h / 4</span>
<span class="sd">            &gt;&gt;&gt; idx = 3</span>
<span class="sd">            &gt;&gt;&gt; resize_poly(poly, x, y, idx)</span>
<span class="sd">            &gt;&gt;&gt; update_UI()</span>
<span class="sd">            &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">            &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: allow resize by middle click to scale from the center</span>
        <span class="c1"># the minus one is because the last coordinate is duplicated (by</span>
        <span class="c1"># matplotlib) to get a closed polygon</span>
        <span class="n">tmpcoords</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">)</span>
        <span class="n">previdx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">)</span>
        <span class="n">nextidx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">)</span>
        <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">-</span> <span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Fudge factor is due to gravity vectors constants</span>
        <span class="n">fudge_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">*</span> <span class="n">TAU</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="n">poly_theta</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span> <span class="o">+</span> <span class="n">fudge_factor</span>

        <span class="n">polar_idx2prev</span> <span class="o">=</span> <span class="n">polarDelta</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">tmpcoords</span><span class="p">[</span><span class="n">previdx</span><span class="p">])</span>
        <span class="n">polar_idx2next</span> <span class="o">=</span> <span class="n">polarDelta</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">tmpcoords</span><span class="p">[</span><span class="n">nextidx</span><span class="p">])</span>
        <span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span>
        <span class="n">mag_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">((</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">))</span>
        <span class="n">theta_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">theta_rot</span> <span class="o">=</span> <span class="n">theta_delta</span> <span class="o">-</span> <span class="p">(</span><span class="n">poly_theta</span> <span class="o">+</span> <span class="n">TAU</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">rotx</span> <span class="o">=</span> <span class="n">mag_delta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rot</span><span class="p">)</span>
        <span class="n">roty</span> <span class="o">=</span> <span class="n">mag_delta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_rot</span><span class="p">)</span>
        <span class="n">polar_idx2prev</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">rotx</span>
        <span class="n">polar_idx2next</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">roty</span>
        <span class="n">tmpcoords</span><span class="p">[</span><span class="n">previdx</span><span class="p">]</span> <span class="o">=</span> <span class="n">apply_polarDelta</span><span class="p">(</span><span class="n">polar_idx2prev</span><span class="p">,</span> <span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">tmpcoords</span><span class="p">[</span><span class="n">nextidx</span><span class="p">]</span> <span class="o">=</span> <span class="n">apply_polarDelta</span><span class="p">(</span><span class="n">polar_idx2next</span><span class="p">,</span> <span class="n">tmpcoords</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

        <span class="c1"># rotate the points by -theta to get the &quot;unrotated&quot; points for use as</span>
        <span class="c1"># basecoords</span>
        <span class="n">tmpcoords</span> <span class="o">=</span> <span class="n">rotate_points_around</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">,</span> <span class="o">-</span><span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="o">*</span><span class="n">points_center</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">))</span>
        <span class="c1"># ensure the poly is closed, matplotlib might do this, but I&#39;m not sure</span>
        <span class="c1"># if it preserves the ordering we depend on, even if it does add the</span>
        <span class="c1"># point</span>
        <span class="n">tmpcoords</span> <span class="o">=</span> <span class="n">tmpcoords</span><span class="p">[:]</span> <span class="o">+</span> <span class="p">[</span><span class="n">tmpcoords</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="n">dispcoords</span> <span class="o">=</span> <span class="n">calc_display_coords</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">check_valid_coords</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">dispcoords</span><span class="p">)</span> <span class="ow">and</span> <span class="n">check_min_wh</span><span class="p">(</span><span class="n">tmpcoords</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span> <span class="o">=</span> <span class="n">tmpcoords</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">update_display_coords</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotPoly.rotate_poly"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.rotate_poly">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_poly</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="n">coords_lis</span> <span class="o">=</span> <span class="n">calc_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span> <span class="o">+</span> <span class="n">dtheta</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_valid_coords</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">coords_lis</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">theta</span> <span class="o">+=</span> <span class="n">dtheta</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">update_display_coords</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotPoly.move_poly"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.move_poly">[docs]</a>    <span class="k">def</span> <span class="nf">move_poly</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="n">new_coords</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">]</span>
        <span class="n">coords_list</span> <span class="o">=</span> <span class="n">calc_display_coords</span><span class="p">(</span><span class="n">new_coords</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_valid_coords</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">coords_list</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span> <span class="o">=</span> <span class="n">new_coords</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">update_display_coords</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotPoly.update_display_coords"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.update_display_coords">[docs]</a>    <span class="k">def</span> <span class="nf">update_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">xy</span> <span class="o">=</span> <span class="n">calc_display_coords</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">tag_pos</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">calc_tag_position</span><span class="p">()</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">tag_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">tag_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">metadata_tag</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">tag_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">tag_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">))</span></div>

<div class="viewcode-block" id="AnnotPoly.print_info"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.print_info">[docs]</a>    <span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;poly = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">poly</span><span class="p">,))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;poly.tag_text = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">(),))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;poly.metadata = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">metadata</span><span class="p">,))</span></div>

<div class="viewcode-block" id="AnnotPoly.get_poly_mask"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.get_poly_mask">[docs]</a>    <span class="k">def</span> <span class="nf">get_poly_mask</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[:</span><span class="n">h</span><span class="p">,</span> <span class="p">:</span><span class="n">w</span><span class="p">]</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">xy</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">contains_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="c1"># mask = nxutils.points_inside_poly(points, verts)</span>
        <span class="k">return</span> <span class="n">mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotPoly.is_near_handle"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotPoly.is_near_handle">[docs]</a>    <span class="k">def</span> <span class="nf">is_near_handle</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">xy_pt</span><span class="p">,</span> <span class="n">max_dist</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">calc_handle_display_coords</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">is_within_distance_from_line</span><span class="p">(</span><span class="n">xy_pt</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">max_dist</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">vt</span><span class="o">.</span><span class="n">bbox_from_verts</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span></div>


<div class="viewcode-block" id="AnnotationInteraction"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction">[docs]</a><span class="nd">@six</span><span class="o">.</span><span class="n">add_metaclass</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ReloadingMetaclass</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AnnotationInteraction</span><span class="p">(</span><span class="n">abstract_interaction</span><span class="o">.</span><span class="n">AbstractInteraction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An interactive polygon editor.</span>

<span class="sd">    SeeAlso:</span>
<span class="sd">        wbia.viz.interact.interact_annotations2</span>
<span class="sd">        (ensure that any updates here are propogated there)</span>

<span class="sd">    Args:</span>
<span class="sd">        verts_list (list) : list of lists of (float, float)</span>
<span class="sd">            List of (x, y) coordinates used as vertices of the polygon.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># --- Initialization and Figure Widgets</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img</span><span class="p">,</span>
        <span class="n">img_ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">commit_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verts_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">bbox_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">theta_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">species_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">line_width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">line_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">face_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">default_species</span><span class="o">=</span><span class="n">DEFAULT_SPECIES_TAG</span><span class="p">,</span>
        <span class="n">next_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prev_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">do_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">valid_species</span><span class="o">=</span><span class="p">[],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AnnotationInteraction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">valid_species</span> <span class="o">=</span> <span class="n">valid_species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commit_callback</span> <span class="o">=</span> <span class="n">commit_callback</span>  <span class="c1"># commit_callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">but_width</span> <span class="o">=</span> <span class="mf">0.14</span>
        <span class="c1"># self.but_height = .08</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_prev_but_height</span> <span class="o">=</span> <span class="mf">0.08</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">but_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_prev_but_height</span> <span class="o">-</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_funcs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;close_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_close</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;draw_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_callback</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_click</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_click_release</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;figure_leave_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_figure_leave</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_key_press</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_motion</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;pick_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_pick</span><span class="p">),</span>
                <span class="c1"># (&#39;resize_event&#39;, self.on_resize),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_callback_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_species_tags</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="k">def</span> <span class="nf">_reinitialize_variables</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_mask</span> <span class="o">=</span> <span class="n">do_mask</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_ind</span> <span class="o">=</span> <span class="n">img_ind</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_tag</span> <span class="o">=</span> <span class="n">default_species</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showverts</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc_default</span> <span class="o">=</span> <span class="n">face_color</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># mouse X coordinate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># mouse Y coordinate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ind_xy</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_autoinc_polynum</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># num polys in image</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># if any poly is active</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># active polygon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_poly</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># level of parts heirarchy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Ensure nothing is down</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_mouse_state</span><span class="p">()</span>

        <span class="n">_reinitialize_variables</span><span class="p">()</span>
        <span class="c1"># hack involving exploting lexical scoping to save defaults for a</span>
        <span class="c1"># restore operation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reinitialize_variables</span> <span class="o">=</span> <span class="n">_reinitialize_variables</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fnum</span><span class="p">,</span> <span class="n">doclf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">docla</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">df2</span><span class="o">.</span><span class="n">close_figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fnum</span><span class="p">,</span> <span class="n">doclf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">docla</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reinitialize_figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fnum</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">verts_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">bbox_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;only one can be specified&#39;</span>
        <span class="c1"># bbox_list will get converted to verts_list</span>
        <span class="k">if</span> <span class="n">verts_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bbox_list</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">bboxes_from_vert_list</span><span class="p">(</span><span class="n">verts_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bbox_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">verts_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">vt</span><span class="o">.</span><span class="n">verts_from_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">bbox_list</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">theta_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">theta_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">verts_list</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">species_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species_tag</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">verts_list</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">metadata_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">verts_list</span><span class="p">]</span>

        <span class="c1"># Create the list of polygons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_polygon_creation</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">,</span> <span class="n">metadata_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the active vert</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_rotate_poly</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_callback_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_mpl_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_action_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_callbacks</span><span class="p">(</span><span class="n">next_callback</span><span class="p">,</span> <span class="n">prev_callback</span><span class="p">)</span>

<div class="viewcode-block" id="AnnotationInteraction.reinitialize_figure"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.reinitialize_figure">[docs]</a>    <span class="k">def</span> <span class="nf">reinitialize_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="c1"># self.fig.cla()</span>
        <span class="c1"># ut.qflag()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnum</span> <span class="o">=</span> <span class="n">fnum</span>
        <span class="c1"># print(self.fnum)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="c1"># self.fig.ax = ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">remove_patches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s1">&#39;Click and drag to select/move/resize/orient an ANNOTATION&#39;</span><span class="p">,</span>
                        <span class="c1">#&#39;Press enter to clear the species tag of the selected ANNOTATION&#39;,</span>
                        <span class="s1">&#39;Press tab to cycle through annotation species&#39;</span><span class="p">,</span>
                        <span class="c1">#&#39;Type to edit the ANNOTATION species (press tab to autocomplete)&#39;</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="AnnotationInteraction.add_action_buttons"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.add_action_buttons">[docs]</a>    <span class="k">def</span> <span class="nf">add_action_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_button</span><span class="p">(</span>
            <span class="s1">&#39;Add Annotation</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">pretty_hotkey_map</span><span class="p">(</span><span class="n">ADD_RECTANGLE_HOTKEY</span><span class="p">),</span>
            <span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_height</span><span class="p">],</span>
            <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_new_poly</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># self.append_button(</span>
        <span class="c1">#     &#39;Add Full Annotation\n&#39; + pretty_hotkey_map(ADD_RECTANGLE_FULL_HOTKEY),</span>
        <span class="c1">#     rect=[0.34, 0.015, self.but_width, self.but_height],</span>
        <span class="c1">#     callback=ut.partial(self.add_new_poly, full=True)</span>
        <span class="c1"># )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_button</span><span class="p">(</span>
            <span class="s1">&#39;Delete Annotation</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">pretty_hotkey_map</span><span class="p">(</span><span class="n">DEL_RECTANGLE_HOTKEY</span><span class="p">),</span>
            <span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_height</span><span class="p">],</span>
            <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_current_poly</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_button</span><span class="p">(</span>
            <span class="s1">&#39;Save and Exit</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">pretty_hotkey_map</span><span class="p">(</span><span class="n">ACCEPT_SAVE_HOTKEY</span><span class="p">),</span>
            <span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mf">0.66</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_height</span><span class="p">],</span>
            <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save_and_exit</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="AnnotationInteraction.disconnect_mpl_callbacks"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.disconnect_mpl_callbacks">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect_mpl_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; disconnects all connected matplotlib callbacks &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">callbackid</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mpl_callback_ids</span><span class="p">):</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="n">callbackid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_callback_ids</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="AnnotationInteraction.connect_mpl_callbacks"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.connect_mpl_callbacks">[docs]</a>    <span class="k">def</span> <span class="nf">connect_mpl_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; disconnects matplotlib callbacks specified in the</span>
<span class="sd">        self.mpl_callback_ids dict &quot;&quot;&quot;</span>
        <span class="c1"># http://matplotlib.org/1.3.1/api/backend_bases_api.html</span>
        <span class="c1"># Create callback ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_mpl_callbacks</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_callback_ids</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_funcs</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span></div>

    <span class="c1"># --- Updates</span>

<div class="viewcode-block" id="AnnotationInteraction.update_callbacks"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.update_callbacks">[docs]</a>    <span class="k">def</span> <span class="nf">update_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_callback</span><span class="p">,</span> <span class="n">prev_callback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_callback</span> <span class="o">=</span> <span class="n">prev_callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_callback</span> <span class="o">=</span> <span class="n">next_callback</span>
        <span class="c1"># Hack because the callbacks actually need to be wrapped</span>
        <span class="n">_next_callback</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_callback</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_image</span>
        <span class="n">_prev_callback</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_callback</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_button</span><span class="p">(</span>
            <span class="s1">&#39;Previous Image</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">pretty_hotkey_map</span><span class="p">(</span><span class="n">PREV_IMAGE_HOTKEYS</span><span class="p">),</span>
            <span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_prev_but_height</span><span class="p">],</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">_prev_callback</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_button</span><span class="p">(</span>
            <span class="s1">&#39;Next Image</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">pretty_hotkey_map</span><span class="p">(</span><span class="n">NEXT_IMAGE_HOTKEYS</span><span class="p">),</span>
            <span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mf">0.82</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_prev_but_height</span><span class="p">],</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">_next_callback</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="AnnotationInteraction.update_image_and_callbacks"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.update_image_and_callbacks">[docs]</a>    <span class="k">def</span> <span class="nf">update_image_and_callbacks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img</span><span class="p">,</span>
        <span class="n">bbox_list</span><span class="p">,</span>
        <span class="n">theta_list</span><span class="p">,</span>
        <span class="n">species_list</span><span class="p">,</span>
        <span class="n">metadata_list</span><span class="p">,</span>
        <span class="n">next_callback</span><span class="p">,</span>
        <span class="n">prev_callback</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_mpl_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polys</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reinitialize_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reinitialize_figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fnum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_polygon_creation</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">,</span> <span class="n">metadata_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_action_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_mpl_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_callbacks</span><span class="p">(</span><span class="n">next_callback</span><span class="p">,</span> <span class="n">prev_callback</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] drawing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_UI</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_update_poly_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uneditable_polys</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">update_color</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">poly</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="n">ind</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="n">poly</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span>
            <span class="n">editing_parts</span> <span class="o">=</span> <span class="n">poly</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_poly</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">update_color</span><span class="p">(</span><span class="n">selected</span><span class="p">,</span> <span class="n">editing_parts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_poly_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uneditable_polys</span><span class="p">):</span>
            <span class="c1"># self.last_vert_ind = len(poly.xy) - 1</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">update_lines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_vert_ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">update_lines</span><span class="p">()</span>

<div class="viewcode-block" id="AnnotationInteraction.update_UI"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.update_UI">[docs]</a>    <span class="k">def</span> <span class="nf">update_UI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_poly_lines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_poly_colors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_artists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotationInteraction.draw_artists"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.draw_artists">[docs]</a>    <span class="k">def</span> <span class="nf">draw_artists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uneditable_polys</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">draw_self</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">draw_self</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_species_tags</span><span class="p">)</span></div>

    <span class="c1"># --- Data Matainence / Other</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uneditable_polys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_edit_parts_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_poly</span><span class="o">.</span><span class="n">num</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_poly</span><span class="p">}</span>
            <span class="c1"># return self.polys</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">editable_polys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># return self.polys</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_edit_parts_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_poly</span><span class="o">.</span><span class="n">child_polys</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">polys</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polys</span>

<div class="viewcode-block" id="AnnotationInteraction.get_poly_under_cursor"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.get_poly_under_cursor">[docs]</a>    <span class="k">def</span> <span class="nf">get_poly_under_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the index of the vertex under cursor if within max_dist tolerance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Remove any deleted polygons</span>
        <span class="n">poly_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">poly_inds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">poly_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">poly_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">poly_dict</span><span class="p">,</span> <span class="n">poly_inds</span><span class="p">)</span>
            <span class="c1"># Put polygon coords into figure space</span>
            <span class="n">poly_pts</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">poly</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">))</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">poly_list</span>
            <span class="p">]</span>
            <span class="c1"># Find the nearest vertex from the annotations</span>
            <span class="n">ind_dist_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">vt</span><span class="o">.</span><span class="n">nearest_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">polypts</span><span class="p">)</span> <span class="k">for</span> <span class="n">polypts</span> <span class="ow">in</span> <span class="n">poly_pts</span><span class="p">]</span>
            <span class="n">dist_lists</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">ind_dist_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">min_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dist_lists</span><span class="p">)</span>
            <span class="n">sel_polyind</span> <span class="o">=</span> <span class="n">poly_inds</span><span class="p">[</span><span class="n">min_idx</span><span class="p">]</span>
            <span class="n">sel_vertx</span><span class="p">,</span> <span class="n">sel_dist</span> <span class="o">=</span> <span class="n">ind_dist_list</span><span class="p">[</span><span class="n">min_idx</span><span class="p">]</span>
            <span class="c1"># Ensure nearest distance is within threshold</span>
            <span class="k">if</span> <span class="n">sel_dist</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span> <span class="o">**</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">sel_polyind</span><span class="p">,</span> <span class="n">sel_vertx</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sel_polyind</span><span class="p">,</span> <span class="n">sel_vertx</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sel_polyind</span><span class="p">,</span> <span class="n">sel_vertx</span></div>

<div class="viewcode-block" id="AnnotationInteraction.get_most_recently_added_poly"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.get_most_recently_added_poly">[docs]</a>    <span class="k">def</span> <span class="nf">get_most_recently_added_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># most recently added polygon has the highest index</span>
            <span class="n">poly_ind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="p">[</span><span class="n">poly_ind</span><span class="p">]</span></div>

<div class="viewcode-block" id="AnnotationInteraction.new_polygon"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.new_polygon">[docs]</a>    <span class="k">def</span> <span class="nf">new_polygon</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">verts</span><span class="p">,</span>
        <span class="n">theta</span><span class="p">,</span>
        <span class="n">species</span><span class="p">,</span>
        <span class="n">fc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">line_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">line_width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">is_orig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; verts - list of (x, y) tuples &quot;&quot;&quot;</span>
        <span class="c1"># create new polygon from verts</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_autoinc_polynum</span><span class="p">)</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">AnnotPoly</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
            <span class="n">verts</span><span class="o">=</span><span class="n">verts</span><span class="p">,</span>
            <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span>
            <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
            <span class="n">fc</span><span class="o">=</span><span class="n">fc</span><span class="p">,</span>
            <span class="n">line_color</span><span class="o">=</span><span class="n">line_color</span><span class="p">,</span>
            <span class="n">line_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">,</span>
            <span class="n">is_orig</span><span class="o">=</span><span class="n">is_orig</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">valid_species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_species</span><span class="p">,</span>
            <span class="n">manager</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">set_picker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_poly_pickable</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">poly</span></div>

<div class="viewcode-block" id="AnnotationInteraction.handle_polygon_creation"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.handle_polygon_creation">[docs]</a>    <span class="k">def</span> <span class="nf">handle_polygon_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">,</span> <span class="n">metadata_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Maintain original input &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">bbox_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">theta_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">theta_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">species_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">))]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta_list</span><span class="p">),</span> <span class="s1">&#39;inconconsitent data1&#39;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_list</span><span class="p">),</span> <span class="s1">&#39;inconconsitent data2&#39;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadata_list</span><span class="p">),</span> <span class="s1">&#39;inconconsitent data2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_bbox_list</span> <span class="o">=</span> <span class="n">bbox_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_theta_list</span> <span class="o">=</span> <span class="n">theta_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_species_list</span> <span class="o">=</span> <span class="n">species_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_metadata_list</span> <span class="o">=</span> <span class="n">metadata_list</span>
        <span class="c1"># Convert bbox to verticies</span>
        <span class="n">verts_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">vt</span><span class="o">.</span><span class="n">verts_from_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">bbox_list</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">verts</span> <span class="ow">in</span> <span class="n">verts_list</span><span class="p">:</span>
            <span class="n">verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="n">verts</span><span class="p">:</span>
                <span class="n">enforce_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">vert</span><span class="p">)</span>
        <span class="c1"># Create polygons</span>
        <span class="n">poly_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_polygon</span><span class="p">(</span><span class="n">verts_</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">is_orig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">verts_</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">verts_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">,</span> <span class="n">metadata_list</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polys</span> <span class="o">=</span> <span class="p">{</span><span class="n">poly</span><span class="o">.</span><span class="n">num</span><span class="p">:</span> <span class="n">poly</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">poly_list</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Select poly with largest area</span>
            <span class="n">wh_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">poly</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">)])</span>
            <span class="n">poly_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">wh_list</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">[</span><span class="n">poly_index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_poly_colors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_poly_lines</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Add polygons to the axis</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">add_to_axis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span></div>
        <span class="c1"># Give polygons mpl change callbacks</span>
        <span class="c1"># for poly in six.itervalues(self.polys):</span>
        <span class="c1">#    poly.add_callback(self.poly_changed)</span>

    <span class="c1"># --- Actions</span>

<div class="viewcode-block" id="AnnotationInteraction.add_new_poly"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.add_new_poly">[docs]</a>    <span class="k">def</span> <span class="nf">add_new_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a new annotation to the image &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">defaultshape_polys</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">num</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">defaultshape_polys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">default_vertices</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">defaultshape_polys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span>
            <span class="p">)</span>

        <span class="n">poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_polygon</span><span class="p">(</span><span class="n">verts</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species_tag</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_poly</span>

        <span class="c1"># Add to the correct place in current heirarchy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="p">[</span><span class="n">poly</span><span class="o">.</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">poly</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">add_to_axis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>

        <span class="c1"># self.polys[poly.num] = poly</span>

        <span class="c1"># poly.add_callback(self.poly_changed)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the active vert</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_most_recently_added_poly</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_poly_lines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_poly_colors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotationInteraction.delete_current_poly"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.delete_current_poly">[docs]</a>    <span class="k">def</span> <span class="nf">delete_current_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes an annotation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] No polygon selected to delete&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] delete annot&#39;</span><span class="p">)</span>
            <span class="n">poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span>
            <span class="c1"># self.polys.pop(poly.num)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="p">[</span><span class="n">poly</span><span class="o">.</span><span class="n">num</span><span class="p">]</span>
            <span class="c1"># remove the poly from the figure itself</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">remove_from_axis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
            <span class="c1"># reset anything that has to do with current poly</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_most_recently_added_poly</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_poly_colors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotationInteraction.edit_poly_parts"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.edit_poly_parts">[docs]</a>    <span class="k">def</span> <span class="nf">edit_poly_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poly</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">poly</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_poly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_poly</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.parent_poly = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_poly</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_poly</span> <span class="o">=</span> <span class="n">poly</span>
        <span class="k">if</span> <span class="n">poly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_most_recently_added_poly</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self._selected_poly = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">poly</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">vt</span><span class="o">.</span><span class="n">convert_colorspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="s1">&#39;RGB&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Mask the part of the image not belonging to the annotation</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">get_poly_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">masked_img</span> <span class="o">=</span> <span class="n">apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">vt</span><span class="o">.</span><span class="n">convert_colorspace</span><span class="p">(</span><span class="n">masked_img</span><span class="p">,</span> <span class="s1">&#39;RGB&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_poly_colors</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">in_edit_parts_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_poly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<div class="viewcode-block" id="AnnotationInteraction.toggle_species_label"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.toggle_species_label">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_species_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] toggle_species_label()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_species_tags</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_species_tags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_UI</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotationInteraction.save_and_exit"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.save_and_exit">[docs]</a>    <span class="k">def</span> <span class="nf">save_and_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">do_close</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The Save and Exit Button</span>

<span class="sd">        write a callback to redraw viz for bbox_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] Pressed Accept Button&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_get_annottup_list</span><span class="p">():</span>
            <span class="n">annottup_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">indices_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># theta_list = []</span>
            <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">poly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">num</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">vt</span><span class="o">.</span><span class="n">bbox_from_verts</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">basecoords</span><span class="p">)))</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">theta</span>
                <span class="n">species</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">species_tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                <span class="n">annottup</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>
                <span class="n">indices_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">annottup_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annottup</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">indices_list</span><span class="p">,</span> <span class="n">annottup_list</span>

        <span class="k">def</span> <span class="nf">_send_back_annotations</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] _send_back_annotations&#39;</span><span class="p">)</span>
            <span class="n">indices_list</span><span class="p">,</span> <span class="n">annottup_list</span> <span class="o">=</span> <span class="n">_get_annottup_list</span><span class="p">()</span>
            <span class="c1"># Delete if index is in original_indices but no in indices_list</span>
            <span class="n">deleted_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_indices</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">indices_list</span><span class="p">))</span>
            <span class="n">changed_indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">unchanged_indices</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># sanity check</span>
            <span class="n">changed_annottups</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">new_annottups</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">original_annottup_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_bbox_list</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_theta_list</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_species_list</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">annottup</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indices_list</span><span class="p">,</span> <span class="n">annottup_list</span><span class="p">):</span>
                <span class="c1"># If the index is not in the originals then it is new</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_indices</span><span class="p">:</span>
                    <span class="n">new_annottups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annottup</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">annottup</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">original_annottup_list</span><span class="p">:</span>
                        <span class="n">changed_annottups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annottup</span><span class="p">)</span>
                        <span class="n">changed_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">unchanged_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commit_callback</span><span class="p">(</span>
                <span class="n">unchanged_indices</span><span class="p">,</span>
                <span class="n">deleted_indices</span><span class="p">,</span>
                <span class="n">changed_indices</span><span class="p">,</span>
                <span class="n">changed_annottups</span><span class="p">,</span>
                <span class="n">new_annottups</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_send_back_annotations</span><span class="p">()</span>
        <span class="c1"># Make mask from selection</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_mask</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">mask_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">poly</span><span class="o">.</span><span class="n">get_poly_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polys</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] No polygons to make mask out of&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">mask_</span> <span class="ow">in</span> <span class="n">mask_list</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask_</span><span class="p">)</span>
            <span class="c1"># mask = self.get_poly_mask()</span>
            <span class="c1"># User must close previous figure</span>
            <span class="c1"># Modify the image with the mask</span>
            <span class="n">masked_img</span> <span class="o">=</span> <span class="n">apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
            <span class="c1"># show the modified image</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">masked_img</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Region outside of mask is darkened&#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] Accept Over&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_close</span><span class="p">:</span>
            <span class="n">df2</span><span class="o">.</span><span class="n">close_figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span></div>

    <span class="c1"># --- Connected Slots and Callbacks</span>

<div class="viewcode-block" id="AnnotationInteraction.next_image"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.next_image">[docs]</a>    <span class="k">def</span> <span class="nf">next_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_callback</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotationInteraction.prev_image"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.prev_image">[docs]</a>    <span class="k">def</span> <span class="nf">prev_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_callback</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotationInteraction.start"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># FIXME: conform to abstract_interaction start conventions</span>
        <span class="c1"># self._ensure_running()</span>
        <span class="c1"># self.show_page()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotationInteraction.show"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bring_to_front</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotationInteraction.draw_callback"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.draw_callback">[docs]</a>    <span class="k">def</span> <span class="nf">draw_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_from_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_artists</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_show_poly_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_make_options</span><span class="p">():</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">metadata</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">options</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="c1"># (&#39;Foo: &#39;,  ut.partial(print, &#39;bar&#39;)),</span>
                <span class="c1"># (&#39;Move to back &#39;,  self._selected_poly.move_to_back),</span>
                <span class="p">(</span><span class="s1">&#39;PolyInfo: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">print_info</span><span class="p">),</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">LazyDict</span><span class="p">):</span>
                <span class="n">options</span> <span class="o">+=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">nocache_eval</span><span class="p">(</span><span class="s1">&#39;annot_context_options&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">options</span>

        <span class="n">options</span> <span class="o">=</span> <span class="n">_make_options</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup_menu</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

<div class="viewcode-block" id="AnnotationInteraction.is_poly_pickable"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.is_poly_pickable">[docs]</a>    <span class="k">def</span> <span class="nf">is_poly_pickable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="p">:</span>
            <span class="n">mouse_xy</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span>
            <span class="n">hit</span> <span class="o">=</span> <span class="n">artist</span><span class="o">.</span><span class="n">contains_point</span><span class="p">(</span><span class="n">mouse_xy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># import utool</span>
        <span class="c1"># utool.embed()</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dblclick&#39;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">dblclick</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">hit</span><span class="p">,</span> <span class="n">props</span></div>

<div class="viewcode-block" id="AnnotationInteraction.on_pick"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.on_pick">[docs]</a>    <span class="k">def</span> <span class="nf">on_pick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Makes selected polygon translucent &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] on_pick&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span><span class="p">:</span>
            <span class="n">artist</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">artist</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] picked artist = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">artist</span><span class="p">,))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="o">=</span> <span class="n">artist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">dblclick</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_edit_parts_mode</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edit_poly_parts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="p">)</span>
                <span class="k">pass</span></div>
        <span class="c1"># x, y = event.mouseevent.xdata, event.mouseevent.xdata</span>

<div class="viewcode-block" id="AnnotationInteraction.on_click"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.on_click">[docs]</a>    <span class="k">def</span> <span class="nf">on_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        python -m wbia.viz.interact.interact_annotations2 --test-ishow_image2 --show</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AnnotationInteraction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showverts</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] No polygons on screen&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Right click - context menu</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RIGHT_BUTTON</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_poly_context_menu</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c1"># Left click, indicate that a mouse button is down</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">LEFT_BUTTON</span><span class="p">:</span>
            <span class="c1"># if event.dblclick and not self.in_edit_parts_mode:</span>
            <span class="c1">#    # On double click enter a single annotation to annotation parts</span>
            <span class="c1">#    #print(&quot;DOUBLECLICK&quot;)</span>
            <span class="c1">#    #self.edit_poly_parts(self._selected_poly)</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;shift&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_current_rotate_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Determine if we are clicking the rotation line</span>
                <span class="n">mouse_xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_near_handle</span><span class="p">(</span><span class="n">mouse_xy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_current_rotate_poly</span> <span class="o">=</span> <span class="n">poly</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">dblclick</span><span class="p">:</span>
                    <span class="c1"># Reset rotation</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_rotate_poly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_current_rotate_poly</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_current_rotate_poly</span><span class="o">.</span><span class="n">update_display_coords</span><span class="p">()</span>

        <span class="n">polyind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_poly_under_cursor</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">polyind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="p">[</span><span class="n">polyind</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ind_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">anchor_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_poly_colors</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_poly_colors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_poly_lines</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] error: self.background is none.&#39;</span> <span class="s1">&#39; Trying refresh.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_from_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>

        <span class="c1"># Redraw blitted objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_artists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotationInteraction.on_motion"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.on_motion">[docs]</a>    <span class="k">def</span> <span class="nf">on_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] on_motion&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] Got key: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AnnotationInteraction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">on_motion</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c1"># uses boolean punning for terseness</span>
        <span class="n">lastX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="n">lastY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="c1"># Allow for getting coordinates outside the axes</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span>
        <span class="n">mousePos</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">mousePos</span><span class="p">)</span>
        <span class="n">deltaX</span> <span class="o">=</span> <span class="n">lastX</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span> <span class="o">-</span> <span class="n">lastX</span>
        <span class="n">deltaY</span> <span class="o">=</span> <span class="n">lastY</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="o">-</span> <span class="n">lastY</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showverts</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># if self.in_edit_parts_mode:</span>
        <span class="c1">#    return</span>

        <span class="n">quick_resize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MIDDLE_BUTTON</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RIGHT_BUTTON</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">LEFT_BUTTON</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;ctrl&#39;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Resize by dragging corner</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">resize_poly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">anchor_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span>
        <span class="k">elif</span> <span class="n">quick_resize</span><span class="p">:</span>
            <span class="c1"># Quick resize with special click</span>
            <span class="n">anchor_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">anchor_idx</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">anchor_idx</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span>  <span class="c1"># choose opposite anchor point</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">resize_poly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_rotate_poly</span><span class="p">:</span>
            <span class="c1"># Rotate using handle</span>
            <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">points_center</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_rotate_poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">cy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span><span class="p">,</span> <span class="n">cx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">)</span> <span class="o">-</span> <span class="n">TAU</span> <span class="o">/</span> <span class="mi">4</span>
            <span class="n">dtheta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_rotate_poly</span><span class="o">.</span><span class="n">theta</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_rotate_poly</span><span class="o">.</span><span class="n">rotate_poly</span><span class="p">(</span><span class="n">dtheta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">LEFT_BUTTON</span><span class="p">:</span>
            <span class="c1"># Translate by dragging inside annot</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="n">deltaX</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deltaY</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">flag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">move_poly</span><span class="p">(</span><span class="n">deltaX</span><span class="p">,</span> <span class="n">deltaY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_UI</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotationInteraction.on_click_release"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.on_click_release">[docs]</a>    <span class="k">def</span> <span class="nf">on_click_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AnnotationInteraction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">on_click_release</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c1"># if self._poly_held is True:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_current_rotate_poly</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showverts</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">_flag</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span> <span class="ow">is</span> <span class="kc">False</span>
            <span class="ow">or</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_down</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">_flag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># self._selected_poly.set_facecolor(&#39;white&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_UI</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editable_polys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] No polygons on screen&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] WARNING: Polygon unknown.&#39;</span> <span class="s1">&#39; Using default. (2)&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_most_recently_added_poly</span><span class="p">()</span>

        <span class="n">curr_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind_xy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ind_xy</span> <span class="o">-</span> <span class="n">curr_xy</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">):</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotationInteraction.on_figure_leave"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.on_figure_leave">[docs]</a>    <span class="k">def</span> <span class="nf">on_figure_leave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] figure leave&#39;</span><span class="p">)</span>
        <span class="c1"># self.print_status()</span>
        <span class="c1"># self.on_click_release(event)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_held</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_mouse_state</span><span class="p">()</span></div>
        <span class="c1"># self.print_status()</span>

<div class="viewcode-block" id="AnnotationInteraction.on_key_press"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.AnnotationInteraction.on_key_press">[docs]</a>    <span class="k">def</span> <span class="nf">on_key_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] on_key_press&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] Got key: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] Got key: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">ACCEPT_SAVE_HOTKEY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_and_exit</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">ADD_RECTANGLE_HOTKEY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_new_poly</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">ADD_RECTANGLE_FULL_HOTKEY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_new_poly</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">DEL_RECTANGLE_HOTKEY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_current_poly</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">TOGGLE_LABEL_HOTKEY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_species_label</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;escape&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edit_poly_parts</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;^backspace$&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">set_species</span><span class="p">(</span><span class="n">DEFAULT_SPECIES_TAG</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;^tab$&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">increment_species</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^ctrl\+tab$&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_poly</span><span class="o">.</span><span class="n">increment_species</span><span class="p">(</span><span class="n">amount</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># NEXT ANND PREV COMMAND</span>
        <span class="k">def</span> <span class="nf">_matches_hotkey</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">hotkeys</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span>
                <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">hk</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">hk</span> <span class="ow">in</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">hotkeys</span><span class="p">)]</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">_matches_hotkey</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">PREV_IMAGE_HOTKEYS</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_image</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_matches_hotkey</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">NEXT_IMAGE_HOTKEYS</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_image</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div></div>

    <span class="c1"># def poly_changed(self, poly):</span>
    <span class="c1">#    &quot;&quot;&quot; this method is called whenever the polygon object is called &quot;&quot;&quot;</span>
    <span class="c1">#    print(&#39;poly_changed poly=%r&#39; % (poly,))</span>
    <span class="c1">#    # only copy the artist props to the line (except visibility)</span>
    <span class="c1">#    #vis = poly.lines.get_visible()</span>
    <span class="c1">#    #vis = poly.handle.get_visible()</span>
    <span class="c1">#    #poly.lines.set_visible(vis)</span>
    <span class="c1">#    #poly.handle.set_visible(vis)</span>


<div class="viewcode-block" id="pretty_hotkey_map"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.pretty_hotkey_map">[docs]</a><span class="k">def</span> <span class="nf">pretty_hotkey_map</span><span class="p">(</span><span class="n">hotkeys</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">hotkeys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="n">hotkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">hotkeys</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hotkeys</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">hotkeys</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1">#&#39;right&#39;: &#39;right arrow&#39;,</span>
        <span class="c1">#&#39;left&#39;:  &#39;left arrow&#39;,</span>
    <span class="p">}</span>
    <span class="n">mapped_hotkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hk</span><span class="p">,</span> <span class="n">hk</span><span class="p">)</span> <span class="k">for</span> <span class="n">hk</span> <span class="ow">in</span> <span class="n">hotkeys</span><span class="p">]</span>
    <span class="n">hotkey_str</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">conj_phrase</span><span class="p">(</span><span class="n">mapped_hotkeys</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
    <span class="k">return</span> <span class="n">hotkey_str</span></div>


<div class="viewcode-block" id="apply_mask"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.apply_mask">[docs]</a><span class="k">def</span> <span class="nf">apply_mask</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
    <span class="n">masked_img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">masked_img</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">masked_img</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">masked_img</span></div>


<div class="viewcode-block" id="points_center"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.points_center">[docs]</a><span class="k">def</span> <span class="nf">points_center</span><span class="p">(</span><span class="n">pts</span><span class="p">):</span>
    <span class="c1"># the polygons have the first point listed twice in order for them to be</span>
    <span class="c1"># drawn as closed, but that point shouldn&#39;t be counted twice for computing</span>
    <span class="c1"># the center (hence the [:-1] slice)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="rotate_points_around"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.rotate_points_around">[docs]</a><span class="k">def</span> <span class="nf">rotate_points_around</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References:</span>
<span class="sd">        http://www.euclideanspace.com/maths/geometry/affine/aroundPoint/matrix2d/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: Can use vtool for this</span>
    <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>
    <span class="n">augpts</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">array</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">points</span><span class="p">])</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="c1"># correct matrix obtained from</span>
    <span class="n">rot_mat</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">ct</span><span class="p">,</span> <span class="o">-</span><span class="n">st</span><span class="p">,</span> <span class="n">ax</span> <span class="o">-</span> <span class="n">ct</span> <span class="o">*</span> <span class="n">ax</span> <span class="o">+</span> <span class="n">st</span> <span class="o">*</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">ay</span> <span class="o">-</span> <span class="n">st</span> <span class="o">*</span> <span class="n">ax</span> <span class="o">-</span> <span class="n">ct</span> <span class="o">*</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rot_mat</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">augpts</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">]</span></div>


<div class="viewcode-block" id="calc_display_coords"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.calc_display_coords">[docs]</a><span class="k">def</span> <span class="nf">calc_display_coords</span><span class="p">(</span><span class="n">oldcoords</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">rotate_points_around</span><span class="p">(</span><span class="n">oldcoords</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="o">*</span><span class="n">points_center</span><span class="p">(</span><span class="n">oldcoords</span><span class="p">))</span></div>


<div class="viewcode-block" id="polarDelta"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.polarDelta">[docs]</a><span class="k">def</span> <span class="nf">polarDelta</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
    <span class="n">mag</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">L2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">mag</span><span class="p">,</span> <span class="n">theta</span><span class="p">]</span></div>


<div class="viewcode-block" id="apply_polarDelta"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.apply_polarDelta">[docs]</a><span class="k">def</span> <span class="nf">apply_polarDelta</span><span class="p">(</span><span class="n">poldelt</span><span class="p">,</span> <span class="n">cart</span><span class="p">):</span>
    <span class="n">newx</span> <span class="o">=</span> <span class="n">cart</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">poldelt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">poldelt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">newy</span> <span class="o">=</span> <span class="n">cart</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">poldelt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">poldelt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">newx</span><span class="p">,</span> <span class="n">newy</span><span class="p">)</span></div>


<div class="viewcode-block" id="is_within_distance_from_line"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.is_within_distance_from_line">[docs]</a><span class="k">def</span> <span class="nf">is_within_distance_from_line</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">max_dist</span><span class="p">):</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vt</span><span class="o">.</span><span class="n">distance_to_lineseg</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">max_dist</span></div>


<div class="viewcode-block" id="check_min_wh"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.check_min_wh">[docs]</a><span class="k">def</span> <span class="nf">check_min_wh</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Depends on hardcoded indices, which is inelegant, but</span>
<span class="sd">    we&#39;re already depending on those for the FUDGE_FACTORS</span>
<span class="sd">    array above</span>
<span class="sd">    0----1</span>
<span class="sd">    |    |</span>
<span class="sd">    3----2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">MIN_W</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">MIN_H</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="c1"># the seperate 1 and 2 variables are not strictly necessary, but</span>
    <span class="c1"># provide a sanity check to ensure that we&#39;re dealing with the</span>
    <span class="c1"># right shape</span>
    <span class="c1"># w, h = vt.get_pointset_extent_wh(np.array(coords))</span>
    <span class="n">w1</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">w2</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="s1">&#39;w1: </span><span class="si">%r</span><span class="s1">, w2: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">),</span> <span class="s1">&#39;h1: </span><span class="si">%r</span><span class="s1">, h2: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">w1</span><span class="p">,</span> <span class="n">h1</span>
    <span class="c1"># print(&#39;w, h = (%r, %r)&#39; % (w1, h1))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">MIN_W</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">MIN_H</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">)</span></div>


<div class="viewcode-block" id="default_vertices"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.default_vertices">[docs]</a><span class="k">def</span> <span class="nf">default_vertices</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">polys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mouseX</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mouseY</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Default to rectangle that has a quarter-width/height border.&quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># Center the new verts around wherever the mouse is</span>
    <span class="k">if</span> <span class="n">mouseX</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mouseY</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">center_x</span> <span class="o">=</span> <span class="n">mouseX</span>
        <span class="n">center_h</span> <span class="o">=</span> <span class="n">mouseY</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">center_x</span> <span class="o">=</span> <span class="n">w</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">center_h</span> <span class="o">=</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">polys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">polys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Use the largest polygon size as the default verts</span>
        <span class="n">wh_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">vt</span><span class="o">.</span><span class="n">bbox_from_verts</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="n">polys</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="n">w_</span><span class="p">,</span> <span class="n">h_</span> <span class="o">=</span> <span class="n">wh_list</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If no poly exists use 1/4 of the image size</span>
        <span class="n">w_</span><span class="p">,</span> <span class="n">h_</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
    <span class="c1"># Get the x/y extents by offseting the centers</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_x</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
    <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">center_h</span><span class="p">,</span> <span class="n">center_h</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">h_</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
    <span class="c1"># Clip to bounds</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">))</span></div>


<div class="viewcode-block" id="check_valid_coords"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.check_valid_coords">[docs]</a><span class="k">def</span> <span class="nf">check_valid_coords</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">coords_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">check_dims</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xy_pt</span><span class="p">)</span> <span class="k">for</span> <span class="n">xy_pt</span> <span class="ow">in</span> <span class="n">coords_list</span><span class="p">])</span></div>


<div class="viewcode-block" id="check_dims"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.check_dims">[docs]</a><span class="k">def</span> <span class="nf">check_dims</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xy_pt</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    checks if bounding box dims are ok</span>

<span class="sd">    Allow the bounding box to go off the image</span>
<span class="sd">    so orientations can be done correctly</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_out</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">xy_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">margin</span><span class="p">:</span>
        <span class="n">num_out</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">xy_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">margin</span><span class="p">:</span>
        <span class="n">num_out</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">xy_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">margin</span><span class="p">:</span>
        <span class="n">num_out</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">xy_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">margin</span><span class="p">:</span>
        <span class="n">num_out</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">num_out</span> <span class="o">&lt;=</span> <span class="mi">3</span></div>


<div class="viewcode-block" id="enforce_dims"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.enforce_dims">[docs]</a><span class="k">def</span> <span class="nf">enforce_dims</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xy_pt</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ONLY USE THIS ON UNROTATED RECTANGLES, as to do otherwise may yield</span>
<span class="sd">    arbitrary polygons</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">xy_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">margin</span><span class="p">:</span>
        <span class="n">xy_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">margin</span>
    <span class="k">if</span> <span class="n">xy_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">margin</span><span class="p">:</span>
        <span class="n">xy_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">margin</span>
    <span class="k">if</span> <span class="n">xy_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">margin</span><span class="p">:</span>
        <span class="n">xy_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">margin</span>
    <span class="k">if</span> <span class="n">xy_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">margin</span><span class="p">:</span>
        <span class="n">xy_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">margin</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="test_interact_annots"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.interact_annotations.test_interact_annots">[docs]</a><span class="k">def</span> <span class="nf">test_interact_annots</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.interact_annotations --test-test_interact_annots --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.interact_annotations import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; self = test_interact_annots()</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(self)</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] *** START DEMO ***&#39;</span><span class="p">)</span>
    <span class="n">verts_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">)),</span>
        <span class="p">((</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">),</span> <span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">700</span><span class="p">),</span> <span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="c1"># if img is None:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">img_url</span> <span class="o">=</span> <span class="s1">&#39;http://i.imgur.com/Vq9CLok.jpg&#39;</span>
        <span class="n">img_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">grab_file_url</span><span class="p">(</span><span class="n">img_url</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_fpath</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[interact_annot] cant read zebra: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ex</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="n">valid_species</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;species1&#39;</span><span class="p">,</span> <span class="s1">&#39;species2&#39;</span><span class="p">]</span>
    <span class="n">metadata_list</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">},</span> <span class="kc">None</span><span class="p">]</span>
    <span class="bp">self</span> <span class="o">=</span> <span class="n">AnnotationInteraction</span><span class="p">(</span>
        <span class="n">img</span><span class="p">,</span>
        <span class="n">verts_list</span><span class="o">=</span><span class="n">verts_list</span><span class="p">,</span>
        <span class="n">valid_species</span><span class="o">=</span><span class="n">valid_species</span><span class="p">,</span>
        <span class="n">metadata_list</span><span class="o">=</span><span class="n">metadata_list</span><span class="p">,</span>
        <span class="n">fnum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>  <span class="c1"># NOQA</span>
    <span class="k">return</span> <span class="bp">self</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.interact_annotations --exec-test_interact_annots --show</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.interact_annotations</span>
<span class="sd">        python -m wbia.plottool.interact_annotations --allexamples</span>
<span class="sd">        python -m wbia.plottool.interact_annotations --allexamples --noface --nosrc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>

    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c1"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>  <span class="c1"># NOQA</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

           </div>

          </div>
          <footer>


  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Wild Me

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>







      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>




  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
