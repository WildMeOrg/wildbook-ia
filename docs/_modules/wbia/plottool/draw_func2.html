
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>wbia.plottool.draw_func2 &#8212; wbia 3.3.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for wbia.plottool.draw_func2</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot; Lots of functions for drawing and plotting visiony things &quot;&quot;&quot;</span>
<span class="c1"># TODO: New naming scheme</span>
<span class="c1"># viz_&lt;funcname&gt; should clear everything. The current axes and fig: clf, cla.</span>
<span class="c1"># # Will add annotations</span>
<span class="c1"># interact_&lt;funcname&gt; should clear everything and start user interactions.</span>
<span class="c1"># show_&lt;funcname&gt; should always clear the current axes, but not fig: cla #</span>
<span class="c1"># Might # add annotates?  plot_&lt;funcname&gt; should not clear the axes or figure.</span>
<span class="c1"># More useful for graphs draw_&lt;funcname&gt; same as plot for now. More useful for</span>
<span class="c1"># images</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">zip</span><span class="p">,</span> <span class="nb">map</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">it</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>  <span class="c1"># NOQA</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span>
        <span class="n">ex</span><span class="p">,</span>
        <span class="s1">&#39;try pip install mpl_toolkits.axes_grid1 or something.  idk yet&#39;</span><span class="p">,</span>
        <span class="n">iswarning</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">raise</span>
<span class="c1"># import colorsys</span>
<span class="kn">import</span> <span class="nn">pylab</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">relpath</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cv2</span>
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR PLOTTOOL CANNOT IMPORT CV2&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="kn">import</span> <span class="n">mpl_keypoint</span> <span class="k">as</span> <span class="n">mpl_kp</span>
<span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="kn">import</span> <span class="n">color_funcs</span> <span class="k">as</span> <span class="n">color_fns</span>
<span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="kn">import</span> <span class="n">custom_constants</span>
<span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="kn">import</span> <span class="n">custom_figure</span>
<span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="kn">import</span> <span class="n">fig_presenter</span>

<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">(</span><span class="nb">print</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">inject2</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;wbia&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="is_texmode"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.is_texmode">[docs]</a><span class="k">def</span> <span class="nf">is_texmode</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.usetex&#39;</span><span class="p">]</span></div>


<span class="c1"># Bring over moved functions that still have dependants elsewhere</span>

<span class="n">TAU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">distinct_colors</span> <span class="o">=</span> <span class="n">color_fns</span><span class="o">.</span><span class="n">distinct_colors</span>
<span class="n">lighten_rgb</span> <span class="o">=</span> <span class="n">color_fns</span><span class="o">.</span><span class="n">lighten_rgb</span>
<span class="n">to_base255</span> <span class="o">=</span> <span class="n">color_fns</span><span class="o">.</span><span class="n">to_base255</span>

<span class="n">DARKEN</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span>
    <span class="s1">&#39;--darken&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mf">0.7</span> <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--darken&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># logger.info(&#39;DARKEN = %r&#39; % (DARKEN,))</span>

<span class="n">all_figures_bring_to_front</span> <span class="o">=</span> <span class="n">fig_presenter</span><span class="o">.</span><span class="n">all_figures_bring_to_front</span>
<span class="n">all_figures_tile</span> <span class="o">=</span> <span class="n">fig_presenter</span><span class="o">.</span><span class="n">all_figures_tile</span>
<span class="n">close_all_figures</span> <span class="o">=</span> <span class="n">fig_presenter</span><span class="o">.</span><span class="n">close_all_figures</span>
<span class="n">close_figure</span> <span class="o">=</span> <span class="n">fig_presenter</span><span class="o">.</span><span class="n">close_figure</span>
<span class="n">iup</span> <span class="o">=</span> <span class="n">fig_presenter</span><span class="o">.</span><span class="n">iup</span>
<span class="n">iupdate</span> <span class="o">=</span> <span class="n">fig_presenter</span><span class="o">.</span><span class="n">iupdate</span>
<span class="n">present</span> <span class="o">=</span> <span class="n">fig_presenter</span><span class="o">.</span><span class="n">present</span>
<span class="n">reset</span> <span class="o">=</span> <span class="n">fig_presenter</span><span class="o">.</span><span class="n">reset</span>
<span class="n">update</span> <span class="o">=</span> <span class="n">fig_presenter</span><span class="o">.</span><span class="n">update</span>


<span class="n">ORANGE</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">ORANGE</span>
<span class="n">RED</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">RED</span>
<span class="n">GREEN</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">GREEN</span>
<span class="n">BLUE</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">BLUE</span>
<span class="n">YELLOW</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">YELLOW</span>
<span class="n">BLACK</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">BLACK</span>
<span class="n">WHITE</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">WHITE</span>
<span class="n">GRAY</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">GRAY</span>
<span class="n">LIGHTGRAY</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">LIGHTGRAY</span>
<span class="n">DEEP_PINK</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">DEEP_PINK</span>
<span class="n">PINK</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">PINK</span>
<span class="n">FALSE_RED</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">FALSE_RED</span>
<span class="n">TRUE_GREEN</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">TRUE_GREEN</span>
<span class="n">TRUE_BLUE</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">TRUE_BLUE</span>
<span class="n">DARK_GREEN</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">DARK_GREEN</span>
<span class="n">DARK_BLUE</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">DARK_BLUE</span>
<span class="n">DARK_RED</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">DARK_RED</span>
<span class="n">DARK_ORANGE</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">DARK_ORANGE</span>
<span class="n">DARK_YELLOW</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">DARK_YELLOW</span>
<span class="n">PURPLE</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">PURPLE</span>
<span class="n">LIGHT_BLUE</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">LIGHT_BLUE</span>
<span class="n">UNKNOWN_PURP</span> <span class="o">=</span> <span class="n">custom_constants</span><span class="o">.</span><span class="n">UNKNOWN_PURP</span>

<span class="n">TRUE</span> <span class="o">=</span> <span class="n">TRUE_BLUE</span>
<span class="n">FALSE</span> <span class="o">=</span> <span class="n">FALSE_RED</span>

<span class="n">figure</span> <span class="o">=</span> <span class="n">custom_figure</span><span class="o">.</span><span class="n">figure</span>
<span class="n">gca</span> <span class="o">=</span> <span class="n">custom_figure</span><span class="o">.</span><span class="n">gca</span>
<span class="n">gcf</span> <span class="o">=</span> <span class="n">custom_figure</span><span class="o">.</span><span class="n">gcf</span>
<span class="n">get_fig</span> <span class="o">=</span> <span class="n">custom_figure</span><span class="o">.</span><span class="n">get_fig</span>
<span class="n">save_figure</span> <span class="o">=</span> <span class="n">custom_figure</span><span class="o">.</span><span class="n">save_figure</span>
<span class="n">set_figtitle</span> <span class="o">=</span> <span class="n">custom_figure</span><span class="o">.</span><span class="n">set_figtitle</span>
<span class="n">set_title</span> <span class="o">=</span> <span class="n">custom_figure</span><span class="o">.</span><span class="n">set_title</span>
<span class="n">set_xlabel</span> <span class="o">=</span> <span class="n">custom_figure</span><span class="o">.</span><span class="n">set_xlabel</span>
<span class="n">set_xticks</span> <span class="o">=</span> <span class="n">custom_figure</span><span class="o">.</span><span class="n">set_xticks</span>
<span class="n">set_ylabel</span> <span class="o">=</span> <span class="n">custom_figure</span><span class="o">.</span><span class="n">set_ylabel</span>
<span class="n">set_yticks</span> <span class="o">=</span> <span class="n">custom_figure</span><span class="o">.</span><span class="n">set_yticks</span>

<span class="n">VERBOSE</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">((</span><span class="s1">&#39;--verbose-df2&#39;</span><span class="p">,</span> <span class="s1">&#39;--verb-pt&#39;</span><span class="p">))</span>

<span class="c1"># ================</span>
<span class="c1"># GLOBALS</span>
<span class="c1"># ================</span>

<span class="n">TMP_mevent</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">plotWidget</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="show_was_requested"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.show_was_requested">[docs]</a><span class="k">def</span> <span class="nf">show_was_requested</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns True if --show is specified on the commandline or you are in</span>
<span class="sd">    IPython (and presumably want some sort of interaction</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">((</span><span class="s1">&#39;--noshow&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">((</span><span class="s1">&#39;--show&#39;</span><span class="p">,</span> <span class="s1">&#39;--save&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">ut</span><span class="o">.</span><span class="n">inIPython</span><span class="p">()</span>
    <span class="p">)</span></div>
    <span class="c1"># return ut.show_was_requested()</span>


<div class="viewcode-block" id="OffsetImage2"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.OffsetImage2">[docs]</a><span class="k">class</span> <span class="nc">OffsetImage2</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">offsetbox</span><span class="o">.</span><span class="n">OffsetBox</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO: If this works reapply to mpl</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">arr</span><span class="p">,</span>
        <span class="n">zoom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">filternorm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">filterrad</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
        <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">dpi_cor</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>

        <span class="n">mpl</span><span class="o">.</span><span class="n">offsetbox</span><span class="o">.</span><span class="n">OffsetBox</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dpi_cor</span> <span class="o">=</span> <span class="n">dpi_cor</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">offsetbox</span><span class="o">.</span><span class="n">BboxImage</span><span class="p">(</span>
            <span class="n">bbox</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
            <span class="n">filternorm</span><span class="o">=</span><span class="n">filternorm</span><span class="p">,</span>
            <span class="n">filterrad</span><span class="o">=</span><span class="n">filterrad</span><span class="p">,</span>
            <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_zoom</span><span class="p">(</span><span class="n">zoom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

<div class="viewcode-block" id="OffsetImage2.set_data"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.OffsetImage2.set_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="OffsetImage2.get_data"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.OffsetImage2.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span></div>

<div class="viewcode-block" id="OffsetImage2.set_zoom"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.OffsetImage2.set_zoom">[docs]</a>    <span class="k">def</span> <span class="nf">set_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zoom</span> <span class="o">=</span> <span class="n">zoom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="OffsetImage2.get_zoom"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.OffsetImage2.get_zoom">[docs]</a>    <span class="k">def</span> <span class="nf">get_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom</span></div>

    <span class="c1">#     def set_axes(self, axes):</span>
    <span class="c1">#         self.image.set_axes(axes)</span>
    <span class="c1">#         martist.Artist.set_axes(self, axes)</span>

    <span class="c1">#     def set_offset(self, xy):</span>
    <span class="c1">#         &quot;&quot;&quot;</span>
    <span class="c1">#         set offset of the container.</span>

    <span class="c1">#         Accept : tuple of x,y coordinate in disokay units.</span>
    <span class="c1">#         &quot;&quot;&quot;</span>
    <span class="c1">#         self._offset = xy</span>

    <span class="c1">#         self.offset_transform.clear()</span>
    <span class="c1">#         self.offset_transform.translate(xy[0], xy[1])</span>

<div class="viewcode-block" id="OffsetImage2.get_offset"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.OffsetImage2.get_offset">[docs]</a>    <span class="k">def</span> <span class="nf">get_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return offset of the container.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span></div>

<div class="viewcode-block" id="OffsetImage2.get_children"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.OffsetImage2.get_children">[docs]</a>    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">]</span></div>

<div class="viewcode-block" id="OffsetImage2.get_window_extent"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.OffsetImage2.get_window_extent">[docs]</a>    <span class="k">def</span> <span class="nf">get_window_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the bounding box in display space.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.transforms</span> <span class="k">as</span> <span class="nn">mtransforms</span>

        <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">xd</span><span class="p">,</span> <span class="n">yd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extent</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
        <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_offset</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mtransforms</span><span class="o">.</span><span class="n">Bbox</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span><span class="n">ox</span> <span class="o">-</span> <span class="n">xd</span><span class="p">,</span> <span class="n">oy</span> <span class="o">-</span> <span class="n">yd</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span></div>

<div class="viewcode-block" id="OffsetImage2.get_extent"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.OffsetImage2.get_extent">[docs]</a>    <span class="k">def</span> <span class="nf">get_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>

        <span class="c1"># FIXME dpi_cor is never used</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dpi_cor</span><span class="p">:</span>  <span class="c1"># True, do correction</span>
            <span class="c1"># conversion (px / pt)</span>
            <span class="n">dpi_cor</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">points_to_pixels</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dpi_cor</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># NOQA</span>

        <span class="n">zoom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_zoom</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

        <span class="c1"># Data width and height in pixels</span>
        <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># w /= dpi_cor</span>
        <span class="c1"># h /= dpi_cor</span>
        <span class="c1"># import utool</span>
        <span class="c1"># if self.axes:</span>
        <span class="c1"># Hack, find right axes</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span>
        <span class="c1"># bbox = mpl.transforms.Bbox.union([ax.get_window_extent()])</span>
        <span class="c1"># xmin, xmax = ax.get_xlim()</span>
        <span class="c1"># ymin, ymax = ax.get_ylim()</span>
        <span class="c1"># https://www.mail-archive.com/matplotlib-users@lists.sourceforge.net/msg25931.html</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span>
        <span class="c1"># dpi = fig.dpi  # (pt / in)</span>
        <span class="n">fw_in</span><span class="p">,</span> <span class="n">fh_in</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
        <span class="c1"># divider = make_axes_locatable(ax)</span>

        <span class="c1"># fig_ppi = dpi * dpi_cor</span>
        <span class="c1"># fw_px = fig_ppi * fw_in</span>
        <span class="c1"># fh_px = fig_ppi * fh_in</span>
        <span class="c1"># bbox.width</span>

        <span class="c1"># transforms data to figure coordinates</span>
        <span class="c1"># pt1 = ax.transData.transform_point([nx, ny])</span>
        <span class="n">pt1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform_point</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
        <span class="n">pt2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform_point</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">pt1</span> <span class="o">-</span> <span class="n">pt2</span>

        <span class="c1"># zoom_factor = max(fw_px, )</span>
        <span class="c1"># logger.info(&#39;fw_px = %r&#39; % (fw_px,))</span>
        <span class="c1"># logger.info(&#39;pos = %r&#39; % (pos,))</span>
        <span class="c1"># w = h = .2 * fw_px * pos[2]</span>
        <span class="c1"># .1 * fig_dpi * fig_size[0] / data.shape[0]</span>
        <span class="c1"># logger.info(&#39;zoom = %r&#39; % (zoom,))</span>

        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">h</span> <span class="o">*</span> <span class="n">zoom</span>
        <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span></div>
        <span class="c1"># return 30, 30, 0, 0</span>

<div class="viewcode-block" id="OffsetImage2.draw"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.OffsetImage2.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw the children</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
        <span class="c1"># bbox_artist(self, renderer, fill=False, props=dict(pad=0.))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="overlay_icon"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.overlay_icon">[docs]</a><span class="k">def</span> <span class="nf">overlay_icon</span><span class="p">(</span>
    <span class="n">icon</span><span class="p">,</span>
    <span class="n">coords</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">coord_type</span><span class="o">=</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span>
    <span class="n">bbox_alignment</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">max_asize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_dsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">as_artist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overlay a species icon</span>

<span class="sd">    References:</span>
<span class="sd">        http://matplotlib.org/examples/pylab_examples/demo_annotation_box.html</span>
<span class="sd">        http://matplotlib.org/users/annotations_guide.html</span>
<span class="sd">        /usr/local/lib/python2.7/dist-packages/matplotlib/offsetbox.py</span>

<span class="sd">    Args:</span>
<span class="sd">        icon (ndarray or str): image icon data or path</span>
<span class="sd">        coords (tuple): (default = (0, 0))</span>
<span class="sd">        coord_type (str): (default = &#39;axes&#39;)</span>
<span class="sd">        bbox_alignment (tuple): (default = (0, 0))</span>
<span class="sd">        max_dsize (None): (default = None)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-overlay_icon --show --icon zebra.png</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-overlay_icon --show --icon lena.png</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-overlay_icon --show --icon lena.png --artist</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.plot2(np.arange(100), np.arange(100))</span>
<span class="sd">        &gt;&gt;&gt; icon = ut.get_argval(&#39;--icon&#39;, type_=str, default=&#39;lena.png&#39;)</span>
<span class="sd">        &gt;&gt;&gt; coords = (0, 0)</span>
<span class="sd">        &gt;&gt;&gt; coord_type = &#39;axes&#39;</span>
<span class="sd">        &gt;&gt;&gt; bbox_alignment = (0, 0)</span>
<span class="sd">        &gt;&gt;&gt; max_dsize = None  # (128, None)</span>
<span class="sd">        &gt;&gt;&gt; max_asize = (60, 40)</span>
<span class="sd">        &gt;&gt;&gt; as_artist = not ut.get_argflag(&#39;--noartist&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = overlay_icon(icon, coords, coord_type, bbox_alignment,</span>
<span class="sd">        &gt;&gt;&gt;                       max_asize, max_dsize, as_artist)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># from mpl_toolkits.axes_grid.anchored_artists import AnchoredAuxTransformBox</span>
    <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="c1"># hack because icon is probably a url</span>
        <span class="n">icon_url</span> <span class="o">=</span> <span class="n">icon</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">grab_file_url</span><span class="p">(</span><span class="n">icon_url</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">max_dsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">resize_to_maxdims</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">max_dsize</span><span class="p">)</span>
    <span class="n">icon</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">convert_colorspace</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="s1">&#39;BGR&#39;</span><span class="p">)</span>

    <span class="c1"># imagebox = OffsetImage2(icon, zoom=.3)</span>
    <span class="k">if</span> <span class="n">coord_type</span> <span class="o">==</span> <span class="s1">&#39;axes&#39;</span><span class="p">:</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># ab = AnchoredAuxTransformBox(ax.transData, loc=2)</span>
    <span class="c1"># ab.drawing_area.add_artist(imagebox)</span>

    <span class="c1"># *xycoords* and *textcoords* are strings that indicate the</span>
    <span class="c1"># coordinates of *xy* and *xytext*, and may be one of the</span>
    <span class="c1"># following values:</span>

    <span class="c1"># &#39;figure points&#39; #&#39;figure pixels&#39; #&#39;figure fraction&#39; #&#39;axes points&#39;</span>
    <span class="c1"># &#39;axes pixels&#39; #&#39;axes fraction&#39; #&#39;data&#39; #&#39;offset points&#39; #&#39;polar&#39;</span>

    <span class="k">if</span> <span class="n">as_artist</span><span class="p">:</span>
        <span class="c1"># Hack while I am trying to get constant size images working</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--save&#39;</span><span class="p">):</span>
            <span class="c1"># zoom = 1.0</span>
            <span class="n">zoom</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zoom</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">zoom</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--overlay-zoom&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">zoom</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># TODO: figure out how to make axes fraction work</span>
            <span class="n">imagebox</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">offsetbox</span><span class="o">.</span><span class="n">OffsetImage</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
            <span class="n">imagebox</span><span class="o">.</span><span class="n">set_width</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">imagebox</span><span class="o">.</span><span class="n">set_height</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ab</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">offsetbox</span><span class="o">.</span><span class="n">AnnotationBbox</span><span class="p">(</span>
                <span class="n">imagebox</span><span class="p">,</span>
                <span class="n">xy</span><span class="p">,</span>
                <span class="n">xybox</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                <span class="n">boxcoords</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
                <span class="c1"># boxcoords=&quot;offset points&quot;,</span>
                <span class="n">box_alignment</span><span class="o">=</span><span class="n">bbox_alignment</span><span class="p">,</span>
                <span class="n">pad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">imagebox</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">offsetbox</span><span class="o">.</span><span class="n">OffsetImage</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="n">zoom</span><span class="p">)</span>
            <span class="n">ab</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">offsetbox</span><span class="o">.</span><span class="n">AnnotationBbox</span><span class="p">(</span>
                <span class="n">imagebox</span><span class="p">,</span>
                <span class="n">xy</span><span class="p">,</span>
                <span class="n">xybox</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                <span class="c1"># xycoords=&#39;axes fraction&#39;,</span>
                <span class="n">boxcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
                <span class="n">box_alignment</span><span class="o">=</span><span class="n">bbox_alignment</span><span class="p">,</span>
                <span class="n">pad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">ab</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">img_size</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;img_size = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">img_size</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">max_asize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dsize</span><span class="p">,</span> <span class="n">ratio</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">resized_dims_and_ratio</span><span class="p">(</span><span class="n">img_size</span><span class="p">,</span> <span class="n">max_asize</span><span class="p">)</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">dsize</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">img_size</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;width, height= </span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="n">width</span><span class="p">,</span>
                <span class="n">height</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">width</span> <span class="o">*</span> <span class="n">bbox_alignment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">height</span> <span class="o">*</span> <span class="n">bbox_alignment</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">width</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bbox_alignment</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bbox_alignment</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">prev_aspect</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_aspect</span><span class="p">()</span>
        <span class="c1"># FIXME: adjust aspect ratio of extent to match the axes</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;icon.shape = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">icon</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;prev_aspect = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prev_aspect</span><span class="p">,))</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;extent = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">extent</span><span class="p">,))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;current_aspect = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_aspect</span><span class="p">(),))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="n">prev_aspect</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;current_aspect = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_aspect</span><span class="p">(),))</span></div>
        <span class="c1"># x - width // 2, x + width // 2,</span>
        <span class="c1"># y - height // 2, y + height // 2])</span>


<div class="viewcode-block" id="update_figsize"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.update_figsize">[docs]</a><span class="k">def</span> <span class="nf">update_figsize</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; updates figsize based on command line &quot;&quot;&quot;</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--figsize&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Enforce inches and DPI</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">gcf</span><span class="p">()</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">term</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">term</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">figsize</span><span class="p">]</span>
        <span class="n">figw</span><span class="p">,</span> <span class="n">figh</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;get_size_inches = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">(),))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;fig w,h (inches) = </span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">figw</span><span class="p">,</span> <span class="n">figh</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figw</span><span class="p">,</span> <span class="n">figh</span><span class="p">)</span></div>
        <span class="c1"># logger.info(&#39;get_size_inches = %r&#39; % (fig.get_size_inches(),))</span>


<div class="viewcode-block" id="udpate_adjust_subplots"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.udpate_adjust_subplots">[docs]</a><span class="k">def</span> <span class="nf">udpate_adjust_subplots</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DEPRICATE</span>

<span class="sd">    updates adjust_subplots based on command line</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">adjust_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--adjust&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">adjust_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># --adjust=[.02,.02,.05]</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;wspace&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;hspace&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">adjust_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># [all]</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">adjust_list</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">adjust_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">adjust_list</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">adjust_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># [left, bottom, wspace]</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">adjust_list</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">adjust_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">adjust_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">adjust_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">adjust_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c1"># [left, bottom, wspace, hspace]</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">adjust_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="mi">1</span> <span class="o">-</span> <span class="n">adjust_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="mi">1</span> <span class="o">-</span> <span class="n">adjust_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">adjust_list</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">adjust_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">adjust_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s1">&#39;vals must be len (1, 3, or 6) not </span><span class="si">%d</span><span class="s1">, adjust_list=</span><span class="si">%r</span><span class="s1">. &#39;</span>
                    <span class="s1">&#39;Expects keys=</span><span class="si">%r</span><span class="s1">&#39;</span>
                <span class="p">)</span>
                <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adjust_list</span><span class="p">),</span> <span class="n">adjust_list</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">adjust_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">vals</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;**adjust_kw = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">adjust_kw</span><span class="p">),))</span>
        <span class="n">adjust_subplots</span><span class="p">(</span><span class="o">**</span><span class="n">adjust_kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="render_figure_to_image"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.render_figure_to_image">[docs]</a><span class="k">def</span> <span class="nf">render_figure_to_image</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">savekw</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">io</span>
    <span class="kn">import</span> <span class="nn">cv2</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="c1"># Pop save kwargs from kwargs</span>
    <span class="c1"># save_keys = [&#39;dpi&#39;, &#39;figsize&#39;, &#39;saveax&#39;, &#39;verbose&#39;]</span>
    <span class="c1"># Write matplotlib axes to an image</span>
    <span class="n">axes_extents</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">extract_axes_extents</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="c1"># assert len(axes_extents) == 1, &#39;more than one axes&#39;</span>
    <span class="c1"># if len(axes_extents) == 1:</span>
    <span class="c1">#     extent = axes_extents[0]</span>
    <span class="c1"># else:</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">Bbox</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">axes_extents</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
        <span class="c1"># This call takes 23% - 15% of the time depending on settings</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="o">**</span><span class="n">savekw</span><span class="p">)</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imdecode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image</span></div>


<div class="viewcode-block" id="RenderingContext"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.RenderingContext">[docs]</a><span class="k">class</span> <span class="nc">RenderingContext</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">savekw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">was_interactive</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savekw</span> <span class="o">=</span> <span class="n">savekw</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

        <span class="n">tmp_fnum</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">tmp_fnum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">was_interactive</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">is_interactive</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">was_interactive</span><span class="p">:</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">trace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># logger.info(&#39;[util_time] Error in context manager!: &#39; + str(value))</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># return a falsey value on error</span>
        <span class="c1"># Ensure that this figure will not pop up</span>
        <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">render_figure_to_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">savekw</span><span class="p">)</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">was_interactive</span><span class="p">:</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">was_interactive</span><span class="p">)</span></div>


<div class="viewcode-block" id="extract_axes_extents"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.extract_axes_extents">[docs]</a><span class="k">def</span> <span class="nf">extract_axes_extents</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 extract_axes_extents</span>
<span class="sd">        python -m wbia.plottool.draw_func2 extract_axes_extents --save foo.jpg</span>

<span class="sd">     Notes:</span>
<span class="sd">          contour does something weird to axes</span>
<span class="sd">          with contour:</span>
<span class="sd">            axes_extents = Bbox([[-0.839827203337, -0.00555555555556], [7.77743055556, 6.97227277762]])</span>

<span class="sd">          without contour</span>
<span class="sd">            axes_extents = Bbox([[0.0290607810781, -0.00555555555556], [7.77743055556, 5.88]])</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.gridspec as gridspec</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import six</span>
<span class="sd">        &gt;&gt;&gt; if six.PY2:</span>
<span class="sd">        &gt;&gt;&gt;     import pytest</span>
<span class="sd">        &gt;&gt;&gt;     pytest.skip()</span>
<span class="sd">        &gt;&gt;&gt; pt.qtensure()</span>
<span class="sd">        &gt;&gt;&gt; fig = plt.figure()</span>
<span class="sd">        &gt;&gt;&gt; gs = gridspec.GridSpec(17, 17)</span>
<span class="sd">        &gt;&gt;&gt; specs = [</span>
<span class="sd">        &gt;&gt;&gt;     gs[0:8,  0:8], gs[0:8,  8:16],</span>
<span class="sd">        &gt;&gt;&gt;     gs[9:17, 0:8], gs[9:17, 8:16],</span>
<span class="sd">        &gt;&gt;&gt; ]</span>
<span class="sd">        &gt;&gt;&gt; rng = np.random.RandomState(0)</span>
<span class="sd">        &gt;&gt;&gt; X = (rng.rand(100, 2) * [[8, 8]]) + [[6, -14]]</span>
<span class="sd">        &gt;&gt;&gt; x_min, x_max = X[:, 0].min() - 1, X[:, 0].max() + 1</span>
<span class="sd">        &gt;&gt;&gt; y_min, y_max = X[:, 1].min() - 1, X[:, 1].max() + 1</span>
<span class="sd">        &gt;&gt;&gt; xx, yy = np.meshgrid(np.arange(x_min, x_max), np.arange(y_min, y_max))</span>
<span class="sd">        &gt;&gt;&gt; yynan = np.full(yy.shape, fill_value=np.nan)</span>
<span class="sd">        &gt;&gt;&gt; xxnan = np.full(yy.shape, fill_value=np.nan)</span>
<span class="sd">        &gt;&gt;&gt; cmap = plt.cm.RdYlBu</span>
<span class="sd">        &gt;&gt;&gt; norm = plt.Normalize(vmin=0, vmax=1)</span>
<span class="sd">        &gt;&gt;&gt; for count, spec in enumerate(specs):</span>
<span class="sd">        &gt;&gt;&gt;     fig.add_subplot(spec)</span>
<span class="sd">        &gt;&gt;&gt;     plt.plot(X.T[0], X.T[1], &#39;o&#39;, color=&#39;r&#39;, markeredgecolor=&#39;w&#39;)</span>
<span class="sd">        &gt;&gt;&gt;     Z = rng.rand(*xx.shape)</span>
<span class="sd">        &gt;&gt;&gt;     plt.contourf(xx, yy, Z, cmap=cmap, norm=norm, alpha=1.0)</span>
<span class="sd">        &gt;&gt;&gt;     plt.title(&#39;full-nan decision point&#39;)</span>
<span class="sd">        &gt;&gt;&gt;     plt.gca().set_aspect(&#39;equal&#39;)</span>
<span class="sd">        &gt;&gt;&gt; gs = gridspec.GridSpec(1, 16)</span>
<span class="sd">        &gt;&gt;&gt; subspec = gs[:, -1:]</span>
<span class="sd">        &gt;&gt;&gt; cax = plt.subplot(subspec)</span>
<span class="sd">        &gt;&gt;&gt; sm = plt.cm.ScalarMappable(cmap=cmap)</span>
<span class="sd">        &gt;&gt;&gt; sm.set_array(np.linspace(0, 1))</span>
<span class="sd">        &gt;&gt;&gt; plt.colorbar(sm, cax)</span>
<span class="sd">        &gt;&gt;&gt; cax.set_ylabel(&#39;ColorBar&#39;)</span>
<span class="sd">        &gt;&gt;&gt; fig.suptitle(&#39;SupTitle&#39;)</span>
<span class="sd">        &gt;&gt;&gt; subkw = dict(left=.001, right=.9, top=.9, bottom=.05, hspace=.2, wspace=.1)</span>
<span class="sd">        &gt;&gt;&gt; plt.subplots_adjust(**subkw)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="c1"># Make sure we draw the axes first so we can</span>
    <span class="c1"># extract positions from the text objects</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="c1"># Group axes that belong together</span>
    <span class="n">atomic_axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">seen_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
        <span class="n">div</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">get_plotdat</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">DF2_DIVIDER_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">div</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df2_div_axes</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">get_plotdat_dict</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;df2_div_axes&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">seen_</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">seen_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df2_div_axes</span><span class="p">))</span>
            <span class="n">atomic_axes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ax</span><span class="p">]</span> <span class="o">+</span> <span class="n">df2_div_axes</span><span class="p">)</span>
            <span class="c1"># TODO: pad these a bit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_</span><span class="p">:</span>
                <span class="n">atomic_axes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ax</span><span class="p">])</span>
                <span class="n">seen_</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="n">hack_axes_group_row</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--grouprows&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hack_axes_group_row</span><span class="p">:</span>
        <span class="n">groupid_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">axs</span> <span class="ow">in</span> <span class="n">atomic_axes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">:</span>
                <span class="n">groupid</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">colNum</span>
            <span class="n">groupid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">groupid</span><span class="p">)</span>

        <span class="n">groupxs</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">group_indices</span><span class="p">(</span><span class="n">groupid_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_groups</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">lmap</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">apply_grouping</span><span class="p">(</span><span class="n">atomic_axes</span><span class="p">,</span> <span class="n">groupxs</span><span class="p">))</span>
        <span class="n">atomic_axes</span> <span class="o">=</span> <span class="n">new_groups</span>
        <span class="c1"># [[(ax.rowNum, ax.colNum) for ax in axs] for axs in atomic_axes]</span>
        <span class="c1"># save all rows of each column</span>

    <span class="n">dpi_scale_trans_inv</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">dpi_scale_trans</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>
    <span class="n">axes_bboxes_</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes_extent</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">pad</span><span class="p">)</span> <span class="k">for</span> <span class="n">axs</span> <span class="ow">in</span> <span class="n">atomic_axes</span><span class="p">]</span>
    <span class="n">axes_extents_</span> <span class="o">=</span> <span class="p">[</span><span class="n">extent</span><span class="o">.</span><span class="n">transformed</span><span class="p">(</span><span class="n">dpi_scale_trans_inv</span><span class="p">)</span> <span class="k">for</span> <span class="n">extent</span> <span class="ow">in</span> <span class="n">axes_bboxes_</span><span class="p">]</span>
    <span class="c1"># axes_extents_ = axes_bboxes_</span>
    <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Grab include extents of figure text as well</span>
            <span class="c1"># FIXME: This might break on OSX</span>
            <span class="c1"># http://stackoverflow.com/questions/22667224/bbox-backend</span>
            <span class="n">renderer</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_renderer</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">mpl_text</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">texts</span><span class="p">:</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="n">mpl_text</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="n">renderer</span><span class="p">)</span>
                <span class="n">extent_</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">expanded</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">pad</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span>
                <span class="n">extent</span> <span class="o">=</span> <span class="n">extent_</span><span class="o">.</span><span class="n">transformed</span><span class="p">(</span><span class="n">dpi_scale_trans_inv</span><span class="p">)</span>
                <span class="c1"># extent = extent_</span>
                <span class="n">axes_extents_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extent</span><span class="p">)</span>
        <span class="n">axes_extents</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">Bbox</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">axes_extents_</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axes_extents</span> <span class="o">=</span> <span class="n">axes_extents_</span>
    <span class="c1"># if True:</span>
    <span class="c1">#     axes_extents.x0 = 0</span>
    <span class="c1">#     # axes_extents.y1 = 0</span>
    <span class="k">return</span> <span class="n">axes_extents</span></div>


<div class="viewcode-block" id="axes_extent"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.axes_extent">[docs]</a><span class="k">def</span> <span class="nf">axes_extent</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the full extent of a group of axes, including axes labels, tick labels,</span>
<span class="sd">    and titles.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">axes_parts</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">ax</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">label</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">label</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">label</span>

    <span class="c1"># def axes_parts2(ax):</span>
    <span class="c1">#     yield (&#39;ax&#39;, ax)</span>
    <span class="c1">#     for c, label in enumerate(ax.get_xticklabels()):</span>
    <span class="c1">#         if label.get_text():</span>
    <span class="c1">#             yield (&#39;xtick{}&#39;.format(c), label)</span>
    <span class="c1">#     for label in ax.get_yticklabels():</span>
    <span class="c1">#         if label.get_text():</span>
    <span class="c1">#             yield (&#39;ytick{}&#39;.format(c), label)</span>
    <span class="c1">#     xlabel = ax.get_xaxis().get_label()</span>
    <span class="c1">#     ylabel = ax.get_yaxis().get_label()</span>
    <span class="c1">#     for key, label in ((&#39;xlabel&#39;, xlabel), (&#39;ylabel&#39;, ylabel),</span>
    <span class="c1">#                   (&#39;title&#39;, ax.title)):</span>
    <span class="c1">#         if label.get_text():</span>
    <span class="c1">#             yield (key, label)</span>
    <span class="c1"># yield from ax.lines</span>
    <span class="c1"># yield from ax.patches</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">axes_parts</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">)</span>
    <span class="n">extents</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
    <span class="c1"># mpl.transforms.Affine2D().scale(1.1)</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">Bbox</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">extents</span><span class="p">)</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="n">extent</span><span class="o">.</span><span class="n">expanded</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">pad</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">extent</span></div>


<div class="viewcode-block" id="save_parts"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.save_parts">[docs]</a><span class="k">def</span> <span class="nf">save_parts</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">grouped_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FIXME: this works in mpl 2.0.0, but not 2.0.2</span>

<span class="sd">    Args:</span>
<span class="sd">        fig (?):</span>
<span class="sd">        fpath (str):  file path string</span>
<span class="sd">        dpi (None): (default = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: subpaths</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 save_parts</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib as mpl</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; def testimg(fname):</span>
<span class="sd">        &gt;&gt;&gt;     return plt.imread(mpl.cbook.get_sample_data(fname))</span>
<span class="sd">        &gt;&gt;&gt; fnames = [&#39;grace_hopper.png&#39;, &#39;ada.png&#39;] * 4</span>
<span class="sd">        &gt;&gt;&gt; fig = plt.figure(1)</span>
<span class="sd">        &gt;&gt;&gt; for c, fname in enumerate(fnames, start=1):</span>
<span class="sd">        &gt;&gt;&gt;     ax = fig.add_subplot(3, 4, c)</span>
<span class="sd">        &gt;&gt;&gt;     ax.imshow(testimg(fname))</span>
<span class="sd">        &gt;&gt;&gt;     ax.set_title(fname[0:3] + str(c))</span>
<span class="sd">        &gt;&gt;&gt;     ax.set_xticks([])</span>
<span class="sd">        &gt;&gt;&gt;     ax.set_yticks([])</span>
<span class="sd">        &gt;&gt;&gt; ax = fig.add_subplot(3, 1, 3)</span>
<span class="sd">        &gt;&gt;&gt; ax.plot(np.sin(np.linspace(0, np.pi * 2)))</span>
<span class="sd">        &gt;&gt;&gt; ax.set_xlabel(&#39;xlabel&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.set_ylabel(&#39;ylabel&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.set_title(&#39;title&#39;)</span>
<span class="sd">        &gt;&gt;&gt; fpath = &#39;test_save_parts.png&#39;</span>
<span class="sd">        &gt;&gt;&gt; adjust_subplots(fig=fig, wspace=.3, hspace=.3, top=.9)</span>
<span class="sd">        &gt;&gt;&gt; subpaths = save_parts(fig, fpath, dpi=300)</span>
<span class="sd">        &gt;&gt;&gt; fig.savefig(fpath)</span>
<span class="sd">        &gt;&gt;&gt; ut.startfile(subpaths[0])</span>
<span class="sd">        &gt;&gt;&gt; ut.startfile(fpath)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dpi</span><span class="p">:</span>
        <span class="c1"># Need to set figure dpi before we draw</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span>
    <span class="c1"># We need to draw the figure before calling get_window_extent</span>
    <span class="c1"># (or we can figure out how to set the renderer object)</span>
    <span class="c1"># if getattr(fig.canvas, &#39;renderer&#39;, None) is None:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="c1"># Group axes that belong together</span>
    <span class="k">if</span> <span class="n">grouped_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">grouped_axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="n">grouped_axes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ax</span><span class="p">])</span>

    <span class="n">subpaths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_iter</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grouped_axes</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">_iter</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ProgIter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">_iter</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;save subfig&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">axs</span> <span class="ow">in</span> <span class="n">_iter</span><span class="p">:</span>
        <span class="n">subpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">augpath</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="mi">65</span><span class="p">))</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="n">axes_extent</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span><span class="o">.</span><span class="n">transformed</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">dpi_scale_trans</span><span class="o">.</span><span class="n">inverted</span><span class="p">())</span>
        <span class="n">savekw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">savekw</span><span class="p">[</span><span class="s1">&#39;transparent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--alpha&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">savekw</span><span class="p">[</span><span class="s1">&#39;dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpi</span>
        <span class="n">savekw</span><span class="p">[</span><span class="s1">&#39;edgecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">subpath</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="o">**</span><span class="n">savekw</span><span class="p">)</span>
        <span class="n">subpaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subpath</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">subpaths</span></div>


<div class="viewcode-block" id="quit_if_noshow"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.quit_if_noshow">[docs]</a><span class="k">def</span> <span class="nf">quit_if_noshow</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">saverequest</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--save&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">saverequest</span> <span class="ow">or</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">((</span><span class="s1">&#39;--show&#39;</span><span class="p">,</span> <span class="s1">&#39;--save&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">ut</span><span class="o">.</span><span class="n">inIPython</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">ExitTestException</span><span class="p">(</span><span class="s1">&#39;This should be caught gracefully by ut.run_test&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="show_if_requested"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.show_if_requested">[docs]</a><span class="k">def</span> <span class="nf">show_if_requested</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used at the end of tests. Handles command line arguments for saving figures</span>

<span class="sd">    Referencse:</span>
<span class="sd">        http://stackoverflow.com/questions/4325733/save-a-subplot-in-matplotlib</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">NOT_QUIET</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[pt] &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_caller_name</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39; show_if_requested()&#39;</span><span class="p">)</span>

    <span class="c1"># Process figures adjustments from command line before a show or a save</span>

    <span class="c1"># udpate_adjust_subplots()</span>
    <span class="n">adjust_subplots</span><span class="p">(</span><span class="n">use_argv</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">update_figsize</span><span class="p">()</span>

    <span class="n">dpi</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--dpi&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">custom_constants</span><span class="o">.</span><span class="n">DPI</span><span class="p">)</span>
    <span class="n">SAVE_PARTS</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--saveparts&#39;</span><span class="p">)</span>

    <span class="n">fpath_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--save&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fpath_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fpath_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--saveparts&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">SAVE_PARTS</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">fpath_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">expanduser</span>

        <span class="n">fpath_</span> <span class="o">=</span> <span class="n">expanduser</span><span class="p">(</span><span class="n">fpath_</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Figure save was requested&#39;</span><span class="p">)</span>
        <span class="n">arg_dict</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_arg_dict</span><span class="p">(</span>
            <span class="n">prefix_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">],</span> <span class="n">type_hints</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># import sys</span>
        <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">basename</span><span class="p">,</span> <span class="n">splitext</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">dirname</span>
        <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>
        <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>

        <span class="c1"># HACK</span>
        <span class="n">arg_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="s1">&#39;][&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">val</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">arg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">fpath_</span> <span class="o">=</span> <span class="n">fpath_</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">arg_dict</span><span class="p">)</span>
        <span class="n">fpath_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">remove_chars</span><span class="p">(</span><span class="n">fpath_</span><span class="p">,</span> <span class="s1">&#39; </span><span class="se">\&#39;</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">dpath</span><span class="p">,</span> <span class="n">gotdpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span>
            <span class="s1">&#39;--dpath&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">return_specified</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">fpath_</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gotdpath</span><span class="p">:</span>
            <span class="n">dpath</span> <span class="o">=</span> <span class="n">dirname</span><span class="p">(</span><span class="n">fpath_</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;dpath = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dpath</span><span class="p">,))</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span>

        <span class="n">fpath_strict</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truepath</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
        <span class="n">CLIP_WHITE</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--clipwhite&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">SAVE_PARTS</span><span class="p">:</span>
            <span class="c1"># TODO: call save_parts instead, but we still need to do the</span>
            <span class="c1"># special grouping.</span>

            <span class="c1"># Group axes that belong together</span>
            <span class="n">atomic_axes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">seen_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
                <span class="n">div</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">get_plotdat</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">DF2_DIVIDER_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">div</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">df2_div_axes</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">get_plotdat_dict</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;df2_div_axes&#39;</span><span class="p">,</span> <span class="p">[])</span>
                    <span class="n">seen_</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
                    <span class="n">seen_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df2_div_axes</span><span class="p">))</span>
                    <span class="n">atomic_axes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ax</span><span class="p">]</span> <span class="o">+</span> <span class="n">df2_div_axes</span><span class="p">)</span>
                    <span class="c1"># TODO: pad these a bit</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_</span><span class="p">:</span>
                        <span class="n">atomic_axes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ax</span><span class="p">])</span>
                        <span class="n">seen_</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

            <span class="n">hack_axes_group_row</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--grouprows&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hack_axes_group_row</span><span class="p">:</span>
                <span class="n">groupid_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">axs</span> <span class="ow">in</span> <span class="n">atomic_axes</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">:</span>
                        <span class="n">groupid</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">colNum</span>
                    <span class="n">groupid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">groupid</span><span class="p">)</span>

                <span class="n">groups</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">group_items</span><span class="p">(</span><span class="n">atomic_axes</span><span class="p">,</span> <span class="n">groupid_list</span><span class="p">)</span>
                <span class="n">new_groups</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">emap</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">,</span> <span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">atomic_axes</span> <span class="o">=</span> <span class="n">new_groups</span>
                <span class="c1"># [[(ax.rowNum, ax.colNum) for ax in axs] for axs in atomic_axes]</span>
                <span class="c1"># save all rows of each column</span>

            <span class="n">subpath_list</span> <span class="o">=</span> <span class="n">save_parts</span><span class="p">(</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="n">fpath_strict</span><span class="p">,</span> <span class="n">grouped_axes</span><span class="o">=</span><span class="n">atomic_axes</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span>
            <span class="p">)</span>
            <span class="n">absfpath_</span> <span class="o">=</span> <span class="n">subpath_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">fpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">relpath</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">dpath</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">subpath_list</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">CLIP_WHITE</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">subpath</span> <span class="ow">in</span> <span class="n">subpath_list</span><span class="p">:</span>
                    <span class="c1"># remove white borders</span>
                    <span class="k">pass</span>
                    <span class="n">vt</span><span class="o">.</span><span class="n">clipwhite_ondisk</span><span class="p">(</span><span class="n">subpath</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">savekw</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># savekw[&#39;transparent&#39;] = fpath.endswith(&#39;.png&#39;) and not noalpha</span>
            <span class="n">savekw</span><span class="p">[</span><span class="s1">&#39;transparent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--alpha&#39;</span><span class="p">)</span>
            <span class="n">savekw</span><span class="p">[</span><span class="s1">&#39;dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpi</span>
            <span class="n">savekw</span><span class="p">[</span><span class="s1">&#39;edgecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
            <span class="n">savekw</span><span class="p">[</span><span class="s1">&#39;bbox_inches&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extract_axes_extents</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>  <span class="c1"># replaces need for clipwhite</span>
            <span class="n">absfpath_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truepath</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">absfpath_</span><span class="p">,</span> <span class="o">**</span><span class="n">savekw</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">CLIP_WHITE</span><span class="p">:</span>
                <span class="c1"># remove white borders</span>
                <span class="n">fpath_in</span> <span class="o">=</span> <span class="n">fpath_out</span> <span class="o">=</span> <span class="n">absfpath_</span>
                <span class="n">vt</span><span class="o">.</span><span class="n">clipwhite_ondisk</span><span class="p">(</span><span class="n">fpath_in</span><span class="p">,</span> <span class="n">fpath_out</span><span class="p">)</span>
                <span class="c1"># img = vt.imread(absfpath_)</span>
                <span class="c1"># thresh = 128</span>
                <span class="c1"># fillval = [255, 255, 255]</span>
                <span class="c1"># cropped_img = vt.crop_out_imgfill(img, fillval=fillval, thresh=thresh)</span>
                <span class="c1"># logger.info(&#39;img.shape = %r&#39; % (img.shape,))</span>
                <span class="c1"># logger.info(&#39;cropped_img.shape = %r&#39; % (cropped_img.shape,))</span>
                <span class="c1"># vt.imwrite(absfpath_, cropped_img)</span>
            <span class="c1"># if dpath is not None:</span>
            <span class="c1">#    fpath_ = ut.unixjoin(dpath, basename(absfpath_))</span>
            <span class="c1"># else:</span>
            <span class="c1">#    fpath_ = fpath</span>
            <span class="n">fpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">fpath_</span><span class="p">]</span>

        <span class="c1"># Print out latex info</span>
        <span class="n">default_caption</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">% ---</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">basename</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">% ---</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">default_label</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">fpath</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># [0].replace(&#39;_&#39;, &#39;&#39;)</span>
        <span class="n">caption_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--caption&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default_caption</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">caption_list</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">caption_str</span> <span class="o">=</span> <span class="n">caption_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">caption_str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">caption_list</span><span class="p">)</span>
        <span class="c1"># caption_str = ut.get_argval(&#39;--caption&#39;, type_=str,</span>
        <span class="c1"># default=basename(fpath).replace(&#39;_&#39;, &#39; &#39;))</span>
        <span class="n">label_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--label&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default_label</span><span class="p">)</span>
        <span class="n">width_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--width&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">textwidth&#39;</span><span class="p">)</span>
        <span class="n">width_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--width&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">textwidth&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;width_str = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">width_str</span><span class="p">,))</span>
        <span class="n">height_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--height&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">caplbl_str</span> <span class="o">=</span> <span class="n">label_str</span>

        <span class="k">if</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">ut</span><span class="o">.</span><span class="n">is_developer</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">latex_block</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">ImageCommand{&#39;</span>
                    <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s1">&#39;}{&#39;</span>
                    <span class="o">+</span> <span class="n">width_str</span>
                    <span class="o">+</span> <span class="s1">&#39;}{</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="o">+</span> <span class="n">caption_str</span>
                    <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">}{&#39;</span>
                    <span class="o">+</span> <span class="n">label_str</span>
                    <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">width_str</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
                <span class="n">latex_block</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">MultiImageCommandII&#39;</span>
                    <span class="o">+</span> <span class="s1">&#39;{&#39;</span>
                    <span class="o">+</span> <span class="n">label_str</span>
                    <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
                    <span class="o">+</span> <span class="s1">&#39;{&#39;</span>
                    <span class="o">+</span> <span class="n">width_str</span>
                    <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
                    <span class="o">+</span> <span class="s1">&#39;{&#39;</span>
                    <span class="o">+</span> <span class="n">caplbl_str</span>
                    <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
                    <span class="o">+</span> <span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="o">+</span> <span class="n">caption_str</span>
                    <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">}&#39;</span>
                    <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;}{&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
                <span class="p">)</span>
            <span class="c1"># HACK</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">RESHAPE</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--reshape&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">RESHAPE</span><span class="p">:</span>

                <span class="k">def</span> <span class="nf">list_reshape</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">new_shape</span><span class="p">):</span>
                        <span class="n">list_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">list_</span><span class="p">[</span><span class="n">i</span><span class="p">::</span><span class="n">dim</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">)])))</span>
                    <span class="k">return</span> <span class="n">list_</span>

                <span class="n">newshape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
                <span class="n">unflat_fpath_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">list_reshape</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">,</span> <span class="n">newshape</span><span class="p">,</span> <span class="n">trail</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">fpath_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">list_transpose</span><span class="p">(</span><span class="n">unflat_fpath_list</span><span class="p">))</span>

            <span class="n">caption_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">caplbl{&#39;</span> <span class="o">+</span> <span class="n">caplbl_str</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span> <span class="o">+</span> <span class="n">caption_str</span>
            <span class="n">figure_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">util_latex</span><span class="o">.</span><span class="n">get_latex_figure_str</span><span class="p">(</span>
                <span class="n">fpath_list</span><span class="p">,</span>
                <span class="n">label_str</span><span class="o">=</span><span class="n">label_str</span><span class="p">,</span>
                <span class="n">caption_str</span><span class="o">=</span><span class="n">caption_str</span><span class="p">,</span>
                <span class="n">width_str</span><span class="o">=</span><span class="n">width_str</span><span class="p">,</span>
                <span class="n">height_str</span><span class="o">=</span><span class="n">height_str</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># import sys</span>
            <span class="c1"># logger.info(sys.argv)</span>
            <span class="n">latex_block</span> <span class="o">=</span> <span class="n">figure_str</span>
            <span class="n">latex_block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">latex_newcommand</span><span class="p">(</span><span class="n">label_str</span><span class="p">,</span> <span class="n">latex_block</span><span class="p">)</span>
        <span class="c1"># latex_block = ut.codeblock(</span>
        <span class="c1">#    r&#39;&#39;&#39;</span>
        <span class="c1">#    \newcommand{\%s}{</span>
        <span class="c1">#    %s</span>
        <span class="c1">#    }</span>
        <span class="c1">#    &#39;&#39;&#39;</span>
        <span class="c1"># ) % (label_str, latex_block,)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">os</span>
            <span class="kn">import</span> <span class="nn">psutil</span>
            <span class="kn">import</span> <span class="nn">pipes</span>

            <span class="c1"># import shlex</span>
            <span class="c1"># TODO: separate into get_process_cmdline_str</span>
            <span class="c1"># TODO: replace home with ~</span>
            <span class="n">proc</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">pid</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
            <span class="n">home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)</span>
            <span class="n">cmdline_str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">pipes</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">home</span><span class="p">,</span> <span class="s1">&#39;~&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">proc</span><span class="o">.</span><span class="n">cmdline</span><span class="p">()]</span>
            <span class="p">)</span>
            <span class="n">latex_block</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
                    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                \begin{comment}</span>
<span class="sd">                %s</span>
<span class="sd">                \end{comment}</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="p">)</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">cmdline_str</span><span class="p">,)</span>
                <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="o">+</span> <span class="n">latex_block</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># latex_indent = &#39; &#39; * (4 * 2)</span>
        <span class="n">latex_indent</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">latex_block_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">latex_block</span><span class="p">,</span> <span class="n">latex_indent</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">print_code</span><span class="p">(</span><span class="n">latex_block_</span><span class="p">,</span> <span class="s1">&#39;latex&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;append&#39;</span> <span class="ow">in</span> <span class="n">arg_dict</span><span class="p">:</span>
            <span class="n">append_fpath</span> <span class="o">=</span> <span class="n">arg_dict</span><span class="p">[</span><span class="s1">&#39;append&#39;</span><span class="p">]</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">write_to</span><span class="p">(</span><span class="n">append_fpath</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">latex_block_</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">((</span><span class="s1">&#39;--diskshow&#39;</span><span class="p">,</span> <span class="s1">&#39;--ds&#39;</span><span class="p">)):</span>
            <span class="c1"># show what we wrote</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="n">absfpath_</span><span class="p">)</span>

        <span class="c1"># Hack write the corresponding logfile next to the output</span>
        <span class="n">log_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_current_log_fpath</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--savelog&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">log_fpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">log_fpath</span><span class="p">,</span> <span class="n">splitext</span><span class="p">(</span><span class="n">absfpath_</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Cannot copy log file because none exists&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">inIPython</span><span class="p">():</span>
        <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

        <span class="n">pt</span><span class="o">.</span><span class="n">iup</span><span class="p">()</span>
    <span class="c1"># elif ut.get_argflag(&#39;--cmd&#39;):</span>
    <span class="c1">#     import wbia.plottool as pt</span>
    <span class="c1">#     pt.draw()</span>
    <span class="c1">#     ut.embed(N=N)</span>
    <span class="k">elif</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--cmd&#39;</span><span class="p">):</span>
        <span class="c1"># cmd must handle show I think</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--show&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--tile&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_computer_name</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hyrule&#39;</span><span class="p">]:</span>
                <span class="n">fig_presenter</span><span class="o">.</span><span class="n">all_figures_tile</span><span class="p">(</span><span class="n">percent_w</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">monitor_num</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig_presenter</span><span class="o">.</span><span class="n">all_figures_tile</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--present&#39;</span><span class="p">):</span>
            <span class="n">fig_presenter</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">fig_presenter</span><span class="o">.</span><span class="n">get_all_figures</span><span class="p">():</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_dpi</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="distinct_markers"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.distinct_markers">[docs]</a><span class="k">def</span> <span class="nf">distinct_markers</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;astrisk&#39;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        num (?):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-distinct_markers --show</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-distinct_markers --mstyle=star --show</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-distinct_markers --mstyle=polygon --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; style = ut.get_argval(&#39;--mstyle&#39;, type_=str, default=&#39;astrisk&#39;)</span>
<span class="sd">        &gt;&gt;&gt; marker_list = distinct_markers(10, style)</span>
<span class="sd">        &gt;&gt;&gt; x_data = np.arange(0, 3)</span>
<span class="sd">        &gt;&gt;&gt; for count, (marker) in enumerate(marker_list):</span>
<span class="sd">        &gt;&gt;&gt;     pt.plot(x_data, [count] * len(x_data), marker=marker, markersize=10, linestyle=&#39;&#39;, label=str(marker))</span>
<span class="sd">        &gt;&gt;&gt; pt.legend()</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_sides</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">style_num</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;astrisk&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;star&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;polygon&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;circle&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}[</span><span class="n">style</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">total</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">num</span>
    <span class="n">total_degrees</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">/</span> <span class="n">num_sides</span>
    <span class="n">marker_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">num_sides</span><span class="p">,</span> <span class="n">style_num</span><span class="p">,</span> <span class="n">total_degrees</span> <span class="o">*</span> <span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">marker_list</span></div>


<div class="viewcode-block" id="get_all_markers"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.get_all_markers">[docs]</a><span class="k">def</span> <span class="nf">get_all_markers</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-get_all_markers --show</span>

<span class="sd">    References:</span>
<span class="sd">        http://matplotlib.org/1.3.1/examples/pylab_examples/line_styles.html</span>
<span class="sd">        http://matplotlib.org/api/markers_api.html#matplotlib.markers.MarkerStyle.markers</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; marker_dict = get_all_markers()</span>
<span class="sd">        &gt;&gt;&gt; x_data = np.arange(0, 3)</span>
<span class="sd">        &gt;&gt;&gt; for count, (marker, name) in enumerate(marker_dict.items()):</span>
<span class="sd">        &gt;&gt;&gt;     pt.plot(x_data, [count] * len(x_data), marker=marker, linestyle=&#39;&#39;, label=name)</span>
<span class="sd">        &gt;&gt;&gt; pt.legend()</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">marker_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;tickleft&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;tickright&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;tickup&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;tickdown&#39;</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;caretleft&#39;</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;caretright&#39;</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;caretup&#39;</span><span class="p">,</span>
        <span class="mi">7</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;caretdown&#39;</span><span class="p">,</span>
        <span class="c1"># None: u&#39;nothing&#39;,</span>
        <span class="c1"># u&#39;None&#39;: u&#39;nothing&#39;,</span>
        <span class="c1"># u&#39; &#39;: u&#39;nothing&#39;,</span>
        <span class="c1"># u&#39;&#39;: u&#39;nothing&#39;,</span>
        <span class="sa">u</span><span class="s1">&#39;*&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;star&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;+&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;plus&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;,&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;pixel&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;.&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;point&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;tri_down&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;tri_up&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;tri_left&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;tri_right&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;8&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;octagon&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;&lt;&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;triangle_left&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;&gt;&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;triangle_right&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;diamond&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;hexagon2&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;^&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;triangle_up&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;_&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;hline&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;thin_diamond&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;hexagon1&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;o&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;pentagon&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;square&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;triangle_down&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;|&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;vline&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="c1"># marker_list = marker_dict.keys()</span>
    <span class="c1"># marker_list = [&#39;.&#39;, &#39;,&#39;, &#39;o&#39;, &#39;v&#39;, &#39;^&#39;, &#39;&lt;&#39;, &#39;&gt;&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;8&#39;, &#39;s&#39;, &#39;p&#39;, &#39;*&#39;,</span>
    <span class="c1">#               &#39;h&#39;, &#39;H&#39;, &#39;+&#39;, &#39;x&#39;, &#39;D&#39;, &#39;d&#39;, &#39;|&#39;, &#39;_&#39;, &#39;TICKLEFT&#39;, &#39;TICKRIGHT&#39;, &#39;TICKUP&#39;,</span>
    <span class="c1">#               &#39;TICKDOWN&#39;, &#39;CARETLEFT&#39;, &#39;CARETRIGHT&#39;, &#39;CARETUP&#39;, &#39;CARETDOWN&#39;]</span>
    <span class="k">return</span> <span class="n">marker_dict</span></div>


<div class="viewcode-block" id="get_pnum_func"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.get_pnum_func">[docs]</a><span class="k">def</span> <span class="nf">get_pnum_func</span><span class="p">(</span><span class="n">nRows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nCols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">base</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;use base 0&#39;</span>
    <span class="n">offst</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">pnum_</span><span class="p">(</span><span class="n">px</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">nRows</span><span class="p">,</span> <span class="n">nCols</span><span class="p">,</span> <span class="n">px</span> <span class="o">+</span> <span class="n">offst</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pnum_</span></div>


<div class="viewcode-block" id="pnum_generator"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.pnum_generator">[docs]</a><span class="k">def</span> <span class="nf">pnum_generator</span><span class="p">(</span><span class="n">nRows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nCols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nSubplots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        nRows (int): (default = 1)</span>
<span class="sd">        nCols (int): (default = 1)</span>
<span class="sd">        base (int): (default = 0)</span>
<span class="sd">        nSubplots (None): (default = None)</span>

<span class="sd">    Yields:</span>
<span class="sd">        tuple : pnum</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-pnum_generator --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; nRows = 3</span>
<span class="sd">        &gt;&gt;&gt; nCols = 2</span>
<span class="sd">        &gt;&gt;&gt; base = 0</span>
<span class="sd">        &gt;&gt;&gt; pnum_ = pnum_generator(nRows, nCols, base)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(list(pnum_), nl=1, nobr=True)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        (3, 2, 1),</span>
<span class="sd">        (3, 2, 2),</span>
<span class="sd">        (3, 2, 3),</span>
<span class="sd">        (3, 2, 4),</span>
<span class="sd">        (3, 2, 5),</span>
<span class="sd">        (3, 2, 6),</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; nRows = 3</span>
<span class="sd">        &gt;&gt;&gt; nCols = 2</span>
<span class="sd">        &gt;&gt;&gt; pnum_ = pnum_generator(nRows, nCols, start=3)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(list(pnum_), nl=1, nobr=True)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        (3, 2, 4),</span>
<span class="sd">        (3, 2, 5),</span>
<span class="sd">        (3, 2, 6),</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pnum_func</span> <span class="o">=</span> <span class="n">get_pnum_func</span><span class="p">(</span><span class="n">nRows</span><span class="p">,</span> <span class="n">nCols</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
    <span class="n">total_plots</span> <span class="o">=</span> <span class="n">nRows</span> <span class="o">*</span> <span class="n">nCols</span>
    <span class="c1"># TODO: have the last pnums fill in the whole figure</span>
    <span class="c1"># when there are less subplots than rows * cols</span>
    <span class="c1"># if nSubplots is not None:</span>
    <span class="c1">#    if nSubplots &lt; total_plots:</span>
    <span class="c1">#        pass</span>
    <span class="k">for</span> <span class="n">px</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">total_plots</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">pnum_func</span><span class="p">(</span><span class="n">px</span><span class="p">)</span></div>


<div class="viewcode-block" id="make_pnum_nextgen"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.make_pnum_nextgen">[docs]</a><span class="k">def</span> <span class="nf">make_pnum_nextgen</span><span class="p">(</span><span class="n">nRows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nCols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nSubplots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        nRows (None): (default = None)</span>
<span class="sd">        nCols (None): (default = None)</span>
<span class="sd">        base (int): (default = 0)</span>
<span class="sd">        nSubplots (None): (default = None)</span>
<span class="sd">        start (int): (default = 0)</span>

<span class="sd">    Returns:</span>
<span class="sd">        iterator: pnum_next</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-make_pnum_nextgen --show</span>

<span class="sd">    GridParams:</span>
<span class="sd">        &gt;&gt;&gt; param_grid = dict(</span>
<span class="sd">        &gt;&gt;&gt;     nRows=[None, 3],</span>
<span class="sd">        &gt;&gt;&gt;     nCols=[None, 3],</span>
<span class="sd">        &gt;&gt;&gt;     nSubplots=[None, 9],</span>
<span class="sd">        &gt;&gt;&gt; )</span>
<span class="sd">        &gt;&gt;&gt; combos = ut.all_dict_combinations(param_grid)</span>

<span class="sd">    GridExample:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; base, start = 0, 0</span>
<span class="sd">        &gt;&gt;&gt; pnum_next = make_pnum_nextgen(nRows, nCols, base, nSubplots, start)</span>
<span class="sd">        &gt;&gt;&gt; pnum_list = list( (pnum_next() for _ in it.count()) )</span>
<span class="sd">        &gt;&gt;&gt; print((nRows, nCols, nSubplots))</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;pnum_list = %s&#39; % (ut.repr2(pnum_list),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">functools</span>

    <span class="n">nRows</span><span class="p">,</span> <span class="n">nCols</span> <span class="o">=</span> <span class="n">get_num_rc</span><span class="p">(</span><span class="n">nSubplots</span><span class="p">,</span> <span class="n">nRows</span><span class="p">,</span> <span class="n">nCols</span><span class="p">)</span>

    <span class="n">pnum_gen</span> <span class="o">=</span> <span class="n">pnum_generator</span><span class="p">(</span>
        <span class="n">nRows</span><span class="o">=</span><span class="n">nRows</span><span class="p">,</span> <span class="n">nCols</span><span class="o">=</span><span class="n">nCols</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">nSubplots</span><span class="o">=</span><span class="n">nSubplots</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span>
    <span class="p">)</span>
    <span class="n">pnum_next</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">next</span><span class="p">,</span> <span class="n">pnum_gen</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pnum_next</span></div>


<div class="viewcode-block" id="get_num_rc"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.get_num_rc">[docs]</a><span class="k">def</span> <span class="nf">get_num_rc</span><span class="p">(</span><span class="n">nSubplots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nRows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nCols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets a constrained row column plot grid</span>

<span class="sd">    Args:</span>
<span class="sd">        nSubplots (None): (default = None)</span>
<span class="sd">        nRows (None): (default = None)</span>
<span class="sd">        nCols (None): (default = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (nRows, nCols)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 get_num_rc</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; cases = [</span>
<span class="sd">        &gt;&gt;&gt;     dict(nRows=None, nCols=None, nSubplots=None),</span>
<span class="sd">        &gt;&gt;&gt;     dict(nRows=2, nCols=None, nSubplots=5),</span>
<span class="sd">        &gt;&gt;&gt;     dict(nRows=None, nCols=2, nSubplots=5),</span>
<span class="sd">        &gt;&gt;&gt;     dict(nRows=None, nCols=None, nSubplots=5),</span>
<span class="sd">        &gt;&gt;&gt; ]</span>
<span class="sd">        &gt;&gt;&gt; for kw in cases:</span>
<span class="sd">        &gt;&gt;&gt;     print(&#39;----&#39;)</span>
<span class="sd">        &gt;&gt;&gt;     size = get_num_rc(**kw)</span>
<span class="sd">        &gt;&gt;&gt;     if kw[&#39;nSubplots&#39;] is not None:</span>
<span class="sd">        &gt;&gt;&gt;         assert size[0] * size[1] &gt;= kw[&#39;nSubplots&#39;]</span>
<span class="sd">        &gt;&gt;&gt;     print(&#39;**kw = %s&#39; % (ut.repr2(kw),))</span>
<span class="sd">        &gt;&gt;&gt;     print(&#39;size = %r&#39; % (size,))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nSubplots</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nRows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nRows</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">nCols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nCols</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nRows</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nCols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="kn">import</span> <span class="n">plot_helpers</span>

            <span class="n">nRows</span><span class="p">,</span> <span class="n">nCols</span> <span class="o">=</span> <span class="n">plot_helpers</span><span class="o">.</span><span class="n">get_square_row_cols</span><span class="p">(</span><span class="n">nSubplots</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">nRows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nCols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nSubplots</span> <span class="o">/</span> <span class="n">nRows</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">nCols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nRows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nSubplots</span> <span class="o">/</span> <span class="n">nCols</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">nRows</span><span class="p">,</span> <span class="n">nCols</span></div>


<div class="viewcode-block" id="fnum_generator"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.fnum_generator">[docs]</a><span class="k">def</span> <span class="nf">fnum_generator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">fnum</span> <span class="o">=</span> <span class="n">base</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">fnum</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="n">fnum</span></div>


<div class="viewcode-block" id="make_fnum_nextgen"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.make_fnum_nextgen">[docs]</a><span class="k">def</span> <span class="nf">make_fnum_nextgen</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">functools</span>

    <span class="n">fnum_gen</span> <span class="o">=</span> <span class="n">fnum_generator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">)</span>
    <span class="n">fnum_next</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">next</span><span class="p">,</span> <span class="n">fnum_gen</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fnum_next</span></div>


<span class="n">BASE_FNUM</span> <span class="o">=</span> <span class="mi">9001</span>


<div class="viewcode-block" id="next_fnum"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.next_fnum">[docs]</a><span class="k">def</span> <span class="nf">next_fnum</span><span class="p">(</span><span class="n">new_base</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">BASE_FNUM</span>
    <span class="k">if</span> <span class="n">new_base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">BASE_FNUM</span> <span class="o">=</span> <span class="n">new_base</span>
    <span class="n">BASE_FNUM</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">BASE_FNUM</span></div>


<div class="viewcode-block" id="ensure_fnum"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.ensure_fnum">[docs]</a><span class="k">def</span> <span class="nf">ensure_fnum</span><span class="p">(</span><span class="n">fnum</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">fnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">next_fnum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fnum</span></div>


<div class="viewcode-block" id="execstr_global"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.execstr_global">[docs]</a><span class="k">def</span> <span class="nf">execstr_global</span><span class="p">():</span>
    <span class="n">execstr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;global&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">execstr</span></div>


<div class="viewcode-block" id="label_to_colors"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.label_to_colors">[docs]</a><span class="k">def</span> <span class="nf">label_to_colors</span><span class="p">(</span><span class="n">labels_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns a unique and distinct color corresponding to each label</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unique_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels_</span><span class="p">))</span>
    <span class="n">unique_colors</span> <span class="o">=</span> <span class="n">distinct_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">))</span>
    <span class="n">label2_color</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">,</span> <span class="n">unique_colors</span><span class="p">))</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">label2_color</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels_</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">color_list</span></div>


<span class="c1"># def distinct_colors(N, brightness=.878, shuffle=True):</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    Args:</span>
<span class="c1">#        N (int): number of distinct colors</span>
<span class="c1">#        brightness (float): brightness of colors (maximum distinctiveness is .5) default is .878</span>
<span class="c1">#    Returns:</span>
<span class="c1">#        RGB_tuples</span>
<span class="c1">#    Example:</span>
<span class="c1">#        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    # http://blog.jianhuashao.com/2011/09/generate-n-distinct-colors.html</span>
<span class="c1">#    sat = brightness</span>
<span class="c1">#    val = brightness</span>
<span class="c1">#    HSV_tuples = [(x * 1.0 / N, sat, val) for x in range(N)]</span>
<span class="c1">#    RGB_tuples = list(map(lambda x: colorsys.hsv_to_rgb(*x), HSV_tuples))</span>
<span class="c1">#    if shuffle:</span>
<span class="c1">#        ut.deterministic_shuffle(RGB_tuples)</span>
<span class="c1">#    return RGB_tuples</span>


<div class="viewcode-block" id="add_alpha"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.add_alpha">[docs]</a><span class="k">def</span> <span class="nf">add_alpha</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_axis_xy_width_height"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.get_axis_xy_width_height">[docs]</a><span class="k">def</span> <span class="nf">get_axis_xy_width_height</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xaug</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">yaug</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">waug</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">haug</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; gets geometry of a subplot &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">autoAxis</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">autoAxis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">xaug</span><span class="p">,</span> <span class="n">autoAxis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">yaug</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">autoAxis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">autoAxis</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">waug</span>
    <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">autoAxis</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">autoAxis</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">haug</span>
    <span class="k">return</span> <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span></div>


<div class="viewcode-block" id="get_axis_bbox"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.get_axis_bbox">[docs]</a><span class="k">def</span> <span class="nf">get_axis_bbox</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # returns in figure coordinates?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_axis_xy_width_height</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_border"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_border">[docs]</a><span class="k">def</span> <span class="nf">draw_border</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">GREEN</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;draws rectangle border around a subplot&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">adjust</span><span class="p">:</span>
        <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_axis_xy_width_height</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_axis_xy_width_height</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xoff</span><span class="p">,</span> <span class="n">yoff</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="p">[</span><span class="n">xoff</span><span class="p">,</span> <span class="n">yoff</span><span class="p">]</span>
        <span class="n">height</span> <span class="o">=</span> <span class="o">-</span><span class="n">height</span> <span class="o">-</span> <span class="n">yoff</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">width</span> <span class="o">-</span> <span class="n">xoff</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
    <span class="n">rect</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">rect</span><span class="o">.</span><span class="n">set_fill</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">rect</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rect</span></div>


<span class="n">TAU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span>


<div class="viewcode-block" id="rotate_plot"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.rotate_plot">[docs]</a><span class="k">def</span> <span class="nf">rotate_plot</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="n">TAU</span> <span class="o">/</span> <span class="mi">8</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        theta (?):</span>
<span class="sd">        ax (None):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --test-rotate_plot</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; ax = gca()</span>
<span class="sd">        &gt;&gt;&gt; theta = TAU / 8</span>
<span class="sd">        &gt;&gt;&gt; plt.plot([1, 2, 3, 4, 5], [1, 2, 3, 2, 2])</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; result = rotate_plot(theta, ax)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="c1"># import vtool as vt</span>
    <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_axis_xy_width_height</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">(</span><span class="n">vt</span><span class="o">.</span><span class="n">rotation_around_bbox_mat3x3</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">bbox</span><span class="p">))</span>
    <span class="n">propname</span> <span class="o">=</span> <span class="s1">&#39;transAxes&#39;</span>
    <span class="c1"># propname = &#39;transData&#39;</span>
    <span class="n">T</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">propname</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="n">transform_affine</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="c1"># T = ax.get_transform()</span>
    <span class="c1"># Tnew = T + M</span>
    <span class="c1"># ax.set_transform(Tnew)</span>
    <span class="c1"># setattr(ax, propname, Tnew)</span>
    <span class="n">iup</span><span class="p">()</span></div>


<div class="viewcode-block" id="cartoon_stacked_rects"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.cartoon_stacked_rects">[docs]</a><span class="k">def</span> <span class="nf">cartoon_stacked_rects</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pt.figure()</span>
<span class="sd">    xy = (.5, .5)</span>
<span class="sd">    width = .2</span>
<span class="sd">    height = .2</span>
<span class="sd">    ax = pt.gca()</span>
<span class="sd">    ax.add_collection(col)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">shift</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.1</span> <span class="o">/</span> <span class="n">num</span><span class="p">)</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
    <span class="n">rectkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">ec</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ec&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">lw</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linestyle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">patch_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">xy</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">*</span> <span class="n">count</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="o">**</span><span class="n">rectkw</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
    <span class="p">]</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">PatchCollection</span><span class="p">(</span><span class="n">patch_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">col</span></div>


<div class="viewcode-block" id="make_bbox"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.make_bbox">[docs]</a><span class="k">def</span> <span class="nf">make_bbox</span><span class="p">(</span>
    <span class="n">bbox</span><span class="p">,</span>
    <span class="n">theta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">bbox_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rw</span><span class="p">,</span> <span class="n">rh</span><span class="p">)</span> <span class="o">=</span> <span class="n">bbox</span>
    <span class="c1"># Transformations are specified in backwards order.</span>
    <span class="n">trans_annotation</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="s1">&#39;center&#39;</span><span class="p">:</span>
        <span class="n">trans_annotation</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">rw</span><span class="p">,</span> <span class="n">rh</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">align</span> <span class="o">==</span> <span class="s1">&#39;outer&#39;</span><span class="p">:</span>
        <span class="n">trans_annotation</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">rw</span> <span class="o">+</span> <span class="p">(</span><span class="n">lw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">rh</span> <span class="o">+</span> <span class="p">(</span><span class="n">lw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">align</span> <span class="o">==</span> <span class="s1">&#39;inner&#39;</span><span class="p">:</span>
        <span class="n">trans_annotation</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">rw</span> <span class="o">-</span> <span class="p">(</span><span class="n">lw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">rh</span> <span class="o">-</span> <span class="p">(</span><span class="n">lw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

    <span class="n">trans_annotation</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">trans_annotation</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">rx</span> <span class="o">+</span> <span class="n">rw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ry</span> <span class="o">+</span> <span class="n">rh</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">t_end</span> <span class="o">=</span> <span class="n">trans_annotation</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">t_end</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">bbox</span><span class="o">.</span><span class="n">set_fill</span><span class="p">(</span><span class="n">fill</span> <span class="k">if</span> <span class="n">fill</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">bbox</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="c1"># bbox.set_transform(trans)</span>
    <span class="n">bbox</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">bbox_color</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bbox</span></div>


<span class="c1"># TODO SEPARTE THIS INTO DRAW BBOX AND DRAW_ANNOTATION</span>
<div class="viewcode-block" id="draw_bbox"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_bbox">[docs]</a><span class="k">def</span> <span class="nf">draw_bbox</span><span class="p">(</span>
    <span class="n">bbox</span><span class="p">,</span>
    <span class="n">lbl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">bbox_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">lbl_bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">lbl_txtcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">draw_arrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">theta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rw</span><span class="p">,</span> <span class="n">rh</span><span class="p">)</span> <span class="o">=</span> <span class="n">bbox</span>
    <span class="c1"># Transformations are specified in backwards order.</span>
    <span class="n">trans_annotation</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span>
    <span class="n">trans_annotation</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">rw</span><span class="p">,</span> <span class="n">rh</span><span class="p">)</span>
    <span class="n">trans_annotation</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">trans_annotation</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">rx</span> <span class="o">+</span> <span class="n">rw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ry</span> <span class="o">+</span> <span class="n">rh</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">t_end</span> <span class="o">=</span> <span class="n">trans_annotation</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">t_end</span><span class="p">)</span>
    <span class="n">bbox</span><span class="o">.</span><span class="n">set_fill</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># bbox.set_transform(trans)</span>
    <span class="n">bbox</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">bbox_color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>
    <span class="c1"># Draw overhead arrow indicating the top of the ANNOTATION</span>
    <span class="k">if</span> <span class="n">draw_arrow</span><span class="p">:</span>
        <span class="n">arw_xydxdy</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">arw_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">head_width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">t_end</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">arrow</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">FancyArrow</span><span class="p">(</span><span class="o">*</span><span class="n">arw_xydxdy</span><span class="p">,</span> <span class="o">**</span><span class="n">arw_kw</span><span class="p">)</span>
        <span class="n">arrow</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">bbox_color</span><span class="p">)</span>
        <span class="n">arrow</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">bbox_color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">arrow</span><span class="p">)</span>
    <span class="c1"># Draw a label</span>
    <span class="k">if</span> <span class="n">lbl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax_absolute_text</span><span class="p">(</span>
            <span class="n">rx</span><span class="p">,</span>
            <span class="n">ry</span><span class="p">,</span>
            <span class="n">lbl</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">lbl_txtcolor</span><span class="p">,</span>
            <span class="n">backgroundcolor</span><span class="o">=</span><span class="n">lbl_bgcolor</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="plot"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.plot">[docs]</a><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">yscale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;yscale&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">)</span>
    <span class="n">xscale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xscale&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">)</span>
    <span class="n">logscale_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;logscale_kwargs&#39;</span><span class="p">,</span> <span class="p">{})</span>  <span class="c1"># , {&#39;nonposx&#39;: &#39;clip&#39;})</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">yscale_kwargs</span> <span class="o">=</span> <span class="n">logscale_kwargs</span> <span class="k">if</span> <span class="n">yscale</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;symlog&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="n">xscale_kwargs</span> <span class="o">=</span> <span class="n">logscale_kwargs</span> <span class="k">if</span> <span class="n">xscale</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;symlog&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">yscale</span><span class="p">,</span> <span class="o">**</span><span class="n">yscale_kwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">,</span> <span class="o">**</span><span class="n">xscale_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plot</span></div>


<div class="viewcode-block" id="plot2"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.plot2">[docs]</a><span class="k">def</span> <span class="nf">plot2</span><span class="p">(</span>
    <span class="n">x_data</span><span class="p">,</span>
    <span class="n">y_data</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="n">title_pref</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
    <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
    <span class="n">unitbox</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">flipx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">flipy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dark</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">equal_aspect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    don&#39;t forget to call pt.legend</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        linewidth (float):</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">warnstr</span> <span class="o">=</span> <span class="s1">&#39;[df2] ! Warning:  x_data is None&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">warnstr</span><span class="p">)</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_data</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">fnum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pnum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">)</span>
    <span class="n">do_plot</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># ensure length</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_data</span><span class="p">):</span>
        <span class="n">warnstr</span> <span class="o">=</span> <span class="s1">&#39;[df2] ! Warning:  len(x_data) != len(y_data). Cannot plot2&#39;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warnstr</span><span class="p">)</span>
        <span class="n">draw_text</span><span class="p">(</span><span class="n">warnstr</span><span class="p">)</span>
        <span class="n">do_plot</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">warnstr</span> <span class="o">=</span> <span class="s1">&#39;[df2] ! Warning:  len(x_data) == 0. Cannot plot2&#39;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warnstr</span><span class="p">)</span>
        <span class="n">draw_text</span><span class="p">(</span><span class="n">warnstr</span><span class="p">)</span>
        <span class="n">do_plot</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># ensure in ndarray</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">do_plot</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">min_x</span> <span class="o">=</span> <span class="n">x_data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">min_y</span> <span class="o">=</span> <span class="n">y_data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">max_x</span> <span class="o">=</span> <span class="n">x_data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">max_y</span> <span class="o">=</span> <span class="n">y_data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">min_</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">)</span>
        <span class="n">max_</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">equal_aspect</span><span class="p">:</span>
            <span class="c1"># Equal aspect ratio</span>
            <span class="k">if</span> <span class="n">unitbox</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># Just plot a little bit outside  the box</span>
                <span class="n">set_axis_limit</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
                <span class="c1"># ax.grid(True)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">set_axis_limit</span><span class="p">(</span><span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
                <span class="c1"># aspect_opptions = [&#39;auto&#39;, &#39;equal&#39;, num]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pad</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">min_x</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">min_y</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span>
        <span class="c1"># ax.grid(True, color=&#39;w&#39; if dark else &#39;k&#39;)</span>
        <span class="k">if</span> <span class="n">flipx</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">flipy</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

        <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="n">dark</span>
        <span class="k">if</span> <span class="n">use_darkbackground</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

            <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">is_default_dark_bg</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">use_darkbackground</span><span class="p">:</span>
            <span class="n">dark_background</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># No data, draw big red x</span>
        <span class="n">draw_boxedX</span><span class="p">()</span>

    <span class="n">presetup_axes</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span> <span class="n">title_pref</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="pad_axes"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.pad_axes">[docs]</a><span class="k">def</span> <span class="nf">pad_axes</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">xlim</span>
    <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="n">ylim</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">min_x</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">min_y</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span></div>


<div class="viewcode-block" id="presetup_axes"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.presetup_axes">[docs]</a><span class="k">def</span> <span class="nf">presetup_axes</span><span class="p">(</span>
    <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
    <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
    <span class="n">title_pref</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">equal_aspect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">x_label</span> <span class="o">+</span> <span class="s1">&#39; vs &#39;</span> <span class="o">+</span> <span class="n">y_label</span>
    <span class="n">set_title</span><span class="p">(</span><span class="n">title_pref</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">title</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">equal_aspect</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="postsetup_axes"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.postsetup_axes">[docs]</a><span class="k">def</span> <span class="nf">postsetup_axes</span><span class="p">(</span><span class="n">use_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="k">if</span> <span class="n">bg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pt</span><span class="o">.</span><span class="n">is_default_dark_bg</span><span class="p">():</span>
            <span class="n">bg</span> <span class="o">=</span> <span class="s1">&#39;dark&#39;</span>

    <span class="k">if</span> <span class="n">bg</span> <span class="o">==</span> <span class="s1">&#39;dark&#39;</span><span class="p">:</span>
        <span class="n">dark_background</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">use_legend</span><span class="p">:</span>
        <span class="n">legend</span><span class="p">()</span></div>


<div class="viewcode-block" id="adjust_subplots"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.adjust_subplots">[docs]</a><span class="k">def</span> <span class="nf">adjust_subplots</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wspace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">hspace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">use_argv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        left (float): left side of the subplots of the figure</span>
<span class="sd">        right (float): right side of the subplots of the figure</span>
<span class="sd">        bottom (float): bottom of the subplots of the figure</span>
<span class="sd">        top (float): top of the subplots of the figure</span>
<span class="sd">        wspace (float): width reserved for blank space between subplots</span>
<span class="sd">        hspace (float): height reserved for blank space between subplots</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span>
    <span class="p">)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">gcf</span><span class="p">()</span>
    <span class="n">subplotpars</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span>
    <span class="n">adjust_dict</span> <span class="o">=</span> <span class="n">subplotpars</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">adjust_dict</span><span class="p">[</span><span class="s1">&#39;validate&#39;</span><span class="p">]</span>
    <span class="n">adjust_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_argv</span><span class="p">:</span>
        <span class="c1"># hack to take args from commandline</span>
        <span class="n">adjust_dict</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">parse_dict_from_argv</span><span class="p">(</span><span class="n">adjust_dict</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="o">**</span><span class="n">adjust_dict</span><span class="p">)</span></div>


<span class="c1"># =======================</span>
<span class="c1"># TEXT FUNCTIONS</span>
<span class="c1"># TODO: I have too many of these. Need to consolidate</span>
<span class="c1"># =======================</span>


<div class="viewcode-block" id="upperleft_text"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.upperleft_text">[docs]</a><span class="k">def</span> <span class="nf">upperleft_text</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">txtargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
        <span class="n">backgroundcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">ORANGE</span> <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">color</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">relative_text</span><span class="p">((</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span> <span class="n">txt</span><span class="p">,</span> <span class="o">**</span><span class="n">txtargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="upperright_text"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.upperright_text">[docs]</a><span class="k">def</span> <span class="nf">upperright_text</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
    <span class="n">txtargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
        <span class="n">backgroundcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">ORANGE</span><span class="p">,</span>
        <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">relative_text</span><span class="p">((</span><span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span> <span class="n">txt</span><span class="p">,</span> <span class="o">**</span><span class="n">txtargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="lowerright_text"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.lowerright_text">[docs]</a><span class="k">def</span> <span class="nf">lowerright_text</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>
    <span class="n">txtargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
        <span class="n">backgroundcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">ORANGE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">relative_text</span><span class="p">((</span><span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">),</span> <span class="n">txt</span><span class="p">,</span> <span class="o">**</span><span class="n">txtargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="absolute_lbl"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.absolute_lbl">[docs]</a><span class="k">def</span> <span class="nf">absolute_lbl</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">roffset</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; alternative to relative text &quot;&quot;&quot;</span>
    <span class="n">txtargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
        <span class="n">backgroundcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">ORANGE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">txtargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax_absolute_text</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">roffset</span><span class="o">=</span><span class="n">roffset</span><span class="p">,</span> <span class="o">**</span><span class="n">txtargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="absolute_text"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.absolute_text">[docs]</a><span class="k">def</span> <span class="nf">absolute_text</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">ax_absolute_text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="relative_text"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.relative_text">[docs]</a><span class="k">def</span> <span class="nf">relative_text</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Places text on axes in a relative position</span>

<span class="sd">    Args:</span>
<span class="sd">        pos (tuple): relative xy position</span>
<span class="sd">        text (str): text</span>
<span class="sd">        ax (None): (default = None)</span>
<span class="sd">        offset (None): (default = None)</span>
<span class="sd">        **kwargs: horizontalalignment, verticalalignment, roffset, ha, va,</span>
<span class="sd">                  fontsize, fontproperties, fontproperties, clip_on</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 relative_text --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; x = .5</span>
<span class="sd">        &gt;&gt;&gt; y = .5</span>
<span class="sd">        &gt;&gt;&gt; txt = &#39;Hello World&#39;</span>
<span class="sd">        &gt;&gt;&gt; pt.figure()</span>
<span class="sd">        &gt;&gt;&gt; ax = pt.gca()</span>
<span class="sd">        &gt;&gt;&gt; family = &#39;monospace&#39;</span>
<span class="sd">        &gt;&gt;&gt; family = &#39;CMU Typewriter Text&#39;</span>
<span class="sd">        &gt;&gt;&gt; fontproperties = mpl.font_manager.FontProperties(family=family,</span>
<span class="sd">        &gt;&gt;&gt;                                                  size=42)</span>
<span class="sd">        &gt;&gt;&gt; result = relative_text((x, y), txt, ax, halign=&#39;center&#39;,</span>
<span class="sd">        &gt;&gt;&gt;                           fontproperties=fontproperties)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;lowerleft&#39;</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;halign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;valign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
    <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;upperleft&#39;</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;halign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;valign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;halign&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;horizontalalignment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;halign&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;valign&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verticalalignment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;valign&#39;</span><span class="p">)</span>
    <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_axis_xy_width_height</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span> <span class="o">=</span> <span class="p">((</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xoff</span><span class="p">,</span> <span class="n">yoff</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="n">x_</span> <span class="o">+=</span> <span class="n">xoff</span>
        <span class="n">y_</span> <span class="o">+=</span> <span class="n">yoff</span>
    <span class="n">absolute_text</span><span class="p">((</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">),</span> <span class="n">text</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="parse_fontkw"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.parse_fontkw">[docs]</a><span class="k">def</span> <span class="nf">parse_fontkw</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kwargs:</span>
<span class="sd">        fontsize, fontfamilty, fontproperties</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">matplotlib.font_manager</span> <span class="kn">import</span> <span class="n">FontProperties</span>

    <span class="k">if</span> <span class="s1">&#39;fontproperties&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fontsize&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fontweight&#39;</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">)</span>
        <span class="n">fontname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fontname&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fontname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO catch user warning</span>
            <span class="s1">&#39;/usr/share/fonts/truetype/&#39;</span>
            <span class="s1">&#39;/usr/share/fonts/opentype/&#39;</span>
            <span class="n">fontpath</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">findfont</span><span class="p">(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">fallback_to_default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">font_prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fontpath</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">family</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fontfamilty&#39;</span><span class="p">,</span> <span class="s1">&#39;monospace&#39;</span><span class="p">)</span>
            <span class="n">font_prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">family</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">font_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontproperties&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">font_prop</span></div>


<div class="viewcode-block" id="ax_absolute_text"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.ax_absolute_text">[docs]</a><span class="k">def</span> <span class="nf">ax_absolute_text</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">roffset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base function for text</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        horizontalalignment in [&#39;right&#39;, &#39;center&#39;, &#39;left&#39;],</span>
<span class="sd">        verticalalignment in [&#39;top&#39;]</span>
<span class="sd">        color</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;ha&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;horizontalalignment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ha&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;va&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verticalalignment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;va&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;fontproperties&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;fontsize&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span>
            <span class="n">font_prop</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;monospace&#39;</span><span class="p">,</span>
                <span class="c1"># weight=&#39;light&#39;,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontproperties&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">font_prop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontproperties&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;monospace&#39;</span><span class="p">)</span>
            <span class="c1"># custom_constants.FONTS.relative</span>

    <span class="k">if</span> <span class="s1">&#39;clip_on&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;clip_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">roffset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xroff</span><span class="p">,</span> <span class="n">yroff</span> <span class="o">=</span> <span class="n">roffset</span>
        <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_axis_xy_width_height</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">x_</span> <span class="o">+=</span> <span class="n">xroff</span> <span class="o">*</span> <span class="n">width</span>
        <span class="n">y_</span> <span class="o">+=</span> <span class="n">yroff</span> <span class="o">*</span> <span class="n">height</span>

    <span class="k">return</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="fig_relative_text"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.fig_relative_text">[docs]</a><span class="k">def</span> <span class="nf">fig_relative_text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;horizontalalignment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verticalalignment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">gcf</span><span class="p">()</span>
    <span class="c1"># xy, width, height = get_axis_xy_width_height(ax)</span>
    <span class="c1"># x_, y_ = ((xy[0]+width)+x*width, (xy[1]+height)-y*height)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_text"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_text">[docs]</a><span class="k">def</span> <span class="nf">draw_text</span><span class="p">(</span><span class="n">text_str</span><span class="p">,</span> <span class="n">rgb_textFG</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rgb_textBG</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_axis_xy_width_height</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">text_x</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">text_y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">text_x</span><span class="p">,</span>
        <span class="n">text_y</span><span class="p">,</span>
        <span class="n">text_str</span><span class="p">,</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">rgb_textFG</span><span class="p">,</span>
        <span class="n">backgroundcolor</span><span class="o">=</span><span class="n">rgb_textBG</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="c1"># def convert_keypress_event_mpl_to_qt4(mevent):</span>
<span class="c1">#    global TMP_mevent</span>
<span class="c1">#    TMP_mevent = mevent</span>
<span class="c1">#    # Grab the key from the mpl.KeyPressEvent</span>
<span class="c1">#    key = mevent.key</span>
<span class="c1">#    logger.info(&#39;[df2] convert event mpl -&gt; qt4&#39;)</span>
<span class="c1">#    logger.info(&#39;[df2] key=%r&#39; % key)</span>
<span class="c1">#    # dicts modified from backend_qt4.py</span>
<span class="c1">#    mpl2qtkey = {&#39;control&#39;: Qt.Key_Control, &#39;shift&#39;: Qt.Key_Shift,</span>
<span class="c1">#                 &#39;alt&#39;: Qt.Key_Alt, &#39;super&#39;: Qt.Key_Meta,</span>
<span class="c1">#                 &#39;enter&#39;: Qt.Key_Return, &#39;left&#39;: Qt.Key_Left, &#39;up&#39;: Qt.Key_Up,</span>
<span class="c1">#                 &#39;right&#39;: Qt.Key_Right, &#39;down&#39;: Qt.Key_Down,</span>
<span class="c1">#                 &#39;escape&#39;: Qt.Key_Escape, &#39;f1&#39;: Qt.Key_F1, &#39;f2&#39;: Qt.Key_F2,</span>
<span class="c1">#                 &#39;f3&#39;: Qt.Key_F3, &#39;f4&#39;: Qt.Key_F4, &#39;f5&#39;: Qt.Key_F5,</span>
<span class="c1">#                 &#39;f6&#39;: Qt.Key_F6, &#39;f7&#39;: Qt.Key_F7, &#39;f8&#39;: Qt.Key_F8,</span>
<span class="c1">#                 &#39;f9&#39;: Qt.Key_F9, &#39;f10&#39;: Qt.Key_F10, &#39;f11&#39;: Qt.Key_F11,</span>
<span class="c1">#                 &#39;f12&#39;: Qt.Key_F12, &#39;home&#39;: Qt.Key_Home, &#39;end&#39;: Qt.Key_End,</span>
<span class="c1">#                 &#39;pageup&#39;: Qt.Key_PageUp, &#39;pagedown&#39;: Qt.Key_PageDown}</span>
<span class="c1">#    # Reverse the control and super (aka cmd/apple) keys on OSX</span>
<span class="c1">#    if sys.platform == &#39;darwin&#39;:</span>
<span class="c1">#        mpl2qtkey.update({&#39;super&#39;: Qt.Key_Control, &#39;control&#39;: Qt.Key_Meta, })</span>

<span class="c1">#    # Try to reconstruct QtGui.KeyEvent</span>
<span class="c1">#    type_ = QtCore.QEvent.Type(QtCore.QEvent.KeyPress)  # The type should always be KeyPress</span>
<span class="c1">#    text = &#39;&#39;</span>
<span class="c1">#    # Try to extract the original modifiers</span>
<span class="c1">#    modifiers = QtCore.Qt.NoModifier  # initialize to no modifiers</span>
<span class="c1">#    if key.find(u&#39;ctrl+&#39;) &gt;= 0:</span>
<span class="c1">#        modifiers = modifiers | QtCore.Qt.ControlModifier</span>
<span class="c1">#        key = key.replace(u&#39;ctrl+&#39;, u&#39;&#39;)</span>
<span class="c1">#        logger.info(&#39;[df2] has ctrl modifier&#39;)</span>
<span class="c1">#        text += &#39;Ctrl+&#39;</span>
<span class="c1">#    if key.find(u&#39;alt+&#39;) &gt;= 0:</span>
<span class="c1">#        modifiers = modifiers | QtCore.Qt.AltModifier</span>
<span class="c1">#        key = key.replace(u&#39;alt+&#39;, u&#39;&#39;)</span>
<span class="c1">#        logger.info(&#39;[df2] has alt modifier&#39;)</span>
<span class="c1">#        text += &#39;Alt+&#39;</span>
<span class="c1">#    if key.find(u&#39;super+&#39;) &gt;= 0:</span>
<span class="c1">#        modifiers = modifiers | QtCore.Qt.MetaModifier</span>
<span class="c1">#        key = key.replace(u&#39;super+&#39;, u&#39;&#39;)</span>
<span class="c1">#        logger.info(&#39;[df2] has super modifier&#39;)</span>
<span class="c1">#        text += &#39;Super+&#39;</span>
<span class="c1">#    if key.isupper():</span>
<span class="c1">#        modifiers = modifiers | QtCore.Qt.ShiftModifier</span>
<span class="c1">#        logger.info(&#39;[df2] has shift modifier&#39;)</span>
<span class="c1">#        text += &#39;Shift+&#39;</span>
<span class="c1">#    # Try to extract the original key</span>
<span class="c1">#    try:</span>
<span class="c1">#        if key in mpl2qtkey:</span>
<span class="c1">#            key_ = mpl2qtkey[key]</span>
<span class="c1">#        else:</span>
<span class="c1">#            key_ = ord(key.upper())  # Qt works with uppercase keys</span>
<span class="c1">#            text += key.upper()</span>
<span class="c1">#    except Exception as ex:</span>
<span class="c1">#        logger.info(&#39;[df2] ERROR key=%r&#39; % key)</span>
<span class="c1">#        logger.info(&#39;[df2] ERROR %r&#39; % ex)</span>
<span class="c1">#        raise</span>
<span class="c1">#    autorep = False  # default false</span>
<span class="c1">#    count   = 1  # default 1</span>
<span class="c1">#    text = str(text)  # The text is somewhat arbitrary</span>
<span class="c1">#    # Create the QEvent</span>
<span class="c1">#    logger.info(&#39;----------------&#39;)</span>
<span class="c1">#    logger.info(&#39;[df2] Create event&#39;)</span>
<span class="c1">#    logger.info(&#39;[df2] type_ = %r&#39; % type_)</span>
<span class="c1">#    logger.info(&#39;[df2] text = %r&#39; % text)</span>
<span class="c1">#    logger.info(&#39;[df2] modifiers = %r&#39; % modifiers)</span>
<span class="c1">#    logger.info(&#39;[df2] autorep = %r&#39; % autorep)</span>
<span class="c1">#    logger.info(&#39;[df2] count = %r &#39; % count)</span>
<span class="c1">#    logger.info(&#39;----------------&#39;)</span>
<span class="c1">#    qevent = QtGui.QKeyEvent(type_, key_, modifiers, text, autorep, count)</span>
<span class="c1">#    return qevent</span>


<span class="c1"># def test_build_qkeyevent():</span>
<span class="c1">#    import draw_func2 as df2</span>
<span class="c1">#    qtwin = df2.QT4_WINS[0]</span>
<span class="c1">#    # This reconstructs an test mplevent</span>
<span class="c1">#    canvas = df2.figure(1).canvas</span>
<span class="c1">#    mevent = mpl.backend_bases.KeyEvent(&#39;key_press_event&#39;, canvas, u&#39;ctrl+p&#39;, x=672, y=230.0)</span>
<span class="c1">#    qevent = df2.convert_keypress_event_mpl_to_qt4(mevent)</span>
<span class="c1">#    app = qtwin.backend.app</span>
<span class="c1">#    app.sendEvent(qtwin.ui, mevent)</span>
<span class="c1">#    #type_ = QtCore.QEvent.Type(QtCore.QEvent.KeyPress)  # The type should always be KeyPress</span>
<span class="c1">#    #text = str(&#39;A&#39;)  # The text is somewhat arbitrary</span>
<span class="c1">#    #modifiers = QtCore.Qt.NoModifier  # initialize to no modifiers</span>
<span class="c1">#    #modifiers = modifiers | QtCore.Qt.ControlModifier</span>
<span class="c1">#    #modifiers = modifiers | QtCore.Qt.AltModifier</span>
<span class="c1">#    #key_ = ord(&#39;A&#39;)  # Qt works with uppercase keys</span>
<span class="c1">#    #autorep = False  # default false</span>
<span class="c1">#    #count   = 1  # default 1</span>
<span class="c1">#    #qevent = QtGui.QKeyEvent(type_, key_, modifiers, text, autorep, count)</span>
<span class="c1">#    return qevent</span>


<div class="viewcode-block" id="show_histogram"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.show_histogram">[docs]</a><span class="k">def</span> <span class="nf">show_histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --test-show_histogram --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([1, 24, 0, 0, 3, 4, 5, 9, 3, 0, 0, 0, 0, 2, 2, 2, 0, 0, 1, 1, 0, 0, 0, 3,])</span>
<span class="sd">        &gt;&gt;&gt; bins = None</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; result = show_histogram(data, bins)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] show_histogram()&#39;</span><span class="p">)</span>
    <span class="n">dmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
    <span class="n">dmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">bins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">dmax</span> <span class="o">-</span> <span class="n">dmin</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>
    <span class="c1"># dark_background()</span>

    <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--save&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span><span class="p">:</span>
        <span class="n">dark_background</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>
    <span class="c1"># help(np.bincount)</span>
    <span class="c1"># fig.show()</span>


<div class="viewcode-block" id="show_signature"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.show_signature">[docs]</a><span class="k">def</span> <span class="nf">show_signature</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="draw_stems"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_stems">[docs]</a><span class="k">def</span> <span class="nf">draw_stems</span><span class="p">(</span>
    <span class="n">x_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">setlims</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draws stem plot</span>

<span class="sd">    Args:</span>
<span class="sd">        x_data (None):</span>
<span class="sd">        y_data (None):</span>
<span class="sd">        setlims (bool):</span>
<span class="sd">        color (None):</span>
<span class="sd">        markersize (None):</span>
<span class="sd">        bottom (None):</span>

<span class="sd">    References:</span>
<span class="sd">        http://exnumerus.blogspot.com/2011/02/how-to-quickly-plot-multiple-line.html</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --test-draw_stems --show</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --test-draw_stems</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; x_data = np.append(np.arange(1, 10), np.arange(1, 10))</span>
<span class="sd">        &gt;&gt;&gt; rng = np.random.RandomState(0)</span>
<span class="sd">        &gt;&gt;&gt; y_data = sorted(rng.rand(len(x_data)) * 10)</span>
<span class="sd">        &gt;&gt;&gt; # y_data = np.array([ut.get_nth_prime(n) for n in x_data])</span>
<span class="sd">        &gt;&gt;&gt; setlims = False</span>
<span class="sd">        &gt;&gt;&gt; color = [1.0, 0.0, 0.0, 1.0]</span>
<span class="sd">        &gt;&gt;&gt; markersize = 2</span>
<span class="sd">        &gt;&gt;&gt; marker = &#39;o&#39;</span>
<span class="sd">        &gt;&gt;&gt; bottom = None</span>
<span class="sd">        &gt;&gt;&gt; result = draw_stems(x_data, y_data, setlims, color, markersize, bottom, marker)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">y_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">x_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_data</span><span class="p">))</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_data</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] WARNING plot_stems(): len(x_data)!=len(y_data)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] WARNING plot_stems(): len(x_data)=len(y_data)=0&#39;</span><span class="p">)</span>
    <span class="n">x_data_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span>
    <span class="n">y_data_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>
    <span class="n">y_data_sortx</span> <span class="o">=</span> <span class="n">y_data_</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x_data_sort</span> <span class="o">=</span> <span class="n">x_data_</span><span class="p">[</span><span class="n">y_data_sortx</span><span class="p">]</span>
    <span class="n">y_data_sort</span> <span class="o">=</span> <span class="n">y_data_</span><span class="p">[</span><span class="n">y_data_sortx</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>

    <span class="n">OLD</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">OLD</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bottom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Faster way of drawing stems</span>
        <span class="c1"># with ut.Timer(&#39;new stem&#39;):</span>
        <span class="n">stemlines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
        <span class="n">x_segments</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">([[</span><span class="n">thisx</span><span class="p">,</span> <span class="n">thisx</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">thisx</span> <span class="ow">in</span> <span class="n">x_data_sort</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">linestyle</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">y_segments</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">([[</span><span class="n">thisy</span><span class="p">,</span> <span class="n">thisy</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">thisy</span> <span class="ow">in</span> <span class="n">y_data_sort</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_segments</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">([[</span><span class="n">bottom</span><span class="p">,</span> <span class="n">thisy</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">thisy</span> <span class="ow">in</span> <span class="n">y_data_sort</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_segments</span><span class="p">,</span> <span class="n">y_segments</span><span class="p">,</span> <span class="n">linestyle</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s1">&#39;old stem&#39;</span><span class="p">):</span>
            <span class="n">markerline</span><span class="p">,</span> <span class="n">stemlines</span><span class="p">,</span> <span class="n">baseline</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span>
                <span class="n">x_data_sort</span><span class="p">,</span> <span class="n">y_data_sort</span><span class="p">,</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">markersize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">markerline</span><span class="o">.</span><span class="n">set_markersize</span><span class="p">(</span><span class="n">markersize</span><span class="p">)</span>

            <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">markerline</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">stemlines</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">stemlines</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># baseline should be invisible</span>
    <span class="k">if</span> <span class="n">setlims</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y_data</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_data</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_sift_signature"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.plot_sift_signature">[docs]</a><span class="k">def</span> <span class="nf">plot_sift_signature</span><span class="p">(</span><span class="n">sift</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots a SIFT descriptor as a histogram and distinguishes different bins</span>
<span class="sd">    into different colors</span>

<span class="sd">    Args:</span>
<span class="sd">        sift (ndarray[dtype=np.uint8]):</span>
<span class="sd">        title (str):  (default = &#39;&#39;)</span>
<span class="sd">        fnum (int):  figure number(default = None)</span>
<span class="sd">        pnum (tuple):  plot number(default = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        AxesSubplot: ax</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --test-plot_sift_signature --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import vtool as vt</span>
<span class="sd">        &gt;&gt;&gt; sift = vt.demodata.testdata_dummy_sift(1, np.random.RandomState(0))[0]</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;test sift histogram&#39;</span>
<span class="sd">        &gt;&gt;&gt; fnum = None</span>
<span class="sd">        &gt;&gt;&gt; pnum = None</span>
<span class="sd">        &gt;&gt;&gt; ax = plot_sift_signature(sift, title, fnum, pnum)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;ax = %s&#39; % (str(ax),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fnum</span> <span class="o">=</span> <span class="n">ensure_fnum</span><span class="p">(</span><span class="n">fnum</span><span class="p">)</span>
    <span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">plot_bars</span><span class="p">(</span><span class="n">sift</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
    <span class="n">space_xticks</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">space_yticks</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
    <span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1"># dark_background(ax)</span>

    <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--save&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span><span class="p">:</span>
        <span class="n">dark_background</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_descriptor_signature"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.plot_descriptor_signature">[docs]</a><span class="k">def</span> <span class="nf">plot_descriptor_signature</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    signature general for for any descriptor vector.</span>

<span class="sd">    Args:</span>
<span class="sd">        vec (ndarray):</span>
<span class="sd">        title (str):  (default = &#39;&#39;)</span>
<span class="sd">        fnum (int):  figure number(default = None)</span>
<span class="sd">        pnum (tuple):  plot number(default = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        AxesSubplot: ax</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --test-plot_descriptor_signature --show</span>

<span class="sd">    SeeAlso:</span>
<span class="sd">        plot_sift_signature</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import vtool as vt</span>
<span class="sd">        &gt;&gt;&gt; vec = ((np.random.RandomState(0).rand(258) - .2) * 4)</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;test sift histogram&#39;</span>
<span class="sd">        &gt;&gt;&gt; fnum = None</span>
<span class="sd">        &gt;&gt;&gt; pnum = None</span>
<span class="sd">        &gt;&gt;&gt; ax = plot_descriptor_signature(vec, title, fnum, pnum)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;ax = %s&#39; % (str(ax),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fnum</span> <span class="o">=</span> <span class="n">ensure_fnum</span><span class="p">(</span><span class="n">fnum</span><span class="p">)</span>
    <span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">plot_bars</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">vec</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">vec</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">vec</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vec</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="c1"># space_xticks(9, 16)</span>
    <span class="c1"># space_yticks(5, 64)</span>
    <span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--save&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span><span class="p">:</span>
        <span class="n">dark_background</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="dark_background"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.dark_background">[docs]</a><span class="k">def</span> <span class="nf">dark_background</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doubleit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        ax (None): (default = None)</span>
<span class="sd">        doubleit (bool): (default = False)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-dark_background --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; fig = pt.figure()</span>
<span class="sd">        &gt;&gt;&gt; pt.dark_background()</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">is_using_style</span><span class="p">(</span><span class="n">style</span><span class="p">):</span>
        <span class="n">style_dict</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">library</span><span class="p">[</span><span class="n">style</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">dict_isect</span><span class="p">(</span><span class="n">style_dict</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">style_dict</span><span class="p">)</span>

    <span class="c1"># is_using_style(&#39;classic&#39;)</span>
    <span class="c1"># is_using_style(&#39;ggplot&#39;)</span>
    <span class="c1"># HARD_DISABLE = force is not True</span>
    <span class="n">HARD_DISABLE</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">HARD_DISABLE</span> <span class="ow">and</span> <span class="n">force</span><span class="p">:</span>
        <span class="c1"># Should use mpl style dark background instead</span>
        <span class="n">bgcolor</span> <span class="o">=</span> <span class="n">BLACK</span> <span class="o">*</span> <span class="mf">0.9</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">Axes3D</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_bgcolor</span><span class="p">(</span><span class="n">bgcolor</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_axis_xy_width_height</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">doubleit</span><span class="p">:</span>
            <span class="n">halfw</span> <span class="o">=</span> <span class="p">(</span><span class="n">doubleit</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">halfh</span> <span class="o">=</span> <span class="p">(</span><span class="n">doubleit</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">halfw</span><span class="p">,</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">halfh</span><span class="p">)</span>
            <span class="n">width</span> <span class="o">*=</span> <span class="n">doubleit</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">height</span> <span class="o">*=</span> <span class="n">doubleit</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">rect</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">rect</span><span class="o">.</span><span class="n">set_fill</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">rect</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">bgcolor</span><span class="p">)</span>
        <span class="n">rect</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="o">-</span><span class="mi">99999999999</span><span class="p">)</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span></div>


<div class="viewcode-block" id="space_xticks"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.space_xticks">[docs]</a><span class="k">def</span> <span class="nf">space_xticks</span><span class="p">(</span><span class="n">nTicks</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nTicks</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing</span><span class="p">)</span>
    <span class="n">small_xticks</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span></div>


<div class="viewcode-block" id="space_yticks"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.space_yticks">[docs]</a><span class="k">def</span> <span class="nf">space_yticks</span><span class="p">(</span><span class="n">nTicks</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nTicks</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing</span><span class="p">)</span>
    <span class="n">small_yticks</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span></div>


<div class="viewcode-block" id="small_xticks"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.small_xticks">[docs]</a><span class="k">def</span> <span class="nf">small_xticks</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
        <span class="n">tick</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span></div>


<div class="viewcode-block" id="small_yticks"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.small_yticks">[docs]</a><span class="k">def</span> <span class="nf">small_yticks</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
        <span class="n">tick</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_bars"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.plot_bars">[docs]</a><span class="k">def</span> <span class="nf">plot_bars</span><span class="p">(</span><span class="n">y_data</span><span class="p">,</span> <span class="n">nColorSplits</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">nDims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>
    <span class="n">nGroup</span> <span class="o">=</span> <span class="n">nDims</span> <span class="o">//</span> <span class="n">nColorSplits</span>
    <span class="n">ori_colors</span> <span class="o">=</span> <span class="n">distinct_colors</span><span class="p">(</span><span class="n">nColorSplits</span><span class="p">)</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nDims</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nColorSplits</span><span class="p">):</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nGroup</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">nGroup</span> <span class="o">*</span> <span class="n">ix</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">ori_colors</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        <span class="n">x_dat</span> <span class="o">=</span> <span class="n">x_data</span><span class="p">[</span><span class="n">xs</span><span class="p">]</span>
        <span class="n">y_dat</span> <span class="o">=</span> <span class="n">y_data</span><span class="p">[</span><span class="n">xs</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x_dat</span><span class="p">,</span> <span class="n">y_dat</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span></div>


<div class="viewcode-block" id="append_phantom_legend_label"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.append_phantom_legend_label">[docs]</a><span class="k">def</span> <span class="nf">append_phantom_legend_label</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    adds a legend label without displaying an actor</span>

<span class="sd">    Args:</span>
<span class="sd">        label (?):</span>
<span class="sd">        color (?):</span>
<span class="sd">        loc (str):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --test-append_phantom_legend_label --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; label = &#39;some label&#39;</span>
<span class="sd">        &gt;&gt;&gt; color = &#39;b&#39;</span>
<span class="sd">        &gt;&gt;&gt; loc = &#39;upper right&#39;</span>
<span class="sd">        &gt;&gt;&gt; fig = pt.figure()</span>
<span class="sd">        &gt;&gt;&gt; ax = pt.gca()</span>
<span class="sd">        &gt;&gt;&gt; result = append_phantom_legend_label(label, color, loc, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; pt.show_phantom_legend_labels(ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pass</span>
    <span class="c1"># , loc=loc</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">_phantom_legend_list</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;_phantom_legend_list&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_phantom_legend_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_phantom_legend_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;_phantom_legend_list&#39;</span><span class="p">,</span> <span class="n">_phantom_legend_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;line&#39;</span><span class="p">:</span>
        <span class="n">phantom_actor</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">phantom_actor</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    <span class="c1"># , prop=custom_constants.FONTS.legend)</span>
    <span class="c1"># legend_tups = []</span>
    <span class="n">_phantom_legend_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phantom_actor</span><span class="p">)</span></div>
    <span class="c1"># ax.legend(handles=[phantom_actor], framealpha=.2)</span>
    <span class="c1"># plt.legend(*zip(*legend_tups), framealpha=.2)</span>


<div class="viewcode-block" id="show_phantom_legend_labels"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.show_phantom_legend_labels">[docs]</a><span class="k">def</span> <span class="nf">show_phantom_legend_labels</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">_phantom_legend_list</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;_phantom_legend_list&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_phantom_legend_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_phantom_legend_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;_phantom_legend_list&#39;</span><span class="p">,</span> <span class="n">_phantom_legend_list</span><span class="p">)</span>
    <span class="c1"># logger.info(_phantom_legend_list)</span>
    <span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">_phantom_legend_list</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    <span class="c1"># ax.legend(handles=_phantom_legend_list, framealpha=.2)</span>


<span class="n">LEGEND_LOCATION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;upper right&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;upper left&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;lower left&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;lower right&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s1">&#39;center left&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s1">&#39;center right&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="s1">&#39;lower center&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;upper center&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">}</span>


<span class="c1"># def legend(loc=&#39;upper right&#39;, fontproperties=None):</span>
<div class="viewcode-block" id="legend"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.legend">[docs]</a><span class="k">def</span> <span class="nf">legend</span><span class="p">(</span>
    <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">handles</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        loc (str): (default = &#39;best&#39;)</span>
<span class="sd">        fontproperties (None): (default = None)</span>
<span class="sd">        size (None): (default = None)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-legend --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; loc = &#39;best&#39;</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; xdata = np.linspace(-6, 6)</span>
<span class="sd">        &gt;&gt;&gt; ydata = np.sin(xdata)</span>
<span class="sd">        &gt;&gt;&gt; pt.plot(xdata, ydata, label=&#39;sin&#39;)</span>
<span class="sd">        &gt;&gt;&gt; fontproperties = None</span>
<span class="sd">        &gt;&gt;&gt; size = None</span>
<span class="sd">        &gt;&gt;&gt; result = legend(loc, fontproperties, size)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">LEGEND_LOCATION</span> <span class="ow">or</span> <span class="n">loc</span> <span class="o">==</span> <span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="s1">&#39;invalid loc. try one of </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">LEGEND_LOCATION</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">fontproperties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span>
        <span class="c1"># prop[&#39;weight&#39;] = &#39;normal&#39;</span>
        <span class="c1"># prop[&#39;family&#39;] = &#39;sans-serif&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">fontproperties</span>
    <span class="n">legendkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prop</span><span class="p">:</span>
        <span class="n">legendkw</span><span class="p">[</span><span class="s1">&#39;prop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span>
    <span class="k">if</span> <span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">legendkw</span><span class="p">[</span><span class="s1">&#39;handles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">handles</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legendkw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">legend</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_fc</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span>
        <span class="n">legend</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_histpdf"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.plot_histpdf">[docs]</a><span class="k">def</span> <span class="nf">plot_histpdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw_support</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">freq</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="kn">import</span> <span class="n">plots</span>

    <span class="n">plots</span><span class="o">.</span><span class="n">plot_pdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">draw_support</span><span class="o">=</span><span class="n">draw_support</span><span class="p">,</span> <span class="n">scale_to</span><span class="o">=</span><span class="n">freq</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_hist"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.plot_hist">[docs]</a><span class="k">def</span> <span class="nf">plot_hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">dmin</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">dmax</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">bins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">dmax</span> <span class="o">-</span> <span class="n">dmin</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">freq</span><span class="p">,</span> <span class="n">bins_</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">freq</span><span class="p">,</span> <span class="n">bins_</span></div>


<div class="viewcode-block" id="variation_trunctate"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.variation_trunctate">[docs]</a><span class="k">def</span> <span class="nf">variation_trunctate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">warnstr</span> <span class="o">=</span> <span class="s1">&#39;[df2] ! Warning: len(data) = 0. Cannot variation_truncate&#39;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warnstr</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">trunc_max</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">trunc_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">trunc_min</span><span class="p">,</span> <span class="n">trunc_max</span><span class="p">)</span></div>
    <span class="c1"># trunc_xticks = np.linspace(0, int(trunc_max),11)</span>
    <span class="c1"># trunc_xticks = trunc_xticks[trunc_xticks &gt;= trunc_min]</span>
    <span class="c1"># trunc_xticks = np.append([int(trunc_min)], trunc_xticks)</span>
    <span class="c1"># no_zero_yticks = ax.get_yticks()[ax.get_yticks() &gt; 0]</span>
    <span class="c1"># ax.set_xticks(trunc_xticks)</span>
    <span class="c1"># ax.set_yticks(no_zero_yticks)</span>


<span class="c1"># _----------------- HELPERS ^^^ ---------</span>


<div class="viewcode-block" id="scores_to_color"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.scores_to_color">[docs]</a><span class="k">def</span> <span class="nf">scores_to_color</span><span class="p">(</span>
    <span class="n">score_list</span><span class="p">,</span>
    <span class="n">cmap_</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">,</span>
    <span class="n">logscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">reverse_cmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">custom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">val2_customcolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">score_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cmap_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Other good colormaps are &#39;spectral&#39;, &#39;gist_rainbow&#39;, &#39;gist_ncar&#39;, &#39;Set1&#39;,</span>
<span class="sd">    &#39;Set2&#39;, &#39;Accent&#39;</span>
<span class="sd">    # TODO: plasma</span>

<span class="sd">    Args:</span>
<span class="sd">        score_list (list):</span>
<span class="sd">        cmap_ (str): defaults to hot</span>
<span class="sd">        logscale (bool):</span>
<span class="sd">        cmap_range (tuple): restricts to only a portion of the cmap to avoid extremes</span>

<span class="sd">    Returns:</span>
<span class="sd">        &lt;class &#39;_ast.ListComp&#39;&gt;</span>

<span class="sd">    SeeAlso:</span>
<span class="sd">        python -m wbia.plottool.color_funcs --test-show_all_colormaps --show --type &quot;Perceptually Uniform Sequential&quot;</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 scores_to_color --show</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; ut.exec_funckw(pt.scores_to_color, globals())</span>
<span class="sd">        &gt;&gt;&gt; score_list = np.array([-1, -2, 1, 1, 2, 10])</span>
<span class="sd">        &gt;&gt;&gt; # score_list = np.array([0, .1, .11, .12, .13, .8])</span>
<span class="sd">        &gt;&gt;&gt; # score_list = np.linspace(0, 1, 100)</span>
<span class="sd">        &gt;&gt;&gt; cmap_ = &#39;plasma&#39;</span>
<span class="sd">        &gt;&gt;&gt; colors = pt.scores_to_color(score_list, cmap_)</span>
<span class="sd">        &gt;&gt;&gt; import vtool as vt</span>
<span class="sd">        &gt;&gt;&gt; imgRGB = vt.atleast_nd(np.array(colors)[:, 0:3], 3, tofront=True)</span>
<span class="sd">        &gt;&gt;&gt; imgRGB = imgRGB.astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; imgBGR = vt.convert_colorspace(imgRGB, &#39;BGR&#39;, &#39;RGB&#39;)</span>
<span class="sd">        &gt;&gt;&gt; pt.imshow(imgBGR)</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; score_list = np.array([-1, -2, 1, 1, 2, 10])</span>
<span class="sd">        &gt;&gt;&gt; cmap_ = &#39;hot&#39;</span>
<span class="sd">        &gt;&gt;&gt; logscale = False</span>
<span class="sd">        &gt;&gt;&gt; reverse_cmap = True</span>
<span class="sd">        &gt;&gt;&gt; custom = True</span>
<span class="sd">        &gt;&gt;&gt; val2_customcolor  = {</span>
<span class="sd">        ...        -1: UNKNOWN_PURP,</span>
<span class="sd">        ...        -2: LIGHT_BLUE,</span>
<span class="sd">        ...    }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">score_list</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;score must be 1d&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">score_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">apply_logscale</span><span class="p">(</span><span class="n">scores</span><span class="p">):</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
        <span class="n">above_zero</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="n">scores_</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">scores_</span><span class="p">[</span><span class="n">above_zero</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores_</span><span class="p">[</span><span class="n">above_zero</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">scores_</span><span class="p">[</span><span class="o">~</span><span class="n">above_zero</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores_</span><span class="p">[</span><span class="o">~</span><span class="n">above_zero</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">scores_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">scores_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scores_</span>

    <span class="k">if</span> <span class="n">logscale</span><span class="p">:</span>
        <span class="c1"># Hack</span>
        <span class="n">score_list</span> <span class="o">=</span> <span class="n">apply_logscale</span><span class="p">(</span><span class="n">score_list</span><span class="p">)</span>
        <span class="c1"># if loglogscale</span>
        <span class="c1"># score_list = np.log2(np.log2(score_list + 2) + 1)</span>
    <span class="c1"># if isinstance(cmap_, six.string_types):</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap_</span><span class="p">)</span>
    <span class="c1"># else:</span>
    <span class="c1">#    cmap = cmap_</span>
    <span class="k">if</span> <span class="n">reverse_cmap</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">reverse_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="c1"># if custom:</span>
    <span class="c1">#    base_colormap = cmap</span>
    <span class="c1">#    data = score_list</span>
    <span class="c1">#    cmap = customize_colormap(score_list, base_colormap)</span>
    <span class="k">if</span> <span class="n">score_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">min_</span> <span class="o">=</span> <span class="n">score_list</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">max_</span> <span class="o">=</span> <span class="n">score_list</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">min_</span> <span class="o">=</span> <span class="n">score_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_</span> <span class="o">=</span> <span class="n">score_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">logscale</span><span class="p">:</span>
            <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span> <span class="o">=</span> <span class="n">apply_logscale</span><span class="p">([</span><span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">cmap_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap_scale_min</span><span class="p">,</span> <span class="n">cmap_scale_max</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap_scale_min</span><span class="p">,</span> <span class="n">cmap_scale_max</span> <span class="o">=</span> <span class="n">cmap_range</span>
    <span class="n">extent_</span> <span class="o">=</span> <span class="n">max_</span> <span class="o">-</span> <span class="n">min_</span>
    <span class="k">if</span> <span class="n">extent_</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="k">for</span> <span class="n">fx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">score_list</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">logscale</span><span class="p">:</span>
            <span class="c1"># hack</span>
            <span class="k">def</span> <span class="nf">score2_01</span><span class="p">(</span><span class="n">score</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span>
                    <span class="mi">1</span>
                    <span class="o">+</span> <span class="n">cmap_scale_min</span>
                    <span class="o">+</span> <span class="n">cmap_scale_max</span> <span class="o">*</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="o">-</span> <span class="n">min_</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">extent_</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="n">score_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">score_list</span><span class="p">)</span>
            <span class="c1"># rank_multiplier = score_list.argsort() / len(score_list)</span>
            <span class="c1"># normscore = np.array(list(map(score2_01, score_list))) * rank_multiplier</span>
            <span class="n">normscore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">score2_01</span><span class="p">,</span> <span class="n">score_list</span><span class="p">)))</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">normscore</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">score2_01</span><span class="p">(</span><span class="n">score</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">cmap_scale_min</span> <span class="o">+</span> <span class="n">cmap_scale_max</span> <span class="o">*</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="o">-</span> <span class="n">min_</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">extent_</span><span class="p">)</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">score2_01</span><span class="p">(</span><span class="n">score</span><span class="p">))</span> <span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">score_list</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">val2_customcolor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val2_customcolor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">color</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">score_list</span><span class="p">)</span>
            <span class="p">]</span>
    <span class="k">return</span> <span class="n">colors</span></div>


<div class="viewcode-block" id="customize_colormap"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.customize_colormap">[docs]</a><span class="k">def</span> <span class="nf">customize_colormap</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">base_colormap</span><span class="p">):</span>
    <span class="n">unique_scalars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
    <span class="n">max_</span> <span class="o">=</span> <span class="n">unique_scalars</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">min_</span> <span class="o">=</span> <span class="n">unique_scalars</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">extent_</span> <span class="o">=</span> <span class="n">max_</span> <span class="o">-</span> <span class="n">min_</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_</span><span class="p">,</span> <span class="n">max_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">extent_</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Get a few more colors than we actually need so we don&#39;t hit the bottom of</span>
    <span class="c1"># the cmap</span>
    <span class="n">colors_ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">extent_</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)))</span>
    <span class="n">colors_rgba</span> <span class="o">=</span> <span class="n">base_colormap</span><span class="p">(</span><span class="n">colors_ix</span><span class="p">)</span>
    <span class="c1"># TODO: parametarize</span>
    <span class="n">val2_special_rgba</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">UNKNOWN_PURP</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="n">LIGHT_BLUE</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_new_color</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">val2_special_rgba</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">val2_special_rgba</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">colors_rgba</span><span class="p">[</span><span class="n">ix</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">val2_special_rgba</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">special_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_new_color</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bounds</span><span class="p">)]</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">special_colors</span><span class="p">)</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>

    <span class="n">sm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
    <span class="n">sm</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">extent_</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="c1"># colorbar = plt.colorbar(sm)</span>

    <span class="k">return</span> <span class="n">cmap</span></div>


<div class="viewcode-block" id="unique_rows"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.unique_rows">[docs]</a><span class="k">def</span> <span class="nf">unique_rows</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/16970982/find-unique-rows-in-numpy-array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rowblocks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">*</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">rowblocks</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">unique_arr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">unique_arr</span></div>


<div class="viewcode-block" id="scores_to_cmap"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.scores_to_cmap">[docs]</a><span class="k">def</span> <span class="nf">scores_to_cmap</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap_</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">scores_to_color</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">cmap_</span><span class="o">=</span><span class="n">cmap_</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
    <span class="n">sortx</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="n">sorted_colors</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">sortx</span><span class="p">]</span>
    <span class="c1"># Make a listed colormap and mappable object</span>
    <span class="n">listed_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">sorted_colors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">listed_cmap</span></div>


<span class="n">DF2_DIVIDER_KEY</span> <span class="o">=</span> <span class="s1">&#39;_df2_divider&#39;</span>


<div class="viewcode-block" id="ensure_divider"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.ensure_divider">[docs]</a><span class="k">def</span> <span class="nf">ensure_divider</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns previously constructed divider or creates one &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="kn">import</span> <span class="n">plot_helpers</span> <span class="k">as</span> <span class="n">ph</span>

    <span class="n">divider</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">get_plotdat</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">DF2_DIVIDER_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">divider</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ph</span><span class="o">.</span><span class="n">set_plotdat</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">DF2_DIVIDER_KEY</span><span class="p">,</span> <span class="n">divider</span><span class="p">)</span>
        <span class="n">orig_append_axes</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span>

        <span class="k">def</span> <span class="nf">df2_append_axes</span><span class="p">(</span>
            <span class="n">divider</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_to_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; override divider add axes to register the divided axes &quot;&quot;&quot;</span>
            <span class="n">div_axes</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">get_plotdat</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;df2_div_axes&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">new_ax</span> <span class="o">=</span> <span class="n">orig_append_axes</span><span class="p">(</span>
                <span class="n">position</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span> <span class="n">add_to_figure</span><span class="o">=</span><span class="n">add_to_figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">div_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_ax</span><span class="p">)</span>
            <span class="n">ph</span><span class="o">.</span><span class="n">set_plotdat</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;df2_div_axes&#39;</span><span class="p">,</span> <span class="n">div_axes</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new_ax</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">inject_func_as_method</span><span class="p">(</span>
            <span class="n">divider</span><span class="p">,</span> <span class="n">df2_append_axes</span><span class="p">,</span> <span class="s1">&#39;append_axes&#39;</span><span class="p">,</span> <span class="n">allow_override</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">divider</span></div>


<div class="viewcode-block" id="get_binary_svm_cmap"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.get_binary_svm_cmap">[docs]</a><span class="k">def</span> <span class="nf">get_binary_svm_cmap</span><span class="p">():</span>
    <span class="c1"># useful for svms</span>
    <span class="k">return</span> <span class="n">reverse_colormap</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;bwr&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="reverse_colormap"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.reverse_colormap">[docs]</a><span class="k">def</span> <span class="nf">reverse_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References:</span>
<span class="sd">        http://nbviewer.ipython.org/github/kwinkunks/notebooks/blob/master/Matteo_colourmaps.ipynb</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">_segmentdata</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">k</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">reverse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">cmap_reversed</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="p">(</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_reversed&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">reverse</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cmap_reversed</span></div>


<div class="viewcode-block" id="interpolated_colormap"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.interpolated_colormap">[docs]</a><span class="k">def</span> <span class="nf">interpolated_colormap</span><span class="p">(</span><span class="n">color_frac_list</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39;lch-ab&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    http://stackoverflow.com/questions/12073306/customize-colorbar-in-matplotlib</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 interpolated_colormap --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; color_frac_list = [</span>
<span class="sd">        &gt;&gt;&gt;     (pt.TRUE_BLUE, 0),</span>
<span class="sd">        &gt;&gt;&gt;     #(pt.WHITE, .5),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.YELLOW, .5),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.FALSE_RED, 1.0),</span>
<span class="sd">        &gt;&gt;&gt; ]</span>
<span class="sd">        &gt;&gt;&gt; color_frac_list = [</span>
<span class="sd">        &gt;&gt;&gt;     (pt.RED, 0),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.PINK, .1),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.ORANGE, .2),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.GREEN, .5),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.TRUE_BLUE, .7),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.PURPLE, 1.0),</span>
<span class="sd">        &gt;&gt;&gt; ]</span>
<span class="sd">        &gt;&gt;&gt; color_frac_list = [</span>
<span class="sd">        &gt;&gt;&gt;     (pt.RED,      0/6),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.YELLOW,   1/6),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.GREEN,    2/6),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.CYAN,     3/6),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.BLUE,     4/6),  # FIXME doesn&#39;t go in correct direction</span>
<span class="sd">        &gt;&gt;&gt;     (pt.MAGENTA,  5/6),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.RED,      6/6),</span>
<span class="sd">        &gt;&gt;&gt; ]</span>
<span class="sd">        &gt;&gt;&gt; color_frac_list = [</span>
<span class="sd">        &gt;&gt;&gt;     ((1, 0, 0, 0),  0/6),</span>
<span class="sd">        &gt;&gt;&gt;     ((1, 0, .001/255, 0),  6/6), # hack</span>
<span class="sd">        &gt;&gt;&gt; ]</span>
<span class="sd">        &gt;&gt;&gt; space = &#39;hsv&#39;</span>
<span class="sd">        &gt;&gt;&gt; color_frac_list = [</span>
<span class="sd">        &gt;&gt;&gt;     (pt.BLUE,   0.0),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.GRAY,   0.5),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.YELLOW, 1.0),</span>
<span class="sd">        &gt;&gt;&gt; ]</span>
<span class="sd">        &gt;&gt;&gt; color_frac_list = [</span>
<span class="sd">        &gt;&gt;&gt;     (pt.GREEN,  0.0),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.GRAY,   0.5),</span>
<span class="sd">        &gt;&gt;&gt;     (pt.RED,    1.0),</span>
<span class="sd">        &gt;&gt;&gt; ]</span>
<span class="sd">        &gt;&gt;&gt; space = &#39;lab&#39;</span>
<span class="sd">        &gt;&gt;&gt; #resolution = 16 + 1</span>
<span class="sd">        &gt;&gt;&gt; resolution = 256 + 1</span>
<span class="sd">        &gt;&gt;&gt; cmap = interpolated_colormap(color_frac_list, resolution, space)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; a = np.linspace(0, 1, resolution).reshape(1, -1)</span>
<span class="sd">        &gt;&gt;&gt; pylab.imshow(a, aspect=&#39;auto&#39;, cmap=cmap, interpolation=&#39;nearest&#39;)  # , origin=&quot;lower&quot;)</span>
<span class="sd">        &gt;&gt;&gt; plt.grid(False)</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">colorsys</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_frac_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">color_frac_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">color_frac_list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_frac_list</span><span class="p">)))</span>
        <span class="p">)</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">color_frac_list</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">fracs</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">color_frac_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># resolution = 17</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="n">fracs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fracs</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">fracs</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">cpool</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># vt.convert_colorspace((c[None, None, 0:3] * 255).astype(np.uint8), &#39;RGB&#39;, &#39;HSV&#39;) / 255</span>

    <span class="c1"># import colorspacious</span>
    <span class="c1"># import colormath</span>
    <span class="kn">from</span> <span class="nn">colormath</span> <span class="kn">import</span> <span class="n">color_conversions</span>

    <span class="c1"># FIXME: need to ensure monkeypatch for networkx 2.0 in colormath</span>
    <span class="c1"># color_conversions._conversion_manager = color_conversions.GraphConversionManager()</span>

    <span class="kn">from</span> <span class="nn">colormath</span> <span class="kn">import</span> <span class="n">color_objects</span>

    <span class="c1"># from colormath import color_conversions</span>

    <span class="k">def</span> <span class="nf">new_convertor</span><span class="p">(</span><span class="n">target_obj</span><span class="p">):</span>
        <span class="n">source_obj</span> <span class="o">=</span> <span class="n">color_objects</span><span class="o">.</span><span class="n">sRGBColor</span>

        <span class="k">def</span> <span class="nf">to_target</span><span class="p">(</span><span class="n">src_tup</span><span class="p">):</span>
            <span class="n">src_tup</span> <span class="o">=</span> <span class="n">src_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">src_co</span> <span class="o">=</span> <span class="n">source_obj</span><span class="p">(</span><span class="o">*</span><span class="n">src_tup</span><span class="p">)</span>
            <span class="n">target_co</span> <span class="o">=</span> <span class="n">color_conversions</span><span class="o">.</span><span class="n">convert_color</span><span class="p">(</span><span class="n">src_co</span><span class="p">,</span> <span class="n">target_obj</span><span class="p">)</span>
            <span class="n">target_tup</span> <span class="o">=</span> <span class="n">target_co</span><span class="o">.</span><span class="n">get_value_tuple</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">target_tup</span>

        <span class="k">def</span> <span class="nf">from_target</span><span class="p">(</span><span class="n">target_tup</span><span class="p">):</span>
            <span class="n">target_co</span> <span class="o">=</span> <span class="n">target_obj</span><span class="p">(</span><span class="o">*</span><span class="n">target_tup</span><span class="p">)</span>
            <span class="n">src_co</span> <span class="o">=</span> <span class="n">color_conversions</span><span class="o">.</span><span class="n">convert_color</span><span class="p">(</span><span class="n">target_co</span><span class="p">,</span> <span class="n">source_obj</span><span class="p">)</span>
            <span class="n">src_tup</span> <span class="o">=</span> <span class="n">src_co</span><span class="o">.</span><span class="n">get_value_tuple</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">src_tup</span>

        <span class="k">return</span> <span class="n">to_target</span><span class="p">,</span> <span class="n">from_target</span>
        <span class="c1"># colorspacious.cspace_convert(rgb, &quot;sRGB255&quot;, &quot;CIELCh&quot;)</span>

    <span class="k">def</span> <span class="nf">from_hsv</span><span class="p">(</span><span class="n">rgb</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">colorsys</span><span class="o">.</span><span class="n">rgb_to_hsv</span><span class="p">(</span><span class="o">*</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">to_hsv</span><span class="p">(</span><span class="n">hsv</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">colorsys</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="o">*</span><span class="n">hsv</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="n">classnames</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># &#39;AdobeRGBColor&#39;,</span>
        <span class="c1"># &#39;BaseRGBColor&#39;,</span>
        <span class="s1">&#39;cmk&#39;</span><span class="p">:</span> <span class="s1">&#39;CMYColor&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cmyk&#39;</span><span class="p">:</span> <span class="s1">&#39;CMYKColor&#39;</span><span class="p">,</span>
        <span class="s1">&#39;hsl&#39;</span><span class="p">:</span> <span class="s1">&#39;HSLColor&#39;</span><span class="p">,</span>
        <span class="s1">&#39;hsv&#39;</span><span class="p">:</span> <span class="s1">&#39;HSVColor&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ipt&#39;</span><span class="p">:</span> <span class="s1">&#39;IPTColor&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lch-ab&#39;</span><span class="p">:</span> <span class="s1">&#39;LCHabColor&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lch-uv&#39;</span><span class="p">:</span> <span class="s1">&#39;LCHuvColor&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lab&#39;</span><span class="p">:</span> <span class="s1">&#39;LabColor&#39;</span><span class="p">,</span>
        <span class="s1">&#39;luv&#39;</span><span class="p">:</span> <span class="s1">&#39;LuvColor&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;SpectralColor&#39;,</span>
        <span class="s1">&#39;xyz&#39;</span><span class="p">:</span> <span class="s1">&#39;XYZColor&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;sRGBColor&#39;,</span>
        <span class="s1">&#39;xyy&#39;</span><span class="p">:</span> <span class="s1">&#39;xyYColor&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">conversions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">new_convertor</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">color_objects</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">classnames</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1"># conversions = {</span>
    <span class="c1">#     &#39;lch&#39;: new_convertor(color_objects.LCHabColor),</span>
    <span class="c1">#     &#39;lch-uv&#39;: new_convertor(color_objects.LCHuvColor),</span>
    <span class="c1">#     &#39;lab&#39;: new_convertor(color_objects.LabColor),</span>
    <span class="c1">#     &#39;hsv&#39;: new_convertor(color_objects.HSVColor),</span>
    <span class="c1">#     &#39;xyz&#39;: new_convertor(color_objects.XYZColor)</span>
    <span class="c1"># }</span>
    <span class="n">from_rgb</span><span class="p">,</span> <span class="n">to_rgb</span> <span class="o">=</span> <span class="n">conversions</span><span class="p">[</span><span class="s1">&#39;hsv&#39;</span><span class="p">]</span>
    <span class="n">from_rgb</span><span class="p">,</span> <span class="n">to_rgb</span> <span class="o">=</span> <span class="n">conversions</span><span class="p">[</span><span class="s1">&#39;xyz&#39;</span><span class="p">]</span>
    <span class="n">from_rgb</span><span class="p">,</span> <span class="n">to_rgb</span> <span class="o">=</span> <span class="n">conversions</span><span class="p">[</span><span class="s1">&#39;lch-uv&#39;</span><span class="p">]</span>
    <span class="n">from_rgb</span><span class="p">,</span> <span class="n">to_rgb</span> <span class="o">=</span> <span class="n">conversions</span><span class="p">[</span><span class="s1">&#39;lch-ab&#39;</span><span class="p">]</span>
    <span class="n">from_rgb</span><span class="p">,</span> <span class="n">to_rgb</span> <span class="o">=</span> <span class="n">conversions</span><span class="p">[</span><span class="n">space</span><span class="p">]</span>
    <span class="c1"># from_rgb, to_rgb = conversions[&#39;lch&#39;]</span>
    <span class="c1"># from_rgb, to_rgb = conversions[&#39;lab&#39;]</span>
    <span class="c1"># from_rgb, to_rgb = conversions[&#39;lch-uv&#39;]</span>

    <span class="k">for</span> <span class="n">idx2</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">basis</span><span class="p">):</span>
        <span class="n">idx1</span> <span class="o">=</span> <span class="n">idx2</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">fracs</span><span class="p">[</span><span class="n">idx1</span><span class="p">]</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">fracs</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span>

        <span class="n">c1</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">idx1</span><span class="p">]</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span>
        <span class="c1"># from_rgb, to_rgb = conversions[&#39;lch&#39;]</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">from_rgb</span><span class="p">(</span><span class="n">c1</span><span class="p">))</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">from_rgb</span><span class="p">(</span><span class="n">c2</span><span class="p">))</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">f1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f2</span> <span class="o">-</span> <span class="n">f1</span><span class="p">)</span>
        <span class="n">new_h</span> <span class="o">=</span> <span class="n">h1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">h2</span> <span class="o">*</span> <span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">new_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">new_h</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># logger.info(&#39;new_c = %r&#39; % (new_c,))</span>
        <span class="n">cpool</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_c</span><span class="p">)</span>

    <span class="n">cpool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cpool</span><span class="p">)</span>
    <span class="c1"># logger.info(&#39;cpool = %r&#39; % (cpool,))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">cpool</span><span class="p">,</span> <span class="s1">&#39;indexed&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cmap</span></div>

    <span class="c1"># cm.register_cmap(cmap=cmap3)</span>
    <span class="c1"># pass</span>


<div class="viewcode-block" id="print_valid_cmaps"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.print_valid_cmaps">[docs]</a><span class="k">def</span> <span class="nf">print_valid_cmaps</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">pylab</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">maps</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">pylab</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">datad</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_r&#39;</span><span class="p">)]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">maps</span><span class="p">)))</span></div>


<div class="viewcode-block" id="colorbar"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.colorbar">[docs]</a><span class="k">def</span> <span class="nf">colorbar</span><span class="p">(</span>
    <span class="n">scalars</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">,</span>
    <span class="n">custom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">lbl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    adds a color bar next to the axes based on specific scalars</span>

<span class="sd">    Args:</span>
<span class="sd">        scalars (ndarray):</span>
<span class="sd">        colors (ndarray):</span>
<span class="sd">        custom (bool): use custom ticks</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        See plt.colorbar</span>

<span class="sd">    Returns:</span>
<span class="sd">        cb : matplotlib colorbar object</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-colorbar --show</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-colorbar:1 --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool import draw_func2 as df2</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; scalars = np.array([-1, -2, 1, 1, 2, 7, 10])</span>
<span class="sd">        &gt;&gt;&gt; cmap_ = &#39;plasma&#39;</span>
<span class="sd">        &gt;&gt;&gt; logscale = False</span>
<span class="sd">        &gt;&gt;&gt; custom = True</span>
<span class="sd">        &gt;&gt;&gt; reverse_cmap = True</span>
<span class="sd">        &gt;&gt;&gt; val2_customcolor  = {</span>
<span class="sd">        ...        -1: UNKNOWN_PURP,</span>
<span class="sd">        ...        -2: LIGHT_BLUE,</span>
<span class="sd">        ...    }</span>
<span class="sd">        &gt;&gt;&gt; colors = scores_to_color(scalars, cmap_=cmap_, logscale=logscale, reverse_cmap=reverse_cmap, val2_customcolor=val2_customcolor)</span>
<span class="sd">        &gt;&gt;&gt; colorbar(scalars, colors, custom=custom)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool import draw_func2 as df2</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; scalars = np.linspace(0, 1, 100)</span>
<span class="sd">        &gt;&gt;&gt; cmap_ = &#39;plasma&#39;</span>
<span class="sd">        &gt;&gt;&gt; logscale = False</span>
<span class="sd">        &gt;&gt;&gt; custom = False</span>
<span class="sd">        &gt;&gt;&gt; reverse_cmap = False</span>
<span class="sd">        &gt;&gt;&gt; colors = scores_to_color(scalars, cmap_=cmap_, logscale=logscale,</span>
<span class="sd">        &gt;&gt;&gt;                          reverse_cmap=reverse_cmap)</span>
<span class="sd">        &gt;&gt;&gt; colors = [pt.lighten_rgb(c, .3) for c in colors]</span>
<span class="sd">        &gt;&gt;&gt; colorbar(scalars, colors, custom=custom)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="kn">import</span> <span class="n">plot_helpers</span> <span class="k">as</span> <span class="n">ph</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">scalars</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">),</span> <span class="s1">&#39;scalars and colors must be corresponding&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scalars</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="c1"># Parameters</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">ensure_divider</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_axis_xy_width_height</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1"># orientation = [&#39;vertical&#39;, &#39;horizontal&#39;][0]</span>
    <span class="n">TICK_FONTSIZE</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="c1">#</span>
    <span class="c1"># Create scalar mappable with cmap</span>
    <span class="k">if</span> <span class="n">custom</span><span class="p">:</span>
        <span class="c1"># FIXME: clean this code up and change the name custom</span>
        <span class="c1"># to be meaningful. It is more like: display unique colors</span>
        <span class="n">unique_scalars</span><span class="p">,</span> <span class="n">unique_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">scalars</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">unique_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">)[</span><span class="n">unique_idx</span><span class="p">]</span>
        <span class="c1"># max_, min_ = unique_scalars.max(), unique_scalars.min()</span>
        <span class="c1"># extent_ = max_ - min_</span>
        <span class="c1"># bounds = np.linspace(min_, max_ + 1, extent_ + 2)</span>
        <span class="n">listed_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">unique_colors</span><span class="p">)</span>
        <span class="c1"># norm = mpl.colors.BoundaryNorm(bounds, listed_cmap.N)</span>
        <span class="c1"># sm = mpl.cm.ScalarMappable(cmap=listed_cmap, norm=norm)</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">listed_cmap</span><span class="p">)</span>
        <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_scalars</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sorted_scalars</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scalars</span><span class="p">)</span>
        <span class="n">listed_cmap</span> <span class="o">=</span> <span class="n">scores_to_cmap</span><span class="p">(</span><span class="n">scalars</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">listed_cmap</span><span class="p">)</span>
        <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">sorted_scalars</span><span class="p">)</span>
    <span class="c1"># Use mapable object to create the colorbar</span>
    <span class="c1"># COLORBAR_SHRINK = .42  # 1</span>
    <span class="c1"># COLORBAR_PAD = .01  # 1</span>
    <span class="c1"># COLORBAR_ASPECT = np.abs(20 * height / (width))  # 1</span>

    <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># # Add the colorbar to the correct label</span>
    <span class="c1"># axis = cb.ax.yaxis  # if orientation == &#39;horizontal&#39; else cb.ax.yaxis</span>
    <span class="c1"># position = &#39;bottom&#39; if orientation == &#39;horizontal&#39; else &#39;right&#39;</span>
    <span class="c1"># axis.set_ticks_position(position)</span>

    <span class="c1"># This line alone removes data</span>
    <span class="c1"># axis.set_ticks([0, .5, 1])</span>
    <span class="k">if</span> <span class="n">custom</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_scalars</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">+=</span> <span class="mf">0.5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># SO HACKY</span>
            <span class="n">ticks</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ticks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unique_scalars</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ut</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">unique_scalars</span><span class="p">):</span>
            <span class="n">ticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="n">float_format</span> <span class="o">%</span> <span class="n">scalar</span> <span class="k">for</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="n">unique_scalars</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ticklabels</span> <span class="o">=</span> <span class="n">unique_scalars</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>  <span class="c1"># tick locations</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">ticklabels</span><span class="p">)</span>  <span class="c1"># tick labels</span>
    <span class="k">elif</span> <span class="n">ticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ticks_</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
        <span class="n">mx</span> <span class="o">=</span> <span class="n">ticks_</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">mn</span> <span class="o">=</span> <span class="n">ticks_</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticklabels</span><span class="p">))</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>  <span class="c1"># tick locations</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">ticklabels</span><span class="p">)</span>
        <span class="c1"># cb.ax.get_yticks()</span>
        <span class="c1"># cb.set_ticks(ticks)  # tick locations</span>
        <span class="c1"># cb.set_ticklabels(ticklabels)  # tick labels</span>
    <span class="n">ph</span><span class="o">.</span><span class="n">set_plotdat</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;viztype&#39;</span><span class="p">,</span> <span class="s1">&#39;colorbar-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lbl</span><span class="p">,))</span>
    <span class="n">ph</span><span class="o">.</span><span class="n">set_plotdat</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;sm&#39;</span><span class="p">,</span> <span class="n">sm</span><span class="p">)</span>
    <span class="c1"># FIXME: Figure out how to make a maximum number of ticks</span>
    <span class="c1"># and to enforce them to be inside the data bounds</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">TICK_FONTSIZE</span><span class="p">)</span>
    <span class="c1"># Sets current axis</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lbl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cb</span></div>


<div class="viewcode-block" id="draw_lines2"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_lines2">[docs]</a><span class="k">def</span> <span class="nf">draw_lines2</span><span class="p">(</span>
    <span class="n">kpts1</span><span class="p">,</span>
    <span class="n">kpts2</span><span class="p">,</span>
    <span class="n">fm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">kpts2_offset</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">color_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span>
    <span class="n">line_alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span>
    <span class="n">H1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">H2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_factor1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_factor2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>

    <span class="k">if</span> <span class="n">scale_factor1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scale_factor1</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">scale_factor2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scale_factor2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span>
    <span class="c1"># input data</span>
    <span class="k">if</span> <span class="n">fm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># assume kpts are in director correspondence</span>
        <span class="k">assert</span> <span class="n">kpts1</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">kpts2</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;bad shape&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">woff</span><span class="p">,</span> <span class="n">hoff</span> <span class="o">=</span> <span class="n">kpts2_offset</span>
    <span class="c1"># Draw line collection</span>
    <span class="n">kpts1_m</span> <span class="o">=</span> <span class="n">kpts1</span><span class="p">[</span><span class="n">fm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">kpts2_m</span> <span class="o">=</span> <span class="n">kpts2</span><span class="p">[</span><span class="n">fm</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">xy1_m</span> <span class="o">=</span> <span class="n">kpts1_m</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">xy2_m</span> <span class="o">=</span> <span class="n">kpts2_m</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">H1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xy1_m</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">transform_points_with_homography</span><span class="p">(</span><span class="n">H1</span><span class="p">,</span> <span class="n">xy1_m</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">H2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xy2_m</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">transform_points_with_homography</span><span class="p">(</span><span class="n">H2</span><span class="p">,</span> <span class="n">xy2_m</span><span class="p">)</span>
    <span class="n">xy1_m</span> <span class="o">=</span> <span class="n">xy1_m</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scale_factor1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">xy2_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">xy2_m</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scale_factor2</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">woff</span><span class="p">,</span> <span class="n">hoff</span><span class="p">]</span>
    <span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">color_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Draw with solid color</span>
            <span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">RED</span> <span class="k">for</span> <span class="n">fx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Draw with colors proportional to score difference</span>
            <span class="n">color_list</span> <span class="o">=</span> <span class="n">scores_to_color</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xy1_m</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">xy2_m</span><span class="o">.</span><span class="n">T</span><span class="p">)]</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="p">[</span><span class="n">lw</span> <span class="k">for</span> <span class="n">fx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="p">))]</span>
    <span class="c1"># line_alpha = line_alpha</span>
    <span class="c1"># line_alpha = np.linspace(0, 1, len(fm))</span>

    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">line_alpha</span><span class="p">):</span>
        <span class="c1"># Hack for multiple alphas</span>
        <span class="k">for</span> <span class="n">segment</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">line_alpha</span><span class="p">,</span> <span class="n">color_list</span><span class="p">):</span>
            <span class="n">line_group</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">LineCollection</span><span class="p">(</span>
                <span class="p">[</span><span class="n">segment</span><span class="p">],</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">line_group</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_group</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">LineCollection</span><span class="p">(</span>
            <span class="n">segments</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">color_list</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">line_alpha</span>
        <span class="p">)</span>
        <span class="c1"># plt.colorbar(line_group, ax=ax)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">line_group</span><span class="p">)</span></div>
    <span class="c1"># figure(100)</span>
    <span class="c1"># plt.hexbin(x,y, cmap=plt.cm.YlOrRd_r)</span>


<div class="viewcode-block" id="draw_line_segments2"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_line_segments2">[docs]</a><span class="k">def</span> <span class="nf">draw_line_segments2</span><span class="p">(</span><span class="n">pts1</span><span class="p">,</span> <span class="n">pts2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    draws `N` line segments</span>

<span class="sd">    Args:</span>
<span class="sd">        pts1 (ndarray): Nx2</span>
<span class="sd">        pts2 (ndarray): Nx2</span>
<span class="sd">        ax (None): (default = None)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 draw_line_segments2 --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pts1 = np.array([(1, 1), (0, 0)])</span>
<span class="sd">        &gt;&gt;&gt; pts2 = np.array([(2, 2), (1, 0)])</span>
<span class="sd">        &gt;&gt;&gt; pt.figure(fnum=None)</span>
<span class="sd">        &gt;&gt;&gt; #segments = [np.array((xy1, xy2)) for xy1, xy2 in zip(pts1, pts2)]</span>
<span class="sd">        &gt;&gt;&gt; #draw_line_segments(segments)</span>
<span class="sd">        &gt;&gt;&gt; draw_line_segments2(pts1, pts2)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; ax = pt.gca()</span>
<span class="sd">        &gt;&gt;&gt; pt.set_axis_limit(-1, 3, -1, 3, ax)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts2</span><span class="p">),</span> <span class="s1">&#39;unaligned&#39;</span>
    <span class="c1"># if len(pts1) == 0:</span>
    <span class="c1">#     return</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[(</span><span class="n">xy1</span><span class="p">,</span> <span class="n">xy2</span><span class="p">)</span> <span class="k">for</span> <span class="n">xy1</span><span class="p">,</span> <span class="n">xy2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pts1</span><span class="p">,</span> <span class="n">pts2</span><span class="p">)]</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="c1"># if &#39;color&#39; in kwargs:</span>
    <span class="c1">#     kwargs[&#39;color&#39;] = mpl.colors.ColorConverter().to_rgb(kwargs[&#39;color&#39;])</span>
    <span class="n">line_group</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">LineCollection</span><span class="p">(</span>
        <span class="n">segments</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">line_group</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_line_segments"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_line_segments">[docs]</a><span class="k">def</span> <span class="nf">draw_line_segments</span><span class="p">(</span><span class="n">segments_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    segments_list - list of [xs,ys,...] defining the segments</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;.-&#39;</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">segments_list</span><span class="p">:</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="c1"># from matplotlib.collections import LineCollection</span>
    <span class="c1"># points_list = [np.array([pts[0], pts[1]]).T.reshape(-1, 1, 2) for pts in segments_list]</span>
    <span class="c1"># segments_list = [np.concatenate([points[:-1], points[1:]], axis=1) for points in points_list]</span>
    <span class="c1"># linewidth = 2</span>
    <span class="c1"># alpha = 1.0</span>
    <span class="c1"># lc_list = [LineCollection(segments, linewidth=linewidth, alpha=alpha)</span>
    <span class="c1">#           for segments in segments_list]</span>
    <span class="c1"># ax = plt.gca()</span>
    <span class="c1"># for lc in lc_list:</span>
    <span class="c1">#    ax.add_collection(lc)</span>


<div class="viewcode-block" id="draw_patches_and_sifts"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_patches_and_sifts">[docs]</a><span class="k">def</span> <span class="nf">draw_patches_and_sifts</span><span class="p">(</span><span class="n">patch_list</span><span class="p">,</span> <span class="n">sift_list</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
    <span class="c1"># Hacked together will not work on inputs of all sizes</span>
    <span class="c1"># raise NotImplementedError(&#39;unfinished&#39;)</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">num</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">patch_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">num</span> <span class="o">//</span> <span class="n">rows</span>
    <span class="c1"># TODO: recursive stack</span>
    <span class="c1"># stacked_img = patch_list.transpose(2, 0, 1).reshape(height * rows, width * cols)</span>
    <span class="n">stacked_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">ut</span><span class="o">.</span><span class="n">ichunks</span><span class="p">(</span><span class="n">patch_list</span><span class="p">,</span> <span class="n">rows</span><span class="p">)])</span>

    <span class="n">x_base</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>
    <span class="n">y_base</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>
    <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_base</span><span class="p">,</span> <span class="n">y_base</span><span class="p">)</span>

    <span class="n">tmp_kpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="n">xs</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">ys</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">patch_list</span><span class="p">)),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">patch_list</span><span class="p">)),</span>
            <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">patch_list</span><span class="p">)),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">patch_list</span><span class="p">)),</span>
        <span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span> <span class="n">docla</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">stacked_img</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">)</span>
    <span class="c1"># ax = pt.gca()</span>
    <span class="c1"># ax.invert_yaxis()</span>
    <span class="c1"># ax.invert_xaxis()</span>
    <span class="k">if</span> <span class="n">sift_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">draw_kpts2</span><span class="p">(</span><span class="n">tmp_kpts</span><span class="p">,</span> <span class="n">sifts</span><span class="o">=</span><span class="n">sift_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gca</span><span class="p">()</span></div>
    <span class="c1"># pt.iup()</span>


<div class="viewcode-block" id="show_kpts"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.show_kpts">[docs]</a><span class="k">def</span> <span class="nf">show_kpts</span><span class="p">(</span><span class="n">kpts</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Show keypoints in a new figure. Note: use draw_kpts2 to overlay keypoints on a existing figure.</span>

<span class="sd">    Args:</span>
<span class="sd">        kpts (ndarray[float32_t, ndim=2]):  keypoints</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        xdoctest -m ~/code/plottool/plottool/draw_func2.py show_kpts</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import vtool as vt</span>
<span class="sd">        &gt;&gt;&gt; kpts = vt.demodata.get_dummy_kpts()</span>
<span class="sd">        &gt;&gt;&gt; result = show_kpts(kpts)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">doclf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">ensure_fnum</span><span class="p">(</span><span class="n">fnum</span><span class="p">),</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">draw_kpts2</span><span class="p">(</span><span class="n">kpts</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">extents</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">get_kpts_image_extent</span><span class="p">(</span><span class="n">kpts</span><span class="p">)</span>
    <span class="n">set_axis_extent</span><span class="p">(</span><span class="n">extents</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="set_axis_extent"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.set_axis_extent">[docs]</a><span class="k">def</span> <span class="nf">set_axis_extent</span><span class="p">(</span><span class="n">extents</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        extents: xmin, xmax, ymin, ymax</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="n">extents</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">*</span><span class="n">extents</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span></div>


<div class="viewcode-block" id="set_axis_limit"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.set_axis_limit">[docs]</a><span class="k">def</span> <span class="nf">set_axis_limit</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">set_axis_extent</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_kpts2"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_kpts2">[docs]</a><span class="k">def</span> <span class="nf">draw_kpts2</span><span class="p">(</span>
    <span class="n">kpts</span><span class="p">,</span>
    <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">scale_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">pts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">rect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">eig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ori</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pts_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">ell_alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">ell_linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">ell_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pts_color</span><span class="o">=</span><span class="n">ORANGE</span><span class="p">,</span>
    <span class="n">color_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pts_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">siftkw</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">H</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cmap_</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    thin wrapper around mpl_keypoint.draw_keypoints</span>

<span class="sd">    FIXME: seems to be off by (.5, .5) translation</span>

<span class="sd">    Args:</span>
<span class="sd">        kpts (?):</span>
<span class="sd">        offset (tuple):</span>
<span class="sd">        scale_factor (int):</span>
<span class="sd">        ell (bool):</span>
<span class="sd">        pts (bool):</span>
<span class="sd">        rect (bool):</span>
<span class="sd">        eig (bool):</span>
<span class="sd">        ori (bool):</span>
<span class="sd">        pts_size (int):</span>
<span class="sd">        ell_alpha (float):</span>
<span class="sd">        ell_linewidth (float):</span>
<span class="sd">        ell_color (None):</span>
<span class="sd">        pts_color (ndarray):</span>
<span class="sd">        color_list (list):</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool import draw_func2 as df2</span>
<span class="sd">        &gt;&gt;&gt; offset = (0, 0)</span>
<span class="sd">        &gt;&gt;&gt; scale_factor = 1</span>
<span class="sd">        &gt;&gt;&gt; ell = True</span>
<span class="sd">        &gt;&gt;&gt; ell=True</span>
<span class="sd">        &gt;&gt;&gt; pts=False</span>
<span class="sd">        &gt;&gt;&gt; rect=False</span>
<span class="sd">        &gt;&gt;&gt; eig=False</span>
<span class="sd">        &gt;&gt;&gt; ell=True</span>
<span class="sd">        &gt;&gt;&gt; pts=False</span>
<span class="sd">        &gt;&gt;&gt; rect=False</span>
<span class="sd">        &gt;&gt;&gt; eig=False</span>
<span class="sd">        &gt;&gt;&gt; ori=False</span>
<span class="sd">        &gt;&gt;&gt; pts_size=2</span>
<span class="sd">        &gt;&gt;&gt; ell_alpha=.6</span>
<span class="sd">        &gt;&gt;&gt; ell_linewidth=1.5</span>
<span class="sd">        &gt;&gt;&gt; ell_color=None</span>
<span class="sd">        &gt;&gt;&gt; pts_color=df2.ORANGE</span>
<span class="sd">        &gt;&gt;&gt; color_list=None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ell_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ell_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">BLUE</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kpts</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c1"># ensure numpy</span>
        <span class="n">kpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kpts</span><span class="p">)</span>

    <span class="c1"># if ut.DEBUG2:</span>
    <span class="c1">#    logger.info(&#39;-------------&#39;)</span>
    <span class="c1">#    logger.info(&#39;draw_kpts2():&#39;)</span>
    <span class="c1">#    #logger.info(&#39; * kwargs.keys()=%r&#39; % (kwargs.keys(),))</span>
    <span class="c1">#    logger.info(&#39; * kpts.shape=%r:&#39; % (kpts.shape,))</span>
    <span class="c1">#    logger.info(&#39; * ell=%r pts=%r&#39; % (ell, pts))</span>
    <span class="c1">#    logger.info(&#39; * rect=%r eig=%r, ori=%r&#39; % (rect, eig, ori))</span>
    <span class="c1">#    logger.info(&#39; * scale_factor=%r&#39; % (scale_factor,))</span>
    <span class="c1">#    logger.info(&#39; * offset=%r&#39; % (offset,))</span>
    <span class="c1">#    logger.info(&#39; * drawing kpts.shape=%r&#39; % (kpts.shape,))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">kpts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;len(kpts) &lt; 0&#39;</span>
    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">color_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># hack to turn into a color map</span>
        <span class="n">color_list</span> <span class="o">=</span> <span class="n">scores_to_color</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">cmap_</span><span class="o">=</span><span class="n">cmap_</span><span class="p">,</span> <span class="n">reverse_cmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">color_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ell_color</span> <span class="o">=</span> <span class="n">color_list</span>
        <span class="n">pts_color</span> <span class="o">=</span> <span class="n">color_list</span>
    <span class="c1"># else:</span>
    <span class="c1"># pts_color = [pts_color for _ in range(len(kpts))]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ell_color</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ell_color</span> <span class="o">==</span> <span class="s1">&#39;distinct&#39;</span><span class="p">:</span>
        <span class="n">ell_color</span> <span class="o">=</span> <span class="n">distinct_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kpts</span><span class="p">))</span>  <span class="c1"># , randomize=True)</span>
        <span class="c1"># logger.info(len(kpts))</span>

    <span class="n">_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="c1"># offsets</span>
            <span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
            <span class="s1">&#39;scale_factor&#39;</span><span class="p">:</span> <span class="n">scale_factor</span><span class="p">,</span>
            <span class="c1"># flags</span>
            <span class="s1">&#39;pts&#39;</span><span class="p">:</span> <span class="n">pts</span><span class="p">,</span>
            <span class="s1">&#39;ell&#39;</span><span class="p">:</span> <span class="n">ell</span><span class="p">,</span>
            <span class="s1">&#39;ori&#39;</span><span class="p">:</span> <span class="n">ori</span><span class="p">,</span>
            <span class="s1">&#39;rect&#39;</span><span class="p">:</span> <span class="n">rect</span><span class="p">,</span>
            <span class="s1">&#39;eig&#39;</span><span class="p">:</span> <span class="n">eig</span><span class="p">,</span>
            <span class="c1"># properties</span>
            <span class="s1">&#39;ell_color&#39;</span><span class="p">:</span> <span class="n">ell_color</span><span class="p">,</span>
            <span class="s1">&#39;ell_alpha&#39;</span><span class="p">:</span> <span class="n">ell_alpha</span><span class="p">,</span>
            <span class="s1">&#39;ell_linewidth&#39;</span><span class="p">:</span> <span class="n">ell_linewidth</span><span class="p">,</span>
            <span class="s1">&#39;pts_color&#39;</span><span class="p">:</span> <span class="n">pts_color</span><span class="p">,</span>
            <span class="s1">&#39;pts_alpha&#39;</span><span class="p">:</span> <span class="n">pts_alpha</span><span class="p">,</span>
            <span class="s1">&#39;pts_size&#39;</span><span class="p">:</span> <span class="n">pts_size</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">mpl_kp</span><span class="o">.</span><span class="n">draw_keypoints</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kpts</span><span class="p">,</span> <span class="n">siftkw</span><span class="o">=</span><span class="n">siftkw</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">color_list</span></div>


<div class="viewcode-block" id="draw_keypoint_gradient_orientations"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_keypoint_gradient_orientations">[docs]</a><span class="k">def</span> <span class="nf">draw_keypoint_gradient_orientations</span><span class="p">(</span>
    <span class="n">rchip</span><span class="p">,</span> <span class="n">kpt</span><span class="p">,</span> <span class="n">sift</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;vec&#39;</span><span class="p">,</span> <span class="n">kptkw</span><span class="o">=</span><span class="p">{},</span> <span class="n">siftkw</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts a keypoint patch from a chip, extract the gradient, and visualizes</span>
<span class="sd">    it with respect to the current mode.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>

    <span class="n">wpatch</span><span class="p">,</span> <span class="n">wkp</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">get_warped_patch</span><span class="p">(</span><span class="n">rchip</span><span class="p">,</span> <span class="n">kpt</span><span class="p">,</span> <span class="n">gray</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gradx</span><span class="p">,</span> <span class="n">grady</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">patch_gradient</span><span class="p">(</span><span class="n">wpatch</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;!!!!!!!!!!!!&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2!] Exception = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;---------&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;type(wpatch) = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">wpatch</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;repr(wpatch) = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">wpatch</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;wpatch = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">wpatch</span><span class="p">))</span>
        <span class="k">raise</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;vec&#39;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;vecfield&#39;</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">draw_vector_field</span><span class="p">(</span><span class="n">gradx</span><span class="p">,</span> <span class="n">grady</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;col&#39;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;colors&#39;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

        <span class="n">gmag</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">patch_mag</span><span class="p">(</span><span class="n">gradx</span><span class="p">,</span> <span class="n">grady</span><span class="p">)</span>
        <span class="n">gori</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">patch_ori</span><span class="p">(</span><span class="n">gradx</span><span class="p">,</span> <span class="n">grady</span><span class="p">)</span>
        <span class="n">gorimag</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">color_orimag</span><span class="p">(</span><span class="n">gori</span><span class="p">,</span> <span class="n">gmag</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">imshow</span><span class="p">(</span><span class="n">gorimag</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">wkpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wkp</span><span class="p">])</span>
    <span class="n">sifts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sift</span><span class="p">])</span> <span class="k">if</span> <span class="n">sift</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">draw_kpts2</span><span class="p">(</span><span class="n">wkpts</span><span class="p">,</span> <span class="n">sifts</span><span class="o">=</span><span class="n">sifts</span><span class="p">,</span> <span class="n">siftkw</span><span class="o">=</span><span class="n">siftkw</span><span class="p">,</span> <span class="o">**</span><span class="n">kptkw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<span class="c1"># @ut.indent_func(&#39;[df2.dkp]&#39;)</span>
<div class="viewcode-block" id="draw_keypoint_patch"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_keypoint_patch">[docs]</a><span class="k">def</span> <span class="nf">draw_keypoint_patch</span><span class="p">(</span><span class="n">rchip</span><span class="p">,</span> <span class="n">kp</span><span class="p">,</span> <span class="n">sift</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">warped</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">patch_dict</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        rchip (ndarray[uint8_t, ndim=2]):  rotated annotation image data</span>
<span class="sd">        kp (ndarray[float32_t, ndim=1]):  a single keypoint</span>
<span class="sd">        sift (None): (default = None)</span>
<span class="sd">        warped (bool): (default = False)</span>
<span class="sd">        patch_dict (dict): (default = {})</span>

<span class="sd">    Returns:</span>
<span class="sd">        ?: ax</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --test-draw_keypoint_patch --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import vtool as vt</span>
<span class="sd">        &gt;&gt;&gt; rchip = vt.imread(ut.grab_test_imgpath(&#39;lena.png&#39;))</span>
<span class="sd">        &gt;&gt;&gt; kp = [100, 100, 20, 0, 20, 0]</span>
<span class="sd">        &gt;&gt;&gt; sift = None</span>
<span class="sd">        &gt;&gt;&gt; warped = True</span>
<span class="sd">        &gt;&gt;&gt; patch_dict = {}</span>
<span class="sd">        &gt;&gt;&gt; ax = draw_keypoint_patch(rchip, kp, sift, warped, patch_dict)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;ax = %s&#39; % (str(ax),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>

    <span class="c1"># logger.info(&#39;--------------------&#39;)</span>
    <span class="n">kpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kp</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">warped</span><span class="p">:</span>
        <span class="n">patches</span><span class="p">,</span> <span class="n">subkpts</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">get_warped_patches</span><span class="p">(</span><span class="n">rchip</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">patches</span><span class="p">,</span> <span class="n">subkpts</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">get_unwarped_patches</span><span class="p">(</span><span class="n">rchip</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span>
    <span class="c1"># logger.info(&#39;[df2] kpts[0]    = %r&#39; % (kpts[0]))</span>
    <span class="c1"># logger.info(&#39;[df2] subkpts[0] = %r&#39; % (subkpts[0]))</span>
    <span class="c1"># logger.info(&#39;[df2] patches[0].shape = %r&#39; % (patches[0].shape,))</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="n">patches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">subkpts_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subkpts</span><span class="p">)</span>
    <span class="n">patch_dict_</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;sifts&#39;</span><span class="p">:</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">sift</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sift</span><span class="p">]),</span>
        <span class="s1">&#39;ell_color&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ell_color&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="s1">&#39;pts&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pts&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;ori&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ori&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;ell&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;eig&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;rect&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stroke&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;arm1_lw&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;arm1_lw&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="s1">&#39;multicolored_arms&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;multicolored_arms&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">patch_dict_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">patch_dict</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;ell_alpha&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">patch_dict</span><span class="p">[</span><span class="s1">&#39;ell_alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ell_alpha&#39;</span><span class="p">]</span>

    <span class="c1"># Draw patch with keypoint overlay</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">imshow</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">draw_kpts2</span><span class="p">(</span><span class="n">subkpts_</span><span class="p">,</span> <span class="o">**</span><span class="n">patch_dict_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<span class="c1"># ---- CHIP DISPLAY COMMANDS ----</span>
<div class="viewcode-block" id="imshow"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.imshow">[docs]</a><span class="k">def</span> <span class="nf">imshow</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">figtitle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">heatmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">data_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">darken</span><span class="o">=</span><span class="n">DARKEN</span><span class="p">,</span>
    <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">redraw_image</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        img (ndarray): image data</span>
<span class="sd">        fnum (int): figure number</span>
<span class="sd">        title (str):</span>
<span class="sd">        figtitle (None):</span>
<span class="sd">        pnum (tuple): plot number</span>
<span class="sd">        interpolation (str): other interpolations = nearest, bicubic, bilinear</span>
<span class="sd">        cmap (None):</span>
<span class="sd">        heatmap (bool):</span>
<span class="sd">        data_colorbar (bool):</span>
<span class="sd">        darken (None):</span>
<span class="sd">        update (bool): (default = False)</span>
<span class="sd">        redraw_image (bool): used when calling imshow over and over. if false</span>
<span class="sd">                                doesnt do the image part.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (fig, ax)</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        docla, doclf, projection</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (fig, ax)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-imshow --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import vtool as vt</span>
<span class="sd">        &gt;&gt;&gt; img_fpath = ut.grab_test_imgpath(&#39;carl.jpg&#39;)</span>
<span class="sd">        &gt;&gt;&gt; img = vt.imread(img_fpath)</span>
<span class="sd">        &gt;&gt;&gt; (fig, ax) = imshow(img)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;(fig, ax) = %s&#39; % (str((fig, ax)),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>
        <span class="n">nospecial</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">figtitle</span><span class="o">=</span><span class="n">figtitle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
        <span class="n">nospecial</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># ax.set_xticks([])</span>
        <span class="c1"># ax.set_yticks([])</span>
        <span class="c1"># return fig, ax</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">redraw_image</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="c1"># Allow for path to image to be specified</span>
        <span class="n">img_fpath</span> <span class="o">=</span> <span class="n">img</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">assertpath</span><span class="p">(</span><span class="n">img_fpath</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>

        <span class="n">img</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_fpath</span><span class="p">)</span>
    <span class="c1"># darken = .4</span>
    <span class="k">if</span> <span class="n">darken</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">darken</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">darken</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="c1"># Darken the shown picture</span>
        <span class="n">imgdtype</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">dtype</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">darken</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">imgdtype</span><span class="p">)</span>

    <span class="n">plt_imshow_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="n">interpolation</span><span class="p">,</span>
        <span class="c1"># &#39;cmap&#39;: plt.get_cmap(&#39;gray&#39;),</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt_imshow_kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>

    <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">()</span>
        <span class="n">plt_imshow_kwargs</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">heatmap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">nospecial</span><span class="p">:</span>
            <span class="n">plt_imshow_kwargs</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">plt_imshow_kwargs</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
    <span class="k">if</span> <span class="n">heatmap</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;hot&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
            <span class="c1"># img is in a color format</span>
            <span class="n">imgBGR</span> <span class="o">=</span> <span class="n">img</span>

            <span class="k">if</span> <span class="n">imgBGR</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">imgBGR</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">1.01</span><span class="p">:</span>
                    <span class="n">imgBGR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imgBGR</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">imgBGR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imgBGR</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">imgBGR</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
                <span class="c1"># logger.info(&#39;[imshow] imgBGR.dtype = %r&#39; % (imgBGR.dtype,))</span>
                <span class="c1"># logger.info(&#39;[imshow] imgBGR.max() = %r&#39; % (imgBGR.max(),))</span>
                <span class="k">pass</span>
                <span class="c1"># imgBGR *= 255</span>
                <span class="c1"># if imgBGR.max() &lt;= 1.0001:</span>
                <span class="c1">#    plt_imshow_kwargs[&#39;vmax&#39;] = 1</span>
                <span class="c1">#    #del plt_imshow_kwargs[&#39;vmin&#39;]</span>
                <span class="c1">#    #del plt_imshow_kwargs[&#39;vmax&#39;]</span>
            <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">imgRGB</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">imgBGR</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
                <span class="c1"># logger.info(&#39;plt_imshow_kwargs = %r&#39; % (plt_imshow_kwargs,))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">imgRGB</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_imshow_kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">imgBGRA</span> <span class="o">=</span> <span class="n">imgBGR</span>
                <span class="n">imgRGBA</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">imgBGRA</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGRA2RGBA</span><span class="p">)</span>
                <span class="c1"># logger.info(&#39;plt_imshow_kwargs = %r&#39; % (plt_imshow_kwargs,))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">imgRGBA</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_imshow_kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># img is in grayscale</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">imgGRAY</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">imgGRAY</span> <span class="o">=</span> <span class="n">img</span>
            <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">plt_imshow_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;norm&#39;</span><span class="p">):</span>
                <span class="c1"># for some reason gray floats aren&#39;t working right</span>
                <span class="k">if</span> <span class="n">imgGRAY</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">1.01</span> <span class="ow">and</span> <span class="n">imgGRAY</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1e-9</span><span class="p">:</span>
                    <span class="n">imgGRAY</span> <span class="o">=</span> <span class="p">(</span><span class="n">imgGRAY</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">imgGRAY</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_imshow_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="s1">&#39;unknown image format. img.dtype=</span><span class="si">%r</span><span class="s1">, img.shape=</span><span class="si">%r</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">te</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] imshow ERROR </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">te</span><span class="p">,))</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;!!!!!!!!!!!!!!WARNING!!!!!!!!!!!&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] type(img) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;!!!!!!!!!!!!!!ERRROR!!!!!!!!!!!&#39;</span><span class="p">)</span>
            <span class="k">pass</span>
            <span class="c1"># logger.info(&#39;img = %r&#39; % (img,))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] img.dtype = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">dtype</span><span class="p">,))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] type(img) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">img</span><span class="p">),))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] img.shape = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] imshow ERROR </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ex</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="c1"># plt.set_cmap(&#39;gray&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">data_colorbar</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;hot&#39;</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">scores_to_color</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
        <span class="n">colorbar</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">custom_figure</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">figtitle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">custom_figure</span><span class="o">.</span><span class="n">set_figtitle</span><span class="p">(</span><span class="n">figtitle</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
        <span class="n">fig_presenter</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="draw_vector_field"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_vector_field">[docs]</a><span class="k">def</span> <span class="nf">draw_vector_field</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 draw_vector_field --show</span>
<span class="sd">        python -m wbia.plottool.draw_func2 draw_vector_field --show --fname=zebra.png --fx=121 --stride=3</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; import vtool as vt</span>
<span class="sd">        &gt;&gt;&gt; patch = vt.testdata_patch()</span>
<span class="sd">        &gt;&gt;&gt; gx, gy = vt.patch_gradient(patch, gaussian_weighted=False)</span>
<span class="sd">        &gt;&gt;&gt; stride = ut.get_argval(&#39;--stride&#39;, default=1)</span>
<span class="sd">        &gt;&gt;&gt; pt.draw_vector_field(gx, gy, stride=stride)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># https://stackoverflow.com/questions/1843194/plotting-vector-fields-in-python-matplotlib</span>
    <span class="c1"># http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.quiver</span>
    <span class="n">quiv_kw</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;xy&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scale_units&#39;</span><span class="p">:</span> <span class="s1">&#39;xy&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;angles&#39;: &#39;uv&#39;,</span>
        <span class="c1"># &#39;scale&#39;: 80,</span>
        <span class="c1"># &#39;width&#39;:</span>
        <span class="s1">&#39;headaxislength&#39;</span><span class="p">:</span> <span class="mf">4.5</span><span class="p">,</span>
        <span class="c1"># &#39;headlength&#39;: 5,</span>
        <span class="s1">&#39;headlength&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="c1"># &#39;headwidth&#39;: 3,</span>
        <span class="s1">&#39;headwidth&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s1">&#39;minshaft&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;minlength&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="c1"># &#39;color&#39;: &#39;r&#39;,</span>
        <span class="c1"># &#39;edgecolor&#39;: &#39;k&#39;,</span>
        <span class="s1">&#39;linewidths&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,),</span>
        <span class="s1">&#39;pivot&#39;</span><span class="p">:</span> <span class="s1">&#39;tail&#39;</span><span class="p">,</span>  <span class="c1"># &#39;middle&#39;,</span>
    <span class="p">}</span>
    <span class="c1"># TAU = 2 * np.pi</span>
    <span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gx</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gy</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Vector locations and directions</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span><span class="p">)</span>
    <span class="n">U</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">gx</span><span class="p">,</span> <span class="o">-</span><span class="n">gy</span>
    <span class="c1"># Apply stride</span>
    <span class="n">X_</span> <span class="o">=</span> <span class="n">X</span><span class="p">[::</span><span class="n">stride</span><span class="p">,</span> <span class="p">::</span><span class="n">stride</span><span class="p">]</span>
    <span class="n">Y_</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[::</span><span class="n">stride</span><span class="p">,</span> <span class="p">::</span><span class="n">stride</span><span class="p">]</span>
    <span class="n">U_</span> <span class="o">=</span> <span class="n">U</span><span class="p">[::</span><span class="n">stride</span><span class="p">,</span> <span class="p">::</span><span class="n">stride</span><span class="p">]</span>
    <span class="n">V_</span> <span class="o">=</span> <span class="n">V</span><span class="p">[::</span><span class="n">stride</span><span class="p">,</span> <span class="p">::</span><span class="n">stride</span><span class="p">]</span>
    <span class="c1"># Draw arrows</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">X_</span><span class="p">,</span> <span class="n">Y_</span><span class="p">,</span> <span class="n">U_</span><span class="p">,</span> <span class="n">V_</span><span class="p">,</span> <span class="o">**</span><span class="n">quiv_kw</span><span class="p">)</span>
    <span class="c1"># Plot properties</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="show_chipmatch2"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.show_chipmatch2">[docs]</a><span class="k">def</span> <span class="nf">show_chipmatch2</span><span class="p">(</span>
    <span class="n">rchip1</span><span class="p">,</span>
    <span class="n">rchip2</span><span class="p">,</span>
    <span class="n">kpts1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">kpts2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fm_norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vert</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">heatmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">modifysize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">new_return</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">draw_fmatch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">darken</span><span class="o">=</span><span class="n">DARKEN</span><span class="p">,</span>
    <span class="n">H1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">H2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sel_fm</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">heatmask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">white_background</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draws two chips and the feature matches between them. feature matches</span>
<span class="sd">    kpts1 and kpts2 use the (x,y,a,c,d)</span>

<span class="sd">    Args:</span>
<span class="sd">        rchip1 (ndarray): rotated annotation 1 image data</span>
<span class="sd">        rchip2 (ndarray): rotated annotation 2 image data</span>
<span class="sd">        kpts1 (ndarray): keypoints for annotation 1 [x, y, a=1, c=0, d=1, theta=0]</span>
<span class="sd">        kpts2 (ndarray): keypoints for annotation 2 [x, y, a=1, c=0, d=1, theta=0]</span>
<span class="sd">        fm (list):  list of feature matches as tuples (qfx, dfx)</span>
<span class="sd">        fs (list):  list of feature scores</span>
<span class="sd">        fm_norm (None): (default = None)</span>
<span class="sd">        title (str):  (default = None)</span>
<span class="sd">        vert (None): (default = None)</span>
<span class="sd">        fnum (int):  figure number(default = None)</span>
<span class="sd">        pnum (tuple):  plot number(default = None)</span>
<span class="sd">        heatmap (bool): (default = False)</span>
<span class="sd">        modifysize (bool): (default = False)</span>
<span class="sd">        new_return (bool): (default = False)</span>
<span class="sd">        draw_fmatch (bool): (default = True)</span>
<span class="sd">        darken (None): (default = None)</span>
<span class="sd">        H1 (None): (default = None)</span>
<span class="sd">        H2 (None): (default = None)</span>
<span class="sd">        sel_fm (list): (default = [])</span>
<span class="sd">        ax (None): (default = None)</span>
<span class="sd">        heatmask (bool): (default = False)</span>
<span class="sd">        **kwargs: all_kpts, lbl1, lbl2, rect, colorbar_, draw_border, cmap,</span>
<span class="sd">                  scale_factor1, scale_factor2, draw_pts, draw_ell,</span>
<span class="sd">                  draw_lines, ell_alpha, colors</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (xywh1, xywh2, sf_tup)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 show_chipmatch2 --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; import vtool as vt</span>
<span class="sd">        &gt;&gt;&gt; rchip1 = vt.imread(ut.grab_test_imgpath(&#39;easy1.png&#39;))</span>
<span class="sd">        &gt;&gt;&gt; rchip2 = vt.imread(ut.grab_test_imgpath(&#39;easy2.png&#39;))</span>
<span class="sd">        &gt;&gt;&gt; kpts1 = np.array([</span>
<span class="sd">        &gt;&gt;&gt;     [10,  10,   30,   0,    30,    0.  ],</span>
<span class="sd">        &gt;&gt;&gt;     [ 355.89,  142.95,   10.46,   -0.63,    8.59,    0.  ],</span>
<span class="sd">        &gt;&gt;&gt;     [ 356.35,  147.  ,    8.38,    1.08,   11.68,    0.  ],</span>
<span class="sd">        &gt;&gt;&gt;     [ 361.4 ,  150.64,    7.44,    3.45,   13.63,    0.  ]</span>
<span class="sd">        &gt;&gt;&gt; ], dtype=np.float64)</span>
<span class="sd">        &gt;&gt;&gt; kpts2 = np.array([</span>
<span class="sd">        &gt;&gt;&gt;     [ 10,   10,   30,   0,    30,    0.  ],</span>
<span class="sd">        &gt;&gt;&gt;     [ 376.98,   50.61,   11.91,   -2.9 ,    9.77,    0.  ],</span>
<span class="sd">        &gt;&gt;&gt;     [ 377.59,   54.89,    9.7 ,   -1.4 ,   13.72,    0.  ],</span>
<span class="sd">        &gt;&gt;&gt;     [ 382.8 ,   58.2 ,    7.87,   -0.31,   15.23,    0.  ]</span>
<span class="sd">        &gt;&gt;&gt; ], dtype=np.float64)</span>
<span class="sd">        &gt;&gt;&gt; fm = None</span>
<span class="sd">        &gt;&gt;&gt; fs = None</span>
<span class="sd">        &gt;&gt;&gt; H1 = np.array([</span>
<span class="sd">        &gt;&gt;&gt;     [ -4.68815126e-01,   7.80306795e-02,  -2.23674587e+01],</span>
<span class="sd">        &gt;&gt;&gt;     [  4.54394231e-02,  -7.67438835e-01,   5.92158624e+01],</span>
<span class="sd">        &gt;&gt;&gt;     [  2.12918867e-04,  -8.64851418e-05,  -6.21472492e-01]])</span>
<span class="sd">        &gt;&gt;&gt; H1 = None</span>
<span class="sd">        &gt;&gt;&gt; H2 = None</span>
<span class="sd">        &gt;&gt;&gt; #H_half = np.array([[.2, 0, 0], [0, .2, 0], [0, 0, 1]])</span>
<span class="sd">        &gt;&gt;&gt; #H1 = H_half</span>
<span class="sd">        &gt;&gt;&gt; #H2 = H_half</span>
<span class="sd">        &gt;&gt;&gt; kwargs = dict(H1=H1, H2=H2, fm=fm, draw_lines=True, draw_ell=True)</span>
<span class="sd">        &gt;&gt;&gt; kwargs.update(ell_linewidth=5, lw=10, line_alpha=[1, .3, .3, .3])</span>
<span class="sd">        &gt;&gt;&gt; result = show_chipmatch2(rchip1, rchip2, kpts1, kpts2, **kwargs)</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>

    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] show_chipmatch2() fnum=</span><span class="si">%r</span><span class="s1">, pnum=</span><span class="si">%r</span><span class="s1">, ax=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="p">,</span> <span class="n">ax</span><span class="p">))</span>
    <span class="n">wh1</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">rchip1</span><span class="p">)</span>
    <span class="n">wh2</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">rchip2</span><span class="p">)</span>
    <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># if H1 is None and H2 is not None or H2 is None and H1 is not None:</span>
        <span class="c1"># We are warping one chip into the space of the other</span>
        <span class="n">dsize1</span> <span class="o">=</span> <span class="n">wh2</span>
        <span class="n">dsize2</span> <span class="o">=</span> <span class="n">wh1</span>

    <span class="k">if</span> <span class="n">heatmask</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">vtool.coverage_kpts</span> <span class="kn">import</span> <span class="n">make_kpts_heatmask</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;all_kpts&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kpts1_m</span> <span class="o">=</span> <span class="n">kpts1</span><span class="p">[</span><span class="n">fm</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">kpts2_m</span> <span class="o">=</span> <span class="n">kpts2</span><span class="p">[</span><span class="n">fm</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kpts1_m</span> <span class="o">=</span> <span class="n">kpts1</span>
            <span class="n">kpts2_m</span> <span class="o">=</span> <span class="n">kpts2</span>

        <span class="n">heatmask1</span> <span class="o">=</span> <span class="n">make_kpts_heatmask</span><span class="p">(</span><span class="n">kpts1_m</span><span class="p">,</span> <span class="n">wh1</span><span class="p">)</span>
        <span class="n">heatmask2</span> <span class="o">=</span> <span class="n">make_kpts_heatmask</span><span class="p">(</span><span class="n">kpts2_m</span><span class="p">,</span> <span class="n">wh2</span><span class="p">)</span>
        <span class="n">rchip1</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">overlay_alpha_images</span><span class="p">(</span><span class="n">heatmask1</span><span class="p">,</span> <span class="n">rchip1</span><span class="p">)</span>
        <span class="n">rchip2</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">overlay_alpha_images</span><span class="p">(</span><span class="n">heatmask2</span><span class="p">,</span> <span class="n">rchip2</span><span class="p">)</span>

    <span class="c1"># Warp if homography is specified</span>
    <span class="n">rchip1_</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">warpHomog</span><span class="p">(</span><span class="n">rchip1</span><span class="p">,</span> <span class="n">H1</span><span class="p">,</span> <span class="n">dsize1</span><span class="p">)</span> <span class="k">if</span> <span class="n">H1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rchip1</span>
    <span class="n">rchip2_</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">warpHomog</span><span class="p">(</span><span class="n">rchip2</span><span class="p">,</span> <span class="n">H2</span><span class="p">,</span> <span class="n">dsize2</span><span class="p">)</span> <span class="k">if</span> <span class="n">H2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rchip2</span>
    <span class="c1"># get matching keypoints + offset</span>
    <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">h1</span><span class="p">)</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">rchip1_</span><span class="p">)</span>
    <span class="p">(</span><span class="n">w2</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">rchip2_</span><span class="p">)</span>
    <span class="c1"># Stack the compared chips</span>
    <span class="c1"># modifysize = True</span>
    <span class="n">match_img</span><span class="p">,</span> <span class="n">offset_tup</span><span class="p">,</span> <span class="n">sf_tup</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">stack_images</span><span class="p">(</span>
        <span class="n">rchip1_</span><span class="p">,</span>
        <span class="n">rchip2_</span><span class="p">,</span>
        <span class="n">vert</span><span class="p">,</span>
        <span class="n">modifysize</span><span class="o">=</span><span class="n">modifysize</span><span class="p">,</span>
        <span class="n">return_sf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">white_background</span><span class="o">=</span><span class="n">white_background</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="p">(</span><span class="n">woff</span><span class="p">,</span> <span class="n">hoff</span><span class="p">)</span> <span class="o">=</span> <span class="n">offset_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">xywh1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">h1</span><span class="p">)</span>
    <span class="n">xywh2</span> <span class="o">=</span> <span class="p">(</span><span class="n">woff</span><span class="p">,</span> <span class="n">hoff</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span>
    <span class="c1"># Show the stacked chips</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">imshow</span><span class="p">(</span>
        <span class="n">match_img</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span>
        <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">heatmap</span><span class="o">=</span><span class="n">heatmap</span><span class="p">,</span>
        <span class="n">darken</span><span class="o">=</span><span class="n">darken</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># Overlay feature match nnotations</span>
    <span class="k">if</span> <span class="n">draw_fmatch</span> <span class="ow">and</span> <span class="n">kpts1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kpts2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sf1</span><span class="p">,</span> <span class="n">sf2</span> <span class="o">=</span> <span class="n">sf_tup</span>
        <span class="n">plot_fmatch</span><span class="p">(</span>
            <span class="n">xywh1</span><span class="p">,</span>
            <span class="n">xywh2</span><span class="p">,</span>
            <span class="n">kpts1</span><span class="p">,</span>
            <span class="n">kpts2</span><span class="p">,</span>
            <span class="n">fm</span><span class="p">,</span>
            <span class="n">fs</span><span class="p">,</span>
            <span class="n">fm_norm</span><span class="o">=</span><span class="n">fm_norm</span><span class="p">,</span>
            <span class="n">H1</span><span class="o">=</span><span class="n">H1</span><span class="p">,</span>
            <span class="n">scale_factor1</span><span class="o">=</span><span class="n">sf1</span><span class="p">,</span>
            <span class="n">scale_factor2</span><span class="o">=</span><span class="n">sf2</span><span class="p">,</span>
            <span class="n">H2</span><span class="o">=</span><span class="n">H2</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sel_fm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Draw any selected matches in blue</span>
            <span class="n">sm_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">BLUE</span><span class="p">)</span>
            <span class="n">plot_fmatch</span><span class="p">(</span><span class="n">xywh1</span><span class="p">,</span> <span class="n">xywh2</span><span class="p">,</span> <span class="n">kpts1</span><span class="p">,</span> <span class="n">kpts2</span><span class="p">,</span> <span class="n">sel_fm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">sm_kw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">new_return</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">xywh1</span><span class="p">,</span> <span class="n">xywh2</span><span class="p">,</span> <span class="n">sf_tup</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">xywh1</span><span class="p">,</span> <span class="n">xywh2</span></div>


<span class="c1"># plot feature match</span>
<div class="viewcode-block" id="plot_fmatch"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.plot_fmatch">[docs]</a><span class="k">def</span> <span class="nf">plot_fmatch</span><span class="p">(</span>
    <span class="n">xywh1</span><span class="p">,</span>
    <span class="n">xywh2</span><span class="p">,</span>
    <span class="n">kpts1</span><span class="p">,</span>
    <span class="n">kpts2</span><span class="p">,</span>
    <span class="n">fm</span><span class="p">,</span>
    <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fm_norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">lbl1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">lbl2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">colorbar_</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">draw_border</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">H1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">H2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_factor1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_factor2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overlays the matching features over chips that were previously plotted.</span>

<span class="sd">    Args:</span>
<span class="sd">        xywh1 (tuple): location of rchip1 in the axes</span>
<span class="sd">        xywh2 (tuple): location or rchip2 in the axes</span>
<span class="sd">        kpts1 (ndarray): keypoints in rchip1</span>
<span class="sd">        kpts2 (ndarray): keypoints in rchip1</span>
<span class="sd">        fm (list): feature matches</span>
<span class="sd">        fs (list): features scores</span>
<span class="sd">        fm_norm (None): (default = None)</span>
<span class="sd">        lbl1 (None): rchip1 label</span>
<span class="sd">        lbl2 (None): rchip2 label</span>
<span class="sd">        fnum (None): figure number</span>
<span class="sd">        pnum (None): plot number</span>
<span class="sd">        rect (bool):</span>
<span class="sd">        colorbar_ (bool):</span>
<span class="sd">        draw_border (bool):</span>
<span class="sd">        cmap (None): (default = None)</span>
<span class="sd">        H1 (None): (default = None)</span>
<span class="sd">        H2 (None): (default = None)</span>
<span class="sd">        scale_factor1 (None): (default = None)</span>
<span class="sd">        scale_factor2 (None): (default = None)</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        draw_pts, draw_ell, draw_lines, show_nMatches, all_kpts</span>

<span class="sd">    Returns:</span>
<span class="sd">        ?: None</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-plot_fmatch</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; xywh1 = &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; xywh2 = &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; kpts1 = &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; kpts2 = &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; fm = &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; fs = None</span>
<span class="sd">        &gt;&gt;&gt; fm_norm = None</span>
<span class="sd">        &gt;&gt;&gt; lbl1 = None</span>
<span class="sd">        &gt;&gt;&gt; lbl2 = None</span>
<span class="sd">        &gt;&gt;&gt; fnum = None</span>
<span class="sd">        &gt;&gt;&gt; pnum = None</span>
<span class="sd">        &gt;&gt;&gt; rect = False</span>
<span class="sd">        &gt;&gt;&gt; colorbar_ = True</span>
<span class="sd">        &gt;&gt;&gt; draw_border = False</span>
<span class="sd">        &gt;&gt;&gt; cmap = None</span>
<span class="sd">        &gt;&gt;&gt; H1 = None</span>
<span class="sd">        &gt;&gt;&gt; H2 = None</span>
<span class="sd">        &gt;&gt;&gt; scale_factor1 = None</span>
<span class="sd">        &gt;&gt;&gt; scale_factor2 = None</span>
<span class="sd">        &gt;&gt;&gt; plot_fmatch(xywh1, xywh2, kpts1, kpts2, fm, fs, fm_norm, lbl1, lbl2,</span>
<span class="sd">        &gt;&gt;&gt;             fnum, pnum, rect, colorbar_, draw_border, cmap, h1, h2,</span>
<span class="sd">        &gt;&gt;&gt;             scale_factor1, scale_factor2)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;None = %s&#39; % (str(None),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fm</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fm_norm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">kpts1</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">kpts2</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;shapes different or fm not none&#39;</span>
        <span class="n">fm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">kpts1</span><span class="p">)),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;draw_pts&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">ell</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;draw_ell&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;draw_lines&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">ell_alpha</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ell_alpha&#39;</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
    <span class="n">nMatch</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="p">)</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">xywh2</span>
    <span class="n">offset1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">offset2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="c1"># THIS IS NOT WHERE THIS CODE BELONGS</span>
    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="c1"># Custom user label for chips 1 and 2</span>
        <span class="k">if</span> <span class="n">lbl1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">h1</span> <span class="o">=</span> <span class="n">xywh1</span>
            <span class="n">absolute_lbl</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">w1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">lbl1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lbl2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">absolute_lbl</span><span class="p">(</span><span class="n">x2</span> <span class="o">+</span> <span class="n">w2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">lbl2</span><span class="p">)</span>
    <span class="c1"># Plot the number of matches</span>
    <span class="c1"># if kwargs.get(&#39;show_nMatches&#39;, False):</span>
    <span class="c1">#    upperleft_text(&#39;#match=%d&#39; % nMatch)</span>
    <span class="c1"># Draw all keypoints in both chips as points</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;all_kpts&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">all_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">ell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span>
            <span class="n">pts_color</span><span class="o">=</span><span class="n">GREEN</span><span class="p">,</span>
            <span class="n">pts_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">ell_alpha</span><span class="o">=</span><span class="n">ell_alpha</span><span class="p">,</span>
            <span class="n">rect</span><span class="o">=</span><span class="n">rect</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">all_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">draw_kpts2</span><span class="p">(</span><span class="n">kpts1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset1</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">all_args</span><span class="p">)</span>
        <span class="n">draw_kpts2</span><span class="p">(</span><span class="n">kpts2</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset2</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">all_args</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw_border</span><span class="p">:</span>
        <span class="n">draw_bbox</span><span class="p">(</span><span class="n">xywh1</span><span class="p">,</span> <span class="n">bbox_color</span><span class="o">=</span><span class="n">BLACK</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">draw_arrow</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">draw_bbox</span><span class="p">(</span><span class="n">xywh2</span><span class="p">,</span> <span class="n">bbox_color</span><span class="o">=</span><span class="n">BLACK</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">draw_arrow</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">nMatch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># draw lines and ellipses and points</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">nMatch</span> <span class="k">if</span> <span class="s1">&#39;colors&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">distinct_colors</span><span class="p">(</span><span class="n">nMatch</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">fs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;hot&#39;</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">scores_to_color</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>

        <span class="c1"># acols = add_alpha(colors)</span>

        <span class="c1"># Helper functions</span>
        <span class="k">def</span> <span class="nf">_drawkpts</span><span class="p">(</span><span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
            <span class="n">_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fxs1</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">fxs2</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">kpts1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">draw_kpts2</span><span class="p">(</span>
                    <span class="n">kpts1</span><span class="p">[</span><span class="n">fxs1</span><span class="p">],</span>
                    <span class="n">offset</span><span class="o">=</span><span class="n">offset1</span><span class="p">,</span>
                    <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor1</span><span class="p">,</span>
                    <span class="n">rect</span><span class="o">=</span><span class="n">rect</span><span class="p">,</span>
                    <span class="n">H</span><span class="o">=</span><span class="n">H1</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">_kwargs</span>
                <span class="p">)</span>
            <span class="n">draw_kpts2</span><span class="p">(</span>
                <span class="n">kpts2</span><span class="p">[</span><span class="n">fxs2</span><span class="p">],</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">offset2</span><span class="p">,</span>
                <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor2</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">rect</span><span class="o">=</span><span class="n">rect</span><span class="p">,</span>
                <span class="n">H</span><span class="o">=</span><span class="n">H2</span><span class="p">,</span>
                <span class="o">**</span><span class="n">_kwargs</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">_drawlines</span><span class="p">(</span><span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
            <span class="n">_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;line_lw&#39;</span> <span class="ow">in</span> <span class="n">_kwargs</span><span class="p">:</span>
                <span class="n">_kwargs</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;line_lw&#39;</span><span class="p">)</span>
            <span class="n">draw_lines2</span><span class="p">(</span>
                <span class="n">kpts1</span><span class="p">,</span>
                <span class="n">kpts2</span><span class="p">,</span>
                <span class="n">fm</span><span class="p">,</span>
                <span class="n">fs</span><span class="p">,</span>
                <span class="n">kpts2_offset</span><span class="o">=</span><span class="n">offset2</span><span class="p">,</span>
                <span class="n">scale_factor1</span><span class="o">=</span><span class="n">scale_factor1</span><span class="p">,</span>
                <span class="n">scale_factor2</span><span class="o">=</span><span class="n">scale_factor2</span><span class="p">,</span>
                <span class="n">H1</span><span class="o">=</span><span class="n">H1</span><span class="p">,</span>
                <span class="n">H2</span><span class="o">=</span><span class="n">H2</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="o">**</span><span class="n">_kwargs</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">fm_norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># NORMALIZING MATCHES IF GIVEN</span>
                <span class="n">_kwargs_norm</span> <span class="o">=</span> <span class="n">_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">fs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;cool&#39;</span>
                    <span class="n">colors</span> <span class="o">=</span> <span class="n">scores_to_color</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
                <span class="n">_kwargs_norm</span><span class="p">[</span><span class="s1">&#39;color_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span>
                <span class="n">draw_lines2</span><span class="p">(</span>
                    <span class="n">kpts1</span><span class="p">,</span>
                    <span class="n">kpts2</span><span class="p">,</span>
                    <span class="n">fm_norm</span><span class="p">,</span>
                    <span class="n">fs</span><span class="p">,</span>
                    <span class="n">kpts2_offset</span><span class="o">=</span><span class="n">offset2</span><span class="p">,</span>
                    <span class="n">H1</span><span class="o">=</span><span class="n">H1</span><span class="p">,</span>
                    <span class="n">H2</span><span class="o">=</span><span class="n">H2</span><span class="p">,</span>
                    <span class="n">scale_factor1</span><span class="o">=</span><span class="n">scale_factor1</span><span class="p">,</span>
                    <span class="n">scale_factor2</span><span class="o">=</span><span class="n">scale_factor2</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">_kwargs_norm</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">ell</span><span class="p">:</span>
            <span class="n">_drawkpts</span><span class="p">(</span><span class="n">pts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color_list</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pts</span><span class="p">:</span>
            <span class="c1"># TODO: just draw points with a stroke</span>
            <span class="n">_drawkpts</span><span class="p">(</span><span class="n">pts_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pts_color</span><span class="o">=</span><span class="n">BLACK</span><span class="p">)</span>
            <span class="n">_drawkpts</span><span class="p">(</span><span class="n">pts_size</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color_list</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lines</span> <span class="ow">and</span> <span class="n">kpts1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_drawlines</span><span class="p">(</span><span class="n">color_list</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># if not matches draw a big red X</span>
        <span class="c1"># draw_boxedX(xywh2)</span>
        <span class="k">pass</span>
    <span class="c1"># Turn off colorbar if there are no features being drawn</span>
    <span class="c1"># or the user doesnt want a colorbar</span>
    <span class="n">drew_anything</span> <span class="o">=</span> <span class="n">fs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ell</span> <span class="ow">or</span> <span class="n">pts</span> <span class="ow">or</span> <span class="n">lines</span><span class="p">)</span>
    <span class="n">has_colors</span> <span class="o">=</span> <span class="n">nMatch</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># &#39;colors&#39; in vars()</span>
    <span class="k">if</span> <span class="n">drew_anything</span> <span class="ow">and</span> <span class="n">has_colors</span> <span class="ow">and</span> <span class="n">colorbar_</span><span class="p">:</span>
        <span class="n">colorbar</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>
    <span class="c1"># legend()</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="draw_boxedX"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_boxedX">[docs]</a><span class="k">def</span> <span class="nf">draw_boxedX</span><span class="p">(</span><span class="n">xywh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">RED</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; draws a big red x &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">xywh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xy</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">get_axis_xy_width_height</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">xywh</span> <span class="o">=</span> <span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">xywh</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">h</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)),</span> <span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">))]</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span>
    <span class="n">trans</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">trans</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span>
    <span class="n">width_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">lw</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
    <span class="n">line_group</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">LineCollection</span><span class="p">(</span>
        <span class="n">segments</span><span class="p">,</span> <span class="n">width_list</span><span class="p">,</span> <span class="n">color_list</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">transOffset</span><span class="o">=</span><span class="n">trans</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">line_group</span><span class="p">)</span></div>


<div class="viewcode-block" id="color_orimag"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.color_orimag">[docs]</a><span class="k">def</span> <span class="nf">color_orimag</span><span class="p">(</span><span class="n">gori</span><span class="p">,</span> <span class="n">gmag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gmag_is_01</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;rgb&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        gori (ndarray): orientation values at pixels between 0 and tau</span>
<span class="sd">        gmag (ndarray): orientation magnitude</span>
<span class="sd">        gmag_is_01 (bool): True if gmag is in the 0 and 1 range. if None we try to guess</span>
<span class="sd">        p (float): power to raise normalized weights to for visualization purposes</span>

<span class="sd">    Returns:</span>
<span class="sd">        ndarray: rgb_ori or bgr_ori</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --test-color_orimag --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; import vtool as vt</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; gori = np.array([[ 0.        ,  0.        ,  3.14159265,  3.14159265,  0.        ],</span>
<span class="sd">        ...                  [ 1.57079633,  3.92250052,  1.81294053,  3.29001537,  1.57079633],</span>
<span class="sd">        ...                  [ 4.71238898,  6.15139659,  0.76764078,  1.75632531,  1.57079633],</span>
<span class="sd">        ...                  [ 4.71238898,  4.51993581,  6.12565345,  3.87978382,  1.57079633],</span>
<span class="sd">        ...                  [ 0.        ,  0.        ,  0.        ,  0.        ,  0.        ]])</span>
<span class="sd">        &gt;&gt;&gt; gmag = np.array([[ 0.        ,  0.02160321,  0.00336692,  0.06290751,  0.        ],</span>
<span class="sd">        ...                      [ 0.02363726,  0.04195344,  0.29969492,  0.53007415,  0.0426679 ],</span>
<span class="sd">        ...                      [ 0.00459386,  0.32086307,  0.02844123,  0.24623816,  0.27344167],</span>
<span class="sd">        ...                      [ 0.04204251,  0.52165989,  0.25800464,  0.14568752,  0.023614  ],</span>
<span class="sd">        ...                      [ 0.        ,  0.05143869,  0.2744546 ,  0.01582246,  0.        ]])</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; p = 1</span>
<span class="sd">        &gt;&gt;&gt; bgr_ori1 = color_orimag(gori, gmag, encoding=&#39;bgr&#39;, p=p)</span>
<span class="sd">        &gt;&gt;&gt; bgr_ori2 = color_orimag(gori, None, encoding=&#39;bgr&#39;)</span>
<span class="sd">        &gt;&gt;&gt; legendimg = pt.make_ori_legend_img().astype(np.float32) / 255.0</span>
<span class="sd">        &gt;&gt;&gt; gweights_color = np.dstack([gmag] * 3).astype(np.float32)</span>
<span class="sd">        &gt;&gt;&gt; img, _, _ = vt.stack_images(bgr_ori2, gweights_color, vert=False)</span>
<span class="sd">        &gt;&gt;&gt; img, _, _ = vt.stack_images(img, bgr_ori1, vert=False)</span>
<span class="sd">        &gt;&gt;&gt; img, _, _ = vt.stack_images(img, legendimg, vert=True, modifysize=True)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; pt.imshow(img, pnum=(1, 2, 1))</span>
<span class="sd">        &gt;&gt;&gt; # Hack orientation offset so 0 is downward</span>
<span class="sd">        &gt;&gt;&gt; gradx, grady = np.cos(gori + TAU / 4.0), np.sin(gori + TAU / 4.0)</span>
<span class="sd">        &gt;&gt;&gt; pt.imshow(bgr_ori2, pnum=(1, 2, 2))</span>
<span class="sd">        &gt;&gt;&gt; pt.draw_vector_field(gradx, grady, pnum=(1, 2, 2), invert=False)</span>
<span class="sd">        &gt;&gt;&gt; color_orimag_colorbar(gori)</span>
<span class="sd">        &gt;&gt;&gt; pt.set_figtitle(&#39;weighted and unweighted orientaiton colors&#39;)</span>
<span class="sd">        &gt;&gt;&gt; pt.update()</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Turn a 0 to 1 orienation map into hsv colors</span>
    <span class="c1"># gori_01 = (gori - gori.min()) / (gori.max() - gori.min())</span>
    <span class="k">if</span> <span class="n">gori</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">TAU</span> <span class="ow">or</span> <span class="n">gori</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;WARNING: [color_orimag] gori might not be in radians&#39;</span><span class="p">)</span>
    <span class="n">flat_rgb</span> <span class="o">=</span> <span class="n">get_orientation_color</span><span class="p">(</span><span class="n">gori</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="c1"># flat_rgb = np.array(cmap_(), dtype=np.float32)</span>
    <span class="n">rgb_ori_alpha</span> <span class="o">=</span> <span class="n">flat_rgb</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">gori</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">])))</span>
    <span class="n">rgb_ori</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">rgb_ori_alpha</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_RGBA2RGB</span><span class="p">)</span>
    <span class="n">hsv_ori</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">rgb_ori</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_RGB2HSV</span><span class="p">)</span>
    <span class="c1"># Darken colors based on magnitude</span>
    <span class="k">if</span> <span class="n">gmag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Hueristic hack</span>
        <span class="k">if</span> <span class="n">gmag_is_01</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gmag_is_01</span> <span class="o">=</span> <span class="n">gmag</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>
        <span class="n">gmag_</span> <span class="o">=</span> <span class="n">gmag</span> <span class="k">if</span> <span class="n">gmag_is_01</span> <span class="k">else</span> <span class="n">gmag</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mf">255.0</span><span class="p">,</span> <span class="n">gmag</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="c1"># Weights modify just value</span>
        <span class="n">gmag_</span> <span class="o">=</span> <span class="n">gmag_</span> <span class="o">**</span> <span class="n">p</span>
        <span class="c1"># SAT_CHANNEL = 1</span>
        <span class="n">VAL_CHANNEL</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="c1"># hsv_ori[:, :, SAT_CHANNEL] = gmag_</span>
        <span class="n">hsv_ori</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">VAL_CHANNEL</span><span class="p">]</span> <span class="o">=</span> <span class="n">gmag_</span>
    <span class="c1"># Convert back to bgr</span>
    <span class="c1"># bgr_ori = cv2.cvtColor(hsv_ori, cv2.COLOR_HSV2BGR)</span>
    <span class="k">if</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s1">&#39;rgb&#39;</span><span class="p">:</span>
        <span class="n">rgb_ori</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">hsv_ori</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_HSV2RGB</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rgb_ori</span>
    <span class="k">elif</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s1">&#39;bgr&#39;</span><span class="p">:</span>
        <span class="n">bgr_ori</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">hsv_ori</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_HSV2BGR</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bgr_ori</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;unkonwn encoding=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">encoding</span><span class="p">,))</span></div>


<div class="viewcode-block" id="get_orientation_color"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.get_orientation_color">[docs]</a><span class="k">def</span> <span class="nf">get_orientation_color</span><span class="p">(</span><span class="n">radians_list</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        radians_list (list):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --test-get_orientation_color</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; radians_list = np.linspace(-1, 10, 10)</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; result = get_orientation_color(radians_list)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TAU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="c1"># Map radians to 0 to 1</span>
    <span class="n">ori01_list</span> <span class="o">=</span> <span class="p">(</span><span class="n">radians_list</span> <span class="o">%</span> <span class="n">TAU</span><span class="p">)</span> <span class="o">/</span> <span class="n">TAU</span>
    <span class="n">cmap_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;hsv&#39;</span><span class="p">)</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="n">cmap_</span><span class="p">(</span><span class="n">ori01_list</span><span class="p">)</span>
    <span class="n">ori_colors_rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">color_list</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ori_colors_rgb</span></div>


<div class="viewcode-block" id="color_orimag_colorbar"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.color_orimag_colorbar">[docs]</a><span class="k">def</span> <span class="nf">color_orimag_colorbar</span><span class="p">(</span><span class="n">gori</span><span class="p">):</span>
    <span class="n">TAU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">ori_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">TAU</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="n">get_orientation_color</span><span class="p">(</span><span class="n">ori_list</span><span class="p">)</span>
    <span class="c1"># colorbar(ori_list, color_list, lbl=&#39;orientation (radians)&#39;, custom=True)</span>
    <span class="n">colorbar</span><span class="p">(</span><span class="n">ori_list</span><span class="p">,</span> <span class="n">color_list</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s1">&#39;radians&#39;</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">custom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="make_ori_legend_img"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.make_ori_legend_img">[docs]</a><span class="k">def</span> <span class="nf">make_ori_legend_img</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    creates a figure that shows which colors are associated with which keypoint</span>
<span class="sd">    rotations.</span>

<span class="sd">    a rotation of 0 should point downward (becuase it is relative the the (0, 1)</span>
<span class="sd">    keypoint eigenvector. and its color should be red due to the hsv mapping</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --test-make_ori_legend_img --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; img_BGR = make_ori_legend_img()</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; pt.imshow(img_BGR)</span>
<span class="sd">        &gt;&gt;&gt; pt.iup()</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">TAU</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">NUM</span> <span class="o">=</span> <span class="mi">36</span>
    <span class="n">NUM</span> <span class="o">=</span> <span class="mi">36</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NUM</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">theta_list</span> <span class="o">=</span> <span class="n">domain</span> <span class="o">*</span> <span class="n">TAU</span>
    <span class="n">relative_theta_list</span> <span class="o">=</span> <span class="n">theta_list</span> <span class="o">+</span> <span class="p">(</span><span class="n">TAU</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">color_rgb_list</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">get_orientation_color</span><span class="p">(</span><span class="n">theta_list</span><span class="p">)</span>
    <span class="n">c_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">relative_theta_list</span><span class="p">)</span>
    <span class="n">r_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">relative_theta_list</span><span class="p">)</span>
    <span class="n">rc_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">r_list</span><span class="p">,</span> <span class="n">c_list</span><span class="p">))</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">1024</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">ut</span><span class="o">.</span><span class="n">PHI</span>
    <span class="c1"># size_root = size / 4</span>
    <span class="n">half_size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">img_BGR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">x_kernel_offset</span><span class="p">,</span> <span class="n">y_kernel_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
    <span class="n">x_kernel_offset</span> <span class="o">=</span> <span class="n">x_kernel_offset</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">y_kernel_offset</span> <span class="o">=</span> <span class="n">y_kernel_offset</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="c1"># x_kernel_offset = np.array([0, 1,  0, -1, -1, -1,  0,  1, 1])</span>
    <span class="c1"># y_kernel_offset = np.array([0, 1,  1,  1,  0, -1, -1, -1, 0])</span>
    <span class="c1"># new_data_weight = np.ones(x_kernel_offset.shape, dtype=np.int32)</span>
    <span class="k">for</span> <span class="n">color_rgb</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">color_rgb_list</span><span class="p">,</span> <span class="n">rc_list</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">x_kernel_offset</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">+</span> <span class="n">half_size</span><span class="p">)</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">y_kernel_offset</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">+</span> <span class="n">half_size</span><span class="p">)</span>
        <span class="c1"># old_data = img[row, col, :]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color_rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span>
        <span class="n">color_bgr</span> <span class="o">=</span> <span class="n">color</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># img_BGR[row, col, :] = color</span>
        <span class="n">img_BGR</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">color_bgr</span>
        <span class="c1"># new_data = img_BGR[row, col, :]</span>
        <span class="c1"># old_data_weight = np.array(list(map(np.any, old_data &gt; 0)), dtype=np.int32)</span>
        <span class="c1"># total_weight = old_data_weight + 1</span>
    <span class="kn">import</span> <span class="nn">cv2</span>

    <span class="k">for</span> <span class="n">color_rgb</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">color_rgb_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span> <span class="n">rc_list</span><span class="p">))[::</span><span class="mi">8</span><span class="p">]:</span>
        <span class="n">row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">+</span> <span class="n">half_size</span><span class="p">)</span>
        <span class="n">col</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">+</span> <span class="n">half_size</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;t=</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theta</span><span class="p">))</span>
        <span class="n">fontFace</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span>
        <span class="n">fontScale</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">textcolor</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span>
        <span class="n">text_pt</span><span class="p">,</span> <span class="n">text_sz</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getTextSize</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">fontFace</span><span class="p">,</span> <span class="n">fontScale</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
        <span class="n">text_w</span><span class="p">,</span> <span class="n">text_h</span> <span class="o">=</span> <span class="n">text_pt</span>
        <span class="n">org</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="n">text_w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">text_h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="c1"># logger.info(row)</span>
        <span class="c1"># logger.info(col)</span>
        <span class="c1"># logger.info(color_rgb)</span>
        <span class="c1"># logger.info(text)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span>
            <span class="n">img_BGR</span><span class="p">,</span>
            <span class="n">text</span><span class="p">,</span>
            <span class="n">org</span><span class="p">,</span>
            <span class="n">fontFace</span><span class="p">,</span>
            <span class="n">fontScale</span><span class="p">,</span>
            <span class="n">textcolor</span><span class="p">,</span>
            <span class="n">thickness</span><span class="p">,</span>
            <span class="n">bottomLeftOrigin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># img_BGR[row, col, :] = ((old_data * old_data_weight[:, None] +</span>
        <span class="c1"># new_data) / total_weight[:, None])</span>
    <span class="c1"># logger.info(img_BGR)</span>
    <span class="k">return</span> <span class="n">img_BGR</span></div>


<div class="viewcode-block" id="remove_patches"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.remove_patches">[docs]</a><span class="k">def</span> <span class="nf">remove_patches</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; deletes patches from axes &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">patch</span></div>


<div class="viewcode-block" id="imshow_null"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.imshow_null">[docs]</a><span class="k">def</span> <span class="nf">imshow_null</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        msg (None): (default = None)</span>
<span class="sd">        ax (None): (default = None)</span>
<span class="sd">        **kwargs: fnum, title, figtitle, pnum, interpolation, cmap, heatmap,</span>
<span class="sd">                  data_colorbar, darken, update, xlabel, redraw_image, alpha,</span>
<span class="sd">                  docla, doclf, projection, use_gridspec</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 imshow_null --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; msg = None</span>
<span class="sd">        &gt;&gt;&gt; ax = None</span>
<span class="sd">        &gt;&gt;&gt; result = imshow_null(msg, ax)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gca</span><span class="p">()</span>
    <span class="n">subkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;kwargs = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">,))</span>
    <span class="n">kwargs_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_subset</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">subkeys</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;kwargs_ = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kwargs_</span><span class="p">,))</span>
    <span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">draw_boxedX</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">relative_text</span><span class="p">(</span>
            <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">msg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="axes_bottom_button_bar"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.axes_bottom_button_bar">[docs]</a><span class="k">def</span> <span class="nf">axes_bottom_button_bar</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">text_list</span><span class="o">=</span><span class="p">[]):</span>
    <span class="c1"># Method 2</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">but_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">text_list</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">but</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">ax_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">but_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">but</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">but_list</span><span class="p">,</span> <span class="n">ax_list</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # Method 1</span>
<span class="sd">    (x1, y1), (x2, y2) = ax.get_position().get_points()</span>
<span class="sd">    # Parent axes props</span>
<span class="sd">    root_left   = x1</span>
<span class="sd">    root_bottom = y1</span>
<span class="sd">    root_height = y2 - y1</span>
<span class="sd">    root_width  = x2 - x1</span>

<span class="sd">    # Build axes for buttons</span>
<span class="sd">    num = len(text_list)</span>
<span class="sd">    pad_percent = .05</span>
<span class="sd">    rect_list = []</span>
<span class="sd">    xpad = root_width * pad_percent</span>
<span class="sd">    width = (root_width - (xpad * num)) / num</span>
<span class="sd">    height = root_height * .05</span>
<span class="sd">    left = root_left</span>
<span class="sd">    bottom = root_bottom - height</span>
<span class="sd">    for ix in range(num):</span>
<span class="sd">        rect = [left, bottom, width, height]</span>
<span class="sd">        rect_list.append(rect)</span>
<span class="sd">        left += width + xpad</span>
<span class="sd">    ax_list = [plt.axes(rect) for rect in rect_list]</span>
<span class="sd">    but_list = [mpl.widgets.Button(ax_, text) for ax_, text in zip(ax_list, text_list)]</span>
<span class="sd">    return but_list</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="make_bbox_positioners"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.make_bbox_positioners">[docs]</a><span class="k">def</span> <span class="nf">make_bbox_positioners</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">xpad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">startx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stopx</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">hl_slot</span><span class="p">(</span><span class="n">ix</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">startx</span> <span class="o">+</span> <span class="p">(</span><span class="n">xpad</span> <span class="o">*</span> <span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">ix</span> <span class="o">*</span> <span class="n">w</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hr_slot</span><span class="p">(</span><span class="n">ix</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">stopx</span> <span class="o">-</span> <span class="p">((</span><span class="n">xpad</span> <span class="o">*</span> <span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hl_slot</span><span class="p">,</span> <span class="n">hr_slot</span></div>


<div class="viewcode-block" id="width_from"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.width_from">[docs]</a><span class="k">def</span> <span class="nf">width_from</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pad</span><span class="p">))</span> <span class="o">/</span> <span class="n">num</span></div>


<span class="c1"># +-----</span>
<span class="c1"># From vtool.patch</span>
<div class="viewcode-block" id="param_plot_iterator"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.param_plot_iterator">[docs]</a><span class="k">def</span> <span class="nf">param_plot_iterator</span><span class="p">(</span><span class="n">param_list</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="kn">import</span> <span class="n">plot_helpers</span>

    <span class="n">nRows</span><span class="p">,</span> <span class="n">nCols</span> <span class="o">=</span> <span class="n">plot_helpers</span><span class="o">.</span><span class="n">get_square_row_cols</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">param_list</span><span class="p">),</span> <span class="n">fix</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># next_pnum = make_pnum_nextgen(nRows=nRows, nCols=nCols)</span>
    <span class="n">pnum_gen</span> <span class="o">=</span> <span class="n">pnum_generator</span><span class="p">(</span><span class="n">nRows</span><span class="p">,</span> <span class="n">nCols</span><span class="p">)</span>
    <span class="n">pnum</span> <span class="o">=</span> <span class="p">(</span><span class="n">nRows</span><span class="p">,</span> <span class="n">nCols</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">pnum</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">param_list</span><span class="p">,</span> <span class="n">pnum_gen</span><span class="p">):</span>
        <span class="c1"># get next figure ready</span>
        <span class="c1"># logger.info(&#39;fnum=%r, pnum=%r&#39; % (fnum, pnum))</span>
        <span class="k">if</span> <span class="n">projection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">subplot_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">projection</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subplot_kw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="o">*</span><span class="n">pnum</span><span class="p">,</span> <span class="o">**</span><span class="n">subplot_kw</span><span class="p">)</span>
        <span class="c1"># figure(fnum=fnum, pnum=pnum)</span>
        <span class="k">yield</span> <span class="n">param</span></div>


<div class="viewcode-block" id="plot_surface3d"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.plot_surface3d">[docs]</a><span class="k">def</span> <span class="nf">plot_surface3d</span><span class="p">(</span>
    <span class="n">xgrid</span><span class="p">,</span>
    <span class="n">ygrid</span><span class="p">,</span>
    <span class="n">zdata</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">zlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wire</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">contour</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">dark</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">pnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">labelkw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabelkw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabelkw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">zlabelkw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">titlekw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References:</span>
<span class="sd">        http://matplotlib.org/mpl_toolkits/mplot3d/tutorial.html</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-plot_surface3d --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; import vtool as vt</span>
<span class="sd">        &gt;&gt;&gt; shape=(19, 19)</span>
<span class="sd">        &gt;&gt;&gt; sigma1, sigma2 = 2.0, 1.0</span>
<span class="sd">        &gt;&gt;&gt; ybasis = np.arange(shape[0])</span>
<span class="sd">        &gt;&gt;&gt; xbasis = np.arange(shape[1])</span>
<span class="sd">        &gt;&gt;&gt; xgrid, ygrid = np.meshgrid(xbasis, ybasis)</span>
<span class="sd">        &gt;&gt;&gt; sigma = [sigma1, sigma2]</span>
<span class="sd">        &gt;&gt;&gt; gausspatch = vt.gaussian_patch(shape, sigma=sigma)</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;ksize=%r, sigma=%r&#39; % (shape, (sigma1, sigma2),)</span>
<span class="sd">        &gt;&gt;&gt; pt.plot_surface3d(xgrid, ygrid, gausspatch, rstride=1, cstride=1,</span>
<span class="sd">        &gt;&gt;&gt;                   cmap=mpl.cm.coolwarm, title=title)</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">titlekw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">titlekw</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">labelkw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labelkw</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">xlabelkw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlabelkw</span> <span class="o">=</span> <span class="n">labelkw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ylabelkw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylabelkw</span> <span class="o">=</span> <span class="n">labelkw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">zlabelkw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">zlabelkw</span> <span class="o">=</span> <span class="n">labelkw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>  <span class="c1"># NOQA</span>

    <span class="k">if</span> <span class="n">pnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="c1"># logger.info(&#39;pnum = %r&#39; % (pnum,))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="o">*</span><span class="n">pnum</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;wire&#39;</span> <span class="k">if</span> <span class="n">wire</span> <span class="k">else</span> <span class="s1">&#39;surface&#39;</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;wire&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span>
            <span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">,</span> <span class="n">zdata</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="n">rstride</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="n">cstride</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="c1"># ax.contour(xgrid, ygrid, zdata, rstride=rstride, cstride=cstride,</span>
        <span class="c1"># extend3d=True, *args, **kwargs)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;surface&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span>
            <span class="n">xgrid</span><span class="p">,</span>
            <span class="n">ygrid</span><span class="p">,</span>
            <span class="n">zdata</span><span class="p">,</span>
            <span class="n">rstride</span><span class="o">=</span><span class="n">rstride</span><span class="p">,</span>
            <span class="n">cstride</span><span class="o">=</span><span class="n">cstride</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;mode=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,))</span>
    <span class="k">if</span> <span class="n">contour</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>

        <span class="n">xoffset</span> <span class="o">=</span> <span class="n">xgrid</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="p">((</span><span class="n">xgrid</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">xgrid</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="n">yoffset</span> <span class="o">=</span> <span class="n">ygrid</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="p">((</span><span class="n">ygrid</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">ygrid</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="n">zoffset</span> <span class="o">=</span> <span class="n">zdata</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="p">((</span><span class="n">zdata</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">zdata</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">,</span> <span class="n">zdata</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">xoffset</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">,</span> <span class="n">zdata</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">yoffset</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">,</span> <span class="n">zdata</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">zoffset</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="c1"># ax.plot_trisurf(xgrid.flatten(), ygrid.flatten(), zdata.flatten(), *args, **kwargs)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">titlekw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="o">**</span><span class="n">xlabelkw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="o">**</span><span class="n">ylabelkw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="n">zlabel</span><span class="p">,</span> <span class="o">**</span><span class="n">zlabelkw</span><span class="p">)</span>
    <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="n">dark</span>
    <span class="c1"># if use_darkbackground is None:</span>
    <span class="c1">#    use_darkbackground = not ut.get_argflag(&#39;--save&#39;)</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span><span class="p">:</span>
        <span class="n">dark_background</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<span class="c1"># L_____</span>


<div class="viewcode-block" id="draw_text_annotations"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.draw_text_annotations">[docs]</a><span class="k">def</span> <span class="nf">draw_text_annotations</span><span class="p">(</span>
    <span class="n">text_list</span><span class="p">,</span>
    <span class="n">pos_list</span><span class="p">,</span>
    <span class="n">bbox_offset_list</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">pos_offset_list</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">bbox_align_list</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">color_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">textprops</span><span class="o">=</span><span class="p">{},</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hack fixes to issues in text annotations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">artist_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">offset_box_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bbox_offset_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">bbox_offset_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox_offset_list</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_offset_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">pos_offset_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos_offset_list</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bbox_align_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">bbox_align_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox_align_list</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_list</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">textkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
        <span class="n">boxcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
        <span class="n">pad</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
        <span class="n">framewidth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">),</span>
        <span class="c1"># bboxprops=dict(fc=node_attr[&#39;fillcolor&#39;]),</span>
    <span class="p">)</span>

    <span class="n">_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">text_list</span><span class="p">,</span> <span class="n">pos_list</span><span class="p">,</span> <span class="n">pos_offset_list</span><span class="p">,</span> <span class="n">bbox_offset_list</span><span class="p">,</span> <span class="n">bbox_align_list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">tup</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_iter</span><span class="p">):</span>
        <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">pos_offset</span><span class="p">,</span> <span class="n">bbox_offset</span><span class="p">,</span> <span class="n">bbox_align</span><span class="p">)</span> <span class="o">=</span> <span class="n">tup</span>
        <span class="k">if</span> <span class="n">color_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">color_list</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">WHITE</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">dpx</span><span class="p">,</span> <span class="n">dpy</span> <span class="o">=</span> <span class="n">pos_offset</span>

        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset_box</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">offsetbox</span><span class="o">.</span><span class="n">TextArea</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">textprops</span><span class="p">)</span>
            <span class="n">artist</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">offsetbox</span><span class="o">.</span><span class="n">AnnotationBbox</span><span class="p">(</span>
                <span class="n">offset_box</span><span class="p">,</span>
                <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dpx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dpy</span><span class="p">),</span>
                <span class="n">xybox</span><span class="o">=</span><span class="n">bbox_offset</span><span class="p">,</span>
                <span class="n">box_alignment</span><span class="o">=</span><span class="n">bbox_align</span><span class="p">,</span>
                <span class="n">bboxprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fc</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
                <span class="o">**</span><span class="n">textkw</span>
            <span class="p">)</span>
            <span class="n">offset_box_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offset_box</span><span class="p">)</span>
            <span class="n">artist_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artist_list</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hack_fix_centeralign</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Caller needs to call this after limits are set up</span>
<span class="sd">        to fixe issue in matplotlib</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">textprops</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;horizontalalignment&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;center&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fixing centeralign&#39;</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="c1"># Superhack for centered text. Fix bug in</span>
            <span class="c1"># /usr/local/lib/python2.7/dist-packages/matplotlib/offsetbox.py</span>
            <span class="c1"># /usr/local/lib/python2.7/dist-packages/matplotlib/text.py</span>
            <span class="k">for</span> <span class="n">offset_box</span> <span class="ow">in</span> <span class="n">offset_box_list</span><span class="p">:</span>
                <span class="n">offset_box</span><span class="o">.</span><span class="n">set_offset</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">offset_box</span><span class="o">.</span><span class="n">_text</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span>
                <span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">x1</span> <span class="o">-</span> <span class="n">z</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">offset_box</span><span class="o">.</span><span class="n">_text</span>
                <span class="n">T</span> <span class="o">=</span> <span class="n">offset_box</span><span class="o">.</span><span class="n">_text</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span>
                <span class="n">A</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span>
                <span class="n">A</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">A</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="n">z</span><span class="o">.</span><span class="n">x1</span> <span class="o">-</span> <span class="n">z</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">offset_box</span><span class="o">.</span><span class="n">_text</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">A</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hack_fix_centeralign</span></div>


<div class="viewcode-block" id="set_figsize"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.set_figsize">[docs]</a><span class="k">def</span> <span class="nf">set_figsize</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_dpi</span><span class="p">(</span><span class="n">dpi</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_func"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.plot_func">[docs]</a><span class="k">def</span> <span class="nf">plot_func</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plots a numerical function in a given range</span>

<span class="sd">    Args:</span>
<span class="sd">        funcs (list of function):  live python function</span>
<span class="sd">        start (int): (default = 0)</span>
<span class="sd">        stop (int): (default = 1)</span>
<span class="sd">        num (int): (default = 100)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-plot_func --show --range=-1,1 --func=np.exp</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-plot_func --show --range=-1,1 --func=scipy.special.logit</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-plot_func --show --range=0,1 --func=&quot;lambda x: scipy.special.expit(((x * 2) - 1.0) * 6)&quot;</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-plot_func --show --range=0,1 --func=&quot;lambda x: scipy.special.expit(-6 + 12 * x)&quot;</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-plot_func --show --range=0,4 --func=&quot;lambda x: vt.logistic_01((-1 + x) * 2)&quot;</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-plot_func --show --range=0,1 --func=&quot;lambda x: np.tan((x - .5) * np.pi)&quot; --ylim=-10,10</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-plot_func --show --range=0,3 --func=np.tan</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-plot_func --show --range=0,50 --func=&quot;lambda x: np.exp(-x / 50)&quot;</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-plot_func --show --range=-8,8 --func=vt.beaton_tukey_loss</span>
<span class="sd">        python -m wbia.plottool.draw_func2 --exec-plot_func --show --range=-8,8 --func=vt.beaton_tukey_weight,vt.beaton_tukey_loss</span>

<span class="sd">        python -m wbia.plottool plot_func --show --range=-1,1 \</span>
<span class="sd">                --setup=&quot;from wbia.algo.smk.smk_pipeline import SMK&quot; \</span>
<span class="sd">                --func=lambda u: SMK.selectivity(u, 3.0, 0)</span>

<span class="sd">        python -m wbia.plottool plot_func --show --range=-1,1 \</span>
<span class="sd">                --func \</span>
<span class="sd">                &quot;lambda u: sign(u) * abs(u)**3.0 * greater_equal(u, 0)&quot; \</span>
<span class="sd">                &quot;lambda u: (sign((u+1)/2) * abs((u+1)/2)**3.0 * greater_equal(u, 0+.5))&quot;</span>

<span class="sd">        alpha=3</span>
<span class="sd">        thresh=-1</span>

<span class="sd">        python -m wbia.plottool plot_func --show --range=-1,1 \</span>
<span class="sd">                --func \</span>
<span class="sd">                &quot;lambda u: sign(u) * abs(u)**$alpha * greater_equal(u, $thresh)&quot; \</span>
<span class="sd">                &quot;lambda u: (sign(u) * abs(u)**$alpha * greater_equal(u, $thresh) + 1) / 2&quot; \</span>
<span class="sd">                &quot;lambda u: sign((u+1)/2) * abs((u+1)/2)**$alpha * greater_equal(u, $thresh)&quot;</span>

<span class="sd">        python -m wbia.plottool plot_func --show --range=4,100 \</span>
<span class="sd">                --func \</span>
<span class="sd">                &quot;lambda n: log2(n)&quot;\</span>
<span class="sd">                &quot;lambda n: log2(log2(n))&quot;\</span>
<span class="sd">                &quot;lambda n: log2(n)/log2(log2(n))&quot;\</span>
<span class="sd">                &quot;lambda n: log2(n) ** 2&quot;\</span>
<span class="sd">                &quot;lambda n: n&quot;\</span>

<span class="sd">        python -m wbia.plottool plot_func --show --range=4,1000000 \</span>
<span class="sd">                --func \</span>
<span class="sd">                &quot;lambda n: log2(n)&quot;\</span>
<span class="sd">                &quot;lambda n: n ** (1/3)&quot;</span>

<span class="sd">        python -m wbia.plottool plot_func --show --range=0,10 \</span>
<span class="sd">                --func \</span>
<span class="sd">                &quot;lambda x: (3 * (x ** 2) - 18 * (x) - 81) / ((x ** 2) - 54) &quot;</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.draw_func2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import scipy</span>
<span class="sd">        &gt;&gt;&gt; import scipy.special  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; func_list = ut.get_argval(&#39;--func&#39;, type_=list, default=[&#39;np.exp&#39;])</span>
<span class="sd">        &gt;&gt;&gt; setup = ut.get_argval(&#39;--setup&#39;, type_=str, default=None)</span>
<span class="sd">        &gt;&gt;&gt; #funcs = [eval(f) for f in func_list]</span>
<span class="sd">        &gt;&gt;&gt; funcs = func_list</span>
<span class="sd">        &gt;&gt;&gt; start, stop = ut.get_argval(&#39;--range&#39;, type_=list, default=[-1, 1])</span>
<span class="sd">        &gt;&gt;&gt; start, stop = eval(str(start)), eval(str(stop))</span>
<span class="sd">        &gt;&gt;&gt; num = 1000</span>
<span class="sd">        &gt;&gt;&gt; result = plot_func(funcs, start, stop, num, setup=setup)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; ylim = ut.get_argval(&#39;--ylim&#39;, type_=list, default=None)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; None if ylim is None else plt.gca().set_ylim(*ylim)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">funcs</span><span class="p">):</span>
        <span class="n">funcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcs</span><span class="p">]</span>
    <span class="kn">import</span> <span class="nn">scipy</span>  <span class="c1"># NOQA</span>
    <span class="kn">import</span> <span class="nn">scipy.special</span>  <span class="c1"># NOQA</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">func</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span> <span class="k">else</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_callable_name</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span>
    <span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">funcs_</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">eval</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span> <span class="k">else</span> <span class="n">func</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span>
        <span class="p">]</span>
        <span class="n">ydatas</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs_</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="n">locals_</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">setup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exec</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">locals_</span><span class="p">,</span> <span class="n">locals_</span><span class="p">)</span>
        <span class="n">locals_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="n">funcs_</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">eval</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">locals_</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span> <span class="k">else</span> <span class="n">func</span>
            <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span>
        <span class="p">]</span>
        <span class="n">ydatas</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs_</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">funcs</span><span class="p">))</span>
        <span class="k">raise</span>
    <span class="n">fnum</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ensure_fnum</span><span class="p">(</span><span class="n">fnum</span><span class="p">)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">multi_plot</span><span class="p">(</span>
        <span class="n">xdata</span><span class="p">,</span> <span class="n">ydatas</span><span class="p">,</span> <span class="n">label_list</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span>
    <span class="p">)</span>  <span class="c1"># yscale=&#39;log&#39;)</span></div>


<div class="viewcode-block" id="test_save"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.draw_func2.test_save">[docs]</a><span class="k">def</span> <span class="nf">test_save</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.draw_func2 test_save --show</span>
<span class="sd">        python -m wbia.plottool.draw_func2 test_save</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
    <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
    <span class="n">dpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_app_cache_dir</span><span class="p">(</span><span class="s1">&#39;plottool&#39;</span><span class="p">)</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="s1">&#39;test.png&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fpath</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">wbia</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../wbia.html">wbia - Wildbook IA</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../../wbia.html">wbia</a><ul>
  <li><a href="../plottool.html">wbia.plottool</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Wild Me.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>