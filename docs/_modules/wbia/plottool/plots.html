<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>wbia.plottool.plots &mdash; wildbook-ia 4.0.1.dev11+dirty documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> wildbook-ia
          </a>
              <div class="version">
                4.0.1.dev11+dirty
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">wildbook-ia</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
          <li><a href="../plottool.html">wbia.plottool</a> &raquo;</li>
      <li>wbia.plottool.plots</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for wbia.plottool.plots</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">draw_func2</span> <span class="k">as</span> <span class="n">df2</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">zip_longest</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>  <span class="c1"># NOQA</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">print</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">inject2</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;wbia&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="is_default_dark_bg"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.is_default_dark_bg">[docs]</a><span class="k">def</span> <span class="nf">is_default_dark_bg</span><span class="p">():</span>
    <span class="c1"># return True</span>
    <span class="c1"># lightbg = not  ut.get_argflag(&#39;--darkbg&#39;)</span>
    <span class="c1"># lightbg = ut.get_argflag(&#39;--save&#39;) or ut.get_argflag(&#39;--lightbg&#39;)</span>
    <span class="n">lightbg</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="n">lightbg</span></div>


<div class="viewcode-block" id="multi_plot"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.multi_plot">[docs]</a><span class="k">def</span> <span class="nf">multi_plot</span><span class="p">(</span><span class="n">xdata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ydata_list</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plots multiple lines, bars, etc...</span>

<span class="sd">    This is the big function that implements almost all of the heavy lifting in</span>
<span class="sd">    this file.  Any function not using this should probably find a way to use</span>
<span class="sd">    it. It is pretty general and relatively clean.</span>

<span class="sd">    Args:</span>
<span class="sd">        xdata (ndarray): can also be a list of arrays</span>
<span class="sd">        ydata_list (list of ndarrays): can also be a single array</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        Misc:</span>
<span class="sd">            fnum, pnum, use_legend, legend_loc</span>
<span class="sd">        Labels:</span>
<span class="sd">            xlabel, ylabel, title, figtitle</span>
<span class="sd">            ticksize, titlesize, legendsize, labelsize</span>
<span class="sd">        Grid:</span>
<span class="sd">            gridlinewidth, gridlinestyle</span>
<span class="sd">        Ticks:</span>
<span class="sd">            num_xticks, num_yticks, tickwidth, ticklength, ticksize</span>
<span class="sd">        Data:</span>
<span class="sd">            xmin, xmax, ymin, ymax, spread_list</span>
<span class="sd">            # can append _list to any of these</span>
<span class="sd">            plot_kw_keys = [&#39;label&#39;, &#39;color&#39;, &#39;marker&#39;, &#39;markersize&#39;,</span>
<span class="sd">                &#39;markeredgewidth&#39;, &#39;linewidth&#39;, &#39;linestyle&#39;]</span>
<span class="sd">            kind = [&#39;bar&#39;, &#39;plot&#39;, ...]</span>
<span class="sd">        if kind=&#39;plot&#39;:</span>
<span class="sd">            spread</span>
<span class="sd">        if kind=&#39;bar&#39;:</span>
<span class="sd">            stacked, width</span>

<span class="sd">    References:</span>
<span class="sd">        matplotlib.org/examples/api/barchart_demo.html</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots multi_plot:0 --show</span>
<span class="sd">        python -m wbia.plottool.plots multi_plot:1 --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; xdata = [1, 2, 3, 4, 5]</span>
<span class="sd">        &gt;&gt;&gt; ydata_list = [[1, 2, 3, 4, 5], [3, 3, 3, 3, 3], [5, 4, np.nan, 2, 1], [4, 3, np.nan, 1, 0]]</span>
<span class="sd">        &gt;&gt;&gt; kwargs = {&#39;label_list&#39;: [&#39;spamΣ&#39;, &#39;eggs&#39;, &#39;jamµ&#39;, &#39;pram&#39;],  &#39;linestyle&#39;: &#39;-&#39;}</span>
<span class="sd">        &gt;&gt;&gt; #fig = multi_plot(xdata, ydata_list, title=&#39;$\phi_1(\\vec{x})$&#39;, xlabel=&#39;\nfds&#39;, **kwargs)</span>
<span class="sd">        &gt;&gt;&gt; fig = multi_plot(xdata, ydata_list, title=&#39;ΣΣΣµµµ&#39;, xlabel=&#39;\nfdsΣΣΣµµµ&#39;, **kwargs)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;fig = %s&#39; % (str(fig),))</span>
<span class="sd">        &gt;&gt;&gt; fig2 = multi_plot([1, 2, 3], [4, 5, 6], fnum=4)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;fig = %s&#39; % (str(fig),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; fig = multi_plot([1, 2, 3], [4, 5, 6])</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ydata_list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># Special case where ydata is a dictionary</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Special-er case where xdata is specified in ydata</span>
            <span class="n">xkey</span> <span class="o">=</span> <span class="n">xdata</span>
            <span class="n">ykeys</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">setdiff</span><span class="p">(</span><span class="n">ydata_list</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="n">xkey</span><span class="p">])</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">ydata_list</span><span class="p">[</span><span class="n">xkey</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ykeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ydata_list</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># Normalize input</span>
        <span class="n">ydata_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">ydata_list</span><span class="p">,</span> <span class="n">ykeys</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label_list&#39;</span><span class="p">,</span> <span class="n">ykeys</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_listlike</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
        <span class="n">flag</span> <span class="o">&amp;=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flag</span>

    <span class="k">def</span> <span class="nf">is_list_of_scalars</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_listlike</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_listlike</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">is_list_of_lists</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_listlike</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">is_listlike</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># allow ydata_list to be passed without a container</span>
    <span class="k">if</span> <span class="n">is_list_of_scalars</span><span class="p">(</span><span class="n">ydata_list</span><span class="p">):</span>
        <span class="n">ydata_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ydata_list</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">xdata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xdata</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ydata_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>

    <span class="n">num_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata_list</span><span class="p">)</span>

    <span class="c1"># Transform xdata into xdata_list</span>
    <span class="k">if</span> <span class="n">is_list_of_lists</span><span class="p">(</span><span class="n">xdata</span><span class="p">):</span>
        <span class="n">xdata_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">xd</span> <span class="ow">in</span> <span class="n">xdata</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xdata_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span> <span class="o">*</span> <span class="n">num_lines</span>

    <span class="n">fnum</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ensure_fnum</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fnum&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">pnum</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pnum&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kind&#39;</span><span class="p">,</span> <span class="s1">&#39;plot&#39;</span><span class="p">)</span>
    <span class="n">transpose</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;transpose&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parsekw_list</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">num_lines</span><span class="o">=</span><span class="n">num_lines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;copies relevant plot commands into plot_list_kw&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">val_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="o">*</span> <span class="n">num_lines</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_list&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">val_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_list&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># hack, multiple ways to do something</span>
            <span class="n">val_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val_list</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># val_list = [None] * num_lines</span>
        <span class="k">return</span> <span class="n">val_list</span>

    <span class="c1"># Parse out arguments to ax.plot</span>
    <span class="n">plot_kw_keys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;label&#39;</span><span class="p">,</span>
        <span class="s1">&#39;color&#39;</span><span class="p">,</span>
        <span class="s1">&#39;marker&#39;</span><span class="p">,</span>
        <span class="s1">&#39;markersize&#39;</span><span class="p">,</span>
        <span class="s1">&#39;markeredgewidth&#39;</span><span class="p">,</span>
        <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span>
        <span class="s1">&#39;linestyle&#39;</span><span class="p">,</span>
        <span class="s1">&#39;alpha&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="c1"># hackish / extra args that dont go to plot, but help</span>
    <span class="n">extra_plot_kw_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;spread_alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;autolabel&#39;</span><span class="p">,</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;fill&#39;</span><span class="p">]</span>
    <span class="n">plot_kw_keys</span> <span class="o">+=</span> <span class="n">extra_plot_kw_keys</span>
    <span class="n">plot_ks_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">parsekw_list</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">plot_kw_keys</span><span class="p">]</span>
    <span class="n">plot_list_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">plot_kw_keys</span><span class="p">,</span> <span class="n">plot_ks_vals</span><span class="p">)</span> <span class="k">if</span> <span class="n">vals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_list_kw</span><span class="p">:</span>
        <span class="n">plot_list_kw</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">distinct_colors</span><span class="p">(</span><span class="n">num_lines</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;marker&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_list_kw</span><span class="p">:</span>
            <span class="n">plot_list_kw</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">distinct_markers</span><span class="p">(</span><span class="n">num_lines</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;spread_alpha&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_list_kw</span><span class="p">:</span>
            <span class="n">plot_list_kw</span><span class="p">[</span><span class="s1">&#39;spread_alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_lines</span>

    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span>
        <span class="c1"># Remove non-bar kwargs</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">delete_keys</span><span class="p">(</span>
            <span class="n">plot_list_kw</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;markeredgewidth&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">stacked</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stacked&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">width_key</span> <span class="o">=</span> <span class="s1">&#39;height&#39;</span> <span class="k">if</span> <span class="n">transpose</span> <span class="k">else</span> <span class="s1">&#39;width&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;width_list&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">plot_list_kw</span><span class="p">[</span><span class="n">width_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;width_list&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
            <span class="c1"># if width is None:</span>
            <span class="c1">#     # HACK: need variable width</span>
            <span class="c1">#     # width = np.mean(np.diff(xdata_list[0]))</span>
            <span class="c1">#     width = .9</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">stacked</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">/=</span> <span class="n">num_lines</span>
            <span class="c1"># plot_list_kw[&#39;orientation&#39;] = [&#39;horizontal&#39;] * num_lines</span>
            <span class="n">plot_list_kw</span><span class="p">[</span><span class="n">width_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">width</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_lines</span>

    <span class="n">spread_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spread_list&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spread_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># nest into a list of dicts for each line in the multiplot</span>
    <span class="n">valid_keys</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">setdiff_ordered</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">plot_list_kw</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">extra_plot_kw_keys</span><span class="p">)</span>
    <span class="n">valid_vals</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_take</span><span class="p">(</span><span class="n">plot_list_kw</span><span class="p">,</span> <span class="n">valid_keys</span><span class="p">)</span>
    <span class="n">plot_kw_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">valid_keys</span><span class="p">,</span> <span class="n">vals</span><span class="p">))</span> <span class="k">for</span> <span class="n">vals</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">valid_vals</span><span class="p">)]</span>

    <span class="n">extra_kw_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">extra_plot_kw_keys</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">plot_list_kw</span><span class="p">]</span>
    <span class="n">extra_kw_vals</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_take</span><span class="p">(</span><span class="n">plot_list_kw</span><span class="p">,</span> <span class="n">extra_kw_keys</span><span class="p">)</span>
    <span class="n">extra_kw_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">extra_kw_keys</span><span class="p">,</span> <span class="n">vals</span><span class="p">))</span> <span class="k">for</span> <span class="n">vals</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">extra_kw_vals</span><span class="p">)]</span>

    <span class="c1"># Get passed in axes or setup a new figure</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span> <span class="n">docla</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

    <span class="c1"># +---------------</span>
    <span class="c1"># Draw plot lines</span>
    <span class="n">ydata_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ydata_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span>
            <span class="n">plot_func</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">barh</span>
        <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">plot_func</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">_y</span><span class="p">,</span> <span class="n">_x</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot_func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>  <span class="c1"># usually ax.plot</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;no ydata&#39;</span>
    <span class="c1"># assert len(extra_kw_list) == len(plot_kw_list), &#39;bad length&#39;</span>
    <span class="c1"># assert len(extra_kw_list) == len(ydata_list), &#39;bad length&#39;</span>
    <span class="n">_iter</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zip_longest</span><span class="p">(</span><span class="n">xdata_list</span><span class="p">,</span> <span class="n">ydata_list</span><span class="p">,</span> <span class="n">plot_kw_list</span><span class="p">,</span> <span class="n">extra_kw_list</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">_xdata</span><span class="p">,</span> <span class="n">_ydata</span><span class="p">,</span> <span class="n">plot_kw</span><span class="p">,</span> <span class="n">extra_kw</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_iter</span><span class="p">:</span>
        <span class="n">ymask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">_ydata</span><span class="p">)</span>
        <span class="n">ydata_</span> <span class="o">=</span> <span class="n">_ydata</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">ymask</span><span class="p">)</span>
        <span class="n">xdata_</span> <span class="o">=</span> <span class="n">_xdata</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">ymask</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stacked</span><span class="p">:</span>
                <span class="c1"># Plot bars on top of each other</span>
                <span class="n">xdata_</span> <span class="o">=</span> <span class="n">xdata_</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Plot bars side by side</span>
                <span class="n">baseoffset</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">num_lines</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">lineoffset</span> <span class="o">=</span> <span class="n">width</span> <span class="o">*</span> <span class="n">count</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">baseoffset</span> <span class="o">-</span> <span class="n">lineoffset</span>  <span class="c1"># Fixeme for more histogram bars</span>
                <span class="n">xdata_</span> <span class="o">=</span> <span class="n">xdata_</span> <span class="o">-</span> <span class="n">offset</span>
            <span class="c1"># width_key = &#39;height&#39; if transpose else &#39;width&#39;</span>
            <span class="c1"># plot_kw[width_key] = np.diff(xdata)</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="n">plot_func</span><span class="p">(</span><span class="n">xdata_</span><span class="p">,</span> <span class="n">ydata_</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kw</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">extra_kw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;edgecolor&#39;</span> <span class="ow">in</span> <span class="n">extra_kw</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
                    <span class="n">rect</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">extra_kw</span><span class="p">[</span><span class="s1">&#39;edgecolor&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">extra_kw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">extra_kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;autolabel&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="c1"># FIXME: probably a more cannonical way to include bar</span>
                <span class="c1"># autolabeling with tranpose support, but this is a hack that</span>
                <span class="c1"># works for now</span>
                <span class="k">for</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
                        <span class="n">numlbl</span> <span class="o">=</span> <span class="n">width</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span>
                        <span class="n">xpos</span> <span class="o">=</span> <span class="n">width</span> <span class="o">+</span> <span class="p">((</span><span class="n">_xdata</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">_xdata</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">)</span>
                        <span class="n">ypos</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span> <span class="o">+</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.0</span>
                        <span class="n">ha</span><span class="p">,</span> <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">numlbl</span> <span class="o">=</span> <span class="n">height</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
                        <span class="n">xpos</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.0</span>
                        <span class="n">ypos</span> <span class="o">=</span> <span class="mf">1.05</span> <span class="o">*</span> <span class="n">height</span>
                        <span class="n">ha</span><span class="p">,</span> <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="n">barlbl</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">numlbl</span><span class="p">,)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">barlbl</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">)</span>

        <span class="c1"># logger.info(&#39;extra_kw = %r&#39; % (extra_kw,))</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;plot&#39;</span> <span class="ow">and</span> <span class="n">extra_kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="n">_xdata</span><span class="p">,</span>
                <span class="n">ydata_</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">plot_kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="n">plot_kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">)</span>  <span class="c1"># , zorder=0)</span>

        <span class="k">if</span> <span class="n">spread_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Plots a spread around plot lines usually indicating standard</span>
            <span class="c1"># deviation</span>
            <span class="n">_xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_xdata</span><span class="p">)</span>
            <span class="n">spread</span> <span class="o">=</span> <span class="n">spread_list</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
            <span class="n">ydata_ave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ydata_</span><span class="p">)</span>
            <span class="n">y_data_dev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spread</span><span class="p">)</span>
            <span class="n">y_data_max</span> <span class="o">=</span> <span class="n">ydata_ave</span> <span class="o">+</span> <span class="n">y_data_dev</span>
            <span class="n">y_data_min</span> <span class="o">=</span> <span class="n">ydata_ave</span> <span class="o">-</span> <span class="n">y_data_dev</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">spread_alpha</span> <span class="o">=</span> <span class="n">extra_kw</span><span class="p">[</span><span class="s1">&#39;spread_alpha&#39;</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="n">_xdata</span><span class="p">,</span>
                <span class="n">y_data_min</span><span class="p">,</span>
                <span class="n">y_data_max</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">spread_alpha</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">plot_kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">)</span>  <span class="c1"># , zorder=0)</span>
    <span class="c1"># L________________</span>

    <span class="c1"># max_y = max(np.max(y_data), max_y)</span>
    <span class="c1"># min_y = np.min(y_data) if min_y is None else min(np.min(y_data), min_y)</span>

    <span class="n">ydata</span> <span class="o">=</span> <span class="n">_ydata</span>  <span class="c1"># HACK</span>
    <span class="n">xdata</span> <span class="o">=</span> <span class="n">_xdata</span>  <span class="c1"># HACK</span>
    <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
        <span class="c1"># xdata_list = ydata_list</span>
        <span class="n">ydata</span> <span class="o">=</span> <span class="n">xdata</span>

        <span class="c1"># Hack / Fix any transpose issues</span>
        <span class="k">def</span> <span class="nf">transpose_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="s1">&#39;y&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="s1">&#39;x&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;num_x&#39;</span><span class="p">):</span>
                <span class="c1"># hackier, fixme to use regex or something</span>
                <span class="k">return</span> <span class="s1">&#39;num_y&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
            <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;num_y&#39;</span><span class="p">):</span>
                <span class="c1"># hackier, fixme to use regex or something</span>
                <span class="k">return</span> <span class="s1">&#39;num_x&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">key</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">transpose_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Setup axes labeling</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">none_or_unicode</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_unicode</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">none_or_unicode</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">none_or_unicode</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">none_or_unicode</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1"># Initial integration with mpl rcParams standards</span>
    <span class="n">mplrc</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">mplrc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="c1"># &#39;legend.fontsize&#39;: custom_figure.LEGEND_SIZE,</span>
            <span class="c1"># &#39;axes.titlesize&#39;: custom_figure.TITLE_SIZE,</span>
            <span class="c1"># &#39;axes.labelsize&#39;: custom_figure.LABEL_SIZE,</span>
            <span class="c1"># &#39;legend.facecolor&#39;: &#39;w&#39;,</span>
            <span class="c1"># &#39;font.family&#39;: &#39;sans-serif&#39;,</span>
            <span class="c1"># &#39;xtick.labelsize&#39;: custom_figure.TICK_SIZE,</span>
            <span class="c1"># &#39;ytick.labelsize&#39;: custom_figure.TICK_SIZE,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">mplrc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rcParams&#39;</span><span class="p">,</span> <span class="p">{}))</span>

    <span class="n">titlesize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;titlesize&#39;</span><span class="p">,</span> <span class="n">mplrc</span><span class="p">[</span><span class="s1">&#39;axes.titlesize&#39;</span><span class="p">])</span>
    <span class="n">labelsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;labelsize&#39;</span><span class="p">,</span> <span class="n">mplrc</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">])</span>
    <span class="n">legendsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legendsize&#39;</span><span class="p">,</span> <span class="n">mplrc</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">])</span>
    <span class="n">xticksize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ticksize&#39;</span><span class="p">,</span> <span class="n">mplrc</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">])</span>
    <span class="n">yticksize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ticksize&#39;</span><span class="p">,</span> <span class="n">mplrc</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">])</span>
    <span class="n">family</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fontfamily&#39;</span><span class="p">,</span> <span class="n">mplrc</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">])</span>

    <span class="n">tickformat</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tickformat&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ytickformat</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ytickformat&#39;</span><span class="p">,</span> <span class="n">tickformat</span><span class="p">)</span>
    <span class="n">xtickformat</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xtickformat&#39;</span><span class="p">,</span> <span class="n">tickformat</span><span class="p">)</span>

    <span class="c1"># &#39;DejaVu Sans&#39;,&#39;Verdana&#39;, &#39;Arial&#39;</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fontweight&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>

    <span class="n">labelkw</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;fontproperties&#39;</span><span class="p">:</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span>
            <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">family</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">labelsize</span>
        <span class="p">)</span>
    <span class="p">}</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="o">**</span><span class="n">labelkw</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="o">**</span><span class="n">labelkw</span><span class="p">)</span>

    <span class="n">tick_fontprop</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">family</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tick_fontprop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ticklabel</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">ticklabel</span><span class="o">.</span><span class="n">set_fontproperties</span><span class="p">(</span><span class="n">tick_fontprop</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ticklabel</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="n">ticklabel</span><span class="o">.</span><span class="n">set_fontproperties</span><span class="p">(</span><span class="n">tick_fontprop</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xticksize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ticklabel</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">ticklabel</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">xticksize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yticksize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ticklabel</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="n">ticklabel</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">yticksize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xtickformat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># mpl.ticker.StrMethodFormatter  # newstyle</span>
        <span class="c1"># mpl.ticker.FormatStrFormatter  # oldstyle</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="n">xtickformat</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ytickformat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="n">ytickformat</span><span class="p">))</span>

    <span class="n">xtick_kw</span> <span class="o">=</span> <span class="n">ytick_kw</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tickwidth&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="s1">&#39;length&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ticklength&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">xtick_kw</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_filter_nones</span><span class="p">(</span><span class="n">xtick_kw</span><span class="p">)</span>
    <span class="n">ytick_kw</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_filter_nones</span><span class="p">(</span><span class="n">ytick_kw</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="o">**</span><span class="n">xtick_kw</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="o">**</span><span class="n">ytick_kw</span><span class="p">)</span>

    <span class="c1"># ax.yaxis.set_major_formatter(mtick.FormatStrFormatter(&#39;%d&#39;))</span>

    <span class="c1"># Setup axes limits</span>
    <span class="k">if</span> <span class="s1">&#39;xlim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;xmin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;xmax&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;use xmax, xmin instead of xlim&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;ylim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;ymin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;ymay&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ymin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ymay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;use ymay, ymin instead of ylim&#39;</span><span class="p">)</span>

    <span class="n">xmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xmin&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xmax&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ymin&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ymax&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">xmax</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">xd</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">xd</span> <span class="ow">in</span> <span class="n">xdata_list</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">xd</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">xd</span> <span class="ow">in</span> <span class="n">xdata_list</span><span class="p">])</span>

    <span class="c1"># Setup axes ticks</span>
    <span class="n">num_xticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;num_xticks&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">num_yticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;num_yticks&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">num_xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># TODO check if xdata is integral</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">is_int</span><span class="p">(</span><span class="n">xdata</span><span class="p">):</span>
            <span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">xmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">xmax</span><span class="p">),</span> <span class="n">num_xticks</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">int32</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">((</span><span class="n">xmin</span><span class="p">),</span> <span class="p">(</span><span class="n">xmax</span><span class="p">),</span> <span class="n">num_xticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">is_int</span><span class="p">(</span><span class="n">ydata</span><span class="p">):</span>
            <span class="n">yticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ymin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ymax</span><span class="p">),</span> <span class="n">num_yticks</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">int32</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">((</span><span class="n">ymin</span><span class="p">),</span> <span class="p">(</span><span class="n">ymax</span><span class="p">),</span> <span class="n">num_yticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>

    <span class="n">force_xticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;force_xticks&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">force_xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="n">force_xticks</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>

    <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;yticklabels&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Hack ONLY WORKS WHEN TRANSPOSE = True</span>
        <span class="c1"># Overrides num_yticks</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">yticklabels</span><span class="p">)</span>

    <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xticklabels&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Overrides num_xticks</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xticklabels</span><span class="p">)</span>

    <span class="n">xtick_rotation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xtick_rotation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xtick_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="p">[</span><span class="n">lbl</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">xtick_rotation</span><span class="p">)</span> <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()]</span>
    <span class="n">ytick_rotation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ytick_rotation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ytick_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="p">[</span><span class="n">lbl</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="n">ytick_rotation</span><span class="p">)</span> <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()]</span>

    <span class="c1"># Axis padding</span>
    <span class="n">xpad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xpad&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ypad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ypad&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xpad_factor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xpad_factor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ypad_factor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ypad_factor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xpad</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xpad_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xpad</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">*</span> <span class="n">xpad_factor</span>
    <span class="k">if</span> <span class="n">ypad</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ypad_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ypad</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">*</span> <span class="n">ypad_factor</span>
    <span class="n">xpad</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">xpad</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">xpad</span>
    <span class="n">ypad</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">ypad</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ypad</span>
    <span class="n">ypad_high</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ypad_high&#39;</span><span class="p">,</span> <span class="n">ypad</span><span class="p">)</span>
    <span class="n">ypad_low</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ypad_low&#39;</span><span class="p">,</span> <span class="n">ypad</span><span class="p">)</span>
    <span class="n">xpad_high</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xpad_high&#39;</span><span class="p">,</span> <span class="n">xpad</span><span class="p">)</span>
    <span class="n">xpad_low</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xpad_low&#39;</span><span class="p">,</span> <span class="n">xpad</span><span class="p">)</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">-</span> <span class="n">xpad_low</span><span class="p">),</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">+</span> <span class="n">xpad_high</span><span class="p">)</span>
    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymin</span> <span class="o">-</span> <span class="n">ypad_low</span><span class="p">),</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">+</span> <span class="n">ypad_high</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

    <span class="n">xscale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">yscale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;yscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">yscale</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>

    <span class="n">gridlinestyle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gridlinestyle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">gridlinewidth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gridlinewidth&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">gridlines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xgridlines</span><span class="p">()</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ygridlines</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">gridlinestyle</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">gridlines</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="n">gridlinestyle</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gridlinewidth</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">gridlines</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">gridlinewidth</span><span class="p">)</span>

    <span class="c1"># Setup title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">titlekw</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;fontproperties&#39;</span><span class="p">:</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="n">family</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">titlesize</span>
            <span class="p">)</span>
        <span class="p">}</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">titlekw</span><span class="p">)</span>

    <span class="n">use_legend</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_legend&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span> <span class="ow">in</span> <span class="n">valid_keys</span><span class="p">)</span>
    <span class="n">legend_loc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">legend_alpha</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_alpha&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_legend</span><span class="p">:</span>
        <span class="n">legendkw</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">legend_alpha</span><span class="p">,</span>
            <span class="s1">&#39;fontproperties&#39;</span><span class="p">:</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="n">family</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">legendsize</span>
            <span class="p">),</span>
        <span class="p">}</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">legendkw</span><span class="p">)</span>

    <span class="n">figtitle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figtitle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">figtitle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">set_figtitle</span><span class="p">(</span>
            <span class="n">figtitle</span><span class="p">,</span>
            <span class="n">fontfamily</span><span class="o">=</span><span class="n">family</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figtitlesize&#39;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_darkbackground&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">lightbg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lightbg&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lightbg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lightbg</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">is_default_dark_bg</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">lightbg</span>
        <span class="c1"># use_darkbackground = is_default_dark_bg()</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span><span class="p">:</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">dark_background</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="n">use_darkbackground</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span>
    <span class="c1"># TODO: return better info</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="demo_fonts"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.demo_fonts">[docs]</a><span class="k">def</span> <span class="nf">demo_fonts</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots demo_fonts --show</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/8753835/list-of-fonts-avail-mpl</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; demo_fonts()</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.present()</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">matplotlib.font_manager</span>

    <span class="n">avail_fonts</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">findSystemFonts</span><span class="p">(</span><span class="n">fontpaths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontext</span><span class="o">=</span><span class="s1">&#39;ttf&#39;</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">avail_fonts</span>
    <span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;avail_fonts = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">))))</span>

    <span class="n">xdata</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">ydata_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;label_list&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;spamΣ&#39;</span><span class="p">,</span> <span class="s1">&#39;eggs&#39;</span><span class="p">,</span> <span class="s1">&#39;jamµ&#39;</span><span class="p">,</span> <span class="s1">&#39;pram&#39;</span><span class="p">],</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">}</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;DejaVu Sans&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Bitstream Vera Sans&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Lucida Grande&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Verdana&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Geneva&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Lucid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Arial&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Helvetica&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Avant Garde&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DejaVu Sans&#39;</span><span class="p">,</span> <span class="s1">&#39;Verdana&#39;</span><span class="p">,</span> <span class="s1">&#39;Arial&#39;</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DejaVu Sans&#39;</span><span class="p">,</span> <span class="s1">&#39;CMU Serif&#39;</span><span class="p">,</span> <span class="s1">&#39;FreeMono&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">family</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="n">multi_plot</span><span class="p">(</span>
            <span class="n">xdata</span><span class="p">,</span>
            <span class="n">ydata_list</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">family</span> <span class="o">+</span> <span class="s1">&#39; ΣΣΣµµµ&#39;</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">fdsΣΣΣµµµ&#39;</span><span class="p">,</span>
            <span class="n">fontfamily</span><span class="o">=</span><span class="n">family</span><span class="p">,</span>
            <span class="n">fnum</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="plot_multiple_scores"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.plot_multiple_scores">[docs]</a><span class="k">def</span> <span class="nf">plot_multiple_scores</span><span class="p">(</span>
    <span class="n">known_nd_data</span><span class="p">,</span>
    <span class="n">known_target_points</span><span class="p">,</span>
    <span class="n">nd_labels</span><span class="p">,</span>
    <span class="n">target_label</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">use_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">marker_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">report_max</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots nd-data in 2d using multiple contour lines</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --test-plot_multiple_scores --show</span>

<span class="sd">        python -m wbia.plottool.plots --exec-plot_rank_cumhist \</span>
<span class="sd">            --adjust=.15 --dpi=512 --figsize=11,4 --clipwhite \</span>
<span class="sd">            --dpath ~/latex/crall-candidacy-2015/ --save &quot;figures/tmp.jpg&quot;  --diskshow \</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; known_nd_data = np.array([[  1,   2,   4,   7,   1,   2,   4,   7,   1,   2,   4,   7,   1,</span>
<span class="sd">        ...                              2,   4,   7,   1,   2,   4,   7],</span>
<span class="sd">        ...                           [ 50,  50,  50,  50, 100, 100, 100, 100, 200, 200, 200, 200, 300,</span>
<span class="sd">        ...                            300, 300, 300, 500, 500, 500, 500]], dtype=np.int64).T</span>
<span class="sd">        &gt;&gt;&gt; known_target_points = np.array([35, 32, 32, 30, 33, 32, 33, 30, 32, 31, 31, 32, 36, 33, 33, 32, 33,</span>
<span class="sd">        ...                                 33, 32, 31], dtype=np.int64)</span>
<span class="sd">        &gt;&gt;&gt; label_list = [&#39;custom&#39;, &#39;custom:sv_on=False&#39;]</span>
<span class="sd">        &gt;&gt;&gt; nd_labels = [u&#39;K&#39;, u&#39;dsize&#39;]</span>
<span class="sd">        &gt;&gt;&gt; target_label = &#39;score&#39;</span>
<span class="sd">        &gt;&gt;&gt; fnum = None</span>
<span class="sd">        &gt;&gt;&gt; pnum = None</span>
<span class="sd">        &gt;&gt;&gt; use_legend = True</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;test&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = plot_multiple_scores(known_nd_data, known_target_points, nd_labels, target_label, title=title)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">known_nd_data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;cannot do more than 2 right now&#39;</span>

    <span class="c1"># Put the data into a dense field grid</span>
    <span class="n">nd_basis</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">known_nd_data</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
    <span class="n">inverse_basis</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))))</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">nd_basis</span><span class="p">]</span>
    <span class="n">data_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">maplen</span><span class="p">(</span><span class="n">nd_basis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="c1"># Fill in field values</span>
    <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">known_nd_data</span><span class="p">,</span> <span class="n">known_target_points</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">invbase</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="k">for</span> <span class="n">invbase</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inverse_basis</span><span class="p">,</span> <span class="n">coord</span><span class="p">)]</span>
        <span class="n">data_field</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>

    <span class="n">xdata</span> <span class="o">=</span> <span class="n">nd_basis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ydata_list</span> <span class="o">=</span> <span class="n">data_field</span><span class="o">.</span><span class="n">T</span>

    <span class="k">if</span> <span class="n">report_max</span><span class="p">:</span>
        <span class="c1"># TODO: multiple max poses</span>
        <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>

        <span class="n">maxpos_list</span> <span class="o">=</span> <span class="n">ydata_list</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">max_nd0_list</span> <span class="o">=</span> <span class="n">nd_basis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">maxpos_list</span><span class="p">)</span>
        <span class="n">max_score_list</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">ziptake</span><span class="p">(</span><span class="n">ydata_list</span><span class="p">,</span> <span class="n">maxpos_list</span><span class="p">)</span>
        <span class="n">hasmultiple_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">ydata_list</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">max_score_list</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="n">multiple_max_markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span> <span class="k">if</span> <span class="n">flag</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">hasmultiple_max</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">nd_labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;</span><span class="si">%.2f%%</span><span class="s1"> </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">max_score</span><span class="p">,</span> <span class="n">nd_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">max_nd0</span><span class="p">,</span> <span class="n">marker</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">max_nd0</span><span class="p">,</span> <span class="n">max_score</span><span class="p">,</span> <span class="n">marker</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="n">max_nd0_list</span><span class="p">,</span> <span class="n">max_score_list</span><span class="p">,</span> <span class="n">multiple_max_markers</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;</span><span class="si">%.2f%%</span><span class="s1"> </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">max_score</span><span class="p">,</span> <span class="n">nd_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">max_nd0</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">nd_labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">max_nd0</span><span class="p">,</span> <span class="n">max_score</span><span class="p">,</span> <span class="n">marker</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="n">nd_basis</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">max_nd0_list</span><span class="p">,</span> <span class="n">max_score_list</span><span class="p">,</span> <span class="n">multiple_max_markers</span>
                <span class="p">)</span>
            <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nd_labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">nd_basis</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">multi_plot</span><span class="p">(</span>
        <span class="n">xdata</span><span class="p">,</span>
        <span class="n">ydata_list</span><span class="p">,</span>
        <span class="n">label_list</span><span class="o">=</span><span class="n">label_list</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">marker_list</span><span class="o">=</span><span class="n">marker_list</span><span class="p">,</span>
        <span class="n">color_list</span><span class="o">=</span><span class="n">color_list</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="n">nd_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="n">target_label</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_rank_cumhist"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.plot_rank_cumhist">[docs]</a><span class="k">def</span> <span class="nf">plot_rank_cumhist</span><span class="p">(</span>
    <span class="n">cdf_list</span><span class="p">,</span>
    <span class="n">label_list</span><span class="p">,</span>
    <span class="n">color_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">marker_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;cumfreq&#39;</span><span class="p">,</span>
    <span class="n">use_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">num_xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots CMC curves</span>
<span class="sd">    TODO rename to plot_cmc</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --test-plot_rank_cumhist --show</span>

<span class="sd">        python -m wbia.plottool.plots --exec-plot_rank_cumhist \</span>
<span class="sd">            --adjust=.15 --dpi=512 --figsize=11,4 --clipwhite \</span>
<span class="sd">            --dpath ~/latex/crall-candidacy-2015/ --save &quot;figures/tmp.jpg&quot;  --diskshow \</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; cdf_list = np.array(</span>
<span class="sd">        &gt;&gt;&gt;     [[ 88,  92,  93,  96,  96,  96,  96,  98,  99,  99, 100, 100, 100],</span>
<span class="sd">        &gt;&gt;&gt;      [ 79,  82,  82,  85,  86,  87,  87,  87,  88,  89,  90,  90,  90]])</span>
<span class="sd">        &gt;&gt;&gt; edges = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13]</span>
<span class="sd">        &gt;&gt;&gt; label_list = [&#39;custom&#39;, &#39;custom:sv_on=False&#39;]</span>
<span class="sd">        &gt;&gt;&gt; fnum = None</span>
<span class="sd">        &gt;&gt;&gt; pnum = None</span>
<span class="sd">        &gt;&gt;&gt; plot_rank_cumhist(cdf_list, label_list, edges=edges, fnum=fnum, pnum=pnum)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove values of None (those are defaults)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="n">num_cdfs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cdf_list</span><span class="p">)</span>
    <span class="n">num_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cdf_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">color_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">color_list</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">distinct_colors</span><span class="p">(</span><span class="n">num_cdfs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="c1"># max_y = 0</span>
    <span class="c1"># min_y = None</span>
    <span class="k">if</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">marker_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># marker_list = [&#39;o&#39;] * num_cdfs</span>
        <span class="n">marker_list</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">distinct_markers</span><span class="p">(</span><span class="n">num_cdfs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">256</span><span class="p">:</span>
        <span class="n">marker_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_cdfs</span>
    <span class="k">if</span> <span class="s1">&#39;markersize&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">markersize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;markersize&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">markersize</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">markersize</span> <span class="o">=</span> <span class="mi">7</span>

    <span class="n">multi_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
        <span class="n">num_xticks</span><span class="o">=</span><span class="n">num_xticks</span><span class="p">,</span>
        <span class="n">use_legend</span><span class="o">=</span><span class="n">use_legend</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">multi_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">multi_plot</span><span class="p">(</span>
        <span class="n">x_data</span><span class="p">,</span>
        <span class="n">cdf_list</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
        <span class="n">label_list</span><span class="o">=</span><span class="n">label_list</span><span class="p">,</span>
        <span class="n">color_list</span><span class="o">=</span><span class="n">color_list</span><span class="p">,</span>
        <span class="n">marker_list</span><span class="o">=</span><span class="n">marker_list</span><span class="p">,</span>
        <span class="o">**</span><span class="n">multi_kw</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="draw_hist_subbin_maxima"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.draw_hist_subbin_maxima">[docs]</a><span class="k">def</span> <span class="nf">draw_hist_subbin_maxima</span><span class="p">(</span>
    <span class="n">hist</span><span class="p">,</span>
    <span class="n">centers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">bin_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">maxima_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">remove_endpoints</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        hist (ndarray):</span>
<span class="sd">        centers (None):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --test-draw_hist_subbin_maxima --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; hist = np.array([    6.73, 8.69, 0.00, 0.00, 34.62, 29.16, 0.00, 0.00, 6.73, 8.69])</span>
<span class="sd">        &gt;&gt;&gt; centers = np.array([-0.39, 0.39, 1.18, 1.96,  2.75,  3.53, 4.32, 5.11, 5.89, 6.68])</span>
<span class="sd">        &gt;&gt;&gt; bin_colors = pt.df2.plt.get_cmap(&#39;hsv&#39;)(centers / vt.TAU)</span>
<span class="sd">        &gt;&gt;&gt; use_darkbackground = True</span>
<span class="sd">        &gt;&gt;&gt; maxima_thresh = .8</span>
<span class="sd">        &gt;&gt;&gt; result = draw_hist_subbin_maxima(hist, centers, bin_colors,</span>
<span class="sd">        &gt;&gt;&gt;                                  maxima_thresh,</span>
<span class="sd">        &gt;&gt;&gt;                                  use_darkbackground=use_darkbackground)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find maxima</span>
    <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>

    <span class="n">maxima_x</span><span class="p">,</span> <span class="n">maxima_y</span><span class="p">,</span> <span class="n">argmaxima</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">hist_argmaxima</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">centers</span><span class="p">,</span> <span class="n">maxima_thresh</span><span class="p">)</span>
    <span class="n">argmaxima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">argmaxima</span><span class="p">))</span>
    <span class="n">maxima_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">maxima_y</span><span class="p">))</span>
    <span class="n">maxima_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">maxima_x</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">remove_endpoints</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argmaxima</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">argmaxima</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">argmaxima</span> <span class="o">=</span> <span class="n">argmaxima</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">maxima_x</span> <span class="o">=</span> <span class="n">maxima_x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">maxima_y</span> <span class="o">=</span> <span class="n">maxima_y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argmaxima</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">argmaxima</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">maxima_x</span> <span class="o">=</span> <span class="n">maxima_x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">maxima_y</span> <span class="o">=</span> <span class="n">maxima_y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">argmaxima</span> <span class="o">=</span> <span class="n">argmaxima</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="c1"># Expand parabola points around submaxima</span>
    <span class="n">x123</span><span class="p">,</span> <span class="n">y123</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">maxima_neighbors</span><span class="p">(</span><span class="n">argmaxima</span><span class="p">,</span> <span class="n">hist</span><span class="p">,</span> <span class="n">centers</span><span class="p">)</span>
    <span class="c1"># Find submaxima</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argmaxima</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">submaxima_x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">submaxima_y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">xpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ypoints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">submaxima_x</span><span class="p">,</span> <span class="n">submaxima_y</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">interpolate_submaxima</span><span class="p">(</span><span class="n">argmaxima</span><span class="p">,</span> <span class="n">hist</span><span class="p">,</span> <span class="n">centers</span><span class="p">)</span>
        <span class="c1"># Extract parabola points</span>
        <span class="n">coeff_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xtup</span><span class="p">,</span> <span class="n">ytup</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">xtup</span><span class="p">,</span> <span class="n">ytup</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x123</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">y123</span><span class="o">.</span><span class="n">T</span><span class="p">)]</span>
        <span class="n">xpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x123</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
        <span class="n">ypoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">x_pts</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_pts</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xpoints</span><span class="p">,</span> <span class="n">coeff_list</span><span class="p">)]</span>

    <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_darkbackground&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">linecolor</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span> <span class="k">if</span> <span class="n">use_darkbackground</span> <span class="k">else</span> <span class="s1">&#39;k&#39;</span>

    <span class="c1"># Draw threshold lines</span>
    <span class="k">if</span> <span class="n">maxima_thresh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">maxima_thresh_val</span> <span class="o">=</span> <span class="n">maxima_y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="n">maxima_thresh</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">centers</span><span class="p">,</span> <span class="p">[</span><span class="n">maxima_thresh_val</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">),</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>
    <span class="c1"># Draw linear interpolation lines</span>
    <span class="k">if</span> <span class="n">bin_colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bin_colors</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">centers</span><span class="p">,</span> <span class="n">hist</span><span class="p">,</span> <span class="n">linecolor</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># TODO use bin_color correctly</span>
        <span class="c1"># Create a colormap using exact specified colors</span>
        <span class="c1"># bin_cmap = mpl.colors.ListedColormap(bin_colors)</span>
        <span class="n">bin_cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;hsv&#39;</span><span class="p">)</span>  <span class="c1"># HACK</span>
        <span class="c1"># mpl.colors.ListedColormap(bin_colors)</span>
        <span class="n">colorline</span><span class="p">(</span><span class="n">centers</span><span class="p">,</span> <span class="n">hist</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">bin_cmap</span><span class="p">)</span>
    <span class="c1"># Draw Submax Parabola</span>
    <span class="k">for</span> <span class="n">x_pts</span><span class="p">,</span> <span class="n">y_pts</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xpoints</span><span class="p">,</span> <span class="n">ypoints</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pts</span><span class="p">,</span> <span class="n">y_pts</span><span class="p">,</span> <span class="s1">&#39;y--&#39;</span><span class="p">)</span>
    <span class="c1"># Draw maxbin</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">maxima_x</span><span class="p">,</span> <span class="n">maxima_y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="c1"># Draw submaxbin</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">submaxima_x</span><span class="p">,</span> <span class="n">submaxima_y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="c1"># Draw Bins</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">centers</span><span class="p">,</span> <span class="n">hist</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">bin_colors</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">use_darkbackground</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="n">is_default_dark_bg</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span><span class="p">:</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">dark_background</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;submaxima_x = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">submaxima_x</span><span class="p">,))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;submaxima_y = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">submaxima_y</span><span class="p">,))</span></div>
    <span class="c1"># return (submaxima_x, submaxima_y)</span>


<div class="viewcode-block" id="draw_subextrema"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.draw_subextrema">[docs]</a><span class="k">def</span> <span class="nf">draw_subextrema</span><span class="p">(</span>
    <span class="n">ydata</span><span class="p">,</span>
    <span class="n">xdata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">op</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span>
    <span class="n">bin_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">thresh_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">normalize_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        ydata (ndarray):</span>
<span class="sd">        xdata (None):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --test-draw_subextrema --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import vtool as vt</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; ydata = np.array([    6.73, 8.69, 0.00, 0.00, 34.62, 29.16, 0.01, 0.00, 6.73, 8.69])</span>
<span class="sd">        &gt;&gt;&gt; xdata = np.array([-0.39, 0.39, 1.18, 1.96,  2.75,  3.53, 4.32, 5.11, 5.89, 6.68])</span>
<span class="sd">        &gt;&gt;&gt; bin_colors = pt.df2.plt.get_cmap(&#39;hsv&#39;)(xdata / vt.TAU)</span>
<span class="sd">        &gt;&gt;&gt; use_darkbackground = True</span>
<span class="sd">        &gt;&gt;&gt; thresh_factor = .01</span>
<span class="sd">        &gt;&gt;&gt; op = &#39;max&#39;</span>
<span class="sd">        &gt;&gt;&gt; ut.exec_funckw(draw_subextrema, globals())</span>
<span class="sd">        &gt;&gt;&gt; result = draw_subextrema(ydata, xdata, bin_colors=bin_colors,</span>
<span class="sd">        &gt;&gt;&gt;                          thresh_factor=thresh_factor, op=op)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find maxima</span>
    <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>

    <span class="c1"># Hack into the source code</span>
    <span class="n">locals_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">exec_func_src2</span><span class="p">(</span><span class="n">vt</span><span class="o">.</span><span class="n">argsubextrema2</span><span class="p">)</span>

    <span class="n">x123</span> <span class="o">=</span> <span class="n">locals_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x123&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">coeff_list</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s1">&#39;coeff_list&#39;</span><span class="p">]</span>
    <span class="n">rel_subextrema_x</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s1">&#39;rel_subextrema_x&#39;</span><span class="p">]</span>
    <span class="n">rel_subextrema_y</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s1">&#39;rel_subextrema_y&#39;</span><span class="p">]</span>
    <span class="n">rel_argextrema</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s1">&#39;rel_argextrema&#39;</span><span class="p">]</span>
    <span class="n">other_subextrema_y</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s1">&#39;other_subextrema_y&#39;</span><span class="p">]</span>
    <span class="n">other_subextrema_x</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s1">&#39;other_subextrema_x&#39;</span><span class="p">]</span>
    <span class="n">thresh_value</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s1">&#39;thresh_value&#39;</span><span class="p">]</span>

    <span class="c1"># Find the original max bins of the rel_extrema</span>
    <span class="k">if</span> <span class="n">xdata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xdata_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">))</span>
        <span class="n">rel_extrema_x</span> <span class="o">=</span> <span class="n">rel_argextrema</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xdata_</span> <span class="o">=</span> <span class="n">xdata</span>
        <span class="n">rel_extrema_x</span> <span class="o">=</span> <span class="n">xdata_</span><span class="p">[</span><span class="n">rel_argextrema</span><span class="p">]</span>
    <span class="n">rel_extrema_y</span> <span class="o">=</span> <span class="n">ydata</span><span class="p">[</span><span class="n">rel_argextrema</span><span class="p">]</span>

    <span class="c1"># Find submaxima</span>
    <span class="k">if</span> <span class="n">x123</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ypoints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Extract parabola points</span>
        <span class="n">xpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x123</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
        <span class="n">ypoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">x_pts</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_pts</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xpoints</span><span class="p">,</span> <span class="n">coeff_list</span><span class="p">)]</span>

    <span class="c1"># Draw threshold lines</span>
    <span class="k">if</span> <span class="n">thresh_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata_</span><span class="p">,</span> <span class="p">[</span><span class="n">thresh_value</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata_</span><span class="p">),</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>
    <span class="c1"># Draw linear interpolation lines</span>
    <span class="k">if</span> <span class="n">bin_colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bin_colors</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata_</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># TODO use bin_color correctly</span>
        <span class="c1"># Create a colormap using exact specified colors</span>
        <span class="c1"># bin_cmap = mpl.colors.ListedColormap(bin_colors)</span>
        <span class="n">bin_cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;hsv&#39;</span><span class="p">)</span>  <span class="c1"># HACK</span>
        <span class="c1"># mpl.colors.ListedColormap(bin_colors)</span>
        <span class="n">colorline</span><span class="p">(</span><span class="n">xdata_</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">bin_cmap</span><span class="p">)</span>
    <span class="c1"># Draw Submax Parabola</span>
    <span class="k">for</span> <span class="n">x_pts</span><span class="p">,</span> <span class="n">y_pts</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xpoints</span><span class="p">,</span> <span class="n">ypoints</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pts</span><span class="p">,</span> <span class="n">y_pts</span><span class="p">,</span> <span class="s1">&#39;y--&#39;</span><span class="p">)</span>

    <span class="c1"># Draw flat extrema</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">other_subextrema_x</span><span class="p">,</span> <span class="n">other_subextrema_y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="c1"># Draw maxbin relative extrema</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rel_extrema_x</span><span class="p">,</span> <span class="n">rel_extrema_y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="c1"># Draw relative sub-extrema</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rel_subextrema_x</span><span class="p">,</span> <span class="n">rel_subextrema_y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="c1"># Draw Bins</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata_</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">bin_colors</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span></div>


<div class="viewcode-block" id="zoom_effect01"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.zoom_effect01">[docs]</a><span class="k">def</span> <span class="nf">zoom_effect01</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    connect ax1 &amp; ax2. The x-range of (xmin, xmax) in both axes will</span>
<span class="sd">    be marked.  The keywords parameters will be used ti create</span>
<span class="sd">    patches.</span>

<span class="sd">    Args:</span>
<span class="sd">        ax1 (mpl.axes): the main axes</span>
<span class="sd">        ax2 (mpl.axes): the zoomed axes</span>
<span class="sd">        (xmin,xmax) : the limits of the colored area in both plot axes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (c1, c2, bbox_patch1, bbox_patch2, p)</span>

<span class="sd">    References:</span>
<span class="sd">        matplotlib.org/users/annotations_guide.html</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots zoom_effect01 --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; cdf_list = np.array(</span>
<span class="sd">        &gt;&gt;&gt;     [[10, 15, 40, 42, 50, 88,  92,  93,  96,  96,  96,  96,  98,  99,  99, 100, 100, 100],</span>
<span class="sd">        &gt;&gt;&gt;      [20, 30, 31, 66, 75, 79,  82,  82,  85,  86,  87,  87,  87,  88,  89,  90,  90,  90]])</span>
<span class="sd">        &gt;&gt;&gt; edges = list(range(0, len(cdf_list[0]) + 1))</span>
<span class="sd">        &gt;&gt;&gt; label_list = [&#39;custom&#39;, &#39;custom:sv_on=False&#39;]</span>
<span class="sd">        &gt;&gt;&gt; fnum = 1</span>
<span class="sd">        &gt;&gt;&gt; numranks = len(cdf_list[0])</span>
<span class="sd">        &gt;&gt;&gt; top = 3</span>
<span class="sd">        &gt;&gt;&gt; plot_rank_cumhist(cdf_list, label_list, edges=edges, xmin=.9, num_xticks=numranks, fnum=fnum, pnum=(2, 1, 1), kind=&#39;plot&#39;, ymin=0, ymax=100)</span>
<span class="sd">        &gt;&gt;&gt; ax1 = pt.gca()</span>
<span class="sd">        &gt;&gt;&gt; plot_rank_cumhist(cdf_list.T[0:top].T, label_list, edges=edges[0:top + 1], xmin=.9, num_xticks=top, fnum=fnum, pnum=(2, 1, 2), kind=&#39;plot&#39;, ymin=0, ymax=100)</span>
<span class="sd">        &gt;&gt;&gt; ax2 = pt.gca()</span>
<span class="sd">        &gt;&gt;&gt; xmin = 1</span>
<span class="sd">        &gt;&gt;&gt; xmax = top</span>
<span class="sd">        &gt;&gt;&gt; (c1, c2, bbox_patch1, bbox_patch2, p) = zoom_effect01(ax1, ax2, xmin, xmax)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;(c1, c2, bbox_patch1, bbox_patch2, p) = %s&#39; % (ut.repr2((c1, c2, bbox_patch1, bbox_patch2, p)),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="kn">import</span> <span class="n">Bbox</span><span class="p">,</span> <span class="n">TransformedBbox</span><span class="p">,</span> <span class="n">blended_transform_factory</span>

    <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">BboxPatch</span><span class="p">,</span>
        <span class="n">BboxConnector</span><span class="p">,</span>
        <span class="n">BboxConnectorPatch</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect_bbox</span><span class="p">(</span>
        <span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">,</span> <span class="n">loc1a</span><span class="p">,</span> <span class="n">loc2a</span><span class="p">,</span> <span class="n">loc1b</span><span class="p">,</span> <span class="n">loc2b</span><span class="p">,</span> <span class="n">prop_lines</span><span class="p">,</span> <span class="n">prop_patches</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">prop_patches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prop_patches</span> <span class="o">=</span> <span class="n">prop_lines</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">prop_patches</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop_patches</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>  <span class="c1"># * 0.05</span>
        <span class="n">prop_patches</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>

        <span class="n">c1</span> <span class="o">=</span> <span class="n">BboxConnector</span><span class="p">(</span><span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="n">loc1a</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="n">loc2a</span><span class="p">,</span> <span class="o">**</span><span class="n">prop_lines</span><span class="p">)</span>
        <span class="n">c1</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">BboxConnector</span><span class="p">(</span><span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="n">loc1b</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="n">loc2b</span><span class="p">,</span> <span class="o">**</span><span class="n">prop_lines</span><span class="p">)</span>
        <span class="n">c2</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">bbox_patch1</span> <span class="o">=</span> <span class="n">BboxPatch</span><span class="p">(</span><span class="n">bbox1</span><span class="p">,</span> <span class="o">**</span><span class="n">prop_patches</span><span class="p">)</span>
        <span class="n">bbox_patch2</span> <span class="o">=</span> <span class="n">BboxPatch</span><span class="p">(</span><span class="n">bbox2</span><span class="p">,</span> <span class="o">**</span><span class="n">prop_patches</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">BboxConnectorPatch</span><span class="p">(</span>
            <span class="n">bbox1</span><span class="p">,</span>
            <span class="n">bbox2</span><span class="p">,</span>
            <span class="c1"># loc1a=3, loc2a=2, loc1b=4, loc2b=1,</span>
            <span class="n">loc1a</span><span class="o">=</span><span class="n">loc1a</span><span class="p">,</span>
            <span class="n">loc2a</span><span class="o">=</span><span class="n">loc2a</span><span class="p">,</span>
            <span class="n">loc1b</span><span class="o">=</span><span class="n">loc1b</span><span class="p">,</span>
            <span class="n">loc2b</span><span class="o">=</span><span class="n">loc2b</span><span class="p">,</span>
            <span class="o">**</span><span class="n">prop_patches</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">bbox_patch1</span><span class="p">,</span> <span class="n">bbox_patch2</span><span class="p">,</span> <span class="n">p</span>

    <span class="n">trans1</span> <span class="o">=</span> <span class="n">blended_transform_factory</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">trans2</span> <span class="o">=</span> <span class="n">blended_transform_factory</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

    <span class="n">bbox</span> <span class="o">=</span> <span class="n">Bbox</span><span class="o">.</span><span class="n">from_extents</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">mybbox1</span> <span class="o">=</span> <span class="n">TransformedBbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">trans1</span><span class="p">)</span>
    <span class="n">mybbox2</span> <span class="o">=</span> <span class="n">TransformedBbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">trans2</span><span class="p">)</span>

    <span class="n">prop_patches</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">prop_patches</span><span class="p">[</span><span class="s1">&#39;ec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
    <span class="n">prop_patches</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span>

    <span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">bbox_patch1</span><span class="p">,</span> <span class="n">bbox_patch2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">=</span> <span class="n">connect_bbox</span><span class="p">(</span>
        <span class="n">mybbox1</span><span class="p">,</span>
        <span class="n">mybbox2</span><span class="p">,</span>
        <span class="n">loc1a</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">loc2a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">loc1b</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">loc2b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">prop_lines</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="n">prop_patches</span><span class="o">=</span><span class="n">prop_patches</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">bbox_patch1</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">bbox_patch2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">bbox_patch1</span><span class="p">,</span> <span class="n">bbox_patch2</span><span class="p">,</span> <span class="n">p</span></div>


<span class="c1"># Interface to LineCollection:</span>


<div class="viewcode-block" id="colorline"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.colorline">[docs]</a><span class="k">def</span> <span class="nf">colorline</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;hsv&#39;</span><span class="p">),</span>
    <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a colored line with coordinates x and y</span>
<span class="sd">    Optionally specify colors in the array z</span>
<span class="sd">    Optionally specify a colormap, a norm function and a line width</span>

<span class="sd">    References:</span>
<span class="sd">        nbviewer.ipython.org/github/dpsanders/matplotlib-examples/blob/master/colorline.ipynb</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --test-colorline --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; x = np.array([1, 3, 3, 2, 5]) / 5.0</span>
<span class="sd">        &gt;&gt;&gt; y = np.array([1, 2, 1, 3, 5]) / 5.0</span>
<span class="sd">        &gt;&gt;&gt; z = None</span>
<span class="sd">        &gt;&gt;&gt; cmap = df2.plt.get_cmap(&#39;hsv&#39;)</span>
<span class="sd">        &gt;&gt;&gt; norm = plt.Normalize(0.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; linewidth = 1</span>
<span class="sd">        &gt;&gt;&gt; alpha = 1.0</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; pt.figure()</span>
<span class="sd">        &gt;&gt;&gt; result = colorline(x, y, z, cmap)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; pt.dark_background()</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">LineCollection</span>

    <span class="k">def</span> <span class="nf">make_segments</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create list of line segments from x and y coordinates, in the</span>
<span class="sd">        Returns:</span>
<span class="sd">            ndarray - segments in correct format for LineCollection:</span>
<span class="sd">                an array with shape: (numlines, points per line, 2)</span>
<span class="sd">                the last dimension is for x and y respectively</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">segments</span>

    <span class="c1"># Default colors equally spaced on [0,1]:</span>
    <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="c1"># Special case if a single number:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>  <span class="c1"># to check for numerical input -- this is a hack</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z</span><span class="p">])</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="n">segments</span> <span class="o">=</span> <span class="n">make_segments</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">lc</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span>
        <span class="n">segments</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span>
    <span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lc</span></div>


<div class="viewcode-block" id="plot_stems"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.plot_stems">[docs]</a><span class="k">def</span> <span class="nf">plot_stems</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; x_data = [1, 1, 2, 3, 3, 3, 4, 4, 5]</span>
<span class="sd">        &gt;&gt;&gt; y_data = [1, 2, 1, 2, 1, 4, 4, 5, 1]</span>
<span class="sd">        &gt;&gt;&gt; pt.plots.plot_stems(x_data, y_data)</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fnum</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">next_fnum</span><span class="p">()</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span> <span class="n">doclf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">docla</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">draw_stems</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;query index&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;query ranks&#39;</span><span class="p">)</span>

    <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_darkbackground&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="n">is_default_dark_bg</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span><span class="p">:</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">dark_background</span><span class="p">()</span>

    <span class="c1"># pt.set_figtitle(&#39;plot_stems&#39;)</span>
    <span class="c1"># df2.legend(loc=&#39;upper left&#39;)</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">iup</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_score_histograms"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.plot_score_histograms">[docs]</a><span class="k">def</span> <span class="nf">plot_score_histograms</span><span class="p">(</span>
    <span class="n">scores_list</span><span class="p">,</span>
    <span class="n">score_lbls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">score_markers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">score_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">markersizes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pnum</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">score_label</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span>
    <span class="n">score_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">overlay_prob_given_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">overlay_score_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">logscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">histnorm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Accumulates scores into histograms and plots them</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --test-plot_score_histograms --show</span>

<span class="sd">    Ignore:</span>
<span class="sd">        &gt;&gt;&gt; score_label = &#39;score&#39;</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; rng = np.random.RandomState(seed=0)</span>
<span class="sd">        &gt;&gt;&gt; tp_support = rng.normal(loc=6.5, size=(256,))</span>
<span class="sd">        &gt;&gt;&gt; tn_support = rng.normal(loc=3.5, size=(256,))</span>
<span class="sd">        &gt;&gt;&gt; scores_list = [tp_support, tn_support]</span>
<span class="sd">        &gt;&gt;&gt; logscale = True</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;plot_scores_histogram&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = plot_score_histograms(scores_list, title=title,</span>
<span class="sd">        &gt;&gt;&gt;                                logscale=logscale)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scores_list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">scores_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">scores_list</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Histogram of </span><span class="si">%d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">score_label</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Histogram of &#39;</span> <span class="o">+</span> <span class="n">score_label</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span>
    <span class="n">title</span> <span class="o">+=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;titlesuf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">score_lbls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">score_lbls</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">lblx</span><span class="p">)</span> <span class="k">for</span> <span class="n">lblx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">score_markers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">score_markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span> <span class="k">for</span> <span class="n">lblx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">score_colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">score_colors</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">distinct_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">markersizes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">markersizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">lblx</span><span class="p">)</span> <span class="k">for</span> <span class="n">lblx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">))]</span>
    <span class="c1"># labelx_list = [[lblx] * len(scores_) for lblx, scores_ in enumerate(scores_list)]</span>

    <span class="c1"># append amount of support</span>
    <span class="n">score_lbls_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">))</span> <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">ydata</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">score_lbls</span><span class="p">,</span> <span class="n">scores_list</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># References:</span>
    <span class="c1"># stats.stackexchange.com/questions/798/calculating-optimal-number-of-bins-in-a-histogram-for-n-where-n-ranges-from-30</span>
    <span class="c1"># bandwidth = diff(range(x)) / (2 * IQR(x) / length(x) ^ (1 / 3)))</span>

    <span class="k">if</span> <span class="n">fnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fnum</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">next_fnum</span><span class="p">()</span>

    <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span> <span class="n">doclf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">docla</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># agg_scores  = np.hstack(scores_list)</span>
    <span class="c1"># dmin = agg_scores.min()</span>
    <span class="c1"># dmax = agg_scores.max()</span>

    <span class="n">bins</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">bin_width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bin_width&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">bin_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">bins</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_bins</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">d_min</span><span class="p">,</span> <span class="n">d_max</span><span class="p">,</span> <span class="n">num_bins</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">num_bins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">d_max</span> <span class="o">-</span> <span class="n">d_min</span><span class="p">)</span> <span class="o">//</span> <span class="n">width</span><span class="p">)</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="n">d_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">count</span><span class="p">)</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bins</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">bins</span>

    <span class="k">def</span> <span class="nf">make_bins2</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="n">num_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">//</span> <span class="n">width</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;num_bins = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_bins</span><span class="p">,))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">count</span><span class="p">)</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bins</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">bin_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">total_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="k">for</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">scores_list</span><span class="p">]))</span>
        <span class="n">total_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="k">for</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">scores_list</span><span class="p">]))</span>
        <span class="c1"># ave_diff = np.mean(ut.flatten([np.diff(sorted(scores)) for scores in scores_list]))</span>
        <span class="c1"># std_diff = np.std(ut.flatten([np.diff(sorted(scores)) for scores in scores_list]))</span>
        <span class="c1"># (total_max - total_min) / bin_width</span>
        <span class="n">num_bins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;num_bins&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">total_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_min</span><span class="p">)</span>  <span class="c1"># HACK</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">make_bins</span><span class="p">(</span><span class="n">bin_width</span><span class="p">,</span> <span class="n">total_min</span><span class="p">,</span> <span class="n">total_max</span><span class="p">,</span> <span class="n">num_bins</span><span class="p">)</span>
        <span class="n">bin_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">bins</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># _, agg_bins = np.histogram(agg_scores, &#39;auto&#39;)</span>
        <span class="n">bin_width</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">scores</span><span class="p">)[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">scores_list</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;bin_width = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bin_width</span><span class="p">,))</span>
        <span class="c1"># total_min = np.floor(min([min(scores) for scores in scores_list]))</span>
        <span class="c1"># total_max = np.ceil(max([max(scores) for scores in scores_list]))</span>
        <span class="c1"># start = total_min - bin_width / 2</span>
        <span class="c1"># end = total_max + bin_width / 2</span>
        <span class="c1"># if total_min &gt; 0:</span>
        <span class="c1">#     start = max(0, start)</span>
        <span class="c1"># bin_width = np.mean(np.diff(agg_bins))</span>
        <span class="c1"># num_bins = len(agg_bins)</span>
        <span class="c1"># d_min, d_max = scores.min(), scores.max()</span>
        <span class="c1"># width = bin_width</span>
        <span class="c1"># import utool</span>
        <span class="c1"># utool.embed()</span>
        <span class="n">bin_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">make_bins2</span><span class="p">(</span><span class="n">bin_width</span><span class="p">,</span> <span class="n">scores</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">scores</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="k">for</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">scores_list</span>
        <span class="p">]</span>
    <span class="c1"># else:</span>
    <span class="c1">#     import scipy as sp</span>
    <span class="c1">#     sortscores = np.sort(np.hstack(scores_list))</span>
    <span class="c1">#     area = sp.integrate.cumtrapz(sortscores, initial=0)</span>
    <span class="c1">#     area = area / area[-1]</span>
    <span class="c1">#     inlier_scores = sortscores[np.logical_and(area &lt; .95, area &gt; .05)]</span>
    <span class="c1">#     (inlier_scores.max() - inlier_scores.min())</span>

    <span class="c1"># Plot each datapoint on a line</span>
    <span class="n">_n_max</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_n_min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_bin_max</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">freq_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># ax  = df2.gca()</span>

    <span class="k">if</span> <span class="n">histnorm</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">histnorm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency&#39;</span><span class="p">]:</span>
            <span class="n">histnorm</span> <span class="o">=</span> <span class="s1">&#39;percent&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">histnorm</span> <span class="o">=</span> <span class="s1">&#39;frequency&#39;</span>

    <span class="n">xdata_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">width_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">lblx</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">))):</span>
        <span class="c1"># marker = score_markers[lblx]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">scores_list</span><span class="p">[</span><span class="n">lblx</span><span class="p">]</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">bin_list</span><span class="p">[</span><span class="n">lblx</span><span class="p">]</span>

        <span class="c1"># dmin = int(np.floor(data.min()))</span>
        <span class="c1"># dmax = int(np.ceil(data.max()))</span>
        <span class="k">if</span> <span class="n">bins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
        <span class="c1">#     bins = dmax - dmin</span>
        <span class="c1">#     bins = 50</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># freq, _bins = np.histogram(data, bins, density=histnorm)</span>
            <span class="k">if</span> <span class="n">histnorm</span> <span class="o">==</span> <span class="s1">&#39;percent&#39;</span><span class="p">:</span>
                <span class="n">freq</span><span class="p">,</span> <span class="n">_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
                <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span> <span class="o">/</span> <span class="n">freq</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">histnorm</span> <span class="o">==</span> <span class="s1">&#39;density&#39;</span><span class="p">:</span>
                <span class="n">freq</span><span class="p">,</span> <span class="n">_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">histnorm</span> <span class="o">==</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span>
                <span class="n">freq</span><span class="p">,</span> <span class="n">_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown mode histnorm=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">histnorm</span><span class="p">,))</span>

            <span class="c1"># Accumulate ydata</span>
            <span class="n">freq_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>

            <span class="c1"># accumulate a list of bins</span>
            <span class="c1"># _xdata = (_bins[1:] + _bins[:-1]) / 2</span>
            <span class="n">_xdata</span> <span class="o">=</span> <span class="n">_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">_bins</span><span class="p">)</span>
            <span class="n">xdata_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">_xdata</span><span class="p">]</span>
            <span class="n">width_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_width</span><span class="p">)</span>

            <span class="n">_n</span> <span class="o">=</span> <span class="n">freq</span>
            <span class="c1"># if False:</span>
            <span class="c1">#     # Old non-multiplot way</span>
            <span class="c1">#     label = score_lbls_[lblx]</span>
            <span class="c1">#     color = score_colors[lblx]</span>
            <span class="c1">#     _n, _bins, _patches = ax.hist(</span>
            <span class="c1">#         data, bins=bins, label=str(label), color=color,</span>
            <span class="c1">#         rwidth=None, normed=True,</span>
            <span class="c1">#         histtype=&#39;stepfilled&#39;, alpha=.7, stacked=True)</span>
            <span class="c1">#     #range=(dmin, dmax),</span>
            <span class="c1">#     #for _p in _patches:</span>
            <span class="c1">#     #    _p.set_edgecolor(None)</span>
            <span class="n">_n_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">_n_min</span><span class="p">,</span> <span class="n">_n</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
            <span class="n">_n_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">_n_max</span><span class="p">,</span> <span class="n">_n</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">_bin_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">_bin_max</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">_bins</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span>
                <span class="n">ex</span><span class="p">,</span> <span class="s1">&#39;probably gave negative scores&#39;</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;total_min&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="kn">import</span> <span class="nn">utool</span>

            <span class="n">utool</span><span class="o">.</span><span class="n">embed</span><span class="p">()</span>
            <span class="k">raise</span>

            <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">SUPER_STRICT</span><span class="p">:</span>
                <span class="k">raise</span>

    <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># TODO:</span>
        <span class="c1"># Ensure that multiplot can take in a list of xdata as well as a list</span>
        <span class="c1"># of ydata</span>
        <span class="c1"># New multiplot way</span>
        <span class="c1"># if bin_width is None:</span>
        <span class="c1">#     bin_width = np.mean(np.diff(bins))  # FIXME: variable widths</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">multi_plot</span><span class="p">(</span>
            <span class="n">xdata_list</span><span class="p">,</span>
            <span class="n">freq_list</span><span class="p">,</span>
            <span class="n">label_list</span><span class="o">=</span><span class="n">score_lbls_</span><span class="p">,</span>
            <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span>
            <span class="n">color_list</span><span class="o">=</span><span class="n">score_colors</span><span class="p">,</span>
            <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span>
            <span class="n">width_list</span><span class="o">=</span><span class="n">width_list</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">score_label</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">histnorm</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlim&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">logscale</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">logscale</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">symlogkw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">symlogkw</span> <span class="o">=</span> <span class="n">logscale</span>
        <span class="c1"># ax.set_xscale(&#39;log&#39;)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">symlogkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">symlogkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;basex&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;XSCALE&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">symlogkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">symlogkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;basey&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;YSCALE&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">symlogkw</span><span class="p">)</span>
        <span class="c1"># ax.set_xscale(&#39;symlog&#39;, nonposx=&#39;clip&#39;)</span>
        <span class="c1"># ax.set_yscale(&#39;symlog&#39;, nonposy=&#39;clip&#39;)</span>
        <span class="c1"># ax.set_xscale(&#39;log&#39;, nonposx=&#39;clip&#39;)</span>
        <span class="c1"># ax.set_yscale(&#39;log&#39;, nonposy=&#39;clip&#39;)</span>
        <span class="c1"># set_logyscale_from_data(sorted(ut.flatten(scores_list)))</span>

    <span class="k">if</span> <span class="n">overlay_score_domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">p_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">prob</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">overlay_prob_given_list</span><span class="p">])</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">_n_max</span> <span class="o">/</span> <span class="n">p_max</span>
        <span class="k">for</span> <span class="n">lblx</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">))):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">score_colors</span><span class="p">[</span><span class="n">lblx</span><span class="p">]</span>
            <span class="n">p_given_lbl</span> <span class="o">=</span> <span class="n">overlay_prob_given_list</span><span class="p">[</span><span class="n">lblx</span><span class="p">]</span>
            <span class="n">p_given_lbl_norm</span> <span class="o">=</span> <span class="n">p_given_lbl</span> <span class="o">*</span> <span class="n">scale_factor</span>
            <span class="c1"># / p_given_lbl.max()</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="n">overlay_score_domain</span> <span class="o">&lt;</span> <span class="n">_bin_max</span>
            <span class="n">overlay_score_domain_clip</span> <span class="o">=</span> <span class="n">overlay_score_domain</span><span class="p">[</span><span class="n">flags</span><span class="p">]</span>
            <span class="n">p_given_lbl_norm_clip</span> <span class="o">=</span> <span class="n">p_given_lbl_norm</span><span class="p">[</span><span class="n">flags</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">overlay_score_domain_clip</span><span class="p">,</span> <span class="n">p_given_lbl_norm_clip</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="n">_n_max</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">score_thresh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ydomain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">_n_min</span><span class="p">,</span> <span class="n">_n_max</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">xvalues</span> <span class="o">=</span> <span class="p">[</span><span class="n">score_thresh</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydomain</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span> <span class="n">ydomain</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;score thresh=</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">score_thresh</span><span class="p">,))</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legendsize&#39;</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">])</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_probabilities"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.plot_probabilities">[docs]</a><span class="k">def</span> <span class="nf">plot_probabilities</span><span class="p">(</span>
    <span class="n">prob_list</span><span class="p">,</span>
    <span class="n">prob_lbls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">prob_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xdata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">prob_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">score_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">figtitle</span><span class="o">=</span><span class="s1">&#39;plot_probabilities&#39;</span><span class="p">,</span>
    <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pnum</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Input: a list of scores (either chip or descriptor)</span>

<span class="sd">    Concatenates and sorts the scores</span>
<span class="sd">    Sorts and plots with different types of scores labeled</span>

<span class="sd">    Args:</span>
<span class="sd">        prob_list (list):</span>
<span class="sd">        prob_lbls (None): (default = None)</span>
<span class="sd">        prob_colors (None): (default = None)</span>
<span class="sd">        xdata (None): (default = None)</span>
<span class="sd">        prob_thresh (None): (default = None)</span>
<span class="sd">        figtitle (str): (default = &#39;plot_probabilities&#39;)</span>
<span class="sd">        fnum (int):  figure number(default = None)</span>
<span class="sd">        pnum (tuple):  plot number(default = (1, 1, 1))</span>
<span class="sd">        fill (bool): (default = False)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --exec-plot_probabilities --show --lightbg</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; prob_list = [[.01, .02, .03, .04, .03, .06, .03, .04]]</span>
<span class="sd">        &gt;&gt;&gt; prob_lbls = [&#39;prob&#39;]</span>
<span class="sd">        &gt;&gt;&gt; prob_colors = None</span>
<span class="sd">        &gt;&gt;&gt; xdata = None</span>
<span class="sd">        &gt;&gt;&gt; prob_thresh = None</span>
<span class="sd">        &gt;&gt;&gt; figtitle = &#39;plot_probabilities&#39;</span>
<span class="sd">        &gt;&gt;&gt; fnum = None</span>
<span class="sd">        &gt;&gt;&gt; pnum = (1, 1, 1)</span>
<span class="sd">        &gt;&gt;&gt; fill = True</span>
<span class="sd">        &gt;&gt;&gt; score_thresh = None</span>
<span class="sd">        &gt;&gt;&gt; result = plot_probabilities(prob_list, prob_lbls, prob_colors, xdata, prob_thresh, score_thresh, figtitle, fnum, pnum, fill)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">xdata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prob_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">density</span><span class="p">)</span> <span class="k">for</span> <span class="n">density</span> <span class="ow">in</span> <span class="n">prob_list</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">prob_lbls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prob_lbls</span> <span class="o">=</span> <span class="p">[</span><span class="n">lblx</span> <span class="k">for</span> <span class="n">lblx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prob_list</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">prob_colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prob_colors</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">distinct_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prob_list</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_lbls</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_colors</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fnum</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">next_fnum</span><span class="p">()</span>

    <span class="c1"># df2.figure(fnum=fnum, pnum=pnum, doclf=False, docla=False)</span>
    <span class="n">multi_plot</span><span class="p">(</span>
        <span class="n">xdata</span><span class="p">,</span>
        <span class="n">prob_list</span><span class="p">,</span>
        <span class="n">label_list</span><span class="o">=</span><span class="n">prob_lbls</span><span class="p">,</span>
        <span class="n">color_list</span><span class="o">=</span><span class="n">prob_colors</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span>
        <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;score value&#39;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">figtitle</span><span class="p">,</span>
        <span class="n">use_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">prob_thresh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="p">[</span><span class="n">prob_thresh</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;prob thresh&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">score_thresh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ydata_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">_ydata</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">_ydata</span> <span class="ow">in</span> <span class="n">prob_list</span><span class="p">])</span>
        <span class="n">ydata_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">_ydata</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">_ydata</span> <span class="ow">in</span> <span class="n">prob_list</span><span class="p">])</span>
        <span class="n">ydomain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ydata_min</span><span class="p">,</span> <span class="n">ydata_max</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="n">score_thresh</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydomain</span><span class="p">),</span>
            <span class="n">ydomain</span><span class="p">,</span>
            <span class="s1">&#39;g-&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;score thresh=</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">score_thresh</span><span class="p">,),</span>
        <span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;remove_yticks&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_legend&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legendsize&#39;</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">])</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legendsize&#39;</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span></div>


<span class="c1"># Short alias</span>
<span class="n">plot_probs</span> <span class="o">=</span> <span class="n">plot_probabilities</span>
<span class="c1"># Incorrect (but legacy) alias</span>
<span class="n">plot_densities</span> <span class="o">=</span> <span class="n">plot_probabilities</span>


<div class="viewcode-block" id="plot_sorted_scores"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.plot_sorted_scores">[docs]</a><span class="k">def</span> <span class="nf">plot_sorted_scores</span><span class="p">(</span>
    <span class="n">scores_list</span><span class="p">,</span>
    <span class="n">score_lbls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">score_markers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">score_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">markersizes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pnum</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">logscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figtitle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">score_label</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span>
    <span class="n">thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">use_stems</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Concatenates and sorts the scores</span>
<span class="sd">    Sorts and plots with different types of scores labeled</span>

<span class="sd">    Args:</span>
<span class="sd">        scores_list (list): a list of scores</span>
<span class="sd">        score_lbls (None):</span>
<span class="sd">        score_markers (None):</span>
<span class="sd">        score_colors (None):</span>
<span class="sd">        markersizes (None):</span>
<span class="sd">        fnum (int):  figure number</span>
<span class="sd">        pnum (tuple):  plot number</span>
<span class="sd">        logscale (bool):</span>
<span class="sd">        figtitle (str):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --test-plot_sorted_scores --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; rng = np.random.RandomState(seed=0)</span>
<span class="sd">        &gt;&gt;&gt; tp_support = rng.normal(loc=6.5, size=(256,))</span>
<span class="sd">        &gt;&gt;&gt; tn_support = rng.normal(loc=3.5, size=(256,))</span>
<span class="sd">        &gt;&gt;&gt; scores_list = [tp_support, tn_support]</span>
<span class="sd">        &gt;&gt;&gt; score_lbls = None</span>
<span class="sd">        &gt;&gt;&gt; score_markers = None</span>
<span class="sd">        &gt;&gt;&gt; score_colors = None</span>
<span class="sd">        &gt;&gt;&gt; markersizes = None</span>
<span class="sd">        &gt;&gt;&gt; fnum = None</span>
<span class="sd">        &gt;&gt;&gt; pnum = (1, 1, 1)</span>
<span class="sd">        &gt;&gt;&gt; logscale = True</span>
<span class="sd">        &gt;&gt;&gt; figtitle = &#39;plot_sorted_scores&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = plot_sorted_scores(scores_list, score_lbls, score_markers,</span>
<span class="sd">        &gt;&gt;&gt;                             score_colors, markersizes, fnum, pnum,</span>
<span class="sd">        &gt;&gt;&gt;                             logscale, figtitle)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">figtitle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figtitle</span> <span class="o">=</span> <span class="s1">&#39;sorted &#39;</span> <span class="o">+</span> <span class="n">score_label</span>
    <span class="k">if</span> <span class="n">score_lbls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">score_lbls</span> <span class="o">=</span> <span class="p">[</span><span class="n">lblx</span> <span class="k">for</span> <span class="n">lblx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">score_markers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">score_markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span> <span class="k">for</span> <span class="n">lblx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">score_colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">score_colors</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">distinct_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">markersizes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">markersizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">lblx</span><span class="p">)</span> <span class="k">for</span> <span class="n">lblx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">))]</span>
    <span class="n">labelx_list</span> <span class="o">=</span> <span class="p">[[</span><span class="n">lblx</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores_</span><span class="p">)</span> <span class="k">for</span> <span class="n">lblx</span><span class="p">,</span> <span class="n">scores_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scores_list</span><span class="p">)]</span>
    <span class="n">agg_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">scores_list</span><span class="p">)</span>
    <span class="n">agg_labelx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">labelx_list</span><span class="p">)</span>

    <span class="n">agg_sortx</span> <span class="o">=</span> <span class="n">agg_scores</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>

    <span class="n">sorted_scores</span> <span class="o">=</span> <span class="n">agg_scores</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">agg_sortx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sorted_labelx</span> <span class="o">=</span> <span class="n">agg_labelx</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">agg_sortx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fnum</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">next_fnum</span><span class="p">()</span>

    <span class="n">df2</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span> <span class="n">doclf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">docla</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># plot stems to get a better sense of the distribution for binary data</span>
    <span class="k">if</span> <span class="n">use_stems</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">use_stems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">use_stems</span><span class="p">:</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">sorted_scores</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">absolute_bottom</span> <span class="o">=</span> <span class="n">sorted_scores</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lblx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">)):</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="p">(</span><span class="n">absolute_bottom</span> <span class="o">-</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">))</span> <span class="k">if</span> <span class="n">lblx</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">ymax</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">score_colors</span><span class="p">[</span><span class="n">lblx</span><span class="p">]</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sorted_labelx</span> <span class="o">==</span> <span class="n">lblx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">sorted_scores</span><span class="p">[</span><span class="n">xdata</span><span class="p">]</span>
            <span class="c1"># TODO: stems for binary labels</span>
            <span class="n">df2</span><span class="o">.</span><span class="n">draw_stems</span><span class="p">(</span>
                <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">setlims</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span>
            <span class="p">)</span>
            <span class="k">pass</span>

    <span class="c1"># Plot each datapoint on a line</span>
    <span class="k">for</span> <span class="n">lblx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_list</span><span class="p">)):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">score_lbls</span><span class="p">[</span><span class="n">lblx</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">score_colors</span><span class="p">[</span><span class="n">lblx</span><span class="p">]</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="n">score_markers</span><span class="p">[</span><span class="n">lblx</span><span class="p">]</span>
        <span class="n">markersize</span> <span class="o">=</span> <span class="n">markersizes</span><span class="p">[</span><span class="n">lblx</span><span class="p">]</span>
        <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sorted_labelx</span> <span class="o">==</span> <span class="n">lblx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ydata</span> <span class="o">=</span> <span class="n">sorted_scores</span><span class="p">[</span><span class="n">xdata</span><span class="p">]</span>
        <span class="c1"># printDBG(&#39;[sorted_scores] lblx=%r label=%r, marker=%r&#39; % (lblx, label, marker))</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xdata</span><span class="p">,</span>
            <span class="n">ydata</span><span class="p">,</span>
            <span class="n">marker</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">thresh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_labelx</span><span class="p">))</span>
        <span class="c1"># logger.info(&#39;indicies.shape = %r&#39; % (indicies.shape,))</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">indicies</span><span class="p">,</span>
            <span class="p">[</span><span class="n">thresh</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">indicies</span><span class="p">),</span>
            <span class="s1">&#39;g-&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">score_label</span> <span class="o">+</span> <span class="s1">&#39; thresh=</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">thresh</span><span class="p">,),</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">logscale</span><span class="p">:</span>
        <span class="c1"># DEPRICATE</span>
        <span class="n">set_logyscale_from_data</span><span class="p">(</span><span class="n">sorted_scores</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="c1"># dont let xlimit go far over the number of labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_labelx</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">labelkw</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;fontproperties&#39;</span><span class="p">:</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span>
            <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;labelsize&#39;</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">])</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;sorted individual &#39;</span> <span class="o">+</span> <span class="n">score_label</span> <span class="o">+</span> <span class="s1">&#39; indices&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">labelkw</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">score_label</span><span class="p">,</span> <span class="o">**</span><span class="n">labelkw</span><span class="p">)</span>

    <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_darkbackground&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">use_darkbackground</span> <span class="o">=</span> <span class="n">is_default_dark_bg</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">use_darkbackground</span><span class="p">:</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">dark_background</span><span class="p">()</span>
    <span class="n">titlesize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;titlesize&#39;</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.titlesize&#39;</span><span class="p">])</span>
    <span class="n">titlekw</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;fontproperties&#39;</span><span class="p">:</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span>
            <span class="n">family</span><span class="o">=</span><span class="s1">&#39;DejaVu Sans&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">titlesize</span>
        <span class="p">)</span>
    <span class="p">}</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">figtitle</span><span class="p">,</span> <span class="o">**</span><span class="n">titlekw</span><span class="p">)</span>
    <span class="c1"># df2.legend(loc=&#39;upper left&#39;)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legendsize&#39;</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">])</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legendsize&#39;</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span></div>
    <span class="c1"># df2.legend(loc=&#39;best&#39;)</span>
    <span class="c1"># df2.iup()</span>


<div class="viewcode-block" id="set_logyscale_from_data"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.set_logyscale_from_data">[docs]</a><span class="k">def</span> <span class="nf">set_logyscale_from_data</span><span class="p">(</span><span class="n">y_data</span><span class="p">):</span>
    <span class="c1"># DEPRICATE</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Warning: not enough information to infer yscale&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">logscale_kwargs</span> <span class="o">=</span> <span class="n">get_good_logyscale_kwargs</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">logscale_kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_good_logyscale_kwargs"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.get_good_logyscale_kwargs">[docs]</a><span class="k">def</span> <span class="nf">get_good_logyscale_kwargs</span><span class="p">(</span><span class="n">y_data</span><span class="p">,</span> <span class="n">adaptive_knee_scaling</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># DEPRICATE</span>
    <span class="c1"># Attempts to detect knee points by looking for</span>
    <span class="c1"># log derivatives way past the normal standard deviations</span>
    <span class="c1"># The input data is assumed to be sorted and y_data</span>
    <span class="n">basey</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">nStdDevs_thresh</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="c1"># Take the log of the data</span>
    <span class="n">logy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>
    <span class="n">logy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">logy</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">logy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">logy</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Find the derivative of data</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">logy</span><span class="p">)</span>
    <span class="n">dy_sortx</span> <span class="o">=</span> <span class="n">dy</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="c1"># Get mean and standard deviation</span>
    <span class="n">dy_stats</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span>
    <span class="n">dy_sorted</span> <span class="o">=</span> <span class="n">dy</span><span class="p">[</span><span class="n">dy_sortx</span><span class="p">]</span>
    <span class="c1"># Find the number of standard deveations past the mean each datapoint is</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nStdDevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dy_sorted</span> <span class="o">-</span> <span class="n">dy_stats</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy_stats</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">key_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dy_stats&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="s1">&#39;y_data&#39;</span><span class="p">),</span> <span class="s1">&#39;y_data&#39;</span><span class="p">])</span>
        <span class="k">raise</span>
    <span class="c1"># Mark any above a threshold as knee points</span>
    <span class="n">knee_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nStdDevs</span> <span class="o">&gt;</span> <span class="n">nStdDevs_thresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">knee_mag</span> <span class="o">=</span> <span class="n">nStdDevs</span><span class="p">[</span><span class="n">knee_indexes</span><span class="p">]</span>
    <span class="n">knee_points</span> <span class="o">=</span> <span class="n">dy_sortx</span><span class="p">[</span><span class="n">knee_indexes</span><span class="p">]</span>
    <span class="c1"># printDBG(&#39;[df2] knee_points = %r&#39; % (knee_points,))</span>
    <span class="c1"># Check to see that we have found a knee</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">knee_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">adaptive_knee_scaling</span><span class="p">:</span>
        <span class="c1"># Use linear scaling up the the knee points and</span>
        <span class="c1"># scale it by the magnitude of the knee</span>
        <span class="n">kneex</span> <span class="o">=</span> <span class="n">knee_points</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
        <span class="n">linthreshx</span> <span class="o">=</span> <span class="n">knee_points</span><span class="p">[</span><span class="n">kneex</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">linthreshy</span> <span class="o">=</span> <span class="n">y_data</span><span class="p">[</span><span class="n">linthreshx</span><span class="p">]</span> <span class="o">*</span> <span class="n">basey</span>
        <span class="n">linscaley</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">knee_mag</span><span class="p">[</span><span class="n">kneex</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">basey</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">linthreshx</span> <span class="o">=</span> <span class="mf">1e2</span>
        <span class="n">linthreshy</span> <span class="o">=</span> <span class="mf">1e2</span>
        <span class="n">linscaley</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">logscale_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;basey&#39;</span><span class="p">:</span> <span class="n">basey</span><span class="p">,</span>
        <span class="s1">&#39;nonposx&#39;</span><span class="p">:</span> <span class="s1">&#39;clip&#39;</span><span class="p">,</span>
        <span class="s1">&#39;nonposy&#39;</span><span class="p">:</span> <span class="s1">&#39;clip&#39;</span><span class="p">,</span>
        <span class="s1">&#39;linthreshy&#39;</span><span class="p">:</span> <span class="n">linthreshy</span><span class="p">,</span>
        <span class="s1">&#39;linthreshx&#39;</span><span class="p">:</span> <span class="n">linthreshx</span><span class="p">,</span>
        <span class="s1">&#39;linscalex&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;linscaley&#39;</span><span class="p">:</span> <span class="n">linscaley</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="c1"># logger.info(logscale_kwargs)</span>
    <span class="k">return</span> <span class="n">logscale_kwargs</span></div>


<div class="viewcode-block" id="plot_pdf"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.plot_pdf">[docs]</a><span class="k">def</span> <span class="nf">plot_pdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">draw_support</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nYTicks</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">warnstr</span> <span class="o">=</span> <span class="s1">&#39;[df2] ! Warning: len(data) = 0. Cannot visualize pdf&#39;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warnstr</span><span class="p">)</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">draw_text</span><span class="p">(</span><span class="n">warnstr</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">warnstr</span> <span class="o">=</span> <span class="s1">&#39;[df2] ! Warning: len(data) = 1. Cannot visualize pdf&#39;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warnstr</span><span class="p">)</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">draw_text</span><span class="p">(</span><span class="n">warnstr</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">bw_factor</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">colorx</span> <span class="o">=</span> <span class="n">color</span>
        <span class="n">line_color</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gist_rainbow&#39;</span><span class="p">)(</span><span class="n">colorx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_color</span> <span class="o">=</span> <span class="n">color</span>

    <span class="c1"># Estimate a pdf</span>
    <span class="n">data_pdf</span> <span class="o">=</span> <span class="n">estimate_pdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bw_factor</span><span class="p">)</span>
    <span class="c1"># Get probability of seen data</span>
    <span class="n">prob_x</span> <span class="o">=</span> <span class="n">data_pdf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># Get probability of unseen data data</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">y_data</span> <span class="o">=</span> <span class="n">data_pdf</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span>
    <span class="c1"># Scale if requested</span>
    <span class="k">if</span> <span class="n">scale_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">scale_to</span> <span class="o">/</span> <span class="n">y_data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">y_data</span> <span class="o">*=</span> <span class="n">scale_factor</span>
        <span class="n">prob_x</span> <span class="o">*=</span> <span class="n">scale_factor</span>
    <span class="c1"># Plot the actual datas on near the bottom perterbed in Y</span>
    <span class="k">if</span> <span class="n">draw_support</span><span class="p">:</span>
        <span class="n">pdfrange</span> <span class="o">=</span> <span class="n">prob_x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">prob_x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">perb</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span> <span class="o">*</span> <span class="n">pdfrange</span> <span class="o">/</span> <span class="mf">30.0</span>
        <span class="n">preb_y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">([</span><span class="n">pdfrange</span> <span class="o">/</span> <span class="mf">50.0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span> <span class="o">+</span> <span class="n">perb</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">preb_y_data</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">line_color</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="c1"># Plot the pdf (unseen data)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">line_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nYTicks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y_data</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_data</span><span class="p">),</span> <span class="n">nYTicks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span></div>


<div class="viewcode-block" id="estimate_pdf"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.estimate_pdf">[docs]</a><span class="k">def</span> <span class="nf">estimate_pdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bw_factor</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data_pdf</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bw_factor</span><span class="p">)</span>
        <span class="n">data_pdf</span><span class="o">.</span><span class="n">covariance_factor</span> <span class="o">=</span> <span class="n">bw_factor</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] ! Exception while estimating kernel density&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] data=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">,))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[df2] ex=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ex</span><span class="p">,))</span>
        <span class="k">raise</span>
    <span class="k">return</span> <span class="n">data_pdf</span></div>


<div class="viewcode-block" id="interval_stats_plot"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.interval_stats_plot">[docs]</a><span class="k">def</span> <span class="nf">interval_stats_plot</span><span class="p">(</span>
    <span class="n">param2_stat_dict</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    interval plot for displaying mean, range, and std</span>

<span class="sd">    Args:</span>
<span class="sd">        fnum (int):  figure number</span>
<span class="sd">        pnum (tuple):  plot number</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --test-interval_stats_plot</span>
<span class="sd">        python -m wbia.plottool.plots --test-interval_stats_plot --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; param2_stat_dict = {</span>
<span class="sd">        ...     0.5: dict([(&#39;max&#39;, 0.0584), (&#39;min&#39;, 0.0543), (&#39;mean&#39;, 0.0560), (&#39;std&#39;, 0.00143),]),</span>
<span class="sd">        ...     0.6: dict([(&#39;max&#39;, 0.0593), (&#39;min&#39;, 0.0538), (&#39;mean&#39;, 0.0558), (&#39;std&#39;, 0.00178),]),</span>
<span class="sd">        ...     0.7: dict([(&#39;max&#39;, 0.0597), (&#39;min&#39;, 0.0532), (&#39;mean&#39;, 0.0556), (&#39;std&#39;, 0.00216),]),</span>
<span class="sd">        ...     0.8: dict([(&#39;max&#39;, 0.0601), (&#39;min&#39;, 0.0525), (&#39;mean&#39;, 0.0552), (&#39;std&#39;, 0.00257),]),</span>
<span class="sd">        ...     0.9: dict([(&#39;max&#39;, 0.0604), (&#39;min&#39;, 0.0517), (&#39;mean&#39;, 0.0547), (&#39;std&#39;, 0.00300),]),</span>
<span class="sd">        ...     1.0: dict([(&#39;max&#39;, 0.0607), (&#39;min&#39;, 0.0507), (&#39;mean&#39;, 0.0541), (&#39;std&#39;, 0.00345),])</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; fnum = None</span>
<span class="sd">        &gt;&gt;&gt; pnum = (1, 1, 1)</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;p vs score&#39;</span>
<span class="sd">        &gt;&gt;&gt; x_label = &#39;p&#39;</span>
<span class="sd">        &gt;&gt;&gt; y_label = &#39;score diff&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = interval_stats_plot(param2_stat_dict, fnum, pnum, x_label, y_label, title)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fnum</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">next_fnum</span><span class="p">()</span>

    <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">param2_stat_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">sortx</span> <span class="o">=</span> <span class="n">x_data</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="n">x_data_sort</span> <span class="o">=</span> <span class="n">x_data</span><span class="p">[</span><span class="n">sortx</span><span class="p">]</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

    <span class="c1"># Prepare y data for boxplot</span>
    <span class="n">y_data_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">]</span>
    <span class="n">y_data_dict</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">param2_stat_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_dictlist_key</span><span class="p">(</span><span class="n">dict_list</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">dict_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">dict_</span> <span class="ow">in</span> <span class="n">dict_list</span><span class="p">]</span>

    <span class="n">y_data_components</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_dictlist_key</span><span class="p">(</span><span class="n">y_data_dict</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">y_data_keys</span><span class="p">]</span>
    <span class="c1"># The stacking is pretty much not needed anymore, but whatever</span>
    <span class="n">y_data_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">y_data_components</span><span class="p">)[:,</span> <span class="n">sortx</span><span class="p">]</span>
    <span class="n">y_data_std_sort</span> <span class="o">=</span> <span class="n">y_data_sort</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y_data_mean_sort</span> <span class="o">=</span> <span class="n">y_data_sort</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">y_data_max_sort</span> <span class="o">=</span> <span class="n">y_data_sort</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">y_data_min_sort</span> <span class="o">=</span> <span class="n">y_data_sort</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">y_data_stdlow_sort</span> <span class="o">=</span> <span class="n">y_data_mean_sort</span> <span class="o">-</span> <span class="n">y_data_std_sort</span>
    <span class="n">y_data_stdhigh_sort</span> <span class="o">=</span> <span class="n">y_data_mean_sort</span> <span class="o">+</span> <span class="n">y_data_std_sort</span>
    <span class="n">FIX_STD_SYMETRY</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">FIX_STD_SYMETRY</span><span class="p">:</span>
        <span class="c1"># Standard deviation is symetric where min and max are not.</span>
        <span class="c1"># To avoid weird looking plots clip the stddev fillbetweens</span>
        <span class="c1"># at the min and max</span>
        <span class="c1"># ut.embed()</span>
        <span class="n">outlier_min_std</span> <span class="o">=</span> <span class="n">y_data_stdlow_sort</span> <span class="o">&lt;</span> <span class="n">y_data_min_sort</span>
        <span class="n">outlier_max_std</span> <span class="o">=</span> <span class="n">y_data_stdhigh_sort</span> <span class="o">&gt;</span> <span class="n">y_data_max_sort</span>
        <span class="n">y_data_stdlow_sort</span><span class="p">[</span><span class="n">outlier_min_std</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_data_min_sort</span><span class="p">[</span><span class="n">outlier_min_std</span><span class="p">]</span>
        <span class="n">y_data_stdhigh_sort</span><span class="p">[</span><span class="n">outlier_max_std</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_data_max_sort</span><span class="p">[</span><span class="n">outlier_max_std</span><span class="p">]</span>
    <span class="c1"># Make firgure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span> <span class="n">doclf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">docla</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="c1"># Plot max and mins</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">x_data_sort</span><span class="p">,</span> <span class="n">y_data_min_sort</span><span class="p">,</span> <span class="n">y_data_max_sort</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;range&#39;</span>
    <span class="p">)</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">append_phantom_legend_label</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="c1"># Plot standard deviations</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">x_data_sort</span><span class="p">,</span>
        <span class="n">y_data_stdlow_sort</span><span class="p">,</span>
        <span class="n">y_data_stdhigh_sort</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">append_phantom_legend_label</span><span class="p">(</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="c1"># Plot means</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data_sort</span><span class="p">,</span> <span class="n">y_data_mean_sort</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">append_phantom_legend_label</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;line&#39;</span><span class="p">)</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">show_phantom_legend_labels</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>
    <span class="c1"># df2.dark_background()</span>
    <span class="c1"># plt.show()</span>


<div class="viewcode-block" id="interval_line_plot"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.interval_line_plot">[docs]</a><span class="k">def</span> <span class="nf">interval_line_plot</span><span class="p">(</span>
    <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata_mean</span><span class="p">,</span> <span class="n">y_data_std</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        xdata (ndarray):</span>
<span class="sd">        ydata_mean (ndarray):</span>
<span class="sd">        y_data_std (ndarray):</span>

<span class="sd">    SeeAlso:</span>
<span class="sd">        pt.multi_plot (using the spread_list kwarg)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --test-interval_line_plot --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; xdata = [1, 2, 3, 4, 5, 6, 7, 8]</span>
<span class="sd">        &gt;&gt;&gt; ydata_mean = [2, 3, 4, 3, 3, 2, 2, 2]</span>
<span class="sd">        &gt;&gt;&gt; y_data_std = [1, 2, 1, 1, 3, 2, 2, 1]</span>
<span class="sd">        &gt;&gt;&gt; result = interval_line_plot(xdata, ydata_mean, y_data_std)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
    <span class="n">ydata_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ydata_mean</span><span class="p">)</span>
    <span class="n">y_data_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_data_std</span><span class="p">)</span>
    <span class="n">y_data_max</span> <span class="o">=</span> <span class="n">ydata_mean</span> <span class="o">+</span> <span class="n">y_data_std</span>
    <span class="n">y_data_min</span> <span class="o">=</span> <span class="n">ydata_mean</span> <span class="o">-</span> <span class="n">y_data_std</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">y_data_min</span><span class="p">,</span> <span class="n">y_data_max</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata_mean</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span>
    <span class="p">)</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="plot_search_surface"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.plot_search_surface">[docs]</a><span class="k">def</span> <span class="nf">plot_search_surface</span><span class="p">(</span>
    <span class="n">known_nd_data</span><span class="p">,</span>
    <span class="n">known_target_points</span><span class="p">,</span>
    <span class="n">nd_labels</span><span class="p">,</span>
    <span class="n">target_label</span><span class="p">,</span>
    <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    3D Function</span>

<span class="sd">    Args:</span>
<span class="sd">        known_nd_data (?): should be integral for now</span>
<span class="sd">        known_target_points (?):</span>
<span class="sd">        nd_labels (?):</span>
<span class="sd">        target_label (?):</span>
<span class="sd">        fnum (int):  figure number(default = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ?: ax</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --exec-plot_search_surface --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; known_nd_data = np.array([x.flatten() for x in np.meshgrid(*[np.linspace(-20, 20, 10).astype(np.int32), np.linspace(-20, 20, 10).astype(np.int32)])]).T</span>
<span class="sd">        &gt;&gt;&gt; # complicated polynomial target</span>
<span class="sd">        &gt;&gt;&gt; known_target_points = -.001 * known_nd_data.T[0] ** 4 + .25 * known_nd_data.T[1] ** 2 - .0005 * known_nd_data.T[1] ** 4 + .001 * known_nd_data.T[1] ** 3</span>
<span class="sd">        &gt;&gt;&gt; nd_labels = [&#39;big-dim&#39;, &#39;small-dim&#39;]</span>
<span class="sd">        &gt;&gt;&gt; target_label = [&#39;score&#39;]</span>
<span class="sd">        &gt;&gt;&gt; fnum = 1</span>
<span class="sd">        &gt;&gt;&gt; ax = plot_search_surface(known_nd_data, known_target_points, nd_labels, target_label, fnum)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>
    <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>  <span class="c1"># NOQA</span>

    <span class="n">fnum</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ensure_fnum</span><span class="p">(</span><span class="n">fnum</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;fnum = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fnum</span><span class="p">,))</span>
    <span class="c1"># pt.figure(fnum=fnum, pnum=pnum, doclf=pnum is None, projection=&#39;3d&#39;)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span> <span class="n">doclf</span><span class="o">=</span><span class="n">pnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Convert our non-uniform grid into a uniform grid using gcd</span>
    <span class="k">def</span> <span class="nf">compute_interpolation_grid</span><span class="p">(</span><span class="n">known_nd_data</span><span class="p">,</span> <span class="n">pad_steps</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;use gcd to get the number of steps to take in each dimension&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">fractions</span>

        <span class="n">ug_steps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">reduce</span><span class="p">(</span><span class="n">fractions</span><span class="o">.</span><span class="n">gcd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x_</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="k">for</span> <span class="n">x_</span> <span class="ow">in</span> <span class="n">known_nd_data</span><span class="o">.</span><span class="n">T</span>
        <span class="p">]</span>
        <span class="n">ug_min</span> <span class="o">=</span> <span class="n">known_nd_data</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ug_max</span> <span class="o">=</span> <span class="n">known_nd_data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ug_basis</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">min_</span> <span class="o">-</span> <span class="p">(</span><span class="n">step_</span> <span class="o">*</span> <span class="n">pad_steps</span><span class="p">),</span> <span class="n">max_</span> <span class="o">+</span> <span class="p">(</span><span class="n">step_</span> <span class="o">*</span> <span class="p">(</span><span class="n">pad_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">step_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">step_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ug_min</span><span class="p">,</span> <span class="n">ug_max</span><span class="p">,</span> <span class="n">ug_steps</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">ug_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">basis</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">ug_basis</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># ig = interpolated grid</span>
        <span class="n">unknown_nd_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">_pts</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">_pts</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">ug_basis</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">unknown_nd_data</span><span class="p">,</span> <span class="n">ug_shape</span>

    <span class="k">def</span> <span class="nf">interpolate_error</span><span class="p">(</span><span class="n">known_nd_data</span><span class="p">,</span> <span class="n">known_target_points</span><span class="p">,</span> <span class="n">unknown_nd_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        References:</span>
<span class="sd">            docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.interpolate.griddata.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># method = &#39;cubic&#39;  # {&#39;linear&#39;, &#39;nearest&#39;, &#39;cubic&#39;}</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>  <span class="c1"># {&#39;linear&#39;, &#39;nearest&#39;, &#39;cubic&#39;}</span>
        <span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>

        <span class="n">interpolated_targets</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span>
            <span class="n">known_nd_data</span><span class="p">,</span> <span class="n">known_target_points</span><span class="p">,</span> <span class="n">unknown_nd_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
        <span class="p">)</span>
        <span class="c1"># interpolated_targets[np.isnan(interpolated_targets)] = known_target_points.max() * 2</span>
        <span class="n">interpolated_targets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">interpolated_targets</span><span class="p">)]</span> <span class="o">=</span> <span class="n">known_target_points</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">interpolated_targets</span>

    <span class="c1"># Interpolate uniform grid positions</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">known_nd_data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">ut</span><span class="o">.</span><span class="n">allsame</span><span class="p">(</span><span class="n">known_nd_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">xdata</span> <span class="o">=</span> <span class="n">known_nd_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ydata</span> <span class="o">=</span> <span class="n">known_target_points</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">known_nd_data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
                <span class="n">nd_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="o">+</span> <span class="s1">&#39; (const:&#39;</span>
                <span class="o">+</span> <span class="n">nd_labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="o">+</span> <span class="s1">&#39;=</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">known_nd_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">nd_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">target_label</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unknown_nd_data</span><span class="p">,</span> <span class="n">ug_shape</span> <span class="o">=</span> <span class="n">compute_interpolation_grid</span><span class="p">(</span><span class="n">known_nd_data</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">interpolated_error</span> <span class="o">=</span> <span class="n">interpolate_error</span><span class="p">(</span>
            <span class="n">known_nd_data</span><span class="p">,</span> <span class="n">known_target_points</span><span class="p">,</span> <span class="n">unknown_nd_data</span>
        <span class="p">)</span>

        <span class="n">label_fontprop</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">title_fontprop</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1"># label_fontprop = mpl.font_manager.FontProperties(size=8)</span>
        <span class="c1"># title_fontprop = mpl.font_manager.FontProperties(size=10)</span>
        <span class="n">labelkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="n">label_fontprop</span><span class="p">)</span>
        <span class="n">titlekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fontproperties</span><span class="o">=</span><span class="n">title_fontprop</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">plot_surface3d</span><span class="p">(</span>
            <span class="n">unknown_nd_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ug_shape</span><span class="p">),</span>
            <span class="n">unknown_nd_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ug_shape</span><span class="p">),</span>
            <span class="n">interpolated_error</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ug_shape</span><span class="p">),</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">nd_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">nd_labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">zlabel</span><span class="o">=</span><span class="n">target_label</span><span class="p">,</span>
            <span class="n">labelkw</span><span class="o">=</span><span class="n">labelkw</span><span class="p">,</span>
            <span class="n">titlekw</span><span class="o">=</span><span class="n">titlekw</span><span class="p">,</span>
            <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span>
            <span class="c1"># cmap=pt.plt.get_cmap(&#39;jet&#39;),</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">),</span>
            <span class="c1"># wire=True,</span>
            <span class="c1"># mode=&#39;wire&#39;,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">contour</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="c1"># mode=&#39;contour&#39;,</span>
            <span class="c1"># norm=pt.mpl.colors.Normalize(0, 1),</span>
            <span class="c1"># shade=False,</span>
            <span class="c1"># dark=False,</span>
        <span class="p">)</span>
        <span class="c1"># ax.scatter(known_nd_data.T[0], known_nd_data.T[1], known_target_points, s=100, c=pt.YELLOW)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">known_nd_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">known_nd_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">known_target_points</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">YELLOW</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
        <span class="c1"># given_data_dims = [0]</span>
        <span class="c1"># assert len(given_data_dims) == 1, &#39;can only plot 1 given data dim&#39;</span>
        <span class="c1"># xdim = given_data_dims[0]</span>
        <span class="c1"># xdim = 0</span>
        <span class="c1"># ydim = (xdim + 1) % (len(known_nd_data.T))</span>
        <span class="c1"># known_nd_min = known_nd_data.min(axis=0)</span>
        <span class="c1"># known_nd_max = known_nd_data.max(axis=0)</span>
        <span class="c1"># xmin, xmax = known_nd_min[xdim], known_nd_max[xdim]</span>
        <span class="c1"># ymin, ymax = known_nd_min[ydim], known_nd_max[ydim]</span>
        <span class="c1"># zmin, zmax = known_target_points.min(), known_target_points.max()</span>

        <span class="c1"># # ax.set_xlim(xmin, xmax * 1.05)</span>
        <span class="c1"># # ax.set_ylim(ymin, ymax * 1.05)</span>
        <span class="c1"># # ax.set_zlim(zmin, zmax * 1.05)</span>
        <span class="c1"># # ax.set_xlim(0, xmax + 1)</span>
        <span class="c1"># # ax.set_ylim(0, ymax + 1)</span>
        <span class="c1"># # ax.set_zlim(0, zmax + 1)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_zticklabels</span><span class="p">():</span>
            <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="c1"># import matplotlib.ticker as mtick</span>
        <span class="c1"># ax.zaxis.set_major_formatter(mtick.FormatStrFormatter(&#39;%.2f&#39;))</span>
        <span class="c1"># ax.zaxis.set_major_formatter(mtick.FormatStrFormatter(&#39;%d&#39;))</span>
        <span class="c1"># ax.xaxis.set_major_formatter(mtick.FormatStrFormatter(&#39;%d&#39;))</span>
        <span class="c1"># ax.yaxis.set_major_formatter(mtick.FormatStrFormatter(&#39;%d&#39;))</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="draw_timedelta_pie"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.draw_timedelta_pie">[docs]</a><span class="k">def</span> <span class="nf">draw_timedelta_pie</span><span class="p">(</span><span class="n">timedeltas</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        timedeltas (list):</span>
<span class="sd">        bins (None): (default = None)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --exec-draw_timedelta_pie --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; timedeltas = np.array([    1.,    14.,    17.,    34.,     4.,    36.,    34.,     2.,</span>
<span class="sd">        ...                         3268.,    34., np.nan,    33.,     5.,     2.,    16.,     5.,</span>
<span class="sd">        ...                           35.,    64.,   299.,    35.,     2.,     5.,    34.,    12.,</span>
<span class="sd">        ...                            1.,     8.,     6.,     7.,    11.,     5.,    46.,    47.,</span>
<span class="sd">        ...                           22.,     3.,  np.nan,    11.], dtype=np.float64) ** 2</span>
<span class="sd">        &gt;&gt;&gt; bins = None</span>
<span class="sd">        &gt;&gt;&gt; result = draw_timedelta_pie(timedeltas, bins)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">datetime</span>

    <span class="n">xdata</span> <span class="o">=</span> <span class="n">timedeltas</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">timedeltas</span><span class="p">)]</span>
    <span class="n">numnan</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">timedeltas</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
    <span class="n">max_time</span> <span class="o">=</span> <span class="n">xdata</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">bins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">356</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span>
            <span class="c1"># np.inf,</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">356</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span> <span class="n">max_time</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">bins</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">timedelta_strs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">get_timedelta_str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">b</span><span class="p">),</span> <span class="n">exclude_zeros</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bins</span>
    <span class="p">]</span>
    <span class="n">bin_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">ll</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="n">h</span> <span class="k">for</span> <span class="n">ll</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">ut</span><span class="o">.</span><span class="n">iter_window</span><span class="p">(</span><span class="n">timedelta_strs</span><span class="p">)]</span>
    <span class="n">bin_labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&gt; 1 year&#39;</span>
    <span class="n">bin_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&lt; 1 minute&#39;</span>

    <span class="n">WITH_NAN</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">WITH_NAN</span><span class="p">:</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="p">[</span><span class="n">numnan</span><span class="p">])</span>
        <span class="n">bin_labels</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;nan&#39;</span><span class="p">]</span>

    <span class="c1"># Convert to percent</span>
    <span class="n">fnum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">fnum</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ensure_fnum</span><span class="p">(</span><span class="n">fnum</span><span class="p">)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">)</span>
    <span class="n">bin_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">distinct_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_labels</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">WITH_NAN</span><span class="p">:</span>
        <span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">GRAY</span>
    <span class="c1"># xints = np.arange(len(bin_labels))</span>

    <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">freq</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">masked_freq</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">masked_freq</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">masked_lbls</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">bin_labels</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
    <span class="n">masked_colors</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
    <span class="n">explode</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">masked_freq</span><span class="p">)</span>
    <span class="n">masked_percent</span> <span class="o">=</span> <span class="n">masked_freq</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">size</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span>
        <span class="n">masked_percent</span><span class="p">,</span>
        <span class="n">explode</span><span class="o">=</span><span class="n">explode</span><span class="p">,</span>
        <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.1f%%</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">masked_lbls</span><span class="p">,</span>
        <span class="n">colors</span><span class="o">=</span><span class="n">masked_colors</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># ax = pt.gca()</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">size=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">size</span><span class="p">,))</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="word_histogram2"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.word_histogram2">[docs]</a><span class="k">def</span> <span class="nf">word_histogram2</span><span class="p">(</span><span class="n">text_list</span><span class="p">,</span> <span class="n">weight_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        text_list (list):</span>

<span class="sd">    References:</span>
<span class="sd">        stackoverflow.com/questions/17430105/autofmt-xdate-deletes-x-axis-labels-of-all-subplots</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --exec-word_histogram2 --show --lightbg</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; text_list = []</span>
<span class="sd">        &gt;&gt;&gt; item_list = text_list = [&#39;spam&#39;, &#39;eggs&#39;, &#39;ham&#39;, &#39;jam&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;eggs&#39;, &#39;spam&#39;]</span>
<span class="sd">        &gt;&gt;&gt; weight_list = None</span>
<span class="sd">        &gt;&gt;&gt; #weight_list = [.1, .2, .3, .4, .5, .5, .4, .3, .1]</span>
<span class="sd">        &gt;&gt;&gt; #text_list = [x.strip() for x in ut.lorium_ipsum().split()]</span>
<span class="sd">        &gt;&gt;&gt; result = word_histogram2(text_list, weight_list)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">text_hist</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_hist</span><span class="p">(</span><span class="n">text_list</span><span class="p">,</span> <span class="n">weight_list</span><span class="o">=</span><span class="n">weight_list</span><span class="p">)</span>
    <span class="n">text_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">text_hist</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">sortx</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">list_argsort</span><span class="p">(</span><span class="n">text_vals</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">bin_labels</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">text_hist</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">sortx</span><span class="p">)</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">text_vals</span><span class="p">,</span> <span class="n">sortx</span><span class="p">))</span>
    <span class="n">xints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_labels</span><span class="p">))</span>

    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.95</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">freq_max</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">freq_max</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">color</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;inferno&#39;</span><span class="p">)((</span><span class="n">freq</span> <span class="o">/</span> <span class="n">freq_max</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span> <span class="o">+</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">multi_plot</span><span class="p">(</span>
        <span class="n">xints</span><span class="p">,</span>
        <span class="p">[</span><span class="n">freq</span><span class="p">],</span>
        <span class="n">xpad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">ypad_high</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="c1"># kind=&#39;plot&#39;,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="c1"># xtick_rotation=90,</span>
        <span class="c1"># num_yticks=ymax + 1,</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="n">bin_labels</span><span class="p">,</span>
        <span class="n">xmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">xmax</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xints</span><span class="p">),</span>
        <span class="n">transpose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Freq&#39;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Word&#39;</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span></div>
    <span class="c1"># ax.autofmt_xdate()</span>
    <span class="c1"># plt.setp(plt.xticks()[1], rotation=30, ha=&#39;right&#39;)</span>
    <span class="c1"># pt.gcf().autofmt_xdate()</span>


<div class="viewcode-block" id="draw_time_histogram"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.draw_time_histogram">[docs]</a><span class="k">def</span> <span class="nf">draw_time_histogram</span><span class="p">(</span><span class="n">unixtime_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">freq</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">unixtime_list</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

    <span class="c1"># meanshift = sklearn.cluster.MeanShift()</span>
    <span class="c1"># meanshift.fit(unixtime_list)</span>

    <span class="n">bin_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">ut</span><span class="o">.</span><span class="n">unixtime_to_datetimeobj</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">]</span>
    <span class="n">xints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_labels</span><span class="p">))</span>
    <span class="n">freq_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)]</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.95</span>

    <span class="c1"># num_yticks = 1 + max([</span>
    <span class="c1">#    _freq.max() if len(_freq) &gt; 0 else 0</span>
    <span class="c1">#    for _freq in freq_list])</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">multi_plot</span><span class="p">(</span>
        <span class="n">xints</span><span class="p">,</span>
        <span class="n">freq_list</span><span class="p">,</span>
        <span class="n">xpad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">ypad_high</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="c1"># kind=&#39;plot&#39;,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">xtick_rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="c1"># num_yticks=num_yticks,</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="n">bin_labels</span><span class="p">,</span>
        <span class="n">xmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">xmax</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xints</span><span class="p">),</span>
        <span class="c1"># transpose=True,</span>
        <span class="c1"># ymax=num_yticks - 1,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Freq&#39;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="draw_histogram"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.draw_histogram">[docs]</a><span class="k">def</span> <span class="nf">draw_histogram</span><span class="p">(</span>
    <span class="n">bin_labels</span><span class="p">,</span>
    <span class="n">bin_values</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Freq&#39;</span><span class="p">,</span>
    <span class="n">xtick_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        bin_labels (?):</span>
<span class="sd">        bin_values (?):</span>
<span class="sd">        xlabel (unicode): (default = u&#39;&#39;)</span>
<span class="sd">        ylabel (unicode): (default = u&#39;Freq&#39;)</span>
<span class="sd">        xtick_rotation (int): (default = 0)</span>
<span class="sd">        transpose (bool): (default = False)</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        fnum, pnum, kind, spread_list, title, titlesize, labelsize,</span>
<span class="sd">        legendsize, ticksize, num_xticks, num_yticks, yticklabels,</span>
<span class="sd">        xticklabels, ytick_rotation, xpad, ypad, xpad_factor, ypad_factor,</span>
<span class="sd">        ypad_high, ypad_low, xpad_high, xpad_low, xscale, yscale, legend_loc,</span>
<span class="sd">        legend_alpha, use_darkbackground, lightbg</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --exec-draw_histogram --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; bin_labels = [&#39;label1&#39;, &#39;label2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; bin_values = [.4, .6]</span>
<span class="sd">        &gt;&gt;&gt; xlabel = &#39;&#39;</span>
<span class="sd">        &gt;&gt;&gt; ylabel = &#39;Freq&#39;</span>
<span class="sd">        &gt;&gt;&gt; xtick_rotation = 0</span>
<span class="sd">        &gt;&gt;&gt; transpose = False  # True</span>
<span class="sd">        &gt;&gt;&gt; kwargs = dict(use_darkbackground=False)</span>
<span class="sd">        &gt;&gt;&gt; result = draw_histogram(bin_labels, bin_values, xlabel, ylabel, xtick_rotation, transpose, **kwargs)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">xints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_labels</span><span class="p">))</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.95</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;autolabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;autolabel&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">multi_plot</span><span class="p">(</span>
        <span class="n">xints</span><span class="p">,</span>
        <span class="p">[</span><span class="n">bin_values</span><span class="p">],</span>
        <span class="n">xpad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">ypad_high</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="c1"># kind=&#39;plot&#39;,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">xtick_rotation</span><span class="o">=</span><span class="n">xtick_rotation</span><span class="p">,</span>
        <span class="c1"># num_yticks=num_yticks,</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="n">bin_labels</span><span class="p">,</span>
        <span class="n">xmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">xmax</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xints</span><span class="p">),</span>
        <span class="n">transpose</span><span class="o">=</span><span class="n">transpose</span><span class="p">,</span>
        <span class="c1"># ymax=num_yticks - 1,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="draw_time_distribution"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.draw_time_distribution">[docs]</a><span class="k">def</span> <span class="nf">draw_time_distribution</span><span class="p">(</span><span class="n">unixtime_list</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unixtime_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">sklearn.neighbors.kde</span> <span class="kn">import</span> <span class="n">KernelDensity</span>

        <span class="n">unixtime_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">unixtime_list</span><span class="p">)</span>
        <span class="c1"># Remove nans from list</span>
        <span class="n">nanflags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">unixtime_arr</span><span class="p">)</span>
        <span class="n">unixtimes</span> <span class="o">=</span> <span class="n">unixtime_arr</span><span class="p">[</span><span class="o">~</span><span class="n">nanflags</span><span class="p">]</span>
        <span class="n">mintime</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">safe_min</span><span class="p">(</span><span class="n">unixtimes</span><span class="p">)</span>
        <span class="n">maxtime</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">safe_max</span><span class="p">(</span><span class="n">unixtimes</span><span class="p">)</span>
        <span class="n">unixtime_domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mintime</span><span class="p">,</span> <span class="n">maxtime</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="c1"># num_nan = sum(nanflags)</span>
        <span class="c1"># num_nonnan = len(unixtimes)</span>
        <span class="c1"># logger.info(&#39;num_nan = %r&#39; % (num_nan,))</span>
        <span class="c1"># logger.info(&#39;num_nonnan = %r&#39; % (num_nonnan,))</span>

        <span class="k">if</span> <span class="n">bw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>  <span class="c1"># NOQA</span>
            <span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>

            <span class="n">day</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span>
            <span class="c1"># bw_low = day</span>
            <span class="c1"># bw_high = (maxtime - mintime) / 10</span>
            <span class="n">grid_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="c1"># &#39;bandwidth&#39;: np.logspace(np.log(bw_low), np.log(bw_high), 30)</span>
                <span class="c1"># &#39;bandwidth&#39;: np.linspace(bw_low, bw_high, 30)</span>
                <span class="s1">&#39;bandwidth&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">day</span> <span class="o">*</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="c1"># searcher = ut.partial(GridSearchCV, n_jobs=7)</span>
            <span class="n">searcher</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">RandomizedSearchCV</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Searching for best bandwidth&#39;</span><span class="p">)</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">searcher</span><span class="p">(</span>
                <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">),</span> <span class="n">grid_params</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">unixtimes</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
            <span class="n">bw</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s1">&#39;bandwidth&#39;</span><span class="p">]</span>
            <span class="c1"># logger.info(&#39;bw = %r&#39; % (bw,))</span>
        <span class="c1"># else:</span>
        <span class="c1">#     # scott_bw = len(unixtimes) ** (-1 / 4)</span>
        <span class="c1">#     # 3 days bandwidth</span>
        <span class="c1">#     bw = 60 * 60 * 24 * 3</span>
        <span class="n">kde</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="n">bw</span><span class="p">)</span>
        <span class="n">kde</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">unixtimes</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
        <span class="n">log_density</span> <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">unixtime_domain</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
        <span class="n">unixtime_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_density</span><span class="p">)</span>
        <span class="n">xdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">ut</span><span class="o">.</span><span class="n">unixtime_to_datetimeobj</span><span class="p">(</span><span class="n">unixtime</span><span class="p">)</span> <span class="k">for</span> <span class="n">unixtime</span> <span class="ow">in</span> <span class="n">unixtime_domain</span><span class="p">]</span>

        <span class="c1"># unixtime_pdf = vt.estimate_pdf(unixtimes)</span>
        <span class="c1"># unixtime_density = unixtime_pdf.evaluate(unixtime_domain)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unixtime_density</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">xdata</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">fnum</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ensure_fnum</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">plot_probabilities</span><span class="p">(</span>
        <span class="p">[</span><span class="n">unixtime_density</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
        <span class="n">xdata</span><span class="o">=</span><span class="n">xdata</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">use_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span>
        <span class="n">remove_yticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="c1"># freq, bins = np.histogram(unixtimes, bins=30, normed=True)</span>
        <span class="n">freq</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">unixtimes</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># xints = np.arange(len(bins))</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">multi_plot</span><span class="p">(</span>
            <span class="n">bins</span><span class="p">,</span>
            <span class="p">[</span><span class="n">freq</span><span class="p">],</span>
            <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">bins</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span>
            <span class="n">dark_background</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span></div>
    <span class="c1"># xtick_rotation=30,</span>
    <span class="c1"># num_yticks=num_yticks,</span>
    <span class="c1"># xticklabels=bin_labels,</span>
    <span class="c1"># xmin=-1,</span>
    <span class="c1"># xmax=len(xints),</span>
    <span class="c1"># transpose=True,</span>
    <span class="c1"># ymax=num_yticks - 1,</span>
    <span class="c1"># ylabel=&#39;Freq&#39;,</span>
    <span class="c1"># xlabel=&#39;Time&#39;,</span>
    <span class="c1"># **kwargs)</span>


<div class="viewcode-block" id="wordcloud"><a class="viewcode-back" href="../../../wbia.plottool.html#wbia.plottool.plots.wordcloud">[docs]</a><span class="k">def</span> <span class="nf">wordcloud</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References:</span>
<span class="sd">        bioinfoexpert.com/?p=592</span>
<span class="sd">        sudo pip install git+git://github.com/amueller/word_cloud.git</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str or dict): raw text or dictionary of frequencies</span>
<span class="sd">        fnum (int):  figure number(default = None)</span>
<span class="sd">        pnum (tuple):  plot number(default = None)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.plottool.plots --exec-wordcloud --show</span>
<span class="sd">        python -m wbia.plottool.plots --exec-wordcloud --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.plottool.plots import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; text = &#39;&#39;&#39;</span>
<span class="sd">                Normally, Frost-Breath-type cards are only good in aggressive decks,</span>
<span class="sd">                but add an Eldrazi Scion into the mix and that all changes. I&#39;m not</span>
<span class="sd">                adverse to playing a card that ramps my mana, can trade for an x/1, and</span>
<span class="sd">                does so while keeping me alive. I still would rather be beating down if</span>
<span class="sd">                I&#39;m including this in my deck, but I think it does enough different</span>
<span class="sd">                things at a good rate that you are more likely to play it than not.</span>
<span class="sd">                Cards that swing a race this drastically are situationally awesome, and</span>
<span class="sd">                getting the Eldrazi Scion goes a long way toward mitigating the cost of</span>
<span class="sd">                drawing this when you aren&#39;t in a race (which is the reason</span>
<span class="sd">                non-aggressive decks tend to avoid this effect).</span>
<span class="sd">            &#39;&#39;&#39;</span>
<span class="sd">        &gt;&gt;&gt; fnum = None</span>
<span class="sd">        &gt;&gt;&gt; pnum = None</span>
<span class="sd">        &gt;&gt;&gt; result = wordcloud(text, fnum, pnum)</span>
<span class="sd">        &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>
    <span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fnum</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ensure_fnum</span><span class="p">(</span><span class="n">fnum</span><span class="p">)</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">fnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;dont pass ax with fnum&#39;</span>
        <span class="k">assert</span> <span class="n">pnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;dont pass ax with pnum&#39;</span>

    <span class="n">background_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span> <span class="k">if</span> <span class="n">is_default_dark_bg</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;white&#39;</span>
    <span class="c1"># font_path = &#39;/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf&#39;</span>
    <span class="c1"># font_path = &#39;/usr/share/fonts/truetype/freefont/FreeMono.ttf&#39;</span>
    <span class="n">font_path</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truepath</span><span class="p">(</span><span class="s1">&#39;~/.local/share/fonts/Inconsolata-Regular.ttf&#39;</span><span class="p">)</span>
    <span class="n">font_path</span> <span class="o">=</span> <span class="s1">&#39;/usr/share/fonts/opentype/Inconsolata.otf&#39;</span>
    <span class="c1"># /home/joncrall/.local/share/fonts/Inconsolata-Regular.ttf</span>

    <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">exists</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">font_path</span><span class="p">):</span>
        <span class="n">font_path</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">colormap</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">interpolated_colormap</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">PINK</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">),</span>
            <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">ORANGE</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
            <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">GREEN</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">),</span>
            <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">TRUE_BLUE</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
            <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">size</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">_wc</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span>
            <span class="n">font_path</span><span class="o">=</span><span class="n">font_path</span><span class="p">,</span>
            <span class="n">background_color</span><span class="o">=</span><span class="n">background_color</span><span class="p">,</span>
            <span class="c1"># min_font_size=12,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="c1"># relative_scaling=.8,</span>
            <span class="c1"># colormap=&#39;rainbow&#39;</span>
            <span class="n">colormap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># wordcloud = _wc.fit_words(list(text.items()))</span>
            <span class="n">wordcloud</span> <span class="o">=</span> <span class="n">_wc</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wordcloud</span> <span class="o">=</span> <span class="n">_wc</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">imshow_null</span><span class="p">(</span><span class="s1">&#39;NO WORDCLOUD DATA&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Wild Me.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>