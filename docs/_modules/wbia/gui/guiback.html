
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>wbia.gui.guiback &#8212; wbia 3.3.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for wbia.gui.guiback</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module controls the GUI backend.  It is the layer between the GUI frontend</span>
<span class="sd">(newgui.py) and the IBEIS controller.  All the functionality of the nonvisual</span>
<span class="sd">gui components is written or called from here</span>

<span class="sd">TODO:</span>
<span class="sd">    open_database should not allow you to open subfolders</span>

<span class="sd">    python -m utool.util_inspect check_module_usage --pat=&quot;guiback.py&quot;</span>


<span class="sd">Notes:</span>
<span class="sd">    LAYOUT TERMS;</span>
<span class="sd">        Margins / Content Margins;</span>
<span class="sd">           - space around the widgets in the layout</span>
<span class="sd">        Spacing</span>
<span class="sd">           - space between widges in the layout</span>
<span class="sd">        Stretch</span>
<span class="sd">           - relative size ratio vector (1 component for each widget)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">six</span>  <span class="c1"># NOQA</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">traceback</span>  <span class="c1"># NOQA</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
<span class="kn">import</span> <span class="nn">ubelt</span> <span class="k">as</span> <span class="nn">ub</span>
<span class="kn">import</span> <span class="nn">wbia.guitool</span> <span class="k">as</span> <span class="nn">gt</span>
<span class="kn">from</span> <span class="nn">wbia.guitool</span> <span class="kn">import</span> <span class="n">slot_</span><span class="p">,</span> <span class="n">signal_</span><span class="p">,</span> <span class="n">cast_from_qt</span>
<span class="kn">from</span> <span class="nn">wbia.guitool.__PYQT__</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWidgets</span>
<span class="kn">from</span> <span class="nn">wbia</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">const</span>
<span class="kn">from</span> <span class="nn">wbia.other</span> <span class="kn">import</span> <span class="n">ibsfuncs</span>
<span class="kn">from</span> <span class="nn">wbia</span> <span class="kn">import</span> <span class="n">sysres</span>
<span class="kn">from</span> <span class="nn">wbia</span> <span class="kn">import</span> <span class="n">viz</span>
<span class="kn">from</span> <span class="nn">wbia.control</span> <span class="kn">import</span> <span class="n">IBEISControl</span>
<span class="kn">from</span> <span class="nn">wbia.gui</span> <span class="kn">import</span> <span class="n">clock_offset_gui</span>
<span class="kn">from</span> <span class="nn">wbia.gui</span> <span class="kn">import</span> <span class="n">guiexcept</span>
<span class="kn">from</span> <span class="nn">wbia.gui</span> <span class="kn">import</span> <span class="n">guiheaders</span> <span class="k">as</span> <span class="n">gh</span>
<span class="kn">from</span> <span class="nn">wbia.gui</span> <span class="kn">import</span> <span class="n">newgui</span>
<span class="kn">from</span> <span class="nn">wbia.viz</span> <span class="kn">import</span> <span class="n">interact</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">exists</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">normpath</span>
<span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="kn">import</span> <span class="n">fig_presenter</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">zip</span>

<span class="p">(</span><span class="nb">print</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">inject2</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;[back]&#39;</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;wbia&#39;</span><span class="p">)</span>


<span class="n">VERBOSE</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">VERBOSE</span>


<div class="viewcode-block" id="backreport"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.backreport">[docs]</a><span class="k">def</span> <span class="nf">backreport</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    reports errors on backend functions</span>
<span class="sd">    should be around every function by default</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">backreport_wrapper</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;handling user cancel&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="c1"># error_msg = &quot;Error caught while performing function. \n %r&quot; % ex</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;Error: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ex</span><span class="p">,)</span>
            <span class="kn">import</span> <span class="nn">traceback</span>  <span class="c1"># NOQA</span>

            <span class="n">detailed_msg</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
            <span class="n">gt</span><span class="o">.</span><span class="n">msgbox</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Error Catch!&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">error_msg</span><span class="p">,</span> <span class="n">detailed_msg</span><span class="o">=</span><span class="n">detailed_msg</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">backreport_wrapper</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">preserve_sig</span><span class="p">(</span><span class="n">backreport_wrapper</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">backreport_wrapper</span></div>


<div class="viewcode-block" id="backblock"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.backblock">[docs]</a><span class="k">def</span> <span class="nf">backblock</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;BLOCKING DECORATOR</span>
<span class="sd">    TODO: This decorator has to be specific to either front or back. Is there a</span>
<span class="sd">    way to make it more general?</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="c1"># @gt.checks_qt_error</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">bacblock_wrapper</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">_wasBlocked_</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># error_msg = &quot;Error caught while performing function. \n %r&quot; % ex</span>
            <span class="c1"># gt.msgbox(title=&quot;Error Catch!&quot;, msg=error_msg)</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="n">_wasBlocked_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">bacblock_wrapper</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">preserve_sig</span><span class="p">(</span><span class="n">bacblock_wrapper</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bacblock_wrapper</span></div>


<div class="viewcode-block" id="blocking_slot"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.blocking_slot">[docs]</a><span class="k">def</span> <span class="nf">blocking_slot</span><span class="p">(</span><span class="o">*</span><span class="n">types_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A blocking slot accepts the types which are passed to QtCore.pyqtSlot.</span>
<span class="sd">    In addition it also causes the gui frontend to block signals while</span>
<span class="sd">    the decorated function is processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">wrap_bslot</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="c1"># @slot_(*types_)</span>
        <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="o">*</span><span class="n">types_</span><span class="p">)</span>
        <span class="nd">@backblock</span>
        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapped_bslot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">wrapped_bslot</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">preserve_sig</span><span class="p">(</span><span class="n">wrapped_bslot</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapped_bslot</span>

    <span class="k">return</span> <span class="n">wrap_bslot</span></div>


<div class="viewcode-block" id="CustomAnnotCfgSelector"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector">[docs]</a><span class="k">class</span> <span class="nc">CustomAnnotCfgSelector</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">GuitoolWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.gui.guiback CustomAnnotCfgSelector --show</span>
<span class="sd">        python -m wbia.gui.guiback CustomAnnotCfgSelector --show --db PZ_MTEST</span>
<span class="sd">        python -m wbia.gui.guiback CustomAnnotCfgSelector --show --debugwidget</span>
<span class="sd">        python -m wbia.gui.guiback show_advanced_id_interface --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia</span>
<span class="sd">        &gt;&gt;&gt; gt.ensure_qtapp()</span>
<span class="sd">        &gt;&gt;&gt; ibs = wbia.opendb(defaultdb=&#39;testdb1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; self = CustomAnnotCfgSelector(ibs)</span>
<span class="sd">        &gt;&gt;&gt; rect = gt.QtWidgets.QDesktopWidget().availableGeometry(screen=0)</span>
<span class="sd">        &gt;&gt;&gt; self.move(rect.x(), rect.y())</span>
<span class="sd">        &gt;&gt;&gt; self.show()</span>
<span class="sd">        &gt;&gt;&gt; self.apply_new_config()</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; gt.qtapp_loop(qwin=self, freq=10)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">wbia.expt</span> <span class="kn">import</span> <span class="n">annotation_configs</span>
        <span class="kn">from</span> <span class="nn">wbia</span> <span class="kn">import</span> <span class="n">dtool</span>
        <span class="kn">from</span> <span class="nn">wbia.guitool</span> <span class="kn">import</span> <span class="n">PrefWidget2</span>
        <span class="kn">from</span> <span class="nn">wbia.guitool.__PYQT__.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">CustomAnnotCfgSelector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qaids</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept_flag</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">class</span> <span class="nc">TmpAnnotConfig</span><span class="p">(</span><span class="n">dtool</span><span class="o">.</span><span class="n">Config</span><span class="p">):</span>
            <span class="n">_param_info_list</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">annotation_configs</span><span class="o">.</span><span class="n">INDEPENDENT_DEFAULTS_PARAM_INFO</span>
                <span class="o">+</span> <span class="n">annotation_configs</span><span class="o">.</span><span class="n">INTRAGROUP_DEFAULTS_PARAM_INFO</span>
                <span class="o">+</span> <span class="n">annotation_configs</span><span class="o">.</span><span class="n">SAMPLE_DEFAULTS_PARAM_INFO</span>
                <span class="o">+</span> <span class="n">annotation_configs</span><span class="o">.</span><span class="n">SUBINDEX_DEFAULTS_PARAM_INFO</span>
            <span class="p">)</span>

        <span class="k">class</span> <span class="nc">TmpPipelineConfig</span><span class="p">(</span><span class="n">dtool</span><span class="o">.</span><span class="n">Config</span><span class="p">):</span>
            <span class="n">_param_info_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">nn_cfg</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">min_</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">none_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span>
                    <span class="s1">&#39;Knorm&#39;</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">nn_cfg</span><span class="o">.</span><span class="n">Knorm</span><span class="p">,</span> <span class="n">min_</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">none_ok</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">),</span>
                <span class="c1"># ibs.cfg.query_cfg.nn_cfg.lookup_paraminfo(&#39;Knorm&#39;),</span>
                <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">nnweight_cfg</span><span class="o">.</span><span class="n">lookup_paraminfo</span><span class="p">(</span><span class="s1">&#39;normalizer_rule&#39;</span><span class="p">),</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span>
                    <span class="s1">&#39;fgw_thresh&#39;</span><span class="p">,</span>
                    <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">flann_cfg</span><span class="o">.</span><span class="n">fgw_thresh</span><span class="p">,</span>
                    <span class="n">type_</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                    <span class="n">min_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">max_</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span>
                    <span class="s1">&#39;query_rotation_heuristic&#39;</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">query_rotation_heuristic</span>
                <span class="p">),</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span>
                    <span class="s1">&#39;minscale_thresh&#39;</span><span class="p">,</span>
                    <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">flann_cfg</span><span class="o">.</span><span class="n">minscale_thresh</span><span class="p">,</span>
                    <span class="n">type_</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span>
                    <span class="s1">&#39;maxscale_thresh&#39;</span><span class="p">,</span>
                    <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">flann_cfg</span><span class="o">.</span><span class="n">maxscale_thresh</span><span class="p">,</span>
                    <span class="n">type_</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">nnweight_cfg</span><span class="o">.</span><span class="n">lookup_paraminfo</span><span class="p">(</span><span class="s1">&#39;can_match_samename&#39;</span><span class="p">),</span>
                <span class="c1"># ut.ParamInfo(&#39;normalizer_rule&#39;, ibs.cfg.query_cfg.nnweight_cfg.normalizer_rule),</span>
                <span class="c1"># ut.ParamInfo(&#39;AI&#39;, True),</span>
            <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qcfg</span> <span class="o">=</span> <span class="n">TmpAnnotConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcfg</span> <span class="o">=</span> <span class="n">TmpAnnotConfig</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pcfg</span> <span class="o">=</span> <span class="n">TmpPipelineConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span> <span class="o">=</span> <span class="n">dtool</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;filter_reviewed&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;ranks_top&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;filter_true_matches&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_cfg</span> <span class="o">=</span> <span class="n">dtool</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
            <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ibs</span><span class="o">.</span><span class="n">parse_annot_config_stats_filter_kws</span><span class="p">()}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exemplar_cfg</span> <span class="o">=</span> <span class="n">dtool</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="c1"># &#39;imgsetid&#39;: None,</span>
                <span class="s1">&#39;exemplars_per_view&#39;</span><span class="p">:</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">exemplars_per_view</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">info_cfg</span><span class="p">[</span><span class="s1">&#39;species_hist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_cfg</span><span class="p">[</span><span class="s1">&#39;per_vp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_cfg</span><span class="p">[</span><span class="s1">&#39;per_qual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_cfg</span><span class="p">[</span><span class="s1">&#39;hashid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_cfg</span><span class="p">[</span><span class="s1">&#39;per_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_cfg</span><span class="p">[</span><span class="s1">&#39;hashid_visual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_cfg</span><span class="p">[</span><span class="s1">&#39;hashid_uuid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_cfg</span><span class="p">[</span><span class="s1">&#39;per_multiple&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">qcfg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcfg</span><span class="p">]:</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;minqual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;good&#39;</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;reviewed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;multiple&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># cfg[&#39;min_pername&#39;] = 0</span>
            <span class="c1"># from wbia.other import ibsfuncs</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_primary_database_species</span><span class="p">()</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;require_viewpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">get_primary_species_viewpoint</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">])</span>
            <span class="c1"># &#39;right,frontright,backright&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Custom Annot Selector&#39;</span><span class="p">)</span>

        <span class="c1"># cfg_size_policy = (QtWidgets.QSizePolicy.Expanding, QtWidgets.QSizePolicy.Expanding)</span>

        <span class="k">def</span> <span class="nf">new_confg_widget</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">user_mode</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cfg_widget</span> <span class="o">=</span> <span class="n">PrefWidget2</span><span class="o">.</span><span class="n">EditConfigWidget</span><span class="p">(</span>
                <span class="n">config</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">user_mode</span><span class="o">=</span><span class="n">user_mode</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="n">changed</span>
            <span class="p">)</span>
            <span class="c1"># cfg_widget.setSizePolicy(*cfg_size_policy)</span>
            <span class="k">return</span> <span class="n">cfg_widget</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">editQueryConfig</span> <span class="o">=</span> <span class="n">new_confg_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qcfg</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_cfg_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editDataConfig</span> <span class="o">=</span> <span class="n">new_confg_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dcfg</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_cfg_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editPipeConfig</span> <span class="o">=</span> <span class="n">new_confg_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcfg</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_cfg_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editReviewConfig</span> <span class="o">=</span> <span class="n">new_confg_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editInfoConfig</span> <span class="o">=</span> <span class="n">new_confg_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_cfg</span><span class="p">)</span>
        <span class="c1"># self.editExemplarConfig = new_confg_widget(self.exemplar_cfg, changed=self.on_cfg_changed)</span>

        <span class="n">tabwgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewTabWidget</span><span class="p">(</span><span class="n">verticalStretch</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tab1</span> <span class="o">=</span> <span class="n">tabwgt</span><span class="o">.</span><span class="n">addNewTab</span><span class="p">(</span><span class="s1">&#39;Custom Query&#39;</span><span class="p">)</span>
        <span class="n">tab2</span> <span class="o">=</span> <span class="n">tabwgt</span><span class="o">.</span><span class="n">addNewTab</span><span class="p">(</span><span class="s1">&#39;Saved Queries&#39;</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_queries</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">()</span>
        <span class="n">table</span><span class="o">.</span><span class="n">doubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_table_doubleclick</span><span class="p">)</span>
        <span class="n">tab2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saved_queries</span><span class="p">)</span>

        <span class="n">splitter</span> <span class="o">=</span> <span class="n">tab1</span><span class="o">.</span><span class="n">addNewSplitter</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">)</span>

        <span class="n">acfg_hframe</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">newWidget</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>

        <span class="n">query_vframe</span> <span class="o">=</span> <span class="n">acfg_hframe</span><span class="o">.</span><span class="n">addNewVWidget</span><span class="p">()</span>
        <span class="n">query_vframe</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Query Config&#39;</span><span class="p">))</span>
        <span class="n">query_vframe</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editQueryConfig</span><span class="p">)</span>

        <span class="n">data_vframe</span> <span class="o">=</span> <span class="n">acfg_hframe</span><span class="o">.</span><span class="n">addNewVWidget</span><span class="p">()</span>
        <span class="n">data_vframe</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Data Config&#39;</span><span class="p">))</span>
        <span class="n">data_vframe</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editDataConfig</span><span class="p">)</span>
        <span class="c1"># data_vframe.setVisible(False)</span>

        <span class="n">info_vframe</span> <span class="o">=</span> <span class="n">acfg_hframe</span><span class="o">.</span><span class="n">addNewVWidget</span><span class="p">()</span>
        <span class="n">info_vframe</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Exemplar Config&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editExemplarConfig</span> <span class="o">=</span> <span class="n">info_vframe</span><span class="o">.</span><span class="n">addNewEditConfigWidget</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exemplar_cfg</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_cfg_changed</span>
        <span class="p">)</span>
        <span class="n">info_vframe</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Set Exemplars&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_exemplars</span><span class="p">)</span>

        <span class="n">pcfg_hframe</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">newWidget</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="n">pipe_vframe</span> <span class="o">=</span> <span class="n">pcfg_hframe</span><span class="o">.</span><span class="n">addNewVWidget</span><span class="p">()</span>
        <span class="n">pipe_vframe</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Pipeline Config&#39;</span><span class="p">)</span>
        <span class="n">pipe_vframe</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editPipeConfig</span><span class="p">)</span>

        <span class="n">review_vframe</span> <span class="o">=</span> <span class="n">pcfg_hframe</span><span class="o">.</span><span class="n">addNewVWidget</span><span class="p">()</span>
        <span class="n">review_vframe</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Review Config&#39;</span><span class="p">)</span>
        <span class="n">review_vframe</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editReviewConfig</span><span class="p">)</span>

        <span class="n">info_vframe</span> <span class="o">=</span> <span class="n">pcfg_hframe</span><span class="o">.</span><span class="n">addNewVWidget</span><span class="p">()</span>
        <span class="n">info_vframe</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Info Config&#39;</span><span class="p">)</span>
        <span class="n">info_vframe</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editInfoConfig</span><span class="p">)</span>

        <span class="c1"># stats_vwidget = splitter.newWidget(orientation=Qt.Vertical)</span>
        <span class="n">stats_vwidget</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">newWidget</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">,</span> <span class="n">verticalStretch</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">stats_vwidget</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Expanded Annot Info (Info Config Changes Display)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qstats</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTextEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qstats</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qstats</span><span class="o">.</span><span class="n">setWordWrapMode</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTextOption</span><span class="o">.</span><span class="n">WrapAnywhere</span><span class="p">)</span>
        <span class="n">stats_vwidget</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qstats</span><span class="p">)</span>
        <span class="c1"># Hack a copy for tab2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qstats2</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTextEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qstats2</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qstats2</span><span class="o">.</span><span class="n">setWordWrapMode</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTextOption</span><span class="o">.</span><span class="n">WrapAnywhere</span><span class="p">)</span>
        <span class="n">tab2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qstats2</span><span class="p">)</span>
        <span class="c1"># self.layout().addWidget(self.qstats)</span>

        <span class="n">button_bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewHWidget</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_button</span> <span class="o">=</span> <span class="n">button_bar</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span>
            <span class="s1">&#39;Apply New Config&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_new_config</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_button</span> <span class="o">=</span> <span class="n">button_bar</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span>
            <span class="s1">&#39;Execute New Query&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_bc_button</span> <span class="o">=</span> <span class="n">button_bar</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span>
            <span class="s1">&#39;Load Cached Query&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load_bc</span>
        <span class="p">)</span>

        <span class="c1"># button_bar.addNewButton(&#39;TestLog&#39;, pressed=self.log_query)</span>
        <span class="n">button_bar</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Embed&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">)</span>
        <span class="c1"># testlog = QtWidgets.QPushButton(&#39;TestLog&#39;)</span>
        <span class="c1"># testlog.pressed.connect(self.log_query)</span>
        <span class="c1"># button_bar.addWidget(testlog)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewProgressBar</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">fix_child_attr_heirarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;setSpacing&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">fix_child_attr_heirarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;setMargin&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg_needs_update</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bc_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_bc_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_bc_button</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># layout.addWidget(self.update_button, 3, 2, 1, 1)</span>
        <span class="c1"># layout.addWidget(self.editQueryConfig)</span>
        <span class="c1"># layout.addWidget(self.editDataConfig)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">populate_table</span><span class="p">()</span>

<div class="viewcode-block" id="CustomAnnotCfgSelector.set_exemplars"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.set_exemplars">[docs]</a>    <span class="k">def</span> <span class="nf">set_exemplars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;set exemplars&#39;</span><span class="p">)</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;self.exemplar_cfg = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exemplar_cfg</span><span class="p">,))</span>
        <span class="k">with</span> <span class="n">gt</span><span class="o">.</span><span class="n">GuiProgContext</span><span class="p">(</span><span class="s1">&#39;Querying&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>  <span class="c1"># NOQA</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">set_exemplars_from_quality_and_viewpoint</span><span class="p">(</span>
                <span class="n">prog_hook</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">prog_hook</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">exemplar_cfg</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.onstart"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.onstart">[docs]</a>    <span class="k">def</span> <span class="nf">onstart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_queries</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_previous_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saved_queries</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.sizeHint"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.sizeHint">[docs]</a>    <span class="k">def</span> <span class="nf">sizeHint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">900</span><span class="p">,</span> <span class="mi">960</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.embed"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.embed">[docs]</a>    <span class="k">def</span> <span class="nf">embed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">utool</span>

        <span class="n">utool</span><span class="o">.</span><span class="n">embed</span><span class="p">()</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.make_commandline_str"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.make_commandline_str">[docs]</a>    <span class="k">def</span> <span class="nf">make_commandline_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">wbia.expt</span> <span class="kn">import</span> <span class="n">experiment_helpers</span>
        <span class="kn">from</span> <span class="nn">wbia.expt</span> <span class="kn">import</span> <span class="n">annotation_configs</span>

        <span class="n">cfgdict_list</span><span class="p">,</span> <span class="n">pipecfg_list</span> <span class="o">=</span> <span class="n">experiment_helpers</span><span class="o">.</span><span class="n">get_pipecfg_list</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;default:&#39;</span><span class="p">],</span> <span class="n">ibs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ibs</span>
        <span class="p">)</span>
        <span class="n">default_pcfg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pipecfg_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parse_items</span><span class="p">())</span>
        <span class="c1"># Hackish ways to get cmdline string</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_cfg_lbl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcfg</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">default_cfg</span><span class="o">=</span><span class="n">default_pcfg</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;default&#39;</span>
            <span class="o">+</span> <span class="n">annotation_configs</span><span class="o">.</span><span class="n">get_varied_acfg_labels</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">acfg</span><span class="p">,</span> <span class="n">annotation_configs</span><span class="o">.</span><span class="n">default</span><span class="p">]</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">dbdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_dbdir</span><span class="p">()</span>
        <span class="n">wbia_part</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;wbia&#39;</span><span class="p">]</span>
        <span class="n">data_part</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--dbdir&#39;</span><span class="p">,</span> <span class="n">dbdir</span><span class="p">,</span> <span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span>
        <span class="n">cmd_parts</span> <span class="o">=</span> <span class="n">wbia_part</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;draw_rank_cmc&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data_part</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;--show&#39;</span><span class="p">]</span>
        <span class="n">cmdstr</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd_parts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cmdstr</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.populate_table"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.populate_table">[docs]</a>    <span class="k">def</span> <span class="nf">populate_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># data = {&#39;col1&#39;: [&#39;1&#39;,&#39;2&#39;,&#39;3&#39;], &#39;col2&#39;:[&#39;4&#39;,&#39;5&#39;,&#39;6&#39;], &#39;col3&#39;:[&#39;7&#39;,&#39;8&#39;,&#39;9&#39;]}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Updating saved query table&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">wbia.guitool.__PYQT__.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_saved_queries</span><span class="p">()</span>
        <span class="n">horHeaders</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">,</span> <span class="s1">&#39;num_qaids&#39;</span><span class="p">,</span> <span class="s1">&#39;num_daids&#39;</span><span class="p">,</span> <span class="s1">&#39;has_bc&#39;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_queries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_queries</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">horHeaders</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Populating table&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ut</span><span class="o">.</span><span class="n">ProgIter</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">horHeaders</span><span class="p">),</span> <span class="n">lbl</span><span class="o">=</span><span class="s1">&#39;pop table&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saved_queries</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
                <span class="n">newitem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">newitem</span><span class="p">)</span>
                <span class="n">newitem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">newitem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEditable</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span><span class="n">horHeaders</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
        <span class="n">table</span><span class="o">.</span><span class="n">resizeRowsToContents</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Finished populating table&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.on_cfg_changed"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.on_cfg_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_cfg_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg_needs_update</span> <span class="o">=</span> <span class="kc">True</span></div>
        <span class="c1"># logger.info(&#39;detected change&#39;)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">acfg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">acfg</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;qcfg&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcfg</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span> <span class="s1">&#39;dcfg&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcfg</span><span class="o">.</span><span class="n">asdict</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">acfg</span>

<div class="viewcode-block" id="CustomAnnotCfgSelector.expt_query_dir"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.expt_query_dir">[docs]</a>    <span class="k">def</span> <span class="nf">expt_query_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># dbdir = self.ibs.get_dbdir()</span>
        <span class="n">dbdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_dbdir</span><span class="p">()</span>
        <span class="n">expt_dir</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">unixjoin</span><span class="p">(</span><span class="n">dbdir</span><span class="p">,</span> <span class="s1">&#39;SPECIAL_GGR_EXPT_LOGS&#39;</span><span class="p">))</span>
        <span class="n">expt_query_dir</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">unixjoin</span><span class="p">(</span><span class="n">expt_dir</span><span class="p">,</span> <span class="s1">&#39;saved_queries&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">expt_query_dir</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.apply_new_config"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.apply_new_config">[docs]</a>    <span class="k">def</span> <span class="nf">apply_new_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;apply_new_config&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">gt</span><span class="o">.</span><span class="n">GuiProgContext</span><span class="p">(</span><span class="s1">&#39;Updating&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>  <span class="c1"># NOQA</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_total</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">ibs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span>
            <span class="c1"># Discard the loaded query info</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">query_info</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">sample_annots_general</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">qcfg</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">sample_annots_general</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dcfg</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_config_info</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execute_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Execute New Query&#39;</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;apply_new_config is done&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg_needs_update</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bc_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_bc_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_bc_button</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.update_config_info"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.update_config_info">[docs]</a>    <span class="k">def</span> <span class="nf">update_config_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span>
        <span class="kn">from</span> <span class="nn">wbia.algo.Config</span> <span class="kn">import</span> <span class="n">QueryConfig</span>

        <span class="c1"># use defaults instead of back&#39;s ibs.cfg</span>
        <span class="n">query_cfg</span> <span class="o">=</span> <span class="n">QueryConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qreq_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qaids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">daids</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pcfg</span><span class="p">,</span> <span class="n">query_cfg</span><span class="o">=</span><span class="n">query_cfg</span>
        <span class="p">)</span>
        <span class="n">qreq_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qreq_</span>
        <span class="n">stats_dict</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annotconfig_stats</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">daids</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">info_cfg</span><span class="p">)</span>
        <span class="n">cmdstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_commandline_str</span><span class="p">()</span>
        <span class="n">stat_parts</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">filter_Nones</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">cmdstr</span><span class="p">,</span>
                <span class="n">extra</span><span class="p">,</span>
                <span class="s1">&#39;pipe_cfgstr=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qreq_</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">(</span><span class="n">with_data</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">stats_dict</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">stats_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stat_parts</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">stats_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qstats</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="n">stats_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qstats2</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="n">stats_str</span><span class="p">)</span>
        <span class="k">pass</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">expanded_aids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qaids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">daids</span><span class="p">)</span>

<div class="viewcode-block" id="CustomAnnotCfgSelector.get_saved_queries"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.get_saved_queries">[docs]</a>    <span class="k">def</span> <span class="nf">get_saved_queries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Reading saved queries&#39;</span><span class="p">)</span>
        <span class="n">expt_query_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expt_query_dir</span><span class="p">()</span>
        <span class="n">prev_queries</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">expt_query_dir</span><span class="p">,</span> <span class="s1">&#39;long_*.json&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ddict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">basename</span>

        <span class="k">for</span> <span class="n">long_fpath</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">prev_queries</span><span class="p">):</span>
            <span class="n">short_fpath</span> <span class="o">=</span> <span class="n">long_fpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;long&#39;</span><span class="p">,</span> <span class="s1">&#39;short&#39;</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;long_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">long_fpath</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;short_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">short_fpath</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">long_fpath</span><span class="p">))</span>
            <span class="n">short_info</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">short_fpath</span><span class="p">)</span>
            <span class="c1"># Fix old formats</span>
            <span class="c1"># if &#39;expanded_uuids&#39; in short_info:</span>
            <span class="c1">#     quuids, duuids = short_info[&#39;expanded_uuids&#39;]</span>
            <span class="c1">#     short_info[&#39;num_qaids&#39;] = len(quuids)</span>
            <span class="c1">#     short_info[&#39;num_daids&#39;] = len(duuids)</span>
            <span class="c1">#     del short_info[&#39;expanded_uuids&#39;]</span>
            <span class="c1">#     if &#39;expanded_aids&#39; in short_info:</span>
            <span class="c1">#         del short_info[&#39;expanded_aids&#39;]</span>
            <span class="c1">#     ut.save_json(short_fpath, short_info, pretty=True)</span>
            <span class="c1"># if &#39;num_daids&#39; not in short_info:</span>
            <span class="c1">#     long_info = ut.load_json(long_fpath)</span>
            <span class="c1">#     quuids, duuids = long_info[&#39;expanded_uuids&#39;]</span>
            <span class="c1">#     short_info[&#39;num_qaids&#39;] = len(quuids)</span>
            <span class="c1">#     short_info[&#39;num_daids&#39;] = len(duuids)</span>
            <span class="c1">#     ut.save_json(short_fpath, short_info, pretty=True)</span>

            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;num_qaids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">short_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;num_qaids&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">))</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;num_daids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">short_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;num_daids&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">))</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;has_bc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;bc_info&#39;</span> <span class="ow">in</span> <span class="n">short_info</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Finished reading saved queries&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.load_previous_query"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.load_previous_query">[docs]</a>    <span class="k">def</span> <span class="nf">load_previous_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;loading previous query&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;apply_new_config&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">gt</span><span class="o">.</span><span class="n">GuiProgContext</span><span class="p">(</span><span class="s1">&#39;Loading&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>  <span class="c1"># NOQA</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_total</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">long_fpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="p">[</span><span class="s1">&#39;long_path&#39;</span><span class="p">][</span><span class="n">row</span><span class="p">]</span>
            <span class="n">short_fpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="p">[</span><span class="s1">&#39;short_path&#39;</span><span class="p">][</span><span class="n">row</span><span class="p">]</span>

            <span class="n">query_info</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">long_fpath</span><span class="p">)</span>
            <span class="n">query_info_short_text</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">load_text</span><span class="p">(</span><span class="n">short_fpath</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">bc_info</span> <span class="o">=</span> <span class="n">query_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bc_info&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_bc_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_bc_button</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">query_info</span> <span class="o">=</span> <span class="n">query_info</span>

            <span class="n">quuids</span><span class="p">,</span> <span class="n">duuids</span> <span class="o">=</span> <span class="n">query_info</span><span class="p">[</span><span class="s1">&#39;expanded_uuids&#39;</span><span class="p">]</span>
            <span class="n">ibs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_aids_from_uuid</span><span class="p">(</span><span class="n">quuids</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_aids_from_uuid</span><span class="p">(</span><span class="n">duuids</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">editPipeConfig</span><span class="o">.</span><span class="n">set_to_external</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_info</span><span class="p">[</span><span class="s1">&#39;pcfg&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editQueryConfig</span><span class="o">.</span><span class="n">set_to_external</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_info</span><span class="p">[</span><span class="s1">&#39;acfg&#39;</span><span class="p">][</span><span class="s1">&#39;qcfg&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editDataConfig</span><span class="o">.</span><span class="n">set_to_external</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_info</span><span class="p">[</span><span class="s1">&#39;acfg&#39;</span><span class="p">][</span><span class="s1">&#39;dcfg&#39;</span><span class="p">])</span>
            <span class="c1"># self.pcfg.update(**)</span>
            <span class="c1"># TODO: Update acfg as well.</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_config_info</span><span class="p">(</span><span class="s1">&#39;SAVED MANIFEST INFO:&#39;</span> <span class="o">+</span> <span class="n">query_info_short_text</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;...loaded previous query&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execute_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Re-Execute Saved Query&#39;</span><span class="p">)</span>
            <span class="c1"># need to do this or block signals from editPipeConfig</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfg_needs_update</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.log_query"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.log_query">[docs]</a>    <span class="k">def</span> <span class="nf">log_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; DEPRICATE &quot;&quot;&quot;</span>
        <span class="n">expt_query_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expt_query_dir</span><span class="p">()</span>
        <span class="c1"># ut.vd(expt_query_dir)</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span>

        <span class="c1"># TODO: Save the BIGCACHE file to the log, this allows</span>
        <span class="c1"># us to re-load that query even if its slightly invalid</span>

        <span class="k">if</span> <span class="n">qreq_</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">test</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">wbia.algo.Config</span> <span class="kn">import</span> <span class="n">QueryConfig</span>

            <span class="n">query_cfg</span> <span class="o">=</span> <span class="n">QueryConfig</span><span class="p">()</span>
            <span class="n">qreq_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qaids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">daids</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pcfg</span><span class="p">,</span> <span class="n">query_cfg</span><span class="o">=</span><span class="n">query_cfg</span>
            <span class="p">)</span>

        <span class="n">ts</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_timestamp</span><span class="p">(</span><span class="n">isutc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">expt_long_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unixjoin</span><span class="p">(</span>
            <span class="n">expt_query_dir</span><span class="p">,</span> <span class="s1">&#39;long_expt_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.json&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">dbname</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">expt_short_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unixjoin</span><span class="p">(</span>
            <span class="n">expt_query_dir</span><span class="p">,</span> <span class="s1">&#39;short_expt_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.json&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">dbname</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">bc_info</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_bigcache_info</span><span class="p">()</span>

        <span class="n">query_info</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">odict</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;computer&#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_computer_name</span><span class="p">()),</span>
                <span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">ts</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;num_qaids&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qaids</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;num_daids&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daids</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;pcfg&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcfg</span><span class="o">.</span><span class="n">asdict</span><span class="p">()),</span>
                <span class="p">(</span><span class="s1">&#39;acfg&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">acfg</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;review_cfg&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span><span class="o">.</span><span class="n">asdict</span><span class="p">()),</span>
                <span class="p">(</span><span class="s1">&#39;expanded_aids&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qaids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">daids</span><span class="p">)),</span>
                <span class="p">(</span>
                    <span class="s1">&#39;expanded_uuids&#39;</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_uuids</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qaids</span><span class="p">),</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_uuids</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daids</span><span class="p">)),</span>
                <span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;qreq_cfgstr&#39;</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">(</span><span class="n">with_input</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;qparams&#39;</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="p">),</span>
                <span class="p">(</span>
                    <span class="s1">&#39;qvuuid_hash&#39;</span><span class="p">,</span>
                    <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_hashid_visual_uuid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qaids</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;Q&#39;</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="p">(</span>
                    <span class="s1">&#39;dvuuid_hash&#39;</span><span class="p">,</span>
                    <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_hashid_visual_uuid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daids</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;bc_info&#39;</span><span class="p">,</span> <span class="n">bc_info</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">test</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">query_info</span><span class="p">[</span><span class="s1">&#39;expanded_aids&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">query_info</span><span class="p">[</span><span class="s1">&#39;expanded_uuids&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">query_info</span><span class="p">[</span><span class="s1">&#39;qparams&#39;</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;expt_long_fpath = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expt_long_fpath</span><span class="p">,))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;expt_short_fpath = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expt_short_fpath</span><span class="p">,))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;query_info = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">query_info</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="mi">1</span><span class="p">),))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">save_json</span><span class="p">(</span><span class="n">expt_long_fpath</span><span class="p">,</span> <span class="n">query_info</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">query_info</span><span class="p">[</span><span class="s1">&#39;expanded_uuids&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">query_info</span><span class="p">[</span><span class="s1">&#39;expanded_aids&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">query_info</span><span class="p">[</span><span class="s1">&#39;qparams&#39;</span><span class="p">]</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">save_json</span><span class="p">(</span><span class="n">expt_short_fpath</span><span class="p">,</span> <span class="n">query_info</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.execute_query"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.execute_query">[docs]</a>    <span class="nd">@backreport</span>
    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;accept&#39;</span><span class="p">)</span>
        <span class="c1"># assert not self.cfg_needs_update, &#39;NEED TO APPLY ACFG/PCFG BEFORE EXECUTING&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg_needs_update</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Apply now and continue&#39;</span><span class="p">,</span> <span class="s1">&#39;Apply now and wait&#39;</span><span class="p">]</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">user_option</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    Information display is out of date. You should apply the</span>
<span class="sd">                    modified configuration before you continue.</span>
<span class="sd">                    &quot;&quot;&quot;</span>
                <span class="p">),</span>
                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_new_config</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">options</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_new_config</span><span class="p">()</span>
                <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="kn">from</span> <span class="nn">wbia.gui</span> <span class="kn">import</span> <span class="n">inspect_gui</span>

        <span class="n">review_cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">ibs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">qreq_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qreq_</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Dont log on a re-executed query</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_query</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">gt</span><span class="o">.</span><span class="n">GuiProgContext</span><span class="p">(</span><span class="s1">&#39;Querying&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>  <span class="c1"># NOQA</span>
            <span class="n">cm_list</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">prog_hook</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">prog_hook</span><span class="p">)</span>

        <span class="n">qres_wgt</span> <span class="o">=</span> <span class="n">inspect_gui</span><span class="o">.</span><span class="n">QueryResultsWidget</span><span class="p">(</span>
            <span class="n">ibs</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">=</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">review_cfg</span><span class="o">=</span><span class="n">review_cfg</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qres_wgt</span> <span class="o">=</span> <span class="n">qres_wgt</span>
        <span class="n">qres_wgt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">qres_wgt</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Showing query results&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_table</span><span class="p">()</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.load_bc"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.load_bc">[docs]</a>    <span class="k">def</span> <span class="nf">load_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">wbia.gui</span> <span class="kn">import</span> <span class="n">inspect_gui</span>

        <span class="n">review_cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">bc_dpath</span><span class="p">,</span> <span class="n">bc_fname</span><span class="p">,</span> <span class="n">bc_cfgstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_info</span>
        <span class="n">qaid2_cm</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">load_cache</span><span class="p">(</span><span class="n">bc_dpath</span><span class="p">,</span> <span class="n">bc_fname</span><span class="p">,</span> <span class="n">bc_cfgstr</span><span class="p">)</span>
        <span class="n">qreq_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qreq_</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">cm_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">qaid2_cm</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span> <span class="k">for</span> <span class="n">qaid</span> <span class="ow">in</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">]</span>
        <span class="n">qres_wgt</span> <span class="o">=</span> <span class="n">inspect_gui</span><span class="o">.</span><span class="n">QueryResultsWidget</span><span class="p">(</span>
            <span class="n">ibs</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">=</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">review_cfg</span><span class="o">=</span><span class="n">review_cfg</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qres_wgt</span> <span class="o">=</span> <span class="n">qres_wgt</span>
        <span class="n">qres_wgt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">qres_wgt</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="CustomAnnotCfgSelector.on_table_doubleclick"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.CustomAnnotCfgSelector.on_table_doubleclick">[docs]</a>    <span class="k">def</span> <span class="nf">on_table_doubleclick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="c1"># logger.info(&#39;index = %r&#39; % (index,))</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_previous_query</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="NewDatabaseWidget"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.NewDatabaseWidget">[docs]</a><span class="k">class</span> <span class="nc">NewDatabaseWidget</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">GuitoolWidget</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        parent (None): (default = None)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.gui.guiback NewDatabaseWidget --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; gt.ensure_qtapp()</span>
<span class="sd">        &gt;&gt;&gt; self = NewDatabaseWidget(back=None)</span>
<span class="sd">        &gt;&gt;&gt; self.resize(400, 200)</span>
<span class="sd">        &gt;&gt;&gt; self.show()</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; gt.qtapp_loop(qwin=self, freq=10)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="NewDatabaseWidget.initialize"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.NewDatabaseWidget.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">back</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="n">on_chosen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Save arguments</span>
        <span class="k">if</span> <span class="n">back</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">back</span> <span class="o">=</span> <span class="n">back</span>
            <span class="k">if</span> <span class="n">on_chosen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">on_chosen</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">open_database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_chosen</span> <span class="o">=</span> <span class="n">on_chosen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_work_directory</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">back</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truepath</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_chosen</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">title_mode</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="s1">&#39;Create a new IBEIS Database&#39;</span><span class="p">,</span>
            <span class="s1">&#39;copy&#39;</span><span class="p">:</span> <span class="s1">&#39;Create an IBEIS Database copy&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">instruction_mode</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="s1">&#39;Choose a name for the new database&#39;</span><span class="p">,</span>
            <span class="s1">&#39;copy&#39;</span><span class="p">:</span> <span class="s1">&#39;Choose a name for the database copy&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dbname</span> <span class="o">=</span> <span class="s1">&#39;MyNewIBEISDatabase&#39;</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;copy&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbname</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_dbname</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_Copy&#39;</span>

        <span class="c1"># Build layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">title_mode</span><span class="p">[</span><span class="n">mode</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="n">instruction_mode</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="c1"># ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbname_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewHWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbname_row</span><span class="o">.</span><span class="n">edit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbname_row</span><span class="o">.</span><span class="n">addNewLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbname</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbname_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_state</span><span class="p">)</span>
        <span class="c1"># ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewHWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">lbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Current Workdir:&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">edit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">addNewLineEdit</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span>
            <span class="s1">&#39;...&#39;</span><span class="p">,</span> <span class="n">shrink_to_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">change_workdir</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">viewbut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span>
            <span class="s1">&#39;➤&#39;</span><span class="p">,</span> <span class="n">shrink_to_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">view_workdir</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_state</span><span class="p">)</span>
        <span class="c1"># ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewHWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_but</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newButton</span><span class="p">(</span>
            <span class="s1">&#39;Create in workdir&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_in_workdir</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_row</span><span class="o">.</span><span class="n">lbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_row</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span>
            <span class="s1">&#39;Current choice:&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_row</span><span class="o">.</span><span class="n">edit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_row</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">{current_dbdir}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">button_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewHWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_row</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Cancel&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_row</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span>
            <span class="s1">&#39;Create in a different directory&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_in_customdir</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_but</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_state</span><span class="p">()</span></div>

<div class="viewcode-block" id="NewDatabaseWidget.update_state"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.NewDatabaseWidget.update_state">[docs]</a>    <span class="k">def</span> <span class="nf">update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">workdir</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truepath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">dbname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbname_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">current_choice</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="n">dbname</span><span class="p">))</span>
        <span class="n">workdir_exists</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;workdir_exists = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">workdir_exists</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">workdir_exists</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">current_choice</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">setColorFG</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_but</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Open existing database&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">setColorFG</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_but</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Create in workdir&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_but</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">setColorFG</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_but</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Create in workdir&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_but</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">current_choice</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewDatabaseWidget.view_workdir"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.NewDatabaseWidget.view_workdir">[docs]</a>    <span class="k">def</span> <span class="nf">view_workdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">view_directory</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">truepath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span></div>

<div class="viewcode-block" id="NewDatabaseWidget.change_workdir"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.NewDatabaseWidget.change_workdir">[docs]</a>    <span class="k">def</span> <span class="nf">change_workdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;change workdir&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="s1">&#39;change workdir&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
        <span class="n">new_workdir</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">select_directory</span><span class="p">(</span>
            <span class="s1">&#39;Select new work directory&#39;</span><span class="p">,</span>
            <span class="n">other_sidebar_dpaths</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">text</span><span class="p">()],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">new_workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;new_workdir = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_workdir</span><span class="p">,))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">new_workdir</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_state</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">back</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">wbia</span>

                <span class="n">wbia</span><span class="o">.</span><span class="n">sysres</span><span class="o">.</span><span class="n">set_workdir</span><span class="p">(</span><span class="n">work_dir</span><span class="o">=</span><span class="n">new_workdir</span><span class="p">,</span> <span class="n">allow_gui</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewDatabaseWidget.create_in_workdir"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.NewDatabaseWidget.create_in_workdir">[docs]</a>    <span class="k">def</span> <span class="nf">create_in_workdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Create in Workdir&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="s1">&#39;Create in Workdir&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">choose_new_dbdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span></div>

<div class="viewcode-block" id="NewDatabaseWidget.create_in_customdir"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.NewDatabaseWidget.create_in_customdir">[docs]</a>    <span class="k">def</span> <span class="nf">create_in_customdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Create in Custom&#39;</span><span class="p">)</span>
        <span class="n">new_dbdir</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">select_directory</span><span class="p">(</span>
            <span class="s1">&#39;Select directory for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbname</span><span class="p">),</span>
            <span class="n">other_sidebar_dpaths</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir_row</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">text</span><span class="p">()],</span>
        <span class="p">)</span>
        <span class="n">current_choice</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">new_dbdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbname</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">choose_new_dbdir</span><span class="p">(</span><span class="n">current_choice</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewDatabaseWidget.choose_new_dbdir"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.NewDatabaseWidget.choose_new_dbdir">[docs]</a>    <span class="k">def</span> <span class="nf">choose_new_dbdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbdir</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Chose dbdir = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dbdir</span><span class="p">,))</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="s1">&#39;Chose dbdir = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dbdir</span><span class="p">,),</span> <span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_chosen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_chosen</span><span class="p">(</span><span class="n">dbdir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="NewDatabaseWidget.cancel"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.NewDatabaseWidget.cancel">[docs]</a>    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Cancel&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="s1">&#39;Cancel&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<span class="c1"># ------------------------</span>
<span class="c1"># Backend MainWindow Class</span>
<span class="c1"># ------------------------</span>
<span class="c1"># QtReloadingMetaClass = ut.reloading_meta_metaclass_factory(gt.QtCore.pyqtWrapperType)</span>

<span class="n">GUIBACK_BASE</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span>


<span class="c1"># @six.add_metaclass(QtReloadingMetaClass)  # cant do this quit yet</span>
<div class="viewcode-block" id="MainWindowBackend"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend">[docs]</a><span class="k">class</span> <span class="nc">MainWindowBackend</span><span class="p">(</span><span class="n">GUIBACK_BASE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sends and recieves signals to and from the frontend</span>

<span class="sd">    Args:</span>
<span class="sd">        ibs (wbia.IBEISController):  image analysis api(default = None)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m wbia.gui.guiback MainWindowBackend --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import wbia</span>
<span class="sd">        &gt;&gt;&gt; back = testdata_guiback(defaultdb=None)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; gt.qtapp_loop(qwin=back.front, freq=10)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Backend Signals</span>
    <span class="n">updateWindowTitleSignal</span> <span class="o">=</span> <span class="n">signal_</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="c1"># changeSpeciesSignal = signal_(str)</span>
    <span class="c1"># incQuerySignal = signal_(int)</span>

    <span class="c1"># ------------------------</span>
    <span class="c1"># Constructor</span>
    <span class="c1"># ------------------------</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">ibs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates GUIBackend object &quot;&quot;&quot;</span>
        <span class="c1"># GUIBACK_BASE.__init__(back)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MainWindowBackend</span><span class="p">,</span> <span class="n">back</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] MainWindowBackend.__init__(ibs=</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibs</span><span class="p">,))</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">back</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">back</span><span class="o">.</span><span class="n">edit_prefs_wgt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># State variables</span>
        <span class="n">back</span><span class="o">.</span><span class="n">sel_aids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">back</span><span class="o">.</span><span class="n">sel_nids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">back</span><span class="o">.</span><span class="n">sel_gids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">back</span><span class="o">.</span><span class="n">sel_cm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># if ut.is_developer():</span>
        <span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># else:</span>
        <span class="c1"># back.daids_mode = const.VS_EXEMPLARS_KEY</span>
        <span class="c1"># back.imageset_query_results = ut.ddict(dict)</span>
        <span class="c1"># used to store partials defined in the frontend</span>
        <span class="n">back</span><span class="o">.</span><span class="n">special_query_funcs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Create GUIFrontend object</span>
        <span class="n">back</span><span class="o">.</span><span class="n">mainwin</span> <span class="o">=</span> <span class="n">newgui</span><span class="o">.</span><span class="n">IBEISMainWindow</span><span class="p">(</span><span class="n">back</span><span class="o">=</span><span class="n">back</span><span class="p">,</span> <span class="n">ibs</span><span class="o">=</span><span class="n">ibs</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">mainwin</span><span class="o">.</span><span class="n">ibswgt</span>
        <span class="n">back</span><span class="o">.</span><span class="n">web_ibs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">back</span><span class="o">.</span><span class="n">wb_server_running</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibswgt</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">front</span>  <span class="c1"># Alias</span>
        <span class="c1"># connect signals and other objects</span>
        <span class="n">fig_presenter</span><span class="o">.</span><span class="n">register_qt4_win</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">mainwin</span><span class="p">)</span>
        <span class="c1"># register self with the wbia controller</span>
        <span class="n">back</span><span class="o">.</span><span class="n">register_self</span><span class="p">()</span>
        <span class="c1"># back.changeSpeciesSignal.connect(back.ibswgt.species_combo.setItemText)</span>

        <span class="c1"># back.incQuerySignal.connect(back.incremental_query_slot)</span>

    <span class="c1"># def __del__(back):</span>
    <span class="c1">#    back.cleanup()</span>

<div class="viewcode-block" id="MainWindowBackend.set_daids_mode"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.set_daids_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_daids_mode</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">new_mode</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">new_mode</span> <span class="o">==</span> <span class="s1">&#39;toggle&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">VS_EXEMPLARS_KEY</span><span class="p">:</span>
                <span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">INTRA_OCCUR_KEY</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">VS_EXEMPLARS_KEY</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span> <span class="o">=</span> <span class="n">new_mode</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">mainwin</span><span class="o">.</span><span class="n">actionToggleQueryMode</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s1">&#39;Toggle Query Mode currently: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span></div>
        <span class="c1"># back.front.menuActions.</span>

<div class="viewcode-block" id="MainWindowBackend.cleanup"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">back</span><span class="o">.</span><span class="n">kill_web_server_parallel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">wb_server_running</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">shutdown_wildbook</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">remove_observer</span><span class="p">(</span><span class="n">back</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s1">&#39;[back] observer fail&#39;</span><span class="p">)</span></div>

    <span class="c1"># @ut.indent_func</span>
<div class="viewcode-block" id="MainWindowBackend.notify"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.notify">[docs]</a>    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Observer&#39;s notify function. &quot;&quot;&quot;</span>
        <span class="n">back</span><span class="o">.</span><span class="n">refresh_state</span><span class="p">()</span></div>

    <span class="c1"># @ut.indent_func</span>
<div class="viewcode-block" id="MainWindowBackend.notify_controller_killed"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.notify_controller_killed">[docs]</a>    <span class="k">def</span> <span class="nf">notify_controller_killed</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Observer&#39;s notify function that the wbia controller has been killed. &quot;&quot;&quot;</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MainWindowBackend.register_self"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.register_self">[docs]</a>    <span class="k">def</span> <span class="nf">register_self</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">register_observer</span><span class="p">(</span><span class="n">back</span><span class="p">)</span></div>

    <span class="c1"># ------------------------</span>
    <span class="c1"># Draw Functions</span>
    <span class="c1"># ------------------------</span>

<div class="viewcode-block" id="MainWindowBackend.show"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">back</span><span class="o">.</span><span class="n">mainwin</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.get_background_web_domain"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.get_background_web_domain">[docs]</a>    <span class="k">def</span> <span class="nf">get_background_web_domain</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">web_url</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
        <span class="n">web_port</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_web_port_via_scan</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">web_port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;IA web server is not running on any expected port&#39;</span><span class="p">)</span>
        <span class="n">web_domain</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">web_url</span><span class="p">,</span>
            <span class="n">web_port</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">web_domain</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_imgsetid_list_in_web"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_imgsetid_list_in_web">[docs]</a>    <span class="k">def</span> <span class="nf">show_imgsetid_list_in_web</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">webbrowser</span>

        <span class="n">back</span><span class="o">.</span><span class="n">start_web_server_parallel</span><span class="p">(</span><span class="n">browser</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">imgsetid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">)</span>
        <span class="n">imgsetid_str</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">))</span>
        <span class="n">web_domain</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_background_web_domain</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">/view/images/?imgsetid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">web_domain</span><span class="p">,</span>
            <span class="n">imgsetid_str</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_imgsetid_detection_turk_in_web"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_imgsetid_detection_turk_in_web">[docs]</a>    <span class="k">def</span> <span class="nf">show_imgsetid_detection_turk_in_web</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">webbrowser</span>

        <span class="n">back</span><span class="o">.</span><span class="n">start_web_server_parallel</span><span class="p">(</span><span class="n">browser</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">imgsetid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">)</span>
        <span class="n">imgsetid_str</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">))</span>
        <span class="n">web_domain</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_background_web_domain</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">/turk/detection/?imgsetid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">web_domain</span><span class="p">,</span>
            <span class="n">imgsetid_str</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_imgsetid_annotation_turk_in_web"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_imgsetid_annotation_turk_in_web">[docs]</a>    <span class="k">def</span> <span class="nf">show_imgsetid_annotation_turk_in_web</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">webbrowser</span>

        <span class="n">back</span><span class="o">.</span><span class="n">start_web_server_parallel</span><span class="p">(</span><span class="n">browser</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">imgsetid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">)</span>
        <span class="n">imgsetid_str</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">))</span>
        <span class="n">web_domain</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_background_web_domain</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">/turk/annotation/?imgsetid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">web_domain</span><span class="p">,</span>
            <span class="n">imgsetid_str</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_image"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_image">[docs]</a>    <span class="k">def</span> <span class="nf">show_image</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">sel_aids</span><span class="o">=</span><span class="p">[],</span> <span class="n">web</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">web</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">show_images_in_web</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;sel_aids&#39;</span><span class="p">:</span> <span class="n">sel_aids</span><span class="p">,</span> <span class="s1">&#39;select_callback&#39;</span><span class="p">:</span> <span class="n">back</span><span class="o">.</span><span class="n">select_gid</span><span class="p">})</span>
            <span class="n">interact</span><span class="o">.</span><span class="n">ishow_image</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_images_in_web"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_images_in_web">[docs]</a>    <span class="k">def</span> <span class="nf">show_images_in_web</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">webbrowser</span>

        <span class="n">back</span><span class="o">.</span><span class="n">start_web_server_parallel</span><span class="p">(</span><span class="n">browser</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">gid_text</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">))</span>
        <span class="n">web_domain</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_background_web_domain</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">/view/detection?gid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">web_domain</span><span class="p">,</span>
                <span class="n">gid_text</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">/view/images?gid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">web_domain</span><span class="p">,</span>
                <span class="n">gid_text</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_annotation"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_annotation">[docs]</a>    <span class="k">def</span> <span class="nf">show_annotation</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">aid</span><span class="p">,</span> <span class="n">show_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">web</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">webbrowser</span>

            <span class="n">back</span><span class="o">.</span><span class="n">start_web_server_parallel</span><span class="p">(</span><span class="n">browser</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">web_domain</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_background_web_domain</span><span class="p">()</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">/view/annotations?aid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">web_domain</span><span class="p">,</span>
                <span class="n">aid</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">interact</span><span class="o">.</span><span class="n">ishow_chip</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_image</span><span class="p">:</span>
            <span class="n">gid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
            <span class="c1"># interact.ishow_image(back.ibs, gid, sel_aids=[aid])</span>
            <span class="n">back</span><span class="o">.</span><span class="n">show_image</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">sel_aids</span><span class="o">=</span><span class="p">[</span><span class="n">aid</span><span class="p">],</span> <span class="n">web</span><span class="o">=</span><span class="n">web</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_aid_list_in_web"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_aid_list_in_web">[docs]</a>    <span class="k">def</span> <span class="nf">show_aid_list_in_web</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">webbrowser</span>

        <span class="n">back</span><span class="o">.</span><span class="n">start_web_server_parallel</span><span class="p">(</span><span class="n">browser</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">aid_list</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">web_domain</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_background_web_domain</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">/view/annotations?aid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">web_domain</span><span class="p">,</span>
            <span class="n">aid_list</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_name"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_name">[docs]</a>    <span class="k">def</span> <span class="nf">show_name</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">sel_aids</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;sel_aids&#39;</span><span class="p">:</span> <span class="n">sel_aids</span><span class="p">,</span> <span class="s1">&#39;select_aid_callback&#39;</span><span class="p">:</span> <span class="n">back</span><span class="o">.</span><span class="n">select_aid</span><span class="p">})</span>
        <span class="c1"># nid = back.ibs.get_name_rowids_from_text(name)</span>
        <span class="n">interact</span><span class="o">.</span><span class="n">ishow_name</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_nid_list_in_web"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_nid_list_in_web">[docs]</a>    <span class="k">def</span> <span class="nf">show_nid_list_in_web</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">webbrowser</span>

        <span class="n">back</span><span class="o">.</span><span class="n">start_web_server_parallel</span><span class="p">(</span><span class="n">browser</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nid_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">nid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">nid_list</span><span class="p">]</span>

        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_name_aids</span><span class="p">(</span><span class="n">nid_list</span><span class="p">)</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">aids</span> <span class="ow">in</span> <span class="n">aids_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">aid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">aid_str</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">web_domain</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_background_web_domain</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">/view/names?aid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">web_domain</span><span class="p">,</span>
            <span class="n">aid_str</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_hough_image_"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_hough_image_">[docs]</a>    <span class="k">def</span> <span class="nf">show_hough_image_</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">species</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_species</span><span class="p">()</span>
        <span class="n">viz</span><span class="o">.</span><span class="n">show_hough_image</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">viz</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.run_detection_on_imageset"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.run_detection_on_imageset">[docs]</a>    <span class="k">def</span> <span class="nf">run_detection_on_imageset</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">))</span>
        <span class="n">back</span><span class="o">.</span><span class="n">run_detection_on_images</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="n">refresh</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.run_detection_on_images"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.run_detection_on_images">[docs]</a>    <span class="k">def</span> <span class="nf">run_detection_on_images</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">detector</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">detector</span>
        <span class="k">if</span> <span class="n">detector</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cnn_yolo&#39;</span><span class="p">,</span> <span class="s1">&#39;yolo&#39;</span><span class="p">,</span> <span class="s1">&#39;cnn&#39;</span><span class="p">]:</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">detect_cnn_yolo</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">detector</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;random_forest&#39;</span><span class="p">,</span> <span class="s1">&#39;rf&#39;</span><span class="p">]:</span>
            <span class="n">species</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">species_text</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">detect_random_forest</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Detector not recognized&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">])</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_probability_chip"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_probability_chip">[docs]</a>    <span class="k">def</span> <span class="nf">show_probability_chip</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">aid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">viz</span><span class="o">.</span><span class="n">show_probability_chip</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">viz</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.review_queries"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.review_queries">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">review_queries</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">review_cfg</span><span class="o">=</span><span class="p">{},</span> <span class="n">query_title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="c1"># Qt QueryResults Interaction</span>
        <span class="kn">from</span> <span class="nn">wbia.gui</span> <span class="kn">import</span> <span class="n">inspect_gui</span>

        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>

        <span class="k">def</span> <span class="nf">finished_review_callback</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># TODO: only call this if connected to wildbook</span>
                <span class="c1"># TODO: probably need to remove verboseity as well</span>
                <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">wb_server_running</span><span class="p">:</span>
                    <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">wildbook_signal_annot_name_changes</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s1">&#39;Wildbook call did not work. Maybe not connected?&#39;</span><span class="p">)</span>
            <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span>

        <span class="c1"># Overwrite</span>
        <span class="n">review_cfg</span> <span class="o">=</span> <span class="n">review_cfg</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">filter_reviewed</span> <span class="o">=</span> <span class="n">review_cfg</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;filter_reviewed&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filter_reviewed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filter_reviewed</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">ensure_attr</span><span class="p">(</span><span class="s1">&#39;filter_reviewed&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filter_reviewed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># only filter big queries if not specified</span>
                <span class="n">filter_reviewed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cm_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;EVIDENCE_DECISION QUERIES&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;review_cfg = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">review_cfg</span><span class="p">),))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;filter_reviewed = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filter_reviewed</span><span class="p">,))</span>
        <span class="n">review_cfg</span><span class="p">[</span><span class="s1">&#39;filter_reviewed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_reviewed</span>
        <span class="n">review_cfg</span><span class="p">[</span><span class="s1">&#39;ranks_top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">review_cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ranks_top&#39;</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">ranks_top</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">qres_wgt</span> <span class="o">=</span> <span class="n">inspect_gui</span><span class="o">.</span><span class="n">QueryResultsWidget</span><span class="p">(</span>
            <span class="n">ibs</span><span class="p">,</span>
            <span class="n">cm_list</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">finished_review_callback</span><span class="p">,</span>
            <span class="n">qreq_</span><span class="o">=</span><span class="n">qreq_</span><span class="p">,</span>
            <span class="n">query_title</span><span class="o">=</span><span class="n">query_title</span><span class="p">,</span>
            <span class="n">review_cfg</span><span class="o">=</span><span class="n">review_cfg</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">qres_wgt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">qres_wgt</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

    <span class="c1"># ----------------------</span>
    <span class="c1"># State Management Functions</span>
    <span class="c1"># ----------------------</span>

<div class="viewcode-block" id="MainWindowBackend.refresh_state"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.refresh_state">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_state</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Blanket refresh function. Try not to call this &quot;&quot;&quot;</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibswgt</span><span class="o">.</span><span class="n">update_species_available</span><span class="p">(</span><span class="n">reselect</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.connect_wbia_control"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.connect_wbia_control">[docs]</a>    <span class="k">def</span> <span class="nf">connect_wbia_control</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">ibs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] connect_wbia(ibs=</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibs</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">ibs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibs</span>
        <span class="c1"># register self with the wbia controller</span>
        <span class="n">back</span><span class="o">.</span><span class="n">register_self</span><span class="p">()</span>
        <span class="c1"># deselect</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_set_selection</span><span class="p">(</span><span class="n">sel_gids</span><span class="o">=</span><span class="p">[],</span> <span class="n">sel_aids</span><span class="o">=</span><span class="p">[],</span> <span class="n">sel_nids</span><span class="o">=</span><span class="p">[],</span> <span class="n">sel_imgsetids</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">connect_wbia_control</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
        <span class="n">exemplar_gsid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_imgsetids_from_text</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">EXEMPLAR_IMAGESETTEXT</span><span class="p">)</span>
        <span class="n">num_exemplars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ibsfuncs</span><span class="o">.</span><span class="n">_get_gids_in_imgsetid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">exemplar_gsid</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">num_exemplars</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">INTRA_OCCUR_KEY</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">VS_EXEMPLARS_KEY</span>
        <span class="n">back</span><span class="o">.</span><span class="n">set_daids_mode</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.default_config"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.default_config">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">default_config</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Button Click -&gt; Preferences Defaults &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] default preferences&#39;</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">_default_config</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">edit_prefs_wgt</span><span class="o">.</span><span class="n">refresh_layout</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">edit_prefs_wgt</span><span class="o">.</span><span class="n">pref_model</span><span class="o">.</span><span class="n">rootPref</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c1"># due to weirdness of Preferences structs</span>
        <span class="c1"># we have to close the widget otherwise we will</span>
        <span class="c1"># be looking at an outated object</span>
        <span class="n">back</span><span class="o">.</span><span class="n">edit_prefs_wgt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.get_selected_gid"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.get_selected_gid">[docs]</a>    <span class="nd">@ut</span><span class="o">.</span><span class="n">indent_func</span>
    <span class="k">def</span> <span class="nf">get_selected_gid</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; selected image id &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">sel_gids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">sel_aids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sel_gids</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">sel_aids</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sel_gids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">InvalidRequest</span><span class="p">(</span><span class="s1">&#39;There are no selected images&#39;</span><span class="p">)</span>
                <span class="n">gid</span> <span class="o">=</span> <span class="n">sel_gids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">gid</span>
            <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">InvalidRequest</span><span class="p">(</span><span class="s1">&#39;There are no selected images&#39;</span><span class="p">)</span>
        <span class="n">gid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">sel_gids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">gid</span></div>

<div class="viewcode-block" id="MainWindowBackend.get_selected_aids"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.get_selected_aids">[docs]</a>    <span class="nd">@ut</span><span class="o">.</span><span class="n">indent_func</span>
    <span class="k">def</span> <span class="nf">get_selected_aids</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; selected annotation id &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">sel_aids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">InvalidRequest</span><span class="p">(</span><span class="s1">&#39;There are no selected ANNOTATIONs&#39;</span><span class="p">)</span>
        <span class="c1"># aid = back.sel_aids[0]</span>
        <span class="k">return</span> <span class="n">back</span><span class="o">.</span><span class="n">sel_aids</span></div>

<div class="viewcode-block" id="MainWindowBackend.get_selected_imgsetid"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.get_selected_imgsetid">[docs]</a>    <span class="nd">@ut</span><span class="o">.</span><span class="n">indent_func</span>
    <span class="k">def</span> <span class="nf">get_selected_imgsetid</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; selected imageset id &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">sel_imgsetids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">InvalidRequest</span><span class="p">(</span><span class="s1">&#39;There are no selected ImageSets&#39;</span><span class="p">)</span>
        <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">sel_imgsetids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">imgsetid</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Selection Functions</span>
    <span class="c1"># --------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_set_selection2</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">tablename</span><span class="p">,</span> <span class="n">id_list</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;set&#39;</span><span class="p">):</span>
        <span class="c1"># here tablename is a backend const tablename</span>

        <span class="k">def</span> <span class="nf">set_collections</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">aug</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">aug</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">add_collections</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">aug</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">old</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">aug</span><span class="p">)))</span>

        <span class="k">def</span> <span class="nf">diff_collections</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">aug</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">old</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">aug</span><span class="p">)))</span>

        <span class="n">modify_collections</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;set&#39;</span><span class="p">:</span> <span class="n">set_collections</span><span class="p">,</span>
            <span class="s1">&#39;add&#39;</span><span class="p">:</span> <span class="n">add_collections</span><span class="p">,</span>
            <span class="s1">&#39;diff&#39;</span><span class="p">:</span> <span class="n">diff_collections</span><span class="p">,</span>
        <span class="p">}[</span><span class="n">mode</span><span class="p">]</span>

        <span class="n">attr_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">const</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">:</span> <span class="s1">&#39;sel_aids&#39;</span><span class="p">,</span>
            <span class="n">const</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">:</span> <span class="s1">&#39;sel_gids&#39;</span><span class="p">,</span>
            <span class="n">const</span><span class="o">.</span><span class="n">NAME_TABLE</span><span class="p">:</span> <span class="s1">&#39;sel_nids&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">attr_map</span><span class="p">[</span><span class="n">tablename</span><span class="p">]</span>
        <span class="n">new_id_list</span> <span class="o">=</span> <span class="n">modify_collections</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">attr</span><span class="p">),</span> <span class="n">id_list</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">new_id_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_selection3</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">tablename</span><span class="p">,</span> <span class="n">id_list</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;set&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        text = &#39;51e10019-968b-5f2e-2287-8432464d7547 &#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">ensure_uuids_are_ids</span><span class="p">(</span><span class="n">id_list</span><span class="p">,</span> <span class="n">uuid_to_id_fn</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">uuid</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">id_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">):</span>
                <span class="n">id_list</span> <span class="o">=</span> <span class="n">uuid_to_id_fn</span><span class="p">(</span><span class="n">id_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">id_list</span>

        <span class="k">def</span> <span class="nf">ensure_texts_are_ids</span><span class="p">(</span><span class="n">id_list</span><span class="p">,</span> <span class="n">text_to_id_fn</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">id_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="n">id_list</span> <span class="o">=</span> <span class="n">text_to_id_fn</span><span class="p">(</span><span class="n">id_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">id_list</span>

        <span class="k">if</span> <span class="n">tablename</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">:</span>
            <span class="n">id_list</span> <span class="o">=</span> <span class="n">ensure_uuids_are_ids</span><span class="p">(</span>
                <span class="n">id_list</span><span class="p">,</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_aids_from_visual_uuid</span>
            <span class="p">)</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">id_list</span><span class="p">)</span>
            <span class="n">nid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_nids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
            <span class="n">flag_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flag_None_items</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
            <span class="n">nid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">filterfalse_items</span><span class="p">(</span><span class="n">nid_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">filterfalse_items</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">filterfalse_items</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tablename</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">:</span>
            <span class="n">id_list</span> <span class="o">=</span> <span class="n">ensure_uuids_are_ids</span><span class="p">(</span><span class="n">id_list</span><span class="p">,</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_image_gids_from_uuid</span><span class="p">)</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">id_list</span><span class="p">)</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))</span>
            <span class="n">nid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_nids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
            <span class="n">flag_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flag_None_items</span><span class="p">(</span><span class="n">nid_list</span><span class="p">)</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">filterfalse_items</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">filterfalse_items</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tablename</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">NAME_TABLE</span><span class="p">:</span>
            <span class="n">id_list</span> <span class="o">=</span> <span class="n">ensure_texts_are_ids</span><span class="p">(</span><span class="n">id_list</span><span class="p">,</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_name_rowids_from_text_</span><span class="p">)</span>
            <span class="n">nid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">id_list</span><span class="p">)</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_name_aids</span><span class="p">(</span><span class="n">nid_list</span><span class="p">))</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
            <span class="n">flag_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flag_None_items</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">filterfalse_items</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">filterfalse_items</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_set_selection2</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_set_selection2</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">NAME_TABLE</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_set_selection2</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">id_list</span>

    <span class="k">def</span> <span class="nf">_clear_selection</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] _clear_selection&#39;</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">sel_aids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">back</span><span class="o">.</span><span class="n">sel_gids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">back</span><span class="o">.</span><span class="n">sel_nids</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MainWindowBackend.update_selection_texts"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.update_selection_texts">[docs]</a>    <span class="k">def</span> <span class="nf">update_selection_texts</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">sel_imagesettexts</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_text</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">sel_imgsetids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sel_imagesettexts</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
            <span class="n">sel_imagesettexts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sel_imagesettexts</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">sel_imagesettexts</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibswgt</span><span class="o">.</span><span class="n">set_selection_status</span><span class="p">(</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGESET_TABLE</span><span class="p">,</span> <span class="n">sel_imagesettexts</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibswgt</span><span class="o">.</span><span class="n">set_selection_status</span><span class="p">(</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">back</span><span class="o">.</span><span class="n">sel_gids</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibswgt</span><span class="o">.</span><span class="n">set_selection_status</span><span class="p">(</span><span class="n">gh</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="n">back</span><span class="o">.</span><span class="n">sel_aids</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibswgt</span><span class="o">.</span><span class="n">set_selection_status</span><span class="p">(</span><span class="n">gh</span><span class="o">.</span><span class="n">NAMES_TREE</span><span class="p">,</span> <span class="n">back</span><span class="o">.</span><span class="n">sel_nids</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_set_selection</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span>
        <span class="n">sel_gids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sel_aids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sel_nids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sel_cm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sel_imgsetids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;set&#39;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="k">def</span> <span class="nf">modify_collection_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">aug</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
            <span class="n">aug</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">aug</span><span class="p">)</span>
            <span class="n">old</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span><span class="p">:</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">aug</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span><span class="p">:</span>
                <span class="n">new</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">old</span><span class="p">)</span> <span class="o">+</span> <span class="nb">set</span><span class="p">(</span><span class="n">aug</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;remove&#39;</span><span class="p">:</span>
                <span class="n">new</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">old</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">aug</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;uknown mode=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,))</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sel_imgsetids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sel_imgsetids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">sel_imgsetids</span><span class="p">)</span>
            <span class="n">back</span><span class="o">.</span><span class="n">sel_imgsetids</span> <span class="o">=</span> <span class="n">sel_imgsetids</span>
            <span class="n">sel_imagesettexts</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_text</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">sel_imgsetids</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sel_imagesettexts</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
                <span class="n">sel_imagesettexts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sel_imagesettexts</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">sel_imagesettexts</span><span class="p">)</span>
            <span class="n">back</span><span class="o">.</span><span class="n">ibswgt</span><span class="o">.</span><span class="n">set_selection_status</span><span class="p">(</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGESET_TABLE</span><span class="p">,</span> <span class="n">sel_imagesettexts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sel_gids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">modify_collection_attr</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="s1">&#39;sel_gids&#39;</span><span class="p">,</span> <span class="n">sel_gids</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
            <span class="n">back</span><span class="o">.</span><span class="n">ibswgt</span><span class="o">.</span><span class="n">set_selection_status</span><span class="p">(</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">back</span><span class="o">.</span><span class="n">sel_gids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sel_aids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sel_aids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">sel_aids</span><span class="p">)</span>
            <span class="n">back</span><span class="o">.</span><span class="n">sel_aids</span> <span class="o">=</span> <span class="n">sel_aids</span>
            <span class="n">back</span><span class="o">.</span><span class="n">ibswgt</span><span class="o">.</span><span class="n">set_selection_status</span><span class="p">(</span><span class="n">gh</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="n">back</span><span class="o">.</span><span class="n">sel_aids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sel_nids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sel_nids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">sel_nids</span><span class="p">)</span>
            <span class="n">back</span><span class="o">.</span><span class="n">sel_nids</span> <span class="o">=</span> <span class="n">sel_nids</span>
            <span class="n">back</span><span class="o">.</span><span class="n">ibswgt</span><span class="o">.</span><span class="n">set_selection_status</span><span class="p">(</span><span class="n">gh</span><span class="o">.</span><span class="n">NAMES_TREE</span><span class="p">,</span> <span class="n">back</span><span class="o">.</span><span class="n">sel_nids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sel_cm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;no select cm implemented&#39;</span><span class="p">)</span>
            <span class="n">back</span><span class="o">.</span><span class="n">sel_sel_qres</span> <span class="o">=</span> <span class="n">sel_cm</span>

<div class="viewcode-block" id="MainWindowBackend.select_imgsetid"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.select_imgsetid">[docs]</a>    <span class="k">def</span> <span class="nf">select_imgsetid</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">imgsetid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Table Click -&gt; Result Table &quot;&quot;&quot;</span>
        <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">cast_from_qt</span><span class="p">(</span><span class="n">imgsetid</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_caller_name</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;[back] select imageset imgsetid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imgsetid</span><span class="p">))</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_set_selection</span><span class="p">(</span><span class="n">sel_imgsetids</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.select_gid"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.select_gid">[docs]</a>    <span class="k">def</span> <span class="nf">select_gid</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">imgsetid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sel_aids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Table Click -&gt; Image Table</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(--gui)</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; import wbia</span>
<span class="sd">            &gt;&gt;&gt; print(&#39;&#39;&#39;</span>
<span class="sd">            &gt;&gt;&gt;           get_valid_gids</span>
<span class="sd">            &gt;&gt;&gt;           &#39;&#39;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; back = testdata_guiback()</span>
<span class="sd">            &gt;&gt;&gt; valid_gids = back.ibs.get_valid_gids()</span>
<span class="sd">            &gt;&gt;&gt; print(&#39;&#39;&#39;</span>
<span class="sd">            &gt;&gt;&gt;           get_valid_aids</span>
<span class="sd">            &gt;&gt;&gt;           &#39;&#39;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; valid_aids = back.ibs.get_valid_aids()</span>
<span class="sd">            &gt;&gt;&gt; #</span>
<span class="sd">            &gt;&gt;&gt; print(&#39;&#39;&#39;</span>
<span class="sd">            &gt;&gt;&gt; * len(valid_aids) = %r</span>
<span class="sd">            &gt;&gt;&gt; * len(valid_gids) = %r</span>
<span class="sd">            &gt;&gt;&gt; &#39;&#39;&#39; % (len(valid_aids), len(valid_gids)))</span>
<span class="sd">            &gt;&gt;&gt; assert len(valid_gids) &gt; 0, &#39;database images cannot be empty for test&#39;</span>
<span class="sd">            &gt;&gt;&gt; #</span>
<span class="sd">            &gt;&gt;&gt; gid = valid_gids[0]</span>
<span class="sd">            &gt;&gt;&gt; aid_list = back.ibs.get_image_aids(gid)</span>
<span class="sd">            &gt;&gt;&gt; aid = aid_list[-1]</span>
<span class="sd">            &gt;&gt;&gt; back.select_gid(gid, aids=[aid])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Select the first ANNOTATION in the image if unspecified</span>
        <span class="k">if</span> <span class="n">sel_aids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sel_aids</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sel_aids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sel_aids</span> <span class="o">=</span> <span class="n">sel_aids</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sel_aids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;[back] select_gid(gid=</span><span class="si">%r</span><span class="s1">, imgsetid=</span><span class="si">%r</span><span class="s1">, sel_aids=</span><span class="si">%r</span><span class="s1">)&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">imgsetid</span><span class="p">,</span> <span class="n">sel_aids</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_set_selection</span><span class="p">(</span>
            <span class="n">sel_gids</span><span class="o">=</span><span class="n">gid</span><span class="p">,</span> <span class="n">sel_aids</span><span class="o">=</span><span class="n">sel_aids</span><span class="p">,</span> <span class="n">sel_imgsetids</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">show_image</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">sel_aids</span><span class="o">=</span><span class="n">sel_aids</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="n">web</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.copy_species_to_imageset"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.copy_species_to_imageset">[docs]</a>    <span class="k">def</span> <span class="nf">copy_species_to_imageset</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">aid</span><span class="p">,</span> <span class="n">imgsetid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">species_rowid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_rowids</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_aids</span><span class="p">(</span><span class="n">imgsetid</span><span class="p">)</span>
        <span class="n">species_rowid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">species_rowid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_species_rowids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">species_rowid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">gh</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">])</span></div>

<div class="viewcode-block" id="MainWindowBackend.select_gid_from_aid"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.select_gid_from_aid">[docs]</a>    <span class="k">def</span> <span class="nf">select_gid_from_aid</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">aid</span><span class="p">,</span> <span class="n">imgsetid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">gid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">select_gid</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">imgsetid</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="n">web</span><span class="p">,</span> <span class="n">sel_aids</span><span class="o">=</span><span class="p">[</span><span class="n">aid</span><span class="p">])</span></div>

<div class="viewcode-block" id="MainWindowBackend.select_aid"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.select_aid">[docs]</a>    <span class="k">def</span> <span class="nf">select_aid</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span> <span class="n">aid</span><span class="p">,</span> <span class="n">imgsetid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_annotation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Table Click -&gt; Chip Table &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] select aid=</span><span class="si">%r</span><span class="s1">, imgsetid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aid</span><span class="p">,</span> <span class="n">imgsetid</span><span class="p">))</span>
        <span class="n">gid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
        <span class="n">nid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_name_rowids</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_set_selection</span><span class="p">(</span>
            <span class="n">sel_aids</span><span class="o">=</span><span class="n">aid</span><span class="p">,</span> <span class="n">sel_gids</span><span class="o">=</span><span class="n">gid</span><span class="p">,</span> <span class="n">sel_nids</span><span class="o">=</span><span class="n">nid</span><span class="p">,</span> <span class="n">sel_imgsetids</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span> <span class="ow">and</span> <span class="n">show_annotation</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">show_annotation</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span> <span class="n">web</span><span class="o">=</span><span class="n">web</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.select_nid"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.select_nid">[docs]</a>    <span class="nd">@backblock</span>
    <span class="k">def</span> <span class="nf">select_nid</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">imgsetid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Table Click -&gt; Name Table &quot;&quot;&quot;</span>
        <span class="n">nid</span> <span class="o">=</span> <span class="n">cast_from_qt</span><span class="p">(</span><span class="n">nid</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] select nid=</span><span class="si">%r</span><span class="s1">, imgsetid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="n">imgsetid</span><span class="p">))</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_set_selection</span><span class="p">(</span><span class="n">sel_nids</span><span class="o">=</span><span class="n">nid</span><span class="p">,</span> <span class="n">sel_imgsetids</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span> <span class="ow">and</span> <span class="n">show_name</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">show_name</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Action menu slots</span>
    <span class="c1"># --------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MainWindowBackend.add_annotation_from_image"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.add_annotation_from_image">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">add_annotation_from_image</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Context -&gt; Add Annotation from Image&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] add_annotation_from_image&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s1">&#39;must pass in list here&#39;</span>
        <span class="n">size_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_image_sizes</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">bbox_list</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="ow">in</span> <span class="n">size_list</span><span class="p">]</span>
        <span class="n">theta_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">add_annots</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">bbox_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">gh</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">aid_list</span></div>

<div class="viewcode-block" id="MainWindowBackend.delete_image_annotations"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.delete_image_annotations">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">delete_image_annotations</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))</span>
        <span class="n">back</span><span class="o">.</span><span class="n">delete_annot</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.delete_annot"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.delete_annot">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">delete_annot</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">aid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Action -&gt; Delete Annotation</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.gui.guiback --test-delete_annot --show</span>
<span class="sd">            python -m wbia.gui.guiback --test-delete_annot --show --no-api-cache</span>
<span class="sd">            python -m wbia.gui.guiback --test-delete_annot --show --assert-api-cache</span>
<span class="sd">            python -m wbia.gui.guiback --test-delete_annot --show --debug-api-cache --yes</span>

<span class="sd">        SeeAlso:</span>
<span class="sd">            manual_annot_funcs.delete_annots</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(--gui)</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; back = testdata_guiback()</span>
<span class="sd">            &gt;&gt;&gt; ibs = back.ibs</span>
<span class="sd">            &gt;&gt;&gt; imgsetid_list = back.ibs.get_valid_imgsetids()</span>
<span class="sd">            &gt;&gt;&gt; imgsetid = ut.take(imgsetid_list, ut.list_argmax(list(map(len, back.ibs.get_imageset_gids(imgsetid_list)))))</span>
<span class="sd">            &gt;&gt;&gt; back.front.select_imageset_tab(imgsetid)</span>
<span class="sd">            &gt;&gt;&gt; gid = back.ibs.get_imageset_gids(imgsetid)[0]</span>
<span class="sd">            &gt;&gt;&gt; # add a test annotation to delete</span>
<span class="sd">            &gt;&gt;&gt; aid_list = back.add_annotation_from_image([gid])</span>
<span class="sd">            &gt;&gt;&gt; # delte annotations</span>
<span class="sd">            &gt;&gt;&gt; aids1 = back.ibs.get_image_aids(gid)</span>
<span class="sd">            &gt;&gt;&gt; # Mock confirm deletion</span>
<span class="sd">            &gt;&gt;&gt; orig_are_you_sure = back.are_you_sure</span>
<span class="sd">            &gt;&gt;&gt; back.are_you_sure = lambda *args, **kwargs: True</span>
<span class="sd">            &gt;&gt;&gt; back.delete_annot(aid_list)</span>
<span class="sd">            &gt;&gt;&gt; back.are_you_sure = orig_are_you_sure</span>
<span class="sd">            &gt;&gt;&gt; aids2 = back.ibs.get_image_aids(gid)</span>
<span class="sd">            &gt;&gt;&gt; #assert len(aids2) == len(aids1) - 1</span>
<span class="sd">            &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">            &gt;&gt;&gt; gt.qtapp_loop(back.mainwin, frequency=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] delete_annot, aid_list = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aid_list</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">aid_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_aids</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">use_msg</span><span class="o">=</span><span class="s1">&#39;Delete </span><span class="si">%d</span><span class="s1"> annotations?&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">))):</span>
            <span class="k">return</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_set_selection3</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;diff&#39;</span><span class="p">)</span>
        <span class="c1"># get the image-id of the annotation we are deleting</span>
        <span class="c1"># gid_list = back.ibs.get_annot_gids(aid_list)</span>
        <span class="c1"># delete the annotation</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">delete_annots</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="c1"># Select only one image</span>
        <span class="c1"># try:</span>
        <span class="c1">#    if len(gid_list) &gt; 0:</span>
        <span class="c1">#        gid = gid_list[0]</span>
        <span class="c1"># except AttributeError:</span>
        <span class="c1">#    gid = gid_list</span>
        <span class="c1"># back.select_gid(gid, show=False)</span>
        <span class="c1"># update display, to show image without the deleted annotation</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.unset_names"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.unset_names">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">unset_names</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;[back] unsetting </span><span class="si">%d</span><span class="s1"> names&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_names</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="p">[</span><span class="n">const</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">))</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.toggle_thumbnails"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.toggle_thumbnails">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">toggle_thumbnails</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">ibswgt</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">front</span>
        <span class="n">tabwgt</span> <span class="o">=</span> <span class="n">ibswgt</span><span class="o">.</span><span class="n">_tables_tab_widget</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">tabwgt</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">tblname</span> <span class="o">=</span> <span class="n">ibswgt</span><span class="o">.</span><span class="n">tblname_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">ibswgt</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="n">tblname</span><span class="p">]</span>
        <span class="n">col_name_list</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">col_name_list</span>
        <span class="k">if</span> <span class="s1">&#39;thumb&#39;</span> <span class="ow">in</span> <span class="n">col_name_list</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">col_name_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;thumb&#39;</span><span class="p">)</span>
            <span class="n">view</span><span class="o">.</span><span class="n">col_hidden_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">view</span><span class="o">.</span><span class="n">col_hidden_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">view</span><span class="o">.</span><span class="n">hide_cols</span><span class="p">()</span>
            <span class="c1"># view.resizeRowsToContents() Too slow to use</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span></div>

    <span class="c1"># @blocking_slot(int)</span>
    <span class="c1"># @QtCore.pyqtSlot(int)</span>
<div class="viewcode-block" id="MainWindowBackend.delete_image"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.delete_image">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delete_image</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">gid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Action -&gt; Delete Images&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] delete_image, gid_list = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gid_list</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">gid_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">gid_list</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">back</span><span class="o">.</span><span class="n">get_selected_gid</span><span class="p">()]</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;delete </span><span class="si">%d</span><span class="s1"> images!&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))):</span>
            <span class="k">return</span>
        <span class="c1"># FIXME: The api cache seems to break here</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">delete_images</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">reset_table_cache</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.delete_all_imagesets"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.delete_all_imagesets">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">delete_all_imagesets</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">[back] delete all imagesets&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;delete ALL imagesets&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">delete_all_imagesets</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">update_special_imagesets_</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.update_special_imagesets_"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.update_special_imagesets_">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">update_special_imagesets_</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">use_more_special_imagesets</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">ensure_attr</span><span class="p">(</span>
            <span class="s1">&#39;use_more_special_imagesets&#39;</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">update_special_imagesets</span><span class="p">(</span><span class="n">use_more_special_imagesets</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGESET_TABLE</span><span class="p">])</span></div>

<div class="viewcode-block" id="MainWindowBackend.delete_imageset_and_images"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.delete_imageset_and_images">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delete_imageset_and_images</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">[back] delete_imageset_and_images&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">contains_special_imagesets</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">):</span>
            <span class="n">back</span><span class="o">.</span><span class="n">display_special_imagesets_error</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;delete this imageset AND ITS IMAGES!&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">))</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">delete_images</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">delete_imagesets</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">update_special_imagesets_</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.mark_imageset_as_shipped"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.mark_imageset_as_shipped">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">mark_imageset_as_shipped</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">[back] mark_imageset_as_shipped&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">contains_special_imagesets</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">):</span>
            <span class="n">back</span><span class="o">.</span><span class="n">display_special_imagesets_error</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;mark this imageset and shipped to Wildbook&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">set_imageset_shipped_flags</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">))</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">update_special_imagesets</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.delete_imageset"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.delete_imageset">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delete_imageset</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">[back] delete_imageset&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">contains_special_imagesets</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">):</span>
            <span class="n">back</span><span class="o">.</span><span class="n">display_special_imagesets_error</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;delete </span><span class="si">%d</span><span class="s1"> imagesets&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">))):</span>
            <span class="k">return</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">delete_imagesets</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">update_special_imagesets_</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.export_imagesets"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.export_imagesets">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">export_imagesets</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">[back] export imageset&#39;</span><span class="p">)</span>

        <span class="c1"># new_dbname = back.user_input(</span>
        <span class="c1">#    msg=&#39;What do you want to name the new database?&#39;,</span>
        <span class="c1">#    title=&#39;Export to New Database&#39;)</span>
        <span class="c1"># if new_dbname is None or len(new_dbname) == 0:</span>
        <span class="c1">#    logger.info(&#39;Abort export to new database. new_dbname=%r&#39; % new_dbname)</span>
        <span class="c1">#    return</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">export_imagesets</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">,</span> <span class="n">new_dbdir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.train_rf_with_imageset"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.train_rf_with_imageset">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">train_rf_with_imageset</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">wbia.algo.detect</span> <span class="kn">import</span> <span class="n">randomforest</span>

        <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">_eidfromkw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imgsetid</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">(</span><span class="n">imgsetid</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">)</span>
        <span class="n">species</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">species_text</span>
        <span class="k">if</span> <span class="n">species</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">species</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;[train_rf_with_imageset] Training Random Forest trees with imgsetid=</span><span class="si">%r</span><span class="s1"> and species=</span><span class="si">%r</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="n">imgsetid</span><span class="p">,</span>
                <span class="n">species</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">randomforest</span><span class="o">.</span><span class="n">train_gid_list</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">teardown</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.merge_imagesets"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.merge_imagesets">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">merge_imagesets</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">,</span> <span class="n">destination_imgsetid</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Cannot merge fewer than two imagesets&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;[back] merge_imagesets: </span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">destination_imgsetid</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">contains_special_imagesets</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">):</span>
            <span class="n">back</span><span class="o">.</span><span class="n">display_special_imagesets_error</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">destination_index</span> <span class="o">=</span> <span class="n">imgsetid_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">destination_imgsetid</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Default to the first value selected if the imgsetid doesn&#39;t exist in imgsetid_list</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;[back] merge_imagesets cannot find index for </span><span class="si">%r</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">destination_imgsetid</span><span class="p">,)</span>
            <span class="p">)</span>
            <span class="n">destination_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">destination_imgsetid</span> <span class="o">=</span> <span class="n">imgsetid_list</span><span class="p">[</span><span class="n">destination_index</span><span class="p">]</span>
        <span class="n">deprecated_imgsetids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">)</span>
        <span class="n">deprecated_imgsetids</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">destination_index</span><span class="p">)</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span>
            <span class="p">[</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">(</span><span class="n">imgsetid</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">)</span> <span class="k">for</span> <span class="n">imgsetid</span> <span class="ow">in</span> <span class="n">imgsetid_list</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">imgsetid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">destination_imgsetid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_image_imgsetids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_imagesets</span><span class="p">(</span><span class="n">deprecated_imgsetids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">imgsetid</span> <span class="ow">in</span> <span class="n">deprecated_imgsetids</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">imageset_tabwgt</span><span class="o">.</span><span class="n">_close_tab_with_imgsetid</span><span class="p">(</span><span class="n">imgsetid</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGESET_TABLE</span><span class="p">],</span> <span class="n">clear_view_selection</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.copy_imageset"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.copy_imageset">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">copy_imageset</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] copy_imageset: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imgsetid_list</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">contains_special_imagesets</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">):</span>
            <span class="n">back</span><span class="o">.</span><span class="n">display_special_imagesets_error</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">new_imgsetid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">copy_imagesets</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] new_imgsetid_list: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_imgsetid_list</span><span class="p">,))</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGESET_TABLE</span><span class="p">],</span> <span class="n">clear_view_selection</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.remove_from_imageset"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.remove_from_imageset">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">remove_from_imageset</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_imgsetid</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">unrelate_images_and_imagesets</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="p">[</span><span class="n">imgsetid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))</span>
        <span class="n">back</span><span class="o">.</span><span class="n">update_special_imagesets_</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">(</span>
            <span class="p">[</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">gh</span><span class="o">.</span><span class="n">IMAGESET_TABLE</span><span class="p">],</span> <span class="n">clear_view_selection</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.send_to_new_imageset"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.send_to_new_imageset">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">send_to_new_imageset</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;move&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Cannot create a new imageset with no images&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">[back] send_to_new_imageset&#39;</span><span class="p">)</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="c1"># imagesettext = const.NEW_IMAGESET_IMAGESETTEXT</span>
        <span class="c1"># imagesettext_list = [imagesettext] * len(gid_list)</span>
        <span class="c1"># ibs.set_image_imagesettext(gid_list, imagesettext_list)</span>
        <span class="n">new_imgsetid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">create_new_imageset_from_images</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>  <span class="c1"># NOQA</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;move&#39;</span><span class="p">:</span>
            <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_imgsetid</span><span class="p">()</span>
            <span class="n">imgsetid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">imgsetid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">unrelate_images_and_imagesets</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;copy&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;invalid mode=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,))</span>
        <span class="n">back</span><span class="o">.</span><span class="n">update_special_imagesets_</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">(</span>
            <span class="p">[</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">gh</span><span class="o">.</span><span class="n">IMAGESET_TABLE</span><span class="p">],</span> <span class="n">clear_view_selection</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Batch menu slots</span>
    <span class="c1"># --------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MainWindowBackend.imageset_set_species"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.imageset_set_species">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">imageset_set_species</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        HACK: sets the species columns of all annotations in the imageset</span>
<span class="sd">        to be whatever is currently in the detect config</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] imageset_set_species&#39;</span><span class="p">)</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_imgsetid</span><span class="p">()</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">imgsetid</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">)</span>
        <span class="n">species_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">species_text</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_species</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">])</span></div>

<div class="viewcode-block" id="MainWindowBackend.change_detection_species"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.change_detection_species">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">change_detection_species</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">species_text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; callback for combo box &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] change_detection_species(</span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">species_text</span><span class="p">))</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="c1"># Load full blown configs for each species</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">edit_prefs_wgt</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">edit_prefs_wgt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">species_text</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">cfgname</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">UNKNOWN</span>  <span class="c1"># &#39;cfg&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfgname</span> <span class="o">=</span> <span class="n">species_text</span>
        <span class="c1">#</span>
        <span class="n">current_species</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">species_text</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span> <span class="k">else</span> <span class="n">species_text</span>
        <span class="c1">#####</span>
        <span class="c1"># &lt;GENERAL CONFIG SAVE&gt;</span>
        <span class="n">config_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unixjoin</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_dbdir</span><span class="p">(),</span> <span class="s1">&#39;general_config.cPkl&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">general_config</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">load_cPkl</span><span class="p">(</span><span class="n">config_fpath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">general_config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">general_config</span><span class="p">[</span><span class="s1">&#39;current_species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_species</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">save_cPkl</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">unixjoin</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_dbdir</span><span class="p">(),</span> <span class="s1">&#39;general_config.cPkl&#39;</span><span class="p">),</span> <span class="n">general_config</span><span class="p">)</span>
        <span class="c1"># &lt;/GENERAL CONFIG SAVE&gt;</span>
        <span class="c1">#####</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">_load_named_config</span><span class="p">(</span><span class="n">cfgname</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">species_text</span> <span class="o">=</span> <span class="n">species_text</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>

        <span class="c1"># TODO: incorporate this as a signal in guiback which connects to a</span>
        <span class="c1"># slot in guifront</span>
        <span class="c1"># back.front.detect_button.setEnabled(</span>
        <span class="c1">#     ibs.has_species_detector(species_text)</span>
        <span class="c1"># )</span>

<div class="viewcode-block" id="MainWindowBackend.get_selected_species"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.get_selected_species">[docs]</a>    <span class="k">def</span> <span class="nf">get_selected_species</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">species_text</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">species_text</span>
        <span class="k">if</span> <span class="n">species_text</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">species_text</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;species_text = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species_text</span><span class="p">,))</span>

        <span class="k">if</span> <span class="n">species_text</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">species_text</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">:</span>
            <span class="c1"># hack to set species for user</span>
            <span class="k">pass</span>
            <span class="c1"># species_text = back.ibs.get_primary_database_species()</span>
            <span class="c1"># logger.info(&#39;\&#39;species_text = %r&#39; % (species_text,))</span>
            <span class="c1"># sig = signal_(str)</span>
            <span class="c1"># sig.connect(back.ibswgt.species_combo.setItemText)</span>
            <span class="c1"># back.ibswgt.species_combo.setItemText(species_text)</span>
            <span class="c1"># back.changeSpeciesSignal.emit(str(species_text))</span>
            <span class="c1"># sig.emit(species_text)</span>
            <span class="c1"># back.ibs.cfg.detect_cfg.species_text = species_text</span>
        <span class="k">return</span> <span class="n">species_text</span></div>

<div class="viewcode-block" id="MainWindowBackend.change_daids_mode"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.change_daids_mode">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">change_daids_mode</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] change_daids_mode(</span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span> <span class="o">=</span> <span class="n">value</span></div>
        <span class="c1"># ibs = back.ibs</span>
        <span class="c1"># ibs.cfg.detect_cfg.species_text = value</span>
        <span class="c1"># ibs.cfg.save()</span>

<div class="viewcode-block" id="MainWindowBackend.do_group_occurrence_step"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.do_group_occurrence_step">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">do_group_occurrence_step</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Group Step for computing occurrneces</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.gui.guiback --test-MainWindowBackend.do_group_occurrence_step --show --no-cnn</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(--gui)</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; import wbia</span>
<span class="sd">            &gt;&gt;&gt; main_locals = wbia.main(defaultdb=&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; ibs, back = ut.dict_take(main_locals, [&#39;ibs&#39;, &#39;back&#39;])</span>
<span class="sd">            &gt;&gt;&gt; ut.exec_funckw(back.do_group_occurrence_step, globals())</span>
<span class="sd">            &gt;&gt;&gt; # Mock choosing &quot;Create new occurrences&quot;</span>
<span class="sd">            &gt;&gt;&gt; orig_user_option = back.user_option</span>
<span class="sd">            &gt;&gt;&gt; back.user_option = lambda *args, **kwargs: (&#39;Create new occurrences&#39;, None)</span>
<span class="sd">            &gt;&gt;&gt; back.do_group_occurrence_step()</span>
<span class="sd">            &gt;&gt;&gt; back.user_option = orig_user_option</span>
<span class="sd">            &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] do_group_occurrence_step&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">wbia</span> <span class="kn">import</span> <span class="n">dtool</span>

        <span class="c1"># class TmpConfig(dtool.Config):</span>
        <span class="c1">#    _param_info_list = back.ibs.cfg.occur_cfg.get_param_info_list()</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>

        <span class="n">ungrouped_gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_ungrouped_gids</span><span class="p">()</span>
        <span class="c1"># ungrouped_images = ibs.get_image_instancelist(ungrouped_gid_list)</span>
        <span class="c1"># image_list[&#39;unixtime&#39;]</span>

        <span class="n">existing_imgset_id_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_imgsetids</span><span class="p">(</span>
            <span class="n">is_occurrence</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shipped</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_num_gids</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="k">class</span> <span class="nc">TmpConfig</span><span class="p">(</span><span class="n">dtool</span><span class="o">.</span><span class="n">Config</span><span class="p">):</span>
            <span class="n">_param_info_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span><span class="s1">&#39;seconds_thresh&#39;</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="s1">&#39;sec&#39;</span><span class="p">),</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span><span class="s1">&#39;use_gps&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="p">]</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">TmpConfig</span><span class="p">(</span><span class="o">**</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">occur_cfg</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;Create new occurrences&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Add to existing&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Regroup all&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">reply</span><span class="p">,</span> <span class="n">new_config</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">user_option</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Occurrence Grouping&#39;</span><span class="p">,</span>
            <span class="n">msg</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Choose how we should group the %d ungrouped images into occurrences.</span>
<span class="sd">                We can either:</span>
<span class="sd">                    (1) append new occurrences</span>
<span class="sd">                    (2) add to the %d existing occurrences</span>
<span class="sd">                    (3) redo everything</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ungrouped_gid_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_imgset_id_list</span><span class="p">)),</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;reply = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reply</span><span class="p">,))</span>

        <span class="k">if</span> <span class="n">reply</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span>

        <span class="k">if</span> <span class="n">reply</span> <span class="o">!=</span> <span class="n">options</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ungrouped_gid_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">user_warning</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;There are no ungrouped images.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span>

        <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">compute_occurrences</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">new_config</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">options</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="c1"># Add to existing imaesets</span>
            <span class="n">imagesettext_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_text</span><span class="p">(</span><span class="n">existing_imgset_id_list</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

            <span class="c1"># Get unixtimes of the new images</span>
            <span class="n">unixtime_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_unixtime</span><span class="p">(</span><span class="n">ungrouped_gid_list</span><span class="p">)</span>
            <span class="c1"># Get unixtimes of the occurrences</span>
            <span class="n">imgset_gids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">existing_imgset_id_list</span><span class="p">)</span>
            <span class="n">imgset_unixtimes_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span>
                <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_unixtime</span><span class="p">,</span> <span class="n">imgset_gids_list</span>
            <span class="p">)</span>
            <span class="c1"># imageset_start_time_posix_list = np.array(ut.lmap(np.min, unixtimes_list))</span>
            <span class="n">imageset_mean_time_posix_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">lmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">imgset_unixtimes_list</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># imageset_end_time_posix_list = np.array(ut.lmap(np.max, unixtimes_list))</span>

            <span class="n">assigned_idx</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">imageset_mean_time_posix_list</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unixtime_list</span>
            <span class="p">]</span>
            <span class="n">assigned_imgset</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">imagesettext_list</span><span class="p">,</span> <span class="n">assigned_idx</span><span class="p">)</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">set_image_imagesettext</span><span class="p">(</span><span class="n">ungrouped_gid_list</span><span class="p">,</span> <span class="n">assigned_imgset</span><span class="p">)</span>
            <span class="c1"># HACK TO UPDATE IMAGESET POSIX TIMES</span>
            <span class="c1"># CAREFUL THIS BLOWS AWAY SMART DATA</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">update_imageset_info</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_imgsetids</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">options</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">use_msg</span><span class="o">=</span><span class="s1">&#39;Regrouping will destroy all existing groups&#39;</span><span class="p">):</span>
                <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">delete_all_imagesets</span><span class="p">()</span>
                <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">compute_occurrences</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">new_config</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span>

        <span class="n">back</span><span class="o">.</span><span class="n">update_special_imagesets_</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] about to finish computing imagesets&#39;</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">imageset_tabwgt</span><span class="o">.</span><span class="n">_close_all_tabs</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] finished computing imagesets&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.run_detection_step"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.run_detection_step">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run_detection_step</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            refresh (bool): (default = True)</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.gui.guiback run_detection_step --show</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(--gui)</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; import wbia</span>
<span class="sd">            &gt;&gt;&gt; main_locals = wbia.main(defaultdb=&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; ibs, back = ut.dict_take(main_locals, [&#39;ibs&#39;, &#39;back&#39;])</span>
<span class="sd">            &gt;&gt;&gt; ut.exec_funckw(back.run_detection_step, globals())</span>
<span class="sd">            &gt;&gt;&gt; back.run_detection_step()</span>
<span class="sd">            &gt;&gt;&gt; back.cleanup()</span>
<span class="sd">            &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">_eidfromkw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>

        <span class="c1"># Get images without any annotations</span>
        <span class="n">set_gids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">(</span><span class="n">imgsetid</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">)</span>
        <span class="n">is_empty</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_num_annotations</span><span class="p">(</span><span class="n">set_gids</span><span class="p">)]</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">set_gids</span><span class="p">,</span> <span class="n">is_empty</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] run_detection_step(imgsetid=</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imgsetid</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] detected </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> empty gids&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">set_gids</span><span class="p">)))</span>

        <span class="n">imgset_text</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_text</span><span class="p">(</span><span class="n">imgsetid</span><span class="p">)</span>

        <span class="n">detector</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">detector</span>

        <span class="n">review_in_web</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">comp_name</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_computer_name</span><span class="p">()</span>
        <span class="n">db_name</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbname</span>
        <span class="n">is_lewa</span> <span class="o">=</span> <span class="n">comp_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;wbia.cs.uic.edu&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">db_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;LEWA&#39;</span><span class="p">,</span> <span class="s1">&#39;lewa_grevys&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">is_lewa</span><span class="p">:</span>
            <span class="n">review_in_web_mode</span> <span class="o">=</span> <span class="s1">&#39;annotations&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">review_in_web_mode</span> <span class="o">=</span> <span class="s1">&#39;detections&#39;</span>
        <span class="c1"># review_in_web_mode = &#39;annotations&#39;</span>
        <span class="k">assert</span> <span class="n">review_in_web_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;detections&#39;</span><span class="p">,</span> <span class="s1">&#39;annotations&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># TODO better confirm dialog</span>
            <span class="kn">from</span> <span class="nn">wbia</span> <span class="kn">import</span> <span class="n">dtool</span>

            <span class="n">species_text</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_all_species_texts</span><span class="p">()</span>
            <span class="n">species_nice</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_all_species_nice</span><span class="p">()</span>

            <span class="k">class</span> <span class="nc">TmpDetectConfig</span><span class="p">(</span><span class="n">dtool</span><span class="o">.</span><span class="n">Config</span><span class="p">):</span>
                <span class="n">_param_info_list</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span><span class="s1">&#39;review_in_web&#39;</span><span class="p">,</span> <span class="n">review_in_web</span><span class="p">),</span>
                    <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span>
                        <span class="s1">&#39;detector&#39;</span><span class="p">,</span>
                        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">detector</span><span class="p">,</span>
                        <span class="n">valid_values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cnn&#39;</span><span class="p">,</span> <span class="s1">&#39;rf&#39;</span><span class="p">],</span>
                    <span class="p">),</span>
                    <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span>
                        <span class="s1">&#39;species&#39;</span><span class="p">,</span>
                        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">species_text</span><span class="p">,</span>
                        <span class="n">valid_values</span><span class="o">=</span><span class="n">species_nice</span><span class="p">,</span>
                        <span class="n">hideif</span><span class="o">=</span><span class="k">lambda</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;detector&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;rf&#39;</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">]</span>

            <span class="n">config</span> <span class="o">=</span> <span class="n">TmpDetectConfig</span><span class="p">(</span><span class="o">**</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;Start Detection&#39;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">reply</span><span class="p">,</span> <span class="n">new_config</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">user_option</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Run Detection Confirmation&#39;</span><span class="p">,</span>
                <span class="n">msg</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    Preparing to run detection on %d images in \&#39;%s\&#39;.</span>
<span class="sd">                    &quot;&quot;&quot;</span>
                <span class="p">)</span>
                <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">),</span> <span class="n">imgset_text</span><span class="p">),</span>
                <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;reply = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reply</span><span class="p">,))</span>

            <span class="k">if</span> <span class="n">reply</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span>

            <span class="n">review_in_web</span> <span class="o">=</span> <span class="n">new_config</span><span class="p">[</span><span class="s1">&#39;review_in_web&#39;</span><span class="p">]</span>
            <span class="n">detector</span> <span class="o">=</span> <span class="n">new_config</span><span class="p">[</span><span class="s1">&#39;detector&#39;</span><span class="p">]</span>
            <span class="n">species</span> <span class="o">=</span> <span class="n">new_config</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span>
            <span class="n">nice2_text</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">species_nice</span><span class="p">,</span> <span class="n">species_text</span><span class="p">))</span>
            <span class="n">species</span> <span class="o">=</span> <span class="n">nice2_text</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">detector</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cnn&#39;</span><span class="p">,</span> <span class="s1">&#39;cnn_yolo&#39;</span><span class="p">,</span> <span class="s1">&#39;yolo&#39;</span><span class="p">]:</span>
                <span class="n">ibs</span><span class="o">.</span><span class="n">detect_cnn_yolo</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
                <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">gh</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">detector</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;random_forest&#39;</span><span class="p">,</span> <span class="s1">&#39;rf&#39;</span><span class="p">]:</span>
                <span class="n">ibs</span><span class="o">.</span><span class="n">detect_random_forest</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Detector=</span><span class="si">%r</span><span class="s1"> not recognized&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">detector</span><span class="p">,))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] about to finish detection&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
                <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">gh</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># OLD CODE</span>
            <span class="k">if</span> <span class="n">detector</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cnn&#39;</span><span class="p">,</span> <span class="s1">&#39;cnn_yolo&#39;</span><span class="p">,</span> <span class="s1">&#39;yolo&#39;</span><span class="p">]:</span>
                <span class="c1"># Construct message</span>
                <span class="n">msg_fmtstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;You are about to run detection using CNN YOLO...&#39;</span><span class="p">]</span>
                <span class="n">fmtdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="c1"># Append detection configuration information</span>
                <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;    Images:   </span><span class="si">{num_gids}</span><span class="s1">&#39;</span><span class="p">]</span>  <span class="c1"># Add more spaces</span>
                <span class="c1"># msg_fmtstr_list += [&#39;* # database annotations={num_daids}.&#39;]</span>
                <span class="c1"># msg_fmtstr_list += [&#39;* database species={d_species_phrase}.&#39;]</span>
                <span class="n">fmtdict</span><span class="p">[</span><span class="s1">&#39;num_gids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
                <span class="c1"># Finish building confirmation message</span>
                <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
                <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;Press &#39;Yes&#39; to continue&quot;</span><span class="p">]</span>
                <span class="n">msg_fmtstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg_fmtstr_list</span><span class="p">)</span>
                <span class="n">msg_str</span> <span class="o">=</span> <span class="n">msg_fmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">fmtdict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">use_msg</span><span class="o">=</span><span class="n">msg_str</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] run_detection_step(imgsetid=</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imgsetid</span><span class="p">))</span>
                    <span class="n">ibs</span><span class="o">.</span><span class="n">detect_cnn_yolo</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] about to finish detection&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
                        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">gh</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">])</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] finished detection&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">detector</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;random_forest&#39;</span><span class="p">,</span> <span class="s1">&#39;rf&#39;</span><span class="p">]:</span>
                <span class="n">species</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">species_text</span>
                <span class="c1"># Construct message</span>
                <span class="n">msg_fmtstr_list</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s1">&#39;You are about to run detection using Random Forests...&#39;</span>
                <span class="p">]</span>
                <span class="n">fmtdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="c1"># Append detection configuration information</span>
                <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;    Images:   </span><span class="si">{num_gids}</span><span class="s1">&#39;</span><span class="p">]</span>  <span class="c1"># Add more spaces</span>
                <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;    Species: </span><span class="si">{species_phrase}</span><span class="s1">&#39;</span><span class="p">]</span>
                <span class="c1"># msg_fmtstr_list += [&#39;* # database annotations={num_daids}.&#39;]</span>
                <span class="c1"># msg_fmtstr_list += [&#39;* database species={d_species_phrase}.&#39;]</span>
                <span class="n">fmtdict</span><span class="p">[</span><span class="s1">&#39;num_gids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
                <span class="n">fmtdict</span><span class="p">[</span><span class="s1">&#39;species_phrase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">species</span>
                <span class="c1"># Finish building confirmation message</span>
                <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
                <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;Press &#39;Yes&#39; to continue&quot;</span><span class="p">]</span>
                <span class="n">msg_fmtstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg_fmtstr_list</span><span class="p">)</span>
                <span class="n">msg_str</span> <span class="o">=</span> <span class="n">msg_fmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">fmtdict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">use_msg</span><span class="o">=</span><span class="n">msg_str</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s1">&#39;[back] run_detection_step(species=</span><span class="si">%r</span><span class="s1">, imgsetid=</span><span class="si">%r</span><span class="s1">)&#39;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">imgsetid</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">ibs</span><span class="o">.</span><span class="n">detect_random_forest</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] about to finish detection&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
                        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">gh</span><span class="o">.</span><span class="n">ANNOTATION_TABLE</span><span class="p">])</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] finished detection&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Detector not recognized&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">review_in_web</span><span class="p">:</span>
            <span class="c1"># back.user_info(msg=&#39;Detection has finished. Launching web review&#39;)</span>
            <span class="n">web_domain</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_background_web_domain</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">review_in_web_mode</span> <span class="o">==</span> <span class="s1">&#39;annotations&#39;</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">/turk/annotation/?imgsetid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">web_domain</span><span class="p">,</span>
                    <span class="n">imgsetid</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">review_in_web_mode</span> <span class="o">==</span> <span class="s1">&#39;detections&#39;</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">/turk/detection/?imgsetid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">web_domain</span><span class="p">,</span>
                    <span class="n">imgsetid</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid value for review_in_web_mode&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[guiback] Opening... </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,))</span>
            <span class="kn">import</span> <span class="nn">webbrowser</span>

            <span class="n">back</span><span class="o">.</span><span class="n">start_web_server_parallel</span><span class="p">(</span><span class="n">browser</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">user_info</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Detection has finished.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_advanced_id_interface"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_advanced_id_interface">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">show_advanced_id_interface</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.gui.guiback show_advanced_id_interface --show</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(--gui)</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; import wbia</span>
<span class="sd">            &gt;&gt;&gt; main_locals = wbia.main(defaultdb=&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; ibs, back = ut.dict_take(main_locals, [&#39;ibs&#39;, &#39;back&#39;])</span>
<span class="sd">            &gt;&gt;&gt; ut.exec_funckw(back.show_advanced_id_interface, globals())</span>
<span class="sd">            &gt;&gt;&gt; back.show_advanced_id_interface()</span>
<span class="sd">            &gt;&gt;&gt; back.cleanup()</span>
<span class="sd">            &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">            &gt;&gt;&gt; #gt.ensure_qapp()  # must be ensured before any embeding</span>
<span class="sd">            &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">            &gt;&gt;&gt; gt.qtapp_loop(qwin=back)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># from wbia.init import filter_annots</span>
        <span class="c1"># filter_kw = filter_annots.get_default_annot_filter_form()</span>

        <span class="n">back</span><span class="o">.</span><span class="n">custom_query_widget</span> <span class="o">=</span> <span class="n">CustomAnnotCfgSelector</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">custom_query_widget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">get_qtapp</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">custom_query_widget</span><span class="o">.</span><span class="n">onstart</span><span class="p">()</span></div>
        <span class="c1"># back.custom_query_widget.apply_new_config()</span>
        <span class="c1"># dlg = wgt.as_dialog(back)</span>
        <span class="c1"># dlg.show()</span>
        <span class="c1"># dlg.exec_()</span>
        <span class="c1"># if not wgt.accept_flag:</span>
        <span class="c1">#    #reply not in options:</span>
        <span class="c1">#    raise guiexcept.UserCancel</span>
        <span class="c1"># back.compute_queries(qaid_list=wgt.qaids, daid_list=back.daids)</span>

<div class="viewcode-block" id="MainWindowBackend.confirm_query_dialog2"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.confirm_query_dialog2">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_query_dialog2</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span>
        <span class="n">species2_expanded_aids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cfgdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">query_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">query_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">review_cfg</span><span class="o">=</span><span class="p">{},</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asks the user to confirm starting the identification query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg_str</span><span class="p">,</span> <span class="n">detailed_msg</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">make_confirm_query_msg2</span><span class="p">(</span>
            <span class="n">species2_expanded_aids</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">,</span> <span class="n">query_title</span><span class="o">=</span><span class="n">query_title</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">query_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_title</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
        <span class="n">confirm_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">use_msg</span><span class="o">=</span><span class="n">msg_str</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Begin </span><span class="si">%s</span><span class="s1"> ID&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">query_title</span><span class="p">,),</span>
            <span class="n">default</span><span class="o">=</span><span class="s1">&#39;Yes&#39;</span><span class="p">,</span>
            <span class="n">detailed_msg</span><span class="o">=</span><span class="n">detailed_msg</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># TODO better confirm dialog</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">wbia</span> <span class="kn">import</span> <span class="n">dtool</span>

            <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>  <span class="c1"># NOQA</span>
            <span class="c1"># class TmpIDConfig(dtool.Config):</span>
            <span class="c1">#    _param_info_list = [</span>
            <span class="c1">#        #ut.ParamInfo(&#39;K&#39;, ibs.cfg.query_cfg.nn_cfg.K),</span>
            <span class="c1">#        #ut.ParamInfo(&#39;Knorm&#39;, ibs.cfg.query_cfg.nn_cfg.Knorm),</span>
            <span class="c1">#        #ut.ParamInfo(&#39;chip_size&#39;, ibs.cfg.chip_cfg.dim_size),</span>
            <span class="c1">#    ]</span>
            <span class="c1"># **back.ibs.cfg.to_dict())</span>
            <span class="c1"># config = TmpIDConfig()</span>

            <span class="n">review_config</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;filter_reviewed&#39;</span><span class="p">:</span> <span class="n">review_cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s1">&#39;filter_reviewed&#39;</span><span class="p">,</span>
                    <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">ensure_attr</span><span class="p">(</span><span class="s1">&#39;filter_reviewed&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="s1">&#39;ranks_top&#39;</span><span class="p">:</span> <span class="n">review_cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s1">&#39;ranks_top&#39;</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">ensure_attr</span><span class="p">(</span><span class="s1">&#39;ranks_top&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s1">&#39;filter_true_matches&#39;</span><span class="p">:</span> <span class="n">review_cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filter_true_matches&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">cfgdict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">tmpdict</span> <span class="o">=</span> <span class="n">cfgdict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">tmpdict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">review_config</span><span class="p">)</span>

            <span class="n">config</span> <span class="o">=</span> <span class="n">dtool</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">tmpdict</span><span class="p">)</span>

            <span class="c1"># logger.info(&#39;config = %r&#39; % (config,))</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;Start ID&#39;</span><span class="p">,</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">((</span><span class="s1">&#39;--yes&#39;</span><span class="p">,</span> <span class="s1">&#39;-y&#39;</span><span class="p">)):</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">new_config</span> <span class="o">=</span> <span class="n">config</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reply</span><span class="p">,</span> <span class="n">new_config</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">user_option</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Begin </span><span class="si">%s</span><span class="s1"> ID&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">query_title</span><span class="p">,),</span>
                    <span class="n">msg</span><span class="o">=</span><span class="n">msg_str</span><span class="p">,</span>
                    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">detailed_msg</span><span class="o">=</span><span class="n">detailed_msg</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;reply = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reply</span><span class="p">,))</span>
            <span class="n">updated_config</span> <span class="o">=</span> <span class="n">new_config</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
            <span class="n">updated_review_cfg</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_subset</span><span class="p">(</span><span class="n">updated_config</span><span class="p">,</span> <span class="n">review_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">delete_dict_keys</span><span class="p">(</span><span class="n">updated_config</span><span class="p">,</span> <span class="n">review_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">reply</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span>
            <span class="k">return</span> <span class="n">updated_config</span><span class="p">,</span> <span class="n">updated_review_cfg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="o">**</span><span class="n">confirm_kw</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span></div>

<div class="viewcode-block" id="MainWindowBackend.compute_queries"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.compute_queries">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">compute_queries</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span>
        <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">daids_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">query_is_known</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">qaid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">use_prioritized_name_subset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">use_visual_selection</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cfgdict</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">query_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">custom_qaid_list_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">daid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">partition_queries_by_species</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MAIN QUERY FUNCTION</span>

<span class="sd">        execute_query</span>

<span class="sd">        Batch -&gt; Compute OldStyle Queries</span>
<span class="sd">        and Actions -&gt; Query</span>

<span class="sd">        Computes query results for all annotations in an imageset.</span>
<span class="sd">        Results are either vs-exemplar or intra-imageset</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            ./reset_dbs.py &amp;&amp; ./main.py --query 1 -y</span>
<span class="sd">            ./reset_dbs.py --reset-mtest &amp;&amp; ./main.py --query 1 -y --db PZ_MTEST --progtext</span>
<span class="sd">            ./main.py --query 1 -y</span>
<span class="sd">            python -m wbia --query 1 -y</span>
<span class="sd">            python -m wbia --query 1:119 --db PZ_MTEST --nocache-query --nocache-nnmid -y</span>
<span class="sd">            python -m wbia --query 1:119 --db PZ_MTEST --nocache-query --nocache-nnmid -y --force-all-progress</span>
<span class="sd">            python -m wbia --query 1:119 --db PZ_MTEST --nocache-query --nocache-nnmid --hots-batch-size=3 -y</span>
<span class="sd">            python -m wbia --query 1:119 --db PZ_MTEST --nocache-query --nocache-nnmid --hots-batch-size=3 -y</span>
<span class="sd">            python -m wbia --query 1:119 --db PZ_MTEST --nocache-query --nocache-nnmid --hots-batch-size=32 -y</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; import wbia</span>
<span class="sd">            &gt;&gt;&gt; main_locals = wbia.main(db=&#39;testdb2&#39;)</span>
<span class="sd">            &gt;&gt;&gt; back = main_locals[&#39;back&#39;]</span>
<span class="sd">            &gt;&gt;&gt; ibs = back.ibs</span>
<span class="sd">            &gt;&gt;&gt; query_is_known = None</span>
<span class="sd">            &gt;&gt;&gt; refresh = True</span>
<span class="sd">            &gt;&gt;&gt; daids_mode = None</span>
<span class="sd">            &gt;&gt;&gt; imgsetid = None</span>
<span class="sd">            &gt;&gt;&gt; kwargs = {}</span>
<span class="sd">            &gt;&gt;&gt; print(result)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">_eidfromkw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;------&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;[back] compute_queries: imgsetid=</span><span class="si">%r</span><span class="s1">, mode=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imgsetid</span><span class="p">,</span> <span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;[back] use_prioritized_name_subset = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">use_prioritized_name_subset</span><span class="p">,)</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] use_visual_selection        = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">use_visual_selection</span><span class="p">,))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] daids_mode                  = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">daids_mode</span><span class="p">,))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] cfgdict                     = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cfgdict</span><span class="p">,))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] query_is_known              = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">query_is_known</span><span class="p">,))</span>

        <span class="k">if</span> <span class="n">qaid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">custom_qaid_list_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">custom_qaid_list_title</span> <span class="o">=</span> <span class="s1">&#39;Custom&#39;</span>
            <span class="n">qaid_title</span> <span class="o">=</span> <span class="n">custom_qaid_list_title</span>
        <span class="k">elif</span> <span class="n">use_visual_selection</span><span class="p">:</span>
            <span class="n">qaid_title</span> <span class="o">=</span> <span class="s1">&#39;Selected&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if not visual selection, then qaids are selected by imageset</span>
            <span class="n">qaid_title</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_text</span><span class="p">(</span><span class="n">imgsetid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_prioritized_name_subset</span><span class="p">:</span>
            <span class="n">qaid_title</span> <span class="o">+=</span> <span class="s1">&#39;(priority_subset)&#39;</span>

        <span class="c1"># Set title variables</span>
        <span class="n">daid_title</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">daids_mode</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">VS_EXEMPLARS_KEY</span><span class="p">:</span>
            <span class="n">daid_title</span> <span class="o">=</span> <span class="s1">&#39;Exemplars&#39;</span>
        <span class="k">elif</span> <span class="n">daids_mode</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">INTRA_OCCUR_KEY</span><span class="p">:</span>
            <span class="n">daid_title</span> <span class="o">=</span> <span class="s1">&#39;Intra ImageSet&#39;</span>
        <span class="k">elif</span> <span class="n">daids_mode</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
            <span class="n">daid_title</span> <span class="o">=</span> <span class="s1">&#39;Everything&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Unknown daids_mode=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">daids_mode</span><span class="p">,))</span>

        <span class="n">query_title</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-vs-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qaid_title</span><span class="p">,</span> <span class="n">daid_title</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;query_title = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">query_title</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">daids_mode</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">VS_EXEMPLARS_KEY</span><span class="p">:</span>
            <span class="c1"># Automatic setting of exemplars</span>
            <span class="n">back</span><span class="o">.</span><span class="n">set_exemplars_from_quality_and_viewpoint_</span><span class="p">()</span>

        <span class="n">species2_expanded_aids</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">_get_expanded_aids_groups</span><span class="p">(</span>
            <span class="n">imgsetid</span><span class="p">,</span>
            <span class="n">daids_mode</span><span class="o">=</span><span class="n">daids_mode</span><span class="p">,</span>
            <span class="n">use_prioritized_name_subset</span><span class="o">=</span><span class="n">use_prioritized_name_subset</span><span class="p">,</span>
            <span class="n">use_visual_selection</span><span class="o">=</span><span class="n">use_visual_selection</span><span class="p">,</span>
            <span class="n">qaid_list</span><span class="o">=</span><span class="n">qaid_list</span><span class="p">,</span>
            <span class="n">daid_list</span><span class="o">=</span><span class="n">daid_list</span><span class="p">,</span>
            <span class="n">query_is_known</span><span class="o">=</span><span class="n">query_is_known</span><span class="p">,</span>
            <span class="n">partition_queries_by_species</span><span class="o">=</span><span class="n">partition_queries_by_species</span><span class="p">,</span>
            <span class="n">remove_unknown_species</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">partition_queries_by_species</span><span class="p">:</span>
            <span class="c1"># hack: overwrite species2_expanded_aids to undo species partition</span>
            <span class="n">all_qaids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">all_daids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">_qaids</span><span class="p">,</span> <span class="n">_daids</span> <span class="ow">in</span> <span class="n">species2_expanded_aids</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">all_qaids</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_qaids</span><span class="p">)</span>
                <span class="n">all_daids</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_daids</span><span class="p">)</span>
            <span class="n">species2_expanded_aids</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;all_species&#39;</span><span class="p">:</span> <span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">all_qaids</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_daids</span><span class="p">))</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">species2_expanded_aids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">InvalidRequest</span><span class="p">(</span>
                <span class="s1">&#39;Is the database empty? Are species labels assigned correctly? &#39;</span>
                <span class="s1">&#39;There are no pairs of query and database annotations with the same species&#39;</span>
            <span class="p">)</span>

        <span class="n">review_cfg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">review_cfg</span><span class="p">[</span><span class="s1">&#39;filter_true_matches&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">daids_mode</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">VS_EXEMPLARS_KEY</span>

        <span class="c1"># Check if there is nothing to do</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">species</span><span class="p">,</span> <span class="n">expanded_aids</span> <span class="ow">in</span> <span class="n">species2_expanded_aids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span> <span class="o">=</span> <span class="n">expanded_aids</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qaids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">daids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">daids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">flags</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;No need to compute a query against itself&#39;</span><span class="p">)</span>

        <span class="n">cfgdict</span><span class="p">,</span> <span class="n">review_cfg</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">confirm_query_dialog2</span><span class="p">(</span>
            <span class="n">species2_expanded_aids</span><span class="p">,</span>
            <span class="n">query_msg</span><span class="o">=</span><span class="n">query_msg</span><span class="p">,</span>
            <span class="n">query_title</span><span class="o">=</span><span class="n">query_title</span><span class="p">,</span>
            <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">,</span>
            <span class="n">review_cfg</span><span class="o">=</span><span class="n">review_cfg</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;cfgdict = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cfgdict</span><span class="p">,))</span>

        <span class="n">prog_bar</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">prog_bar</span>
        <span class="n">prog_bar</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">prog_bar</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Initialize query&#39;</span><span class="p">)</span>
        <span class="n">prog_hook</span> <span class="o">=</span> <span class="n">prog_bar</span><span class="o">.</span><span class="n">utool_prog_hook</span>
        <span class="c1"># prog_bar = guitool.newProgressBar(None)  # back.front)</span>
        <span class="c1"># Doesn&#39;t seem to work correctly</span>
        <span class="c1"># prog_hook.show_indefinite_progress()</span>
        <span class="n">prog_hook</span><span class="o">.</span><span class="n">force_event_update</span><span class="p">()</span>
        <span class="c1"># prog_hook.set_progress(0)</span>
        <span class="n">prog_bar</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Start query&#39;</span><span class="p">)</span>
        <span class="c1"># import utool</span>
        <span class="c1"># utool.embed()</span>

        <span class="n">query_results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ut</span><span class="o">.</span><span class="n">ProgressIter</span><span class="p">(</span>
            <span class="n">species2_expanded_aids</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">prog_hook</span><span class="o">=</span><span class="n">prog_hook</span>
        <span class="p">):</span>
            <span class="n">prog_bar</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Initialize </span><span class="si">%r</span><span class="s1"> query&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,))</span>
            <span class="n">qreq_</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
            <span class="n">prog_hook</span><span class="o">.</span><span class="n">initialize_subhooks</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">subhook</span> <span class="o">=</span> <span class="n">prog_hook</span><span class="o">.</span><span class="n">next_subhook</span><span class="p">()</span>
            <span class="n">cm_list</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">prog_hook</span><span class="o">=</span><span class="n">subhook</span><span class="p">)</span>
            <span class="n">query_results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cm_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>

            <span class="c1"># HACK IN IMAGESET INFO</span>
            <span class="k">if</span> <span class="n">daids_mode</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">INTRA_OCCUR_KEY</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">cm</span> <span class="ow">in</span> <span class="n">cm_list</span><span class="p">:</span>
                    <span class="c1"># if cm is not None:</span>
                    <span class="n">cm</span><span class="o">.</span><span class="n">imgsetid</span> <span class="o">=</span> <span class="n">imgsetid</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">prog_bar</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] About to finish compute_queries: imgsetid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imgsetid</span><span class="p">,))</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">query_results</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="p">(</span><span class="n">cm_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span> <span class="o">=</span> <span class="n">query_results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="c1"># Filter duplicate names if running vsexemplar</span>
            <span class="n">back</span><span class="o">.</span><span class="n">review_queries</span><span class="p">(</span>
                <span class="n">cm_list</span><span class="p">,</span>
                <span class="n">qreq_</span><span class="o">=</span><span class="n">qreq_</span><span class="p">,</span>
                <span class="n">query_title</span><span class="o">=</span><span class="n">query_title</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
                <span class="n">review_cfg</span><span class="o">=</span><span class="n">review_cfg</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] FINISHED compute_queries: imgsetid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imgsetid</span><span class="p">,))</span></div>

<div class="viewcode-block" id="MainWindowBackend.get_selected_daids"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.get_selected_daids">[docs]</a>    <span class="k">def</span> <span class="nf">get_selected_daids</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span> <span class="n">imgsetid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">daids_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">daids_mode</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span> <span class="k">if</span> <span class="n">daids_mode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">daids_mode</span>
        <span class="n">daids_mode_valid_kw_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">const</span><span class="o">.</span><span class="n">VS_EXEMPLARS_KEY</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is_exemplar&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="n">const</span><span class="o">.</span><span class="n">INTRA_OCCUR_KEY</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;imgsetid&#39;</span><span class="p">:</span> <span class="n">imgsetid</span><span class="p">},</span>
            <span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">qaid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">species</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
            <span class="n">hist_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_hist</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] len(qaid_list)=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">)))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] hist_ = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hist_</span><span class="p">,))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hist_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># select the query species if there is only one</span>
                <span class="n">species</span> <span class="o">=</span> <span class="n">hist_</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">species</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_species</span><span class="p">()</span>

        <span class="n">valid_kw</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;minqual&#39;</span><span class="p">:</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">species</span> <span class="o">!=</span> <span class="n">const</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">:</span>
            <span class="c1"># Query everything if you don&#39;t know the species</span>
            <span class="n">valid_kw</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">species</span>
        <span class="n">mode_str</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">const</span><span class="o">.</span><span class="n">VS_EXEMPLARS_KEY</span><span class="p">:</span> <span class="s1">&#39;vs_exemplar&#39;</span><span class="p">,</span>
            <span class="n">const</span><span class="o">.</span><span class="n">INTRA_OCCUR_KEY</span><span class="p">:</span> <span class="s1">&#39;intra_occurrence&#39;</span><span class="p">,</span>
            <span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
        <span class="p">}[</span><span class="n">daids_mode</span><span class="p">]</span>
        <span class="n">valid_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">daids_mode_valid_kw_dict</span><span class="p">[</span><span class="n">daids_mode</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] get_selected_daids: &#39;</span> <span class="o">+</span> <span class="n">mode_str</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] ... valid_kw = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">valid_kw</span><span class="p">))</span>
        <span class="n">daid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="o">**</span><span class="n">valid_kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">daid_list</span></div>

<div class="viewcode-block" id="MainWindowBackend.make_confirm_query_msg2"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.make_confirm_query_msg2">[docs]</a>    <span class="k">def</span> <span class="nf">make_confirm_query_msg2</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span> <span class="n">species2_expanded_aids</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_title</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.gui.guiback --test-MainWindowBackend.make_confirm_query_msg2 --show</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(--gui)</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; import wbia</span>
<span class="sd">            &gt;&gt;&gt; main_locals = wbia.main(defaultdb=&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; ibs, back = ut.dict_take(main_locals, [&#39;ibs&#39;, &#39;back&#39;])</span>
<span class="sd">            &gt;&gt;&gt; ut.exec_funckw(back.make_confirm_query_msg2, globals())</span>
<span class="sd">            &gt;&gt;&gt; imgsetid = ibs.get_imageset_imgsetids_from_text(&#39;*All Images&#39;)</span>
<span class="sd">            &gt;&gt;&gt; species2_expanded_aids = back._get_expanded_aids_groups(imgsetid)</span>
<span class="sd">            &gt;&gt;&gt; short_msg, detailed_msg = back.make_confirm_query_msg2(species2_expanded_aids)</span>
<span class="sd">            &gt;&gt;&gt; print(short_msg)</span>
<span class="sd">            &gt;&gt;&gt; print(detailed_msg)</span>
<span class="sd">            &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">            &gt;&gt;&gt; back.confirm_query_dialog2(species2_expanded_aids)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">species_text</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_all_species_texts</span><span class="p">()</span>
        <span class="n">species_nice</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_all_species_nice</span><span class="p">()</span>
        <span class="n">species_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">species_text</span><span class="p">,</span> <span class="n">species_nice</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">get_unique_species_phrase</span><span class="p">(</span><span class="n">aid_list</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">boldspecies</span><span class="p">(</span><span class="n">species</span><span class="p">):</span>
                <span class="n">species_bold_nice</span> <span class="o">=</span> <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),)</span>
                <span class="k">return</span> <span class="n">species_bold_nice</span>

            <span class="n">species_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)))</span>
            <span class="n">species_nice_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">boldspecies</span><span class="p">,</span> <span class="n">species_list</span><span class="p">))</span>
            <span class="n">species_phrase</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">conj_phrase</span><span class="p">(</span><span class="n">species_nice_list</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">species_phrase</span>

        <span class="c1"># Build confirmation message</span>
        <span class="n">fmtdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">msg_fmtstr_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">query_msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">query_msg</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">query_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_title</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>

        <span class="n">ngroups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">species2_expanded_aids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ngroups</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="s1">&#39;You are about to run </span><span class="si">{query_title}</span><span class="s1"> &#39;</span>
                    <span class="s1">&#39;identification with </span><span class="si">{ngroups}</span><span class="s1"> groups...&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">query_title</span><span class="o">=</span><span class="n">query_title</span><span class="p">,</span>
                    <span class="n">ngroups</span><span class="o">=</span><span class="n">ngroups</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;You are about to run </span><span class="si">{query_title}</span><span class="s1"> &#39;</span> <span class="s1">&#39;identification...&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">query_title</span><span class="o">=</span><span class="n">query_title</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="n">species_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">species2_expanded_aids</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">detailed_msg_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">annotstats_kw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">species</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species_list</span><span class="p">):</span>
            <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span> <span class="o">=</span> <span class="n">species2_expanded_aids</span><span class="p">[</span><span class="n">species</span><span class="p">]</span>
            <span class="n">species_nice</span> <span class="o">=</span> <span class="n">species_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>
            <span class="c1"># species_phrase = get_unique_species_phrase(qaids + daids)</span>
            <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
            <span class="n">fmtdict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">qaid_stats</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_stats_dict</span><span class="p">(</span>
                <span class="n">qaids</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="n">per_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">old</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">daid_stats</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_stats_dict</span><span class="p">(</span>
                <span class="n">daids</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">per_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">old</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">stats_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annotconfig_stats</span><span class="p">(</span>
                <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">combined</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">species_hist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">annotstats_kw</span>
            <span class="p">)</span>
            <span class="n">fmtdict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">qaid_stats</span><span class="p">)</span>
            <span class="n">fmtdict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">daid_stats</span><span class="p">)</span>
            <span class="n">fmtdict</span><span class="p">[</span><span class="s1">&#39;qannots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">pluralize</span><span class="p">(</span><span class="s1">&#39;annotation&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">qaids</span><span class="p">))</span>
            <span class="n">fmtdict</span><span class="p">[</span><span class="s1">&#39;dannots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">pluralize</span><span class="p">(</span><span class="s1">&#39;annotation&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">daids</span><span class="p">))</span>
            <span class="n">fmtdict</span><span class="p">[</span><span class="s1">&#39;species_nice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">species_nice</span>
            <span class="n">fmtdict</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
            <span class="c1"># Add simple info</span>
            <span class="k">if</span> <span class="n">ngroups</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">part1</span> <span class="o">=</span> <span class="s1">&#39;Group </span><span class="si">{count}</span><span class="s1"> &#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">part1</span> <span class="o">=</span> <span class="s1">&#39;This &#39;</span>
            <span class="n">part2</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">part1</span>
                <span class="o">+</span> <span class="s1">&#39;will identify </span><span class="si">{num_qaids}</span><span class="s1"> query </span><span class="si">{qannots}</span><span class="s1"> against </span><span class="si">{num_daids}</span><span class="s1"> </span><span class="si">{species_nice}</span><span class="s1"> database </span><span class="si">{dannots}</span><span class="s1">.&#39;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">fmtdict</span><span class="p">)</span>
            <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">part2</span><span class="p">]</span>
            <span class="c1"># Add detailed info</span>
            <span class="n">stats_str2</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span>
                <span class="n">stats_</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">newlines</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">explicit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nobraces</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">detailed_msg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--- Group </span><span class="si">%d</span><span class="s1"> ---&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,))</span>
            <span class="n">detailed_msg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats_str2</span><span class="p">)</span>

        <span class="c1"># Finish building confirmation message</span>
        <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="n">msg_fmtstr_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;Press &#39;Yes&#39; to continue&quot;</span><span class="p">]</span>
        <span class="n">msg_fmtstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg_fmtstr_list</span><span class="p">)</span>
        <span class="n">msg_str</span> <span class="o">=</span> <span class="n">msg_fmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">fmtdict</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cfgdict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfgdict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">detailed_msg_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;Special Settings: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">cfgdict</span><span class="p">))</span>
            <span class="p">]</span> <span class="o">+</span> <span class="n">detailed_msg_list</span>

        <span class="n">detailed_msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">detailed_msg_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">msg_str</span><span class="p">,</span> <span class="n">detailed_msg</span></div>

<div class="viewcode-block" id="MainWindowBackend.run_annot_splits"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.run_annot_splits">[docs]</a>    <span class="k">def</span> <span class="nf">run_annot_splits</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks for mismatches within a group of annotations</span>

<span class="sd">        Args:</span>
<span class="sd">            aid_list (int):  list of annotation ids</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.gui.guiback --test-MainWindowBackend.run_annot_splits --show</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(--gui)</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; back = testdata_guiback()</span>
<span class="sd">            &gt;&gt;&gt; ibs = back.ibs</span>
<span class="sd">            &gt;&gt;&gt; aids_list, nids = back.ibs.group_annots_by_name(back.ibs.get_valid_aids())</span>
<span class="sd">            &gt;&gt;&gt; aid_list = aids_list[ut.list_argmax(list(map(len, aids_list)))]</span>
<span class="sd">            &gt;&gt;&gt; back.run_annot_splits(aid_list)</span>
<span class="sd">            &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">            &gt;&gt;&gt; guitool.qtapp_loop(back.mainwin, frequency=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;can_match_samename&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;Knorm&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;prescore_method&#39;</span><span class="p">:</span> <span class="s1">&#39;csum&#39;</span><span class="p">,</span>
            <span class="s1">&#39;score_method&#39;</span><span class="p">:</span> <span class="s1">&#39;csum&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">ranks_top</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">review_cfg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;filter_reviewed&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;ranks_top&#39;</span><span class="p">:</span> <span class="n">ranks_top</span><span class="p">,</span>
            <span class="s1">&#39;name_scoring&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">cfgdict</span><span class="p">,</span> <span class="n">review_cfg</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">confirm_query_dialog2</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;split&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">)},</span>
            <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">,</span>
            <span class="n">query_msg</span><span class="o">=</span><span class="s1">&#39;Checking for SPLIT cases (matching each annotation within a name)&#39;</span><span class="p">,</span>
            <span class="n">review_cfg</span><span class="o">=</span><span class="n">review_cfg</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
        <span class="n">cm_list</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">review_queries</span><span class="p">(</span>
            <span class="n">cm_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">=</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">query_title</span><span class="o">=</span><span class="s1">&#39;Annot Splits&#39;</span><span class="p">,</span> <span class="n">review_cfg</span><span class="o">=</span><span class="n">review_cfg</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">wbia.viz</span> <span class="kn">import</span> <span class="n">viz_graph2</span>
            <span class="kn">import</span> <span class="nn">imp</span>

            <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">viz_graph2</span><span class="p">)</span>
            <span class="n">win</span> <span class="o">=</span> <span class="n">viz_graph2</span><span class="o">.</span><span class="n">make_qt_graph_review</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">,</span> <span class="n">review_cfg</span><span class="o">=</span><span class="n">review_cfg</span><span class="p">)</span>
            <span class="n">win</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.run_merge_checks"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.run_merge_checks">[docs]</a>    <span class="k">def</span> <span class="nf">run_merge_checks</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks for missed matches within a group of annotations</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.gui.guiback --test-run_merge_checks --show</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(--gui)</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; back = testdata_guiback()</span>
<span class="sd">            &gt;&gt;&gt; result = back.run_merge_checks()</span>
<span class="sd">            &gt;&gt;&gt; print(result)</span>
<span class="sd">            &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">            &gt;&gt;&gt; guitool.qtapp_loop(back.mainwin, frequency=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
        <span class="n">qaid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">is_exemplar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;can_match_samename&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="c1"># &#39;K&#39;: 3,</span>
            <span class="c1"># &#39;Knorm&#39;: 3,</span>
            <span class="c1"># &#39;prescore_method&#39;: &#39;csum&#39;,</span>
            <span class="c1"># &#39;score_method&#39;: &#39;csum&#39;</span>
        <span class="p">}</span>
        <span class="n">query_msg</span> <span class="o">=</span> <span class="s1">&#39;Checking for MERGE cases (this is an exemplars-vs-exemplars query)&#39;</span>
        <span class="n">back</span><span class="o">.</span><span class="n">compute_queries</span><span class="p">(</span>
            <span class="n">qaid_list</span><span class="o">=</span><span class="n">qaid_list</span><span class="p">,</span>
            <span class="n">daids_mode</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">VS_EXEMPLARS_KEY</span><span class="p">,</span>
            <span class="n">query_msg</span><span class="o">=</span><span class="n">query_msg</span><span class="p">,</span>
            <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">,</span>
            <span class="n">custom_qaid_list_title</span><span class="o">=</span><span class="s1">&#39;Merge Candidates&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.run_merge_checks_multitons"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.run_merge_checks_multitons">[docs]</a>    <span class="k">def</span> <span class="nf">run_merge_checks_multitons</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks for missed matches within a group of annotations.</span>
<span class="sd">        Only uses annotations with more 2 annots per id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="c1"># qaid_list = back.ibs.get_valid_aids(is_exemplar=True)</span>
        <span class="kn">from</span> <span class="nn">wbia</span> <span class="kn">import</span> <span class="n">dtool</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">dtool</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;Knorm&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="s1">&#39;min_pername&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;max_pername&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;exemplars_per_name&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;randomize&#39;</span><span class="p">,</span>
                <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># ibswgt = None</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">ConfigConfirmWidget</span><span class="o">.</span><span class="n">as_dialog</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Confirm Merge Query&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Confirm&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span>
        <span class="p">)</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">widget</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;config = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config</span><span class="p">,))</span>
        <span class="n">updated_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>  <span class="c1"># NOQA</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;updated_config = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">updated_config</span><span class="p">,))</span>

        <span class="n">min_pername</span> <span class="o">=</span> <span class="n">updated_config</span><span class="p">[</span><span class="s1">&#39;min_pername&#39;</span><span class="p">]</span>
        <span class="n">max_pername</span> <span class="o">=</span> <span class="n">updated_config</span><span class="p">[</span><span class="s1">&#39;max_pername&#39;</span><span class="p">]</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">filter_annots_general</span><span class="p">(</span>
            <span class="n">min_pername</span><span class="o">=</span><span class="n">min_pername</span><span class="p">,</span> <span class="n">max_pername</span><span class="o">=</span><span class="n">max_pername</span><span class="p">,</span> <span class="n">minqual</span><span class="o">=</span><span class="s1">&#39;ok&#39;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">updated_config</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;randomize&#39;</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

            <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">updated_config</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]))</span>
            <span class="n">grouped_aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">group_annots_by_name</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">grouped_aids2</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">aids</span><span class="p">,</span> <span class="n">updated_config</span><span class="p">[</span><span class="s1">&#39;exemplars_per_name&#39;</span><span class="p">],</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">aids</span> <span class="ow">in</span> <span class="n">grouped_aids</span>
            <span class="p">]</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">grouped_aids2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_flag_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_quality_viewpoint_subset</span><span class="p">(</span>
                <span class="n">aid_list</span><span class="p">,</span> <span class="n">updated_config</span><span class="p">[</span><span class="s1">&#39;exemplars_per_name&#39;</span><span class="p">],</span> <span class="n">allow_unknown</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">new_flag_list</span><span class="p">)</span>

        <span class="n">ibs</span><span class="o">.</span><span class="n">print_annot_stats</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>

        <span class="n">daid_list</span> <span class="o">=</span> <span class="n">qaid_list</span> <span class="o">=</span> <span class="n">aid_list</span>
        <span class="c1"># len(aids)</span>
        <span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;can_match_samename&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="n">updated_config</span><span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Knorm&#39;</span><span class="p">:</span> <span class="n">updated_config</span><span class="p">[</span><span class="s1">&#39;Knorm&#39;</span><span class="p">],</span>
            <span class="c1"># &#39;prescore_method&#39;: &#39;csum&#39;,</span>
            <span class="c1"># &#39;score_method&#39;: &#39;csum&#39;</span>
        <span class="p">}</span>
        <span class="n">query_msg</span> <span class="o">=</span> <span class="s1">&#39;Checking for MERGE cases (this is an special query)&#39;</span>
        <span class="n">back</span><span class="o">.</span><span class="n">compute_queries</span><span class="p">(</span>
            <span class="n">qaid_list</span><span class="o">=</span><span class="n">qaid_list</span><span class="p">,</span>
            <span class="n">daid_list</span><span class="o">=</span><span class="n">daid_list</span><span class="p">,</span>
            <span class="n">query_msg</span><span class="o">=</span><span class="n">query_msg</span><span class="p">,</span>
            <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">,</span>
            <span class="n">custom_qaid_list_title</span><span class="o">=</span><span class="s1">&#39;Merge2 Candidates&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_expanded_aids_groups</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span>
        <span class="n">imgsetid</span><span class="p">,</span>
        <span class="n">daids_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">use_prioritized_name_subset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">use_visual_selection</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">qaid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">daid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">query_is_known</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">partition_queries_by_species</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">remove_unknown_species</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the query annotation ids to search and</span>
<span class="sd">        the database annotation ids to be searched</span>
<span class="sd">        The query is either a specific selection or everything from this</span>
<span class="sd">        image set that matches the appropriate filters.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; ut.exec_funckw(back._get_expanded_aids_groups, globals())</span>
<span class="sd">            &gt;&gt;&gt; imgsetid = ibs.get_imageset_imgsetids_from_text(&#39;*All Images&#39;)</span>
<span class="sd">            &gt;&gt;&gt; species2_expanded_aids = back._get_expanded_aids_groups(imgsetid)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">daids_mode</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">daids_mode</span> <span class="k">if</span> <span class="n">daids_mode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">daids_mode</span>
        <span class="k">if</span> <span class="n">imgsetid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;[back] invalid imgsetid&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">enable_custom_filter</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">user_warning</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                other_cfg.enable_custom_filter=True is not longer supported.</span>
<span class="sd">                Please turn off in Preferences</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">remove_unknown_species</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Default behavior is don&#39;t remove unknown species if qaid_list is specified</span>
            <span class="n">remove_unknown_species</span> <span class="o">=</span> <span class="n">qaid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">use_visual_selection</span>

        <span class="c1"># Query aids are either: given, taken from gui selection, or by imageset</span>
        <span class="k">if</span> <span class="n">qaid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">qaid_list</span> <span class="o">=</span> <span class="n">qaid_list</span>
        <span class="k">elif</span> <span class="n">use_visual_selection</span><span class="p">:</span>
            <span class="n">qaid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_aids</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qaid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span>
                <span class="n">imgsetid</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">,</span> <span class="n">is_known</span><span class="o">=</span><span class="n">query_is_known</span><span class="p">,</span> <span class="n">minqual</span><span class="o">=</span><span class="s1">&#39;ok&#39;</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] Initially loaded len(qaid_list) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">),))</span>
        <span class="k">if</span> <span class="n">use_prioritized_name_subset</span><span class="p">:</span>
            <span class="c1"># Pick only a few queries per name to execute</span>
            <span class="n">annots_per_view</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># FIXME: use a configuration</span>
            <span class="n">new_flag_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_quality_viewpoint_subset</span><span class="p">(</span>
                <span class="n">aid_list</span><span class="o">=</span><span class="n">qaid_list</span><span class="p">,</span>
                <span class="n">annots_per_view</span><span class="o">=</span><span class="n">annots_per_view</span><span class="p">,</span>
                <span class="n">allow_unknown</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">qaid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">new_flag_list</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;[back] Filtered query by quality and viewpoint: len(qaid_list) = </span><span class="si">%r</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">),)</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] Found len(qaid_list) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">),))</span>
        <span class="c1"># Group annotations by species</span>
        <span class="n">species2_qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">group_annots_by_prop</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species</span><span class="p">)</span>
        <span class="c1"># ID unknown species against each database species</span>
        <span class="n">nospecies_qaids</span> <span class="o">=</span> <span class="n">species2_qaids</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] num Queries without species = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nospecies_qaids</span><span class="p">),))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;species2_qaids = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species2_qaids</span><span class="p">,))</span>

        <span class="n">species2_expanded_aids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">species_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_all_species_texts</span><span class="p">())</span> <span class="o">+</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">species2_qaids</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">species_list</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] Finding daids for species = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species</span><span class="p">,))</span>
            <span class="n">qaids</span> <span class="o">=</span> <span class="n">species2_qaids</span><span class="p">[</span><span class="n">species</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">daid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">daids</span> <span class="o">=</span> <span class="n">daid_list</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">partition_queries_by_species</span><span class="p">:</span>
                    <span class="n">species</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">UNKNOWN</span>
                <span class="n">daids</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_daids</span><span class="p">(</span>
                    <span class="n">imgsetid</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">,</span>
                    <span class="n">daids_mode</span><span class="o">=</span><span class="n">daids_mode</span><span class="p">,</span>
                    <span class="n">qaid_list</span><span class="o">=</span><span class="n">qaids</span><span class="p">,</span>
                    <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] * Found len(daids) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daids</span><span class="p">),))</span>
            <span class="n">qaids_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">qaids</span> <span class="o">+</span> <span class="n">nospecies_qaids</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qaids_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">daids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">species2_expanded_aids</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">qaids_</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;[back] ! len(nospecies_qaids) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nospecies_qaids</span><span class="p">),)</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] ! len(qaids) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qaids</span><span class="p">),))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] ! len(qaids_) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qaids_</span><span class="p">),))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] ! len(daids) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daids</span><span class="p">),))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;WARNING: species = </span><span class="si">%r</span><span class="s1"> is an invalid query&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species</span><span class="p">,))</span>

        <span class="c1"># Dont query unknown species</span>
        <span class="k">if</span> <span class="n">remove_unknown_species</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ibs</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">UNKNOWN</span> <span class="ow">in</span> <span class="n">species2_expanded_aids</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">species2_expanded_aids</span><span class="p">[</span><span class="n">ibs</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">species2_expanded_aids</span>

<div class="viewcode-block" id="MainWindowBackend.filter_imageset_as_camera_trap"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.filter_imageset_as_camera_trap">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">filter_imageset_as_camera_trap</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">score_thresh</span><span class="o">=</span><span class="mf">0.30</span><span class="p">):</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_imgsetid</span><span class="p">()</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">imgsetid</span><span class="p">)</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))</span>

        <span class="n">imgset_name</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_text</span><span class="p">(</span><span class="n">imgsetid</span><span class="p">)</span>
        <span class="n">imgset_dest_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (FILTERED)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imgset_name</span><span class="p">,)</span>

        <span class="n">confirm_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">use_msg</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This action will process the current ImageSet and search for the images (%d total) which contain zebras.</span>

<span class="sd">            Note: this process is meant for images from sources like camera traps and aerial drones, where the vast majority of the images have no zebras in them.  If you expect the majority of your images to contain zebras, run the standard Detect for better detection accuracy (but will be slower).</span>

<span class="sd">            This operation will find Plains and Grevy&#39;s zebras.</span>

<span class="sd">            Warning: performing this operation will delete all current annotations (%d total) on all images in the current ImageSet. This operation will also de-associate any metadata (e.g. names) from the annotations.  This operation will not delete or modify any images, annotations, or names outside this ImageSet.</span>

<span class="sd">            Selecting YES will remove this ImageSet&#39;s annotations, perform a filtering classification for zebras, run the detection pipeline, and create (or will empty if currently exists) an ImageSet named:</span>

<span class="sd">            \t %r</span>

<span class="sd">            This new ImageSet will contain the images where zebras were detected.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">),</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">),</span>
                <span class="n">imgset_dest_name</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Process ImageSet?&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="s1">&#39;Yes&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="o">**</span><span class="n">confirm_kw</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span>

        <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_image</span>

        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_annots</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="c1"># imgset_rowid_list = ibs.get_imageset_imgsetids_from_text([&#39;POSITIVE_SET&#39;, &#39;NEGATIVE_SET&#39;])</span>
        <span class="n">imgset_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_imgsetids_from_text</span><span class="p">([</span><span class="n">imgset_dest_name</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">imgset_rowid</span> <span class="ow">in</span> <span class="n">imgset_rowid_list</span><span class="p">:</span>
            <span class="n">imgset_rowid_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">imgset_rowid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">unrelate_images_and_imagesets</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">imgset_rowid_list_</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;classifier_weight_filepath&#39;</span><span class="p">:</span> <span class="s1">&#39;coco_zebra&#39;</span><span class="p">}</span>
        <span class="n">class_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="n">score_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="n">score_list_</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">score_</span> <span class="k">if</span> <span class="n">class_</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span> <span class="k">else</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">score_</span>
            <span class="k">for</span> <span class="n">class_</span><span class="p">,</span> <span class="n">score_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">class_list</span><span class="p">,</span> <span class="n">score_list</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">flag_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">score_</span> <span class="o">&gt;=</span> <span class="n">score_thresh</span> <span class="k">for</span> <span class="n">score_</span> <span class="ow">in</span> <span class="n">score_list_</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> / </span><span class="si">%d</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="n">flag_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">flag_list</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">pos_gid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)</span>
        <span class="c1"># neg_gid_list = ut.compress(gid_list, ut.not_list(flag_list))</span>
        <span class="c1"># ibs.set_image_imagesettext(pos_gid_list, [&#39;POSITIVE_SET&#39;] * len(pos_gid_list))</span>
        <span class="c1"># ibs.set_image_imagesettext(neg_gid_list, [&#39;NEGATIVE_SET&#39;] * len(neg_gid_list))</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_image_imagesettext</span><span class="p">(</span><span class="n">pos_gid_list</span><span class="p">,</span> <span class="p">[</span><span class="n">imgset_dest_name</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_gid_list</span><span class="p">))</span>

        <span class="c1"># Run detection</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">detect_cnn_yolo</span><span class="p">(</span><span class="n">pos_gid_list</span><span class="p">)</span>
        <span class="c1"># aids_list = ibs.get_image_aids(pos_gid_list)</span>
        <span class="n">species_list_list</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">)</span>
        <span class="n">species_set_list</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="n">species_list_list</span><span class="p">)</span>
        <span class="n">wanted_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;zebra_grevys&#39;</span><span class="p">,</span> <span class="s1">&#39;zebra_plains&#39;</span><span class="p">])</span>
        <span class="n">flag_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">wanted_set</span> <span class="o">&amp;</span> <span class="n">species_set</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">species_set</span> <span class="ow">in</span> <span class="n">species_set_list</span>
        <span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> / </span><span class="si">%d</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="n">flag_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">flag_list</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">nothing_gid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">pos_gid_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)</span>
        <span class="n">imgset_rowid_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">imgset_rowid_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">nothing_gid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">unrelate_images_and_imagesets</span><span class="p">(</span><span class="n">nothing_gid_list</span><span class="p">,</span> <span class="n">imgset_rowid_list_</span><span class="p">)</span></div>
        <span class="c1"># ibs.set_image_imagesettext(nothing_gid_list, [&#39;NEGATIVE_SET&#39;] * len(nothing_gid_list))</span>

<div class="viewcode-block" id="MainWindowBackend.commit_to_wb_step"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.commit_to_wb_step">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">commit_to_wb_step</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dry</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Step 6) Commit</span>

<span class="sd">        Sets all imagesets as reviwed and ships them to wildbook</span>

<span class="sd">        commit step</span>

<span class="sd">        Args:</span>
<span class="sd">            refresh (bool): (default = True)</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.gui.guiback commit_to_wb_step --show</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(--gui)</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; import wbia</span>
<span class="sd">            &gt;&gt;&gt; main_locals = wbia.main(defaultdb=&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; ibs, back = ut.dict_take(main_locals, [&#39;ibs&#39;, &#39;back&#39;])</span>
<span class="sd">            &gt;&gt;&gt; ut.exec_funckw(back.do_group_occurrence_step, globals())</span>
<span class="sd">            &gt;&gt;&gt; dry = True</span>
<span class="sd">            &gt;&gt;&gt; back.do_group_occurrence_step(dry=dry)</span>

<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; refresh = True</span>
<span class="sd">            &gt;&gt;&gt; result = back.commit_to_wb_step(refresh)</span>
<span class="sd">            &gt;&gt;&gt; print(result)</span>
<span class="sd">            &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">            &gt;&gt;&gt; import wbia.plottool as pt</span>
<span class="sd">            &gt;&gt;&gt; ut.show_if_requested()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_imgsetid</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">contains_special_imagesets</span><span class="p">([</span><span class="n">imgsetid</span><span class="p">])</span> <span class="ow">or</span> <span class="n">imgsetid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">user_warning</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                This operation is only allowed for OCCURRENCES.</span>
<span class="sd">                Tried to send a special ImageSet to Wildbook as an occurrence.</span>
<span class="sd">                Special ImageSets are living entities and are never truely complete.</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Check to make sure imagesets are ok:</span>
            <span class="c1"># First, check if imageset can be pushed</span>
            <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>

            <span class="c1"># imgsets = ibs.imagesets(imgsetid)</span>
            <span class="c1"># aid_list = imgsets.aids[0]</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_aids</span><span class="p">(</span><span class="n">imgsetid</span><span class="p">)</span>

            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="p">),</span> <span class="s1">&#39;ImageSet imgsetid=</span><span class="si">%r</span><span class="s1"> cannot be shipped with0 annots&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imgsetid</span><span class="p">,)</span>

            <span class="n">unknown_flags</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">is_aid_unknown</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
            <span class="n">nUnnamed</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">unknown_flags</span><span class="p">)</span>

            <span class="n">unnamed_aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">unknown_flags</span><span class="p">)</span>
            <span class="n">named_aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">not_list</span><span class="p">(</span><span class="n">unknown_flags</span><span class="p">))</span>
            <span class="n">nid2_aids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">group_items</span><span class="p">(</span><span class="n">named_aid_list</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_nids</span><span class="p">(</span><span class="n">named_aid_list</span><span class="p">))</span>
            <span class="n">nMultiEncounters</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">nid2_aids</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
            <span class="n">nSingleEncounters</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">nid2_aids</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>

            <span class="n">unnamed_ok_aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">filter_annots_general</span><span class="p">(</span>
                <span class="n">unnamed_aid_list</span><span class="p">,</span>
                <span class="n">minqual</span><span class="o">=</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">nUnnamedOk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">unnamed_ok_aid_list</span><span class="p">)</span>

            <span class="n">other_aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_groundtruth</span><span class="p">(</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">nid2_aids</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">is_exemplar</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">other_aids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">aids</span> <span class="ow">in</span> <span class="n">other_aids</span><span class="p">]</span>
            <span class="n">nMatchedExemplars</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">other_aids</span><span class="p">])</span>

            <span class="n">msg_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Encounter</span><span class="si">%s</span><span class="s1"> matched an exemplar&#39;</span>
                <span class="o">%</span> <span class="p">((</span><span class="n">nMatchedExemplars</span><span class="p">),</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">nMatchedExemplars</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span>
                <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Encounter</span><span class="si">%s</span><span class="s1"> only one annotation&#39;</span>
                <span class="o">%</span> <span class="p">((</span><span class="n">nSingleEncounters</span><span class="p">),</span> <span class="s1">&#39; has&#39;</span> <span class="k">if</span> <span class="n">nSingleEncounters</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;s have&#39;</span><span class="p">),</span>
                <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Encounter</span><span class="si">%s</span><span class="s1"> more than one annotation&#39;</span>
                <span class="o">%</span> <span class="p">((</span><span class="n">nMultiEncounters</span><span class="p">),</span> <span class="s1">&#39; has&#39;</span> <span class="k">if</span> <span class="n">nMultiEncounters</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;s have&#39;</span><span class="p">),</span>
                <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> annotation</span><span class="si">%s</span><span class="s1"> have not had a name assigned</span><span class="si">%s</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">nUnnamed</span><span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">nUnnamed</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span> <span class="k">if</span> <span class="n">nUnnamed</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;.&#39;</span><span class="p">),</span>
                <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> annotation</span><span class="si">%s</span><span class="s1"> unnamed with an identifiable quality</span><span class="si">%s</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="n">nUnnamedOk</span><span class="p">,</span>
                    <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">nUnnamedOk</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;!&#39;</span> <span class="k">if</span> <span class="n">nUnnamedOk</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">]</span>

            <span class="c1"># Set all images to be reviewed</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">(</span><span class="n">imgsetid</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">)</span>

            <span class="n">confirm_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">use_msg</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Have you finished reviewing ALL detections,</span>
<span class="sd">                Intra-Occurence IDs, and Vs-Exemplar IDs?</span>

<span class="sd">                %s</span>

<span class="sd">                Selecting YES will remove this occurrence, mark all images are</span>
<span class="sd">                reviewed and processed, and then send it to wildbook.</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="p">)</span>
                <span class="o">%</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg_list</span><span class="p">),</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Complete Occurrence?&#39;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="s1">&#39;Yes&#39;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="o">**</span><span class="n">confirm_kw</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span>

            <span class="k">assert</span> <span class="n">nUnnamedOk</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span>
                <span class="s1">&#39;ImageSet imgsetid=</span><span class="si">%r</span><span class="s1">1 cannot be shipped becuase &#39;</span>
                <span class="s1">&#39;annotation(s) </span><span class="si">%r</span><span class="s1"> with an identifiable quality have &#39;</span>
                <span class="s1">&#39;not been named&#39;</span>
            <span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">imgsetid</span><span class="p">,</span>
                <span class="n">unnamed_ok_aid_list</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">dry</span><span class="p">:</span>
                <span class="c1"># back.start_web_server_parallel(browser=False)</span>
                <span class="c1"># gid_list = ibs.get_imageset_gids(imgsetid)</span>
                <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">set_image_reviewed</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))</span>
                <span class="c1"># Set imageset to be processed</span>
                <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">set_imageset_processed_flags</span><span class="p">([</span><span class="n">imgsetid</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">wildbook_signal_imgsetid_list</span><span class="p">([</span><span class="n">imgsetid</span><span class="p">])</span>
                <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">imageset_tabwgt</span><span class="o">.</span><span class="n">_close_tab_with_imgsetid</span><span class="p">(</span><span class="n">imgsetid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
                <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGESET_TABLE</span><span class="p">])</span></div>

<div class="viewcode-block" id="MainWindowBackend.send_unshipped_processed_imagesets"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.send_unshipped_processed_imagesets">[docs]</a>    <span class="k">def</span> <span class="nf">send_unshipped_processed_imagesets</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">back</span><span class="o">.</span><span class="n">start_web_server_parallel</span><span class="p">(</span><span class="n">browser</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">processed_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_imgsetids</span><span class="p">(</span><span class="n">processed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">shipped_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_imgsetids</span><span class="p">(</span><span class="n">shipped</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">imgsetid_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">processed_set</span> <span class="o">-</span> <span class="n">shipped_set</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">wildbook_signal_imgsetid_list</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">)</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Option menu slots</span>
    <span class="c1"># --------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MainWindowBackend.layout_figures"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.layout_figures">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">layout_figures</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Options -&gt; Layout Figures&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] layout_figures&#39;</span><span class="p">)</span>
        <span class="n">fig_presenter</span><span class="o">.</span><span class="n">all_figures_tile</span><span class="p">()</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="MainWindowBackend.edit_preferences"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.edit_preferences">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">edit_preferences</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Options -&gt; Edit Preferences&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] edit_preferences&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;No database is loaded. Open a database to continue&#39;</span>
        <span class="n">epw</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">createQWidget</span><span class="p">()</span>
        <span class="n">fig_presenter</span><span class="o">.</span><span class="n">register_qt4_win</span><span class="p">(</span><span class="n">epw</span><span class="p">)</span>
        <span class="n">epw</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">defaultPrefsBUT</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">default_config</span><span class="p">)</span>
        <span class="n">epw</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">edit_prefs_wgt</span> <span class="o">=</span> <span class="n">epw</span></div>
        <span class="c1"># query_cfgstr = &#39;&#39;.join(back.ibs.cfg.query_cfg.get_cfgstr())</span>
        <span class="c1"># logger.info(&#39;[back] query_cfgstr = %s&#39; % query_cfgstr)</span>
        <span class="c1"># logger.info(&#39;&#39;)</span>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Help menu slots</span>
    <span class="c1"># --------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MainWindowBackend.view_docs"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.view_docs">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">view_docs</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Help -&gt; View Documentation&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] view_docs&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="MainWindowBackend.view_database_dir"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.view_database_dir">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">view_database_dir</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Help -&gt; View Directory Slots&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] view_database_dir&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">view_directory</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_dbdir</span><span class="p">())</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="MainWindowBackend.view_app_files_dir"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.view_app_files_dir">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">view_app_files_dir</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] view_app_files_dir&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">view_directory</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_app_resource_dir</span><span class="p">(</span><span class="s1">&#39;wbia&#39;</span><span class="p">))</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="MainWindowBackend.view_log_dir_local"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.view_log_dir_local">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">view_log_dir_local</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] view_log_dir_local&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">view_directory</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_logdir_local</span><span class="p">())</span></div>

<div class="viewcode-block" id="MainWindowBackend.view_log_dir_global"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.view_log_dir_global">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">view_log_dir_global</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] view_log_dir_global&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">view_directory</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_logdir_global</span><span class="p">())</span></div>

<div class="viewcode-block" id="MainWindowBackend.view_logs_global"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.view_logs_global">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">view_logs_global</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] view_logs_global&#39;</span><span class="p">)</span>
        <span class="n">log_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_current_log_fpath</span><span class="p">()</span>
        <span class="n">log_text</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_current_log_text</span><span class="p">()</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">msgbox</span><span class="p">(</span>
            <span class="s1">&#39;Click show details to view logs from log_fpath=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">log_fpath</span><span class="p">,),</span>
            <span class="n">detailed_msg</span><span class="o">=</span><span class="n">log_text</span><span class="p">,</span>
        <span class="p">)</span></div>
        <span class="c1"># ut.startfile(back.ibs.get_logdir_global())</span>

<div class="viewcode-block" id="MainWindowBackend.redownload_detection_models"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.redownload_detection_models">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">redownload_detection_models</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] redownload_detection_models&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="s1">&#39;[back] redownload_detection_models&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">redownload_detection_models</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.delete_cache"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.delete_cache">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">delete_cache</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Help -&gt; Delete Directory Slots&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] delete_cache&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="s1">&#39;[back] delete_cache&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">delete_cache</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] finished delete_cache&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.delete_thumbnails"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.delete_thumbnails">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">delete_thumbnails</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Help -&gt; Delete Thumbnails &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;[back] delete_thumbnails&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">delete_thumbnails</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] finished delete_thumbnails&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.delete_global_prefs"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.delete_global_prefs">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">delete_global_prefs</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;[back] delete_global_prefs&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_app_resource_dir</span><span class="p">(</span><span class="s1">&#39;wbia&#39;</span><span class="p">,</span> <span class="s1">&#39;global_cache&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MainWindowBackend.delete_queryresults_dir"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.delete_queryresults_dir">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">delete_queryresults_dir</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;[back] delete_queryresults_dir&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span>
            <span class="n">use_msg</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Are you sure you want to delete the &#39;</span> <span class="s1">&#39;cached query results?&#39;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">qresdir</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">bigcachedir</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">qresdir</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">bigcachedir</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.dev_reload"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.dev_reload">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">dev_reload</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Help -&gt; Developer Reload&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] dev_reload&#39;</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">rrr</span><span class="p">()</span></div>
        <span class="c1"># back.rrr()</span>
        <span class="c1"># reload_all()</span>

<div class="viewcode-block" id="MainWindowBackend.dev_mode"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.dev_mode">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">dev_mode</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Help -&gt; Developer Mode&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] dev_mode&#39;</span><span class="p">)</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>  <span class="c1"># NOQA</span>
        <span class="n">front</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">front</span>  <span class="c1"># NOQA</span>
        <span class="c1"># import IPython</span>
        <span class="c1"># IPython.embed()</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">embed</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.dev_cls"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.dev_cls">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">dev_cls</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Help -&gt; Developer Mode&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] dev_cls&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">reset_table_cache</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">refresh_state</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">wbia.plottool</span> <span class="kn">import</span> <span class="n">draw_func2</span> <span class="k">as</span> <span class="n">df2</span>

        <span class="n">df2</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.dev_export_annotations"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.dev_export_annotations">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">dev_export_annotations</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.start_web_server_parallel"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.start_web_server_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">start_web_server_parallel</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">browser</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">wbia</span>

        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">web_ibs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[guiback] Starting web service&#39;</span><span class="p">)</span>
            <span class="c1"># back.web_ibs = wbia.opendb_in_background(dbdir=ibs.get_dbdir(), web=True, browser=browser)</span>
            <span class="n">back</span><span class="o">.</span><span class="n">web_ibs</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">opendb_bg_web</span><span class="p">(</span>
                <span class="n">dbdir</span><span class="o">=</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_dbdir</span><span class="p">(),</span> <span class="n">web</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">browser</span><span class="o">=</span><span class="n">browser</span><span class="p">,</span> <span class="n">start_job_queue</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[guiback] Web service started&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[guiback] CANNOT START WEB SERVER: WEB INSTANCE ALREADY RUNNING&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.kill_web_server_parallel"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.kill_web_server_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">kill_web_server_parallel</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">web_ibs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[guiback] Stopping web service&#39;</span><span class="p">)</span>
            <span class="c1"># back.web_ibs.terminate()</span>
            <span class="n">back</span><span class="o">.</span><span class="n">web_ibs</span><span class="o">.</span><span class="n">terminate2</span><span class="p">()</span>
            <span class="n">back</span><span class="o">.</span><span class="n">web_ibs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[guiback] CANNOT TERMINATE WEB SERVER: WEB INSTANCE NOT RUNNING&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.fix_and_clean_database"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.fix_and_clean_database">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">fix_and_clean_database</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Help -&gt; Fix/Clean Database &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] Fix/Clean Database&#39;</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">fix_and_clean_database</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.run_integrity_checks"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.run_integrity_checks">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run_integrity_checks</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">run_integrity_checks</span><span class="p">()</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># File Slots</span>
    <span class="c1"># --------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MainWindowBackend.new_database"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.new_database">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">new_database</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">new_dbdir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;File -&gt; New Database</span>

<span class="sd">        Args:</span>
<span class="sd">            new_dbdir (None): (default = None)</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.gui.guiback new_database --show</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; import wbia</span>
<span class="sd">            &gt;&gt;&gt; #back = testdata_guiback(defaultdb=&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; back = testdata_guiback(defaultdb=None)</span>
<span class="sd">            &gt;&gt;&gt; dbdir = None</span>
<span class="sd">            &gt;&gt;&gt; result = back.new_database(dbdir)</span>
<span class="sd">            &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">            &gt;&gt;&gt; gt.qtapp_loop(qwin=back.front, freq=10)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">new_dbdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">old</span><span class="p">:</span>
                <span class="n">new_dbname</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">user_input</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;What do you want to name the new database?&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;New Database&#39;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">new_dbname</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_dbname</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Abort new database. new_dbname=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">new_dbname</span><span class="p">)</span>
                    <span class="k">return</span>
                    <span class="n">new_dbdir_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Choose Directory&#39;</span><span class="p">,</span> <span class="s1">&#39;My Work Dir&#39;</span><span class="p">]</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">user_option</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Where should I put the new database?&#39;</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Import Images&#39;</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="n">new_dbdir_options</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="n">new_dbdir_options</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="s1">&#39;Choose Directory&#39;</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] new_database(): SELECT A DIRECTORY&#39;</span><span class="p">)</span>
                    <span class="n">putdir</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">select_directory</span><span class="p">(</span>
                        <span class="s1">&#39;Select new database directory&#39;</span><span class="p">,</span>
                        <span class="n">other_sidebar_dpaths</span><span class="o">=</span><span class="p">[</span><span class="n">back</span><span class="o">.</span><span class="n">get_work_directory</span><span class="p">()],</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">reply</span> <span class="o">==</span> <span class="s1">&#39;My Work Dir&#39;</span><span class="p">:</span>
                    <span class="n">putdir</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_work_directory</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Abort new database&#39;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="n">new_dbdir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">putdir</span><span class="p">,</span> <span class="n">new_dbname</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">putdir</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Directory </span><span class="si">%r</span><span class="s1"> does not exist.&#39;</span> <span class="o">%</span> <span class="n">putdir</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">new_dbdir</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;New DB </span><span class="si">%r</span><span class="s1"> already exists.&#39;</span> <span class="o">%</span> <span class="n">new_dbdir</span><span class="p">)</span>

                <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">new_dbdir</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] new_database(new_dbdir=</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">new_dbdir</span><span class="p">)</span>
                <span class="n">back</span><span class="o">.</span><span class="n">open_database</span><span class="p">(</span><span class="n">dbdir</span><span class="o">=</span><span class="n">new_dbdir</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">wbia.guitool.__PYQT__.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span>  <span class="c1"># NOQA</span>
                <span class="kn">from</span> <span class="nn">wbia.guitool.__PYQT__</span> <span class="kn">import</span> <span class="n">QtGui</span>  <span class="c1"># NOQA</span>

                <span class="n">dlg</span> <span class="o">=</span> <span class="n">NewDatabaseWidget</span><span class="o">.</span><span class="n">as_dialog</span><span class="p">(</span>
                    <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="p">,</span> <span class="n">back</span><span class="o">=</span><span class="n">back</span><span class="p">,</span> <span class="n">on_chosen</span><span class="o">=</span><span class="n">back</span><span class="o">.</span><span class="n">open_database</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;new&#39;</span>
                <span class="p">)</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.open_database"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.open_database">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">open_database</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">dbdir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        File -&gt; Open Database</span>

<span class="sd">        Args:</span>
<span class="sd">            dbdir (None): (default = None)</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.gui.guiback --test-open_database</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(--gui)</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; back = testdata_guiback(defaultdb=&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; #testdb0 = sysres.db_to_dbdir(&#39;testdb0&#39;)</span>
<span class="sd">            &gt;&gt;&gt; testdb1 = sysres.db_to_dbdir(&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(&#39;[TEST] TEST_OPEN_DATABASE testdb1=%r&#39; % testdb1)</span>
<span class="sd">            &gt;&gt;&gt; back.open_database(testdb1)</span>
<span class="sd">            &gt;&gt;&gt; #print(&#39;[TEST] TEST_OPEN_DATABASE testdb0=%r&#39; % testdb0)</span>
<span class="sd">            &gt;&gt;&gt; #back.open_database(testdb0)</span>
<span class="sd">            &gt;&gt;&gt; import wbia</span>
<span class="sd">            &gt;&gt;&gt; #dbdir = join(wbia.sysres.get_workdir(), &#39;PZ_MTEST&#39;, &#39;_ibsdb&#39;)</span>
<span class="sd">            &gt;&gt;&gt; dbdir = None</span>
<span class="sd">            &gt;&gt;&gt; result = back.open_database(dbdir)</span>
<span class="sd">            &gt;&gt;&gt; print(result)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dbdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] new_database(): SELECT A DIRECTORY&#39;</span><span class="p">)</span>
            <span class="c1"># director</span>
            <span class="n">dbdir</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">select_directory</span><span class="p">(</span>
                <span class="s1">&#39;Open a database directory&#39;</span><span class="p">,</span>
                <span class="n">other_sidebar_dpaths</span><span class="o">=</span><span class="p">[</span><span class="n">back</span><span class="o">.</span><span class="n">get_work_directory</span><span class="p">()],</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">dbdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] open_database(dbdir=</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">dbdir</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">Indenter</span><span class="p">(</span><span class="n">lbl</span><span class="o">=</span><span class="s1">&#39;    [opendb]&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># should this use wbia.opendb? probably. at least it should be</span>
                <span class="c1"># be request IBEISControl</span>
                <span class="c1"># ibs = IBEISControl.IBEISController(dbdir=dbdir)</span>
                <span class="n">ibs</span> <span class="o">=</span> <span class="n">IBEISControl</span><span class="o">.</span><span class="n">request_IBEISController</span><span class="p">(</span><span class="n">dbdir</span><span class="o">=</span><span class="n">dbdir</span><span class="p">)</span>
                <span class="n">back</span><span class="o">.</span><span class="n">connect_wbia_control</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s1">&#39;caught Exception while opening database&#39;</span><span class="p">)</span>
                <span class="k">raise</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sysres</span><span class="o">.</span><span class="n">set_default_dbdir</span><span class="p">(</span><span class="n">dbdir</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.export_database_as_csv"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.export_database_as_csv">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">export_database_as_csv</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; File -&gt; Export Database &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] export_database_as_csv&#39;</span><span class="p">)</span>
        <span class="n">dump_dir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_dbdir</span><span class="p">(),</span> <span class="s1">&#39;CSV_DUMP&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">dump_dir</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">view_directory</span><span class="p">(</span><span class="n">dump_dir</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">dump_database_csv</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.backup_database"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.backup_database">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">backup_database</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; File -&gt; Backup Database&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] backup_database&#39;</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">backup_database</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.make_database_duplicate"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.make_database_duplicate">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">make_database_duplicate</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; File -&gt; Copy Database&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] make_database_duplicate&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">on_chosen</span><span class="p">(</span><span class="n">new_dbdir</span><span class="p">):</span>
            <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">copy_database</span><span class="p">(</span><span class="n">new_dbdir</span><span class="p">)</span>

        <span class="n">dlg</span> <span class="o">=</span> <span class="n">NewDatabaseWidget</span><span class="o">.</span><span class="n">as_dialog</span><span class="p">(</span>
            <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="p">,</span> <span class="n">back</span><span class="o">=</span><span class="n">back</span><span class="p">,</span> <span class="n">on_chosen</span><span class="o">=</span><span class="n">on_chosen</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;copy&#39;</span>
        <span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.import_images_from_file"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.import_images_from_file">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">import_images_from_file</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span> <span class="n">gpath_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_annots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clock_offset</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        File -&gt; Import Images From File</span>

<span class="sd">        Example</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(--gui)</span>
<span class="sd">            &gt;&gt;&gt; print(&#39;[TEST] GET_TEST_IMAGE_PATHS&#39;)</span>
<span class="sd">            &gt;&gt;&gt; # The test api returns a list of interesting chip indexes</span>
<span class="sd">            &gt;&gt;&gt; mode = &#39;FILE&#39;</span>
<span class="sd">            &gt;&gt;&gt; if mode == &#39;FILE&#39;:</span>
<span class="sd">            &gt;&gt;&gt;     gpath_list = list(map(utool.unixpath, grabdata.get_test_gpaths()))</span>
<span class="sd">            &gt;&gt;&gt; #</span>
<span class="sd">            &gt;&gt;&gt;     # else:</span>
<span class="sd">            &gt;&gt;&gt;     #    dir_ = utool.truepath(join(sysres.get_workdir(), &#39;PZ_MOTHERS/images&#39;))</span>
<span class="sd">            &gt;&gt;&gt;     #    gpath_list = utool.list_images(dir_, fullpath=True, recursive=True)[::4]</span>
<span class="sd">            &gt;&gt;&gt;     print(&#39;[TEST] IMPORT IMAGES FROM FILE\n * gpath_list=%r&#39; % gpath_list)</span>
<span class="sd">            &gt;&gt;&gt;     gid_list = back.import_images(gpath_list=gpath_list)</span>
<span class="sd">            &gt;&gt;&gt;     thumbtup_list = ibs.get_image_thumbtup(gid_list)</span>
<span class="sd">            &gt;&gt;&gt;     imgpath_list = [tup[1] for tup in thumbtup_list]</span>
<span class="sd">            &gt;&gt;&gt;     gpath_list2 = ibs.get_image_paths(gid_list)</span>
<span class="sd">            &gt;&gt;&gt;     for path in gpath_list2:</span>
<span class="sd">            &gt;&gt;&gt;         assert path in imgpath_list, &quot;Imported Image not in db, path=%r&quot; % path</span>
<span class="sd">            &gt;&gt;&gt; elif mode == &#39;DIR&#39;:</span>
<span class="sd">            &gt;&gt;&gt;     dir_ = grabdata.get_testdata_dir()</span>
<span class="sd">            &gt;&gt;&gt;     print(&#39;[TEST] IMPORT IMAGES FROM DIR\n * dir_=%r&#39; % dir_)</span>
<span class="sd">            &gt;&gt;&gt;     gid_list = back.import_images(dir_=dir_)</span>
<span class="sd">            &gt;&gt;&gt; else:</span>
<span class="sd">            &gt;&gt;&gt;     raise AssertionError(&#39;unknown mode=%r&#39; % mode)</span>
<span class="sd">            &gt;&gt;&gt; print(&#39;[TEST] * len(gid_list)=%r&#39; % len(gid_list))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] import_images_from_file&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;back.ibs is None! must open IBEIS database first&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gpath_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gpath_list</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">select_images</span><span class="p">(</span><span class="s1">&#39;Select image files to import&#39;</span><span class="p">)</span>

        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">add_images</span><span class="p">(</span>
            <span class="n">gpath_list</span><span class="p">,</span>
            <span class="n">as_annots</span><span class="o">=</span><span class="n">as_annots</span><span class="p">,</span>
            <span class="n">location_for_names</span><span class="o">=</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">location_for_names</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_process_new_images</span><span class="p">(</span><span class="n">refresh</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">clock_offset</span><span class="o">=</span><span class="n">clock_offset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gid_list</span></div>

<div class="viewcode-block" id="MainWindowBackend.import_button_click"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.import_button_click">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">import_button_click</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;How do you want to import images?&#39;</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">user_option</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Import Images&#39;</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[</span>
                <span class="s1">&#39;Directory&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Files&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Smart XML&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Encounters (1)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Encounters (2)&#39;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="s1">&#39;Directory&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;Directory&#39;</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">import_images_from_dir</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;Files&#39;</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">import_images_from_file</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;Smart XML&#39;</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">import_images_from_dir_with_smart</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;Encounters (1)&#39;</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">import_images_from_encounters_1</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;Encounters (2)&#39;</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">import_images_from_encounters_2</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ans</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown anser=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ans</span><span class="p">,))</span></div>

<div class="viewcode-block" id="MainWindowBackend.import_images_from_dir"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.import_images_from_dir">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">import_images_from_dir</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span>
        <span class="n">dir_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">size_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">clock_offset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">return_dir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">defaultdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; File -&gt; Import Images From Directory&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] import_images_from_dir&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dir_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dir_</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">select_directory</span><span class="p">(</span>
                <span class="s1">&#39;Select directory with images in it&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">defaultdir</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">dir_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">gpath_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">list_images</span><span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">fullpath</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">size_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Can someone implement the size filter?&#39;</span><span class="p">)</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">add_images</span><span class="p">(</span>
            <span class="n">gpath_list</span><span class="p">,</span> <span class="n">location_for_names</span><span class="o">=</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">location_for_names</span>
        <span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_process_new_images</span><span class="p">(</span><span class="n">refresh</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">clock_offset</span><span class="o">=</span><span class="n">clock_offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_dir</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">dir_</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gid_list</span></div>

<div class="viewcode-block" id="MainWindowBackend.import_images_from_dir_with_smart"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.import_images_from_dir_with_smart">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">import_images_from_dir_with_smart</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span>
        <span class="n">dir_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">size_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">smart_xml_fpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">defaultdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;File -&gt; Import Images From Directory with smart</span>

<span class="sd">        Args:</span>
<span class="sd">            dir_ (None): (default = None)</span>
<span class="sd">            size_filter (None): (default = None)</span>
<span class="sd">            refresh (bool): (default = True)</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: gid_list</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.gui.guiback --test-import_images_from_dir_with_smart --show</span>
<span class="sd">            python -m wbia.gui.guiback --test-import_images_from_dir_with_smart --show --auto</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # DEV_GUI_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(--gui)</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; back = testdata_guiback(defaultdb=&#39;freshsmart_test&#39;, delete_ibsdir=True, allow_newdir=True)</span>
<span class="sd">            &gt;&gt;&gt; ibs = back.ibs</span>
<span class="sd">            &gt;&gt;&gt; defaultdir = ut.truepath(&#39;~/lewa-desktop/Desktop/GZ_Foal_Patrol_22_06_2015&#39;)</span>
<span class="sd">            &gt;&gt;&gt; dir_ = None if not ut.get_argflag(&#39;--auto&#39;) else join(defaultdir, &#39;Photos&#39;)</span>
<span class="sd">            &gt;&gt;&gt; smart_xml_fpath = None if not ut.get_argflag(&#39;--auto&#39;) else join(defaultdir, &#39;Patrols&#39;, &#39;LWC_000526LEWA_GZ_FOAL_PATROL.xml&#39;)</span>
<span class="sd">            &gt;&gt;&gt; size_filter = None</span>
<span class="sd">            &gt;&gt;&gt; refresh = True</span>
<span class="sd">            &gt;&gt;&gt; gid_list = back.import_images_from_dir_with_smart(dir_, size_filter, refresh, defaultdir=defaultdir, smart_xml_fpath=smart_xml_fpath)</span>
<span class="sd">            &gt;&gt;&gt; result = (&#39;gid_list = %s&#39; % (str(gid_list),))</span>
<span class="sd">            &gt;&gt;&gt; print(result)</span>
<span class="sd">            &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">            &gt;&gt;&gt; gt.qtapp_loop(back.mainwin, frequency=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] import_images_from_dir_with_smart&#39;</span><span class="p">)</span>
        <span class="n">gid_list</span><span class="p">,</span> <span class="n">add_dir_</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">import_images_from_dir</span><span class="p">(</span>
            <span class="n">dir_</span><span class="o">=</span><span class="n">dir_</span><span class="p">,</span>
            <span class="n">size_filter</span><span class="o">=</span><span class="n">size_filter</span><span class="p">,</span>
            <span class="n">refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">clock_offset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">return_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">defaultdir</span><span class="o">=</span><span class="n">defaultdir</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_group_images_with_smartxml</span><span class="p">(</span>
            <span class="n">gid_list</span><span class="p">,</span>
            <span class="n">refresh</span><span class="o">=</span><span class="n">refresh</span><span class="p">,</span>
            <span class="n">smart_xml_fpath</span><span class="o">=</span><span class="n">smart_xml_fpath</span><span class="p">,</span>
            <span class="n">defaultdir</span><span class="o">=</span><span class="n">dirname</span><span class="p">(</span><span class="n">add_dir_</span><span class="p">),</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_group_images_with_smartxml</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">smart_xml_fpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaultdir</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clusters the newly imported images with smart xml file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">smart_xml_fpath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">name_filter</span> <span class="o">=</span> <span class="s1">&#39;XML Files (*.xml)&#39;</span>
                <span class="n">xml_path_list</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">select_files</span><span class="p">(</span>
                    <span class="n">caption</span><span class="o">=</span><span class="s1">&#39;Select Patrol XML File:&#39;</span><span class="p">,</span>
                    <span class="n">directory</span><span class="o">=</span><span class="n">defaultdir</span><span class="p">,</span>
                    <span class="n">name_filter</span><span class="o">=</span><span class="n">name_filter</span><span class="p">,</span>
                    <span class="n">single_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xml_path_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Must specity one Patrol XML file&#39;</span>
                    <span class="n">smart_xml_fpath</span> <span class="o">=</span> <span class="n">xml_path_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">smart_xml_fpath</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="p">),</span> <span class="s1">&#39;Must specity a valid Patrol XML file&#39;</span>
                <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">delete_images</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="s1">&#39;[back] ERROR: Parsing Patrol XML file failed, &#39;</span>
                            <span class="s1">&#39;rolling back by deleting </span><span class="si">%d</span><span class="s1"> images...&#39;</span>
                        <span class="p">)</span>
                        <span class="o">%</span> <span class="p">(</span>
                            <span class="nb">len</span><span class="p">(</span>
                                <span class="n">gid_list</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">e</span>

            <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">compute_occurrences_smart</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">smart_xml_fpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">update_special_imagesets_</span><span class="p">()</span>
            <span class="c1"># back.front.update_tables([gh.IMAGESET_TABLE])</span>
            <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_process_new_images</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">refresh</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">clock_offset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">update_special_imagesets_</span><span class="p">()</span>
            <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">update_tables</span><span class="p">([</span><span class="n">gh</span><span class="o">.</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">gh</span><span class="o">.</span><span class="n">IMAGESET_TABLE</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">clock_offset</span><span class="p">:</span>
            <span class="n">co_wgt</span> <span class="o">=</span> <span class="n">clock_offset_gui</span><span class="o">.</span><span class="n">ClockOffsetWidget</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">)</span>
            <span class="n">co_wgt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">gid_list</span>

<div class="viewcode-block" id="MainWindowBackend.import_images_from_encounters"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.import_images_from_encounters">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">import_images_from_encounters</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span>
        <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">dir_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">size_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">clock_offset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">return_dir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">defaultdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="kn">import</span> <span class="nn">os</span>

        <span class="sd">&quot;&quot;&quot; File -&gt; Import Images From Encounters&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] import_images_from_encounters&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">level</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dir_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="s1">&#39;Select folder(s) of encounter(s) (1 level - folders with only images)&#39;</span>
            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="s1">&#39;Select folder(s) of encounter(s) (2 levels - folders of folders with only images)&#39;</span>
            <span class="n">dir_list</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">select_directories</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">defaultdir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dir_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dir_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># We need to check that the first directory is not a subdirectory of the others</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dir_list</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">subdir1</span> <span class="o">=</span> <span class="n">dir_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">subdir2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">dir_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">subdir1</span> <span class="o">==</span> <span class="n">subdir2</span><span class="p">:</span>
                <span class="n">dir_list</span> <span class="o">=</span> <span class="n">dir_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># Check the folders for invalid values</span>
        <span class="n">invalid_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">warning_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">dir_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dir_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">subdirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dir_</span><span class="p">):</span>
                <span class="n">images</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">list_images</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Assert structure</span>
                    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">subdirs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">subdirs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

                        <span class="c1"># Check subdirectories for level 1 structure</span>
                        <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="n">subdirs</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">root_</span><span class="p">,</span> <span class="n">subdirs_</span><span class="p">,</span> <span class="n">files_</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">subdir</span><span class="p">):</span>
                                <span class="n">images_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">list_images</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">subdirs_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
                                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">images_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                                <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                                    <span class="n">invalid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">root_</span><span class="p">))</span>
                                <span class="c1"># Combined a warning set of non-image files</span>
                                <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">files_</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">images_</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="n">warning_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file_</span><span class="p">))</span>
                                <span class="c1"># Only look at the root path</span>
                                <span class="k">break</span>
                <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                    <span class="n">invalid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
                <span class="c1"># Combined a warning set of non-image files</span>
                <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">warning_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
                <span class="c1"># Only look at the root path</span>
                <span class="k">break</span>

        <span class="c1"># If invalid, give user input information</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    [guiback] The following encounter folder structures (1 level) are not valid: %r</span>
<span class="sd">                    [guiback]     * The selected folders must contain images</span>
<span class="sd">                    [guiback]     * The selected folders must NOT contain any sub-folders</span>
<span class="sd">                    [guiback]     * The selected folders must NOT be empty</span>
<span class="sd">                &quot;&quot;&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">invalid_list</span><span class="p">,)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    [guiback] The following encounter folder structures (2 levels) are not valid: %r</span>
<span class="sd">                    [guiback]     * The selected folders must NOT contain images</span>
<span class="sd">                    [guiback]     * The selected folders must contain sub-folders</span>
<span class="sd">                    [guiback]     * The selected folders must NOT be empty</span>
<span class="sd">                    [guiback]     * The sub-folders in the selected folders must contain images</span>
<span class="sd">                    [guiback]     * The sub-folders in the selected folders must NOT contain any sub-folders</span>
<span class="sd">                    [guiback]     * The sub-folders in the selected folders must NOT be empty</span>
<span class="sd">                &quot;&quot;&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">invalid_list</span><span class="p">,)</span>
                <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[guiback] Encounters are valid, continue with import&#39;</span><span class="p">)</span>

        <span class="c1"># print any warning files</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warning_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warning_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">warning_set</span><span class="p">))</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">warning_list</span><span class="p">,)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;[guiback] WARNING: Some files in the encounters will not be imported: </span><span class="si">%r</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="n">args</span>
            <span class="p">)</span>

        <span class="c1"># Compile the list of images now that the encounter&#39;s structure have been verified</span>
        <span class="n">gpath_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dir_</span> <span class="ow">in</span> <span class="n">dir_list</span><span class="p">:</span>
            <span class="n">gpath_list_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">list_images</span><span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">fullpath</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">gpath_list</span> <span class="o">+=</span> <span class="n">gpath_list_</span>

        <span class="c1"># Check that the encounters behave as expected</span>
        <span class="k">if</span> <span class="n">size_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Can someone implement the size filter?&#39;</span><span class="p">)</span>

        <span class="c1"># Add images to ibs</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">add_images</span><span class="p">(</span>
            <span class="n">gpath_list</span><span class="p">,</span> <span class="n">location_for_names</span><span class="o">=</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">location_for_names</span>
        <span class="p">)</span>

        <span class="c1"># Add imagesets for newly added images</span>
        <span class="n">imageset_text_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">gpath</span> <span class="ow">in</span> <span class="n">gpath_list</span><span class="p">:</span>
            <span class="n">base</span><span class="p">,</span> <span class="n">gname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">gpath</span><span class="p">)</span>
            <span class="n">base</span><span class="p">,</span> <span class="n">level1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">imageset_text</span> <span class="o">=</span> <span class="n">level1</span>
            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">base</span><span class="p">,</span> <span class="n">level2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
                <span class="n">imageset_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  (+)  </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">level2</span><span class="p">,</span>
                    <span class="n">level1</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">imageset_text_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imageset_text</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_image_imagesettext</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">imageset_text_list</span><span class="p">)</span>

        <span class="c1"># Refresh GUI and return</span>
        <span class="n">back</span><span class="o">.</span><span class="n">_process_new_images</span><span class="p">(</span><span class="n">refresh</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">clock_offset</span><span class="o">=</span><span class="n">clock_offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_dir</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">dir_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gid_list</span></div>

<div class="viewcode-block" id="MainWindowBackend.import_images_from_encounters_1"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.import_images_from_encounters_1">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">import_images_from_encounters_1</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span> <span class="n">dir_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">defaultdir</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;File -&gt; Import Images From Encounters (1 level)</span>

<span class="sd">        Args:</span>
<span class="sd">            dir_ (None): (default = None)</span>
<span class="sd">            size_filter (None): (default = None)</span>
<span class="sd">            refresh (bool): (default = True)</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: gid_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] import_images_from_encounters_1&#39;</span><span class="p">)</span>
        <span class="n">gid_list</span><span class="p">,</span> <span class="n">add_dir_</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">import_images_from_encounters</span><span class="p">(</span>
            <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">dir_list</span><span class="o">=</span><span class="n">dir_list</span><span class="p">,</span>
            <span class="n">size_filter</span><span class="o">=</span><span class="n">size_filter</span><span class="p">,</span>
            <span class="n">refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">clock_offset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">return_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">defaultdir</span><span class="o">=</span><span class="n">defaultdir</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.import_images_from_encounters_2"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.import_images_from_encounters_2">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">import_images_from_encounters_2</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span> <span class="n">dir_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">defaultdir</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;File -&gt; Import Images From Encounters (2 levels)</span>

<span class="sd">        Args:</span>
<span class="sd">            dir_ (None): (default = None)</span>
<span class="sd">            size_filter (None): (default = None)</span>
<span class="sd">            refresh (bool): (default = True)</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: gid_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] import_images_from_encounters_2&#39;</span><span class="p">)</span>
        <span class="n">gid_list</span><span class="p">,</span> <span class="n">add_dir_</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">import_images_from_encounters</span><span class="p">(</span>
            <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">dir_list</span><span class="o">=</span><span class="n">dir_list</span><span class="p">,</span>
            <span class="n">size_filter</span><span class="o">=</span><span class="n">size_filter</span><span class="p">,</span>
            <span class="n">refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">clock_offset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">return_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">defaultdir</span><span class="o">=</span><span class="n">defaultdir</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.import_images_as_annots_from_file"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.import_images_as_annots_from_file">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">import_images_as_annots_from_file</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">gpath_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">back</span><span class="o">.</span><span class="n">import_images_from_file</span><span class="p">(</span><span class="n">gpath_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_annots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.localize_images"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.localize_images">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="nd">@backreport</span>
    <span class="k">def</span> <span class="nf">localize_images</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; File -&gt; Localize Images &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] localize_images&#39;</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">localize_images</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.quit"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.quit">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">quit</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; File -&gt; Quit&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] &#39;</span><span class="p">)</span>
        <span class="c1"># back.cleanup()</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">exit_application</span><span class="p">()</span></div>

    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># Helper functions</span>
    <span class="c1"># --------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MainWindowBackend.user_info"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.user_info">[docs]</a>    <span class="k">def</span> <span class="nf">user_info</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">gt</span><span class="o">.</span><span class="n">user_info</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.user_warning"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.user_warning">[docs]</a>    <span class="k">def</span> <span class="nf">user_warning</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Warning&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">gt</span><span class="o">.</span><span class="n">user_info</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.user_input"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.user_input">[docs]</a>    <span class="k">def</span> <span class="nf">user_input</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;user input&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">gt</span><span class="o">.</span><span class="n">user_input</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.user_option"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.user_option">[docs]</a>    <span class="k">def</span> <span class="nf">user_option</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># options, config, msg, title</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">ConfigConfirmWidget</span><span class="o">.</span><span class="n">as_dialog</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># dlg.resize(700, 500)</span>
            <span class="n">confirm_widget</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">widget</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">confirm_widget</span><span class="o">.</span><span class="n">confirm_option</span><span class="p">,</span> <span class="n">confirm_widget</span><span class="o">.</span><span class="n">config</span>
            <span class="c1"># return gt.user_option(parent=back.front, **kwargs)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gt</span><span class="o">.</span><span class="n">user_option</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.are_you_sure"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.are_you_sure">[docs]</a>    <span class="k">def</span> <span class="nf">are_you_sure</span><span class="p">(</span>
        <span class="n">back</span><span class="p">,</span>
        <span class="n">use_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Confirmation&#39;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">detailed_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Prompt user for conformation before changing something &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">default_msg</span> <span class="o">=</span> <span class="s1">&#39;Are you sure?&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default_msg</span> <span class="o">=</span> <span class="s1">&#39;Are you sure you want to </span><span class="si">%s</span><span class="s1">?&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">action</span><span class="p">,)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">default_msg</span> <span class="k">if</span> <span class="n">use_msg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">use_msg</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] Asking User if sure&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] title = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">title</span><span class="p">,))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] msg =</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">msg</span><span class="p">,))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] detailed_msg =</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">detailed_msg</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;-y&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--yes&#39;</span><span class="p">):</span>
            <span class="c1"># DONT ASK WHEN SPECIFIED</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">user_option</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Yes&#39;</span><span class="p">,</span> <span class="s1">&#39;No&#39;</span><span class="p">],</span>
            <span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="n">detailed_msg</span><span class="o">=</span><span class="n">detailed_msg</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] User answered: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ans</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span></div>

<div class="viewcode-block" id="MainWindowBackend.get_work_directory"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.get_work_directory">[docs]</a>    <span class="k">def</span> <span class="nf">get_work_directory</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sysres</span><span class="o">.</span><span class="n">get_workdir</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_eidfromkw</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;imgsetid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_imgsetid</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;imgsetid&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">imgsetid</span>

<div class="viewcode-block" id="MainWindowBackend.contains_special_imagesets"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.contains_special_imagesets">[docs]</a>    <span class="k">def</span> <span class="nf">contains_special_imagesets</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">imgsetid_list</span><span class="p">):</span>
        <span class="n">isspecial_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">is_special_imageset</span><span class="p">(</span><span class="n">imgsetid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">isspecial_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.display_special_imagesets_error"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.display_special_imagesets_error">[docs]</a>    <span class="k">def</span> <span class="nf">display_special_imagesets_error</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">back</span><span class="o">.</span><span class="n">user_warning</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Contains special imagesets&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.override_all_annotation_species"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.override_all_annotation_species">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">override_all_annotation_species</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">aids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gids</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Give the user a dialog box asking to input a species</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">aids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">aid_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ub</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">images</span><span class="p">(</span><span class="n">gids</span><span class="o">=</span><span class="n">gids</span><span class="p">)</span><span class="o">.</span><span class="n">aids</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aid_list</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">aids</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">user_input</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;edit species&#39;</span><span class="p">,</span>
            <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Override species for </span><span class="si">{}</span><span class="s1"> annots&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)),</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;override_all_annotation_species. resp = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">resp</span><span class="p">,))</span>
            <span class="n">species_rowid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">add_species</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
            <span class="n">use_msg</span> <span class="o">=</span> <span class="s1">&#39;Are you sure you want to change </span><span class="si">%d</span><span class="s1"> annotations species to </span><span class="si">%r</span><span class="s1">?&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">),</span>
                <span class="n">resp</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">use_msg</span><span class="o">=</span><span class="n">use_msg</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;performing override&#39;</span><span class="p">)</span>
                <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_species_rowids</span><span class="p">(</span>
                    <span class="n">aid_list</span><span class="p">,</span> <span class="p">[</span><span class="n">species_rowid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># FIXME: api-cache is broken here too</span>
                <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">reset_table_cache</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.update_species_nice_name"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.update_species_nice_name">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">update_species_nice_name</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">wbia.control.manual_species_funcs</span> <span class="kn">import</span> <span class="n">_convert_species_nice_to_code</span>

        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">species_text</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_species</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">species_text</span> <span class="ow">in</span> <span class="p">[</span><span class="n">const</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">user_warning</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Cannot rename this species...&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span>
        <span class="n">species_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_species_rowids_from_text</span><span class="p">(</span><span class="n">species_text</span><span class="p">)</span>
        <span class="n">species_nice</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_species_nice</span><span class="p">(</span><span class="n">species_rowid</span><span class="p">)</span>
        <span class="n">new_species_nice</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">user_input</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Rename species</span><span class="se">\n</span><span class="s1">    Name: </span><span class="si">%r</span><span class="s1"> </span><span class="se">\n</span><span class="s1">    Tag:  </span><span class="si">%r</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">species_nice</span><span class="p">,</span> <span class="n">species_text</span><span class="p">),</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Rename Species&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">new_species_nice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_rowid</span> <span class="o">=</span> <span class="p">[</span><span class="n">species_rowid</span><span class="p">]</span>
            <span class="n">new_species_nice</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_species_nice</span><span class="p">]</span>
            <span class="n">species_code</span> <span class="o">=</span> <span class="n">_convert_species_nice_to_code</span><span class="p">(</span><span class="n">new_species_nice</span><span class="p">)</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">_set_species_nice</span><span class="p">(</span><span class="n">species_rowid</span><span class="p">,</span> <span class="n">new_species_nice</span><span class="p">)</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">_set_species_code</span><span class="p">(</span><span class="n">species_rowid</span><span class="p">,</span> <span class="n">species_code</span><span class="p">)</span>
            <span class="n">back</span><span class="o">.</span><span class="n">ibswgt</span><span class="o">.</span><span class="n">update_species_available</span><span class="p">(</span>
                <span class="n">reselect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reselect_new_name</span><span class="o">=</span><span class="n">new_species_nice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.delete_selected_species"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.delete_selected_species">[docs]</a>    <span class="nd">@blocking_slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">delete_selected_species</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">species_text</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_species</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">species_text</span> <span class="ow">in</span> <span class="p">[</span><span class="n">const</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
            <span class="n">back</span><span class="o">.</span><span class="n">user_warning</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Cannot delete this species...&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span>
        <span class="n">species_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_species_rowids_from_text</span><span class="p">(</span><span class="n">species_text</span><span class="p">)</span>
        <span class="n">species_nice</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_species_nice</span><span class="p">(</span><span class="n">species_rowid</span><span class="p">)</span>

        <span class="n">msg_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;You are about to delete species</span><span class="se">\n</span><span class="s1">    Name: </span><span class="si">%r</span><span class="s1"> </span><span class="se">\n</span><span class="s1">    &#39;</span>
            <span class="o">+</span> <span class="s1">&#39;Tag:  </span><span class="si">%r</span><span class="se">\n\n</span><span class="s1">Do you wish to continue?</span><span class="se">\n</span><span class="s1">All annotations &#39;</span>
            <span class="o">+</span> <span class="s1">&#39;with this species will be set to unknown.&#39;</span>
        <span class="p">)</span>
        <span class="n">msg_str</span> <span class="o">=</span> <span class="n">msg_str</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">species_nice</span><span class="p">,</span>
            <span class="n">species_text</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">confirm_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">use_msg</span><span class="o">=</span><span class="n">msg_str</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Delete Selected Species?&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;No&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">back</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="o">**</span><span class="n">confirm_kw</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">guiexcept</span><span class="o">.</span><span class="n">UserCancel</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_species</span><span class="p">([</span><span class="n">species_rowid</span><span class="p">])</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibswgt</span><span class="o">.</span><span class="n">update_species_available</span><span class="p">(</span><span class="n">deleting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.set_exemplars_from_quality_and_viewpoint_"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.set_exemplars_from_quality_and_viewpoint_">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">set_exemplars_from_quality_and_viewpoint_</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">exemplars_per_view</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">exemplars_per_view</span>
        <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_imgsetid</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;set_exemplars_from_quality_and_viewpoint, imgsetid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imgsetid</span><span class="p">,))</span>
        <span class="n">HACK</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">enable_custom_filter</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">HACK</span><span class="p">,</span> <span class="s1">&#39;enable_custom_filter is no longer supported&#39;</span>

        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">set_exemplars_from_quality_and_viewpoint</span><span class="p">(</span>
            <span class="n">imgsetid</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">,</span> <span class="n">exemplars_per_view</span><span class="o">=</span><span class="n">exemplars_per_view</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.batch_rename_consecutive_via_species_"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.batch_rename_consecutive_via_species_">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">batch_rename_consecutive_via_species_</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="c1"># imgsetid = back.get_selected_imgsetid()</span>
        <span class="c1"># back.ibs.batch_rename_consecutive_via_species(imgsetid=imgsetid)</span>
        <span class="n">imgsetid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;batch_rename_consecutive_via_species, imgsetid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imgsetid</span><span class="p">,))</span>
        <span class="n">location_text</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">location_for_names</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">batch_rename_consecutive_via_species</span><span class="p">(</span>
            <span class="n">imgsetid</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">,</span> <span class="n">location_text</span><span class="o">=</span><span class="n">location_text</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.run_utool_tests"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.run_utool_tests">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run_utool_tests</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">utool.tests.run_tests</span>

        <span class="n">utool</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">run_tests</span><span class="o">.</span><span class="n">run_tests</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.run_vtool_tests"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.run_vtool_tests">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run_vtool_tests</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">vtool.tests.run_tests</span>

        <span class="n">vtool</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">run_tests</span><span class="o">.</span><span class="n">run_tests</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.assert_modules"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.assert_modules">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">assert_modules</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">wbia.tests</span> <span class="kn">import</span> <span class="n">assert_modules</span>

        <span class="n">detailed_msg</span> <span class="o">=</span> <span class="n">assert_modules</span><span class="o">.</span><span class="n">assert_modules</span><span class="p">()</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">msgbox</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Running checks&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Module Checks&#39;</span><span class="p">,</span> <span class="n">detailed_msg</span><span class="o">=</span><span class="n">detailed_msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.display_dbinfo"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.display_dbinfo">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">display_dbinfo</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CommandLine:</span>
<span class="sd">            python -m wbia.gui.guiback --test-display_dbinfo</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from wbia.gui.guiback import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; back = testdata_guiback()</span>
<span class="sd">            &gt;&gt;&gt; result = back.display_dbinfo()</span>
<span class="sd">            &gt;&gt;&gt; print(result)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dbinfo</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_dbinfo_str</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">dbinfo</span><span class="p">)</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">msgbox</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_infostr</span><span class="p">(),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;DBInfo&#39;</span><span class="p">,</span> <span class="n">detailed_msg</span><span class="o">=</span><span class="n">dbinfo</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.show_about_message"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.show_about_message">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">show_about_message</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">wbia</span>

        <span class="n">version</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">__version__</span>
        <span class="n">about_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;IBEIS version </span><span class="si">%s</span><span class="se">\n</span><span class="s1">Image Based Ecological Information System</span><span class="se">\n</span><span class="s1">http://wbia.org/&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">version</span><span class="p">,)</span>
        <span class="p">)</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">msgbox</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">about_msg</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;About&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.take_screenshot"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.take_screenshot">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">take_screenshot</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; dev command only &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[back] TAKING SCREENSHOT&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">wbia.guitool.__PYQT__.QtGui</span> <span class="kn">import</span> <span class="n">QPixmap</span>

        <span class="c1"># screengrab_fpath = ut.truepath(&#39;~/latex/wbia_userguide/figures/filemenu.jpg&#39;)</span>

        <span class="c1"># Find the focused window</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">get_qtapp</span><span class="p">()</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">focusWidget</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">widget</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">mainwin</span>
        <span class="n">window</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">window</span><span class="p">()</span>
        <span class="n">win_title</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">()</span>
        <span class="n">window_id</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">winId</span><span class="p">()</span>

        <span class="c1"># Resolve screengrab path</span>
        <span class="n">screengrab_dpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--screengrab_dpath&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">screengrab_fname</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--screengrab_fname&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">screengrab_fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">screengrab_fname</span> <span class="o">=</span> <span class="n">win_title</span>
        <span class="k">if</span> <span class="n">screengrab_dpath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">screengrab_dpath</span> <span class="o">=</span> <span class="s1">&#39;./screenshots&#39;</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">screengrab_dpath</span><span class="p">)</span>
        <span class="n">screengrab_dpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truepath</span><span class="p">(</span><span class="n">screengrab_dpath</span><span class="p">)</span>
        <span class="n">screengrab_fname</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">sanitize_filename</span><span class="p">(</span><span class="n">screengrab_fname</span><span class="p">)</span>
        <span class="n">fpath_base</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">screengrab_dpath</span><span class="p">,</span> <span class="n">screengrab_fname</span><span class="p">)</span>
        <span class="n">fpath_fmt</span> <span class="o">=</span> <span class="n">fpath_base</span> <span class="o">+</span> <span class="s1">&#39;_</span><span class="si">%d</span><span class="s1">.jpg&#39;</span>
        <span class="n">screengrab_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_nonconflicting_path</span><span class="p">(</span><span class="n">fpath_fmt</span><span class="p">)</span>

        <span class="c1"># Grab image in window</span>
        <span class="n">screenimg</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="o">.</span><span class="n">grabWindow</span><span class="p">(</span><span class="n">window_id</span><span class="p">)</span>
        <span class="c1"># Save image to disk</span>
        <span class="n">screenimg</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">screengrab_fpath</span><span class="p">,</span> <span class="s1">&#39;jpg&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;saved screengrab to </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">screengrab_fpath</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--diskshow&#39;</span><span class="p">):</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="n">screengrab_fpath</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.make_qt_graph_interface"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.make_qt_graph_interface">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">make_qt_graph_interface</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">wbia.viz</span> <span class="kn">import</span> <span class="n">viz_graph2</span>

        <span class="n">imgsetid</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">get_selected_imgsetid</span><span class="p">()</span>
        <span class="n">aids</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">imgsetid</span><span class="o">=</span><span class="n">imgsetid</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;Choose an imageset with annotations&#39;</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">graph_iden_win</span> <span class="o">=</span> <span class="n">viz_graph2</span><span class="o">.</span><span class="n">make_qt_graph_interface</span><span class="p">(</span><span class="n">aids</span><span class="o">=</span><span class="n">aids</span><span class="p">,</span> <span class="n">ibs</span><span class="o">=</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.reconnect_controller"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.reconnect_controller">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">reconnect_controller</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">back</span><span class="o">.</span><span class="n">connect_wbia_control</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.browse_wildbook"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.browse_wildbook">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">browse_wildbook</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">wb_base_url</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_wildbook_base_url</span><span class="p">()</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">get_prefered_browser</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">wb_base_url</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.install_wildbook"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.install_wildbook">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">install_wildbook</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">wbia.control.wildbook_manager</span> <span class="k">as</span> <span class="nn">wb_man</span>

        <span class="n">wb_man</span><span class="o">.</span><span class="n">install_wildbook</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.startup_wildbook"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.startup_wildbook">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">startup_wildbook</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">wbia.control.wildbook_manager</span> <span class="k">as</span> <span class="nn">wb_man</span>

        <span class="n">back</span><span class="o">.</span><span class="n">wb_server_running</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">wb_man</span><span class="o">.</span><span class="n">startup_wildbook_server</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.shutdown_wildbook"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.shutdown_wildbook">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">shutdown_wildbook</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">wbia.control.wildbook_manager</span> <span class="k">as</span> <span class="nn">wb_man</span>

        <span class="n">wb_man</span><span class="o">.</span><span class="n">shutdown_wildbook_server</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">wb_server_running</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="MainWindowBackend.force_wildbook_namechange"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.force_wildbook_namechange">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">force_wildbook_namechange</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">wildbook_signal_annot_name_changes</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.set_workdir"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.set_workdir">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">set_workdir</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">wbia</span>

        <span class="n">wbia</span><span class="o">.</span><span class="n">sysres</span><span class="o">.</span><span class="n">set_workdir</span><span class="p">(</span><span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_gui</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.ensure_demodata"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.ensure_demodata">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">ensure_demodata</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">wbia</span> <span class="kn">import</span> <span class="n">demodata</span>

        <span class="n">demodata</span><span class="o">.</span><span class="n">ensure_demodata</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindowBackend.launch_ipy_notebook"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.launch_ipy_notebook">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">launch_ipy_notebook</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">wbia.templates</span> <span class="kn">import</span> <span class="n">generate_notebook</span>

        <span class="n">generate_notebook</span><span class="o">.</span><span class="n">autogen_ipynb</span><span class="p">(</span><span class="n">back</span><span class="o">.</span><span class="n">ibs</span><span class="p">,</span> <span class="n">launch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.update_source_install"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.update_source_install">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">update_source_install</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">wbia</span>
        <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">dirname</span>

        <span class="n">repo_path</span> <span class="o">=</span> <span class="n">dirname</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">truepath</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_modpath</span><span class="p">(</span><span class="n">wbia</span><span class="p">,</span> <span class="n">prefer_pkg</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span>
        <span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">ChdirContext</span><span class="p">(</span><span class="n">repo_path</span><span class="p">):</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">python_executable</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; super_setup.py pull&#39;</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Done updating source install&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindowBackend.toggle_output_widget"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.MainWindowBackend.toggle_output_widget">[docs]</a>    <span class="nd">@slot_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">toggle_output_widget</span><span class="p">(</span><span class="n">back</span><span class="p">):</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">outputLog</span><span class="o">.</span><span class="n">isVisible</span><span class="p">()</span>
        <span class="n">back</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">outputLog</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="ow">not</span> <span class="n">current</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="testdata_guiback"><a class="viewcode-back" href="../../../wbia.gui.html#wbia.gui.guiback.testdata_guiback">[docs]</a><span class="k">def</span> <span class="nf">testdata_guiback</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">wbia</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;testdata guiback&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">defaultdb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">back</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">entry_points_init_gui</span><span class="p">()</span>
        <span class="c1"># back = MainWindowBackend()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">main_locals</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="n">defaultdb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">back</span> <span class="o">=</span> <span class="n">main_locals</span><span class="p">[</span><span class="s1">&#39;back&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">back</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">wbia</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../wbia.html">wbia - Wildbook IA</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../../wbia.html">wbia</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Wild Me.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>