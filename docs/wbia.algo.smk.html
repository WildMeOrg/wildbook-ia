
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>wbia.algo.smk package &#8212; wbia 2.2.4 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="wbia.algo.verif package" href="wbia.algo.verif.html" />
    <link rel="prev" title="wbia.algo.preproc package" href="wbia.algo.preproc.html" />

  <link rel="stylesheet" href="_static/custom.css" type="text/css" />


  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">


          <div class="body" role="main">

  <div class="section" id="wbia-algo-smk-package">
<h1>wbia.algo.smk package<a class="headerlink" href="#wbia-algo-smk-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-wbia.algo.smk.inverted_index">
<span id="wbia-algo-smk-inverted-index-module"></span><h2>wbia.algo.smk.inverted_index module<a class="headerlink" href="#module-wbia.algo.smk.inverted_index" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnots">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.inverted_index.</code><code class="descname">InvertedAnnots</code><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnots" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#wbia.algo.smk.inverted_index.InvertedAnnotsExtras" title="wbia.algo.smk.inverted_index.InvertedAnnotsExtras"><code class="xref py py-class docutils literal notranslate"><span class="pre">wbia.algo.smk.inverted_index.InvertedAnnotsExtras</span></code></a></p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m wbia.algo.smk.inverted_index InvertedAnnots –show</dd>
<dt>Ignore:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.inverted_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;Oxford&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="s1">&#39;oxford&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:proot=smk,nAssign=1,num_words=64000&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">depc</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">depc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">daids</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">aids</span><span class="p">,</span> <span class="p">[</span><span class="n">qreq_</span><span class="o">.</span><span class="n">daids</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inva</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">DynStruct</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inva</span> <span class="o">=</span> <span class="n">InvertedAnnots</span><span class="p">(</span><span class="n">aids</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">inva</span> <span class="o">=</span> <span class="n">testdata_inva</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnots.compute_gammas">
<code class="descname">compute_gammas</code><span class="sig-paren">(</span><em>alpha</em>, <em>thresh</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnots.compute_gammas"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnots.compute_gammas" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.inverted_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">inva</span> <span class="o">=</span> <span class="n">testdata_inva</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inva</span><span class="o">.</span><span class="n">wx_to_weight</span> <span class="o">=</span> <span class="n">inva</span><span class="o">.</span><span class="n">compute_word_weights</span><span class="p">(</span><span class="s1">&#39;uniform&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thresh</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gamma_list</span> <span class="o">=</span> <span class="n">inva</span><span class="o">.</span><span class="n">compute_gammas</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnots.compute_inverted_list">
<code class="descname">compute_inverted_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnots.compute_inverted_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnots.compute_inverted_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnots.compute_word_weights">
<code class="descname">compute_word_weights</code><span class="sig-paren">(</span><em>method='idf'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnots.compute_word_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnots.compute_word_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute a per-word weight like idf</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.inverted_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">inva</span> <span class="o">=</span> <span class="n">testdata_inva</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx_to_weight</span> <span class="o">=</span> <span class="n">inva</span><span class="o">.</span><span class="n">compute_word_weights</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wx_to_weight = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wx_to_weight</span><span class="p">,))</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnots.from_depc">
<em class="property">classmethod </em><code class="descname">from_depc</code><span class="sig-paren">(</span><em>depc</em>, <em>aids</em>, <em>vocab_aids</em>, <em>config</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnots.from_depc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnots.from_depc" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnots.get_annot">
<code class="descname">get_annot</code><span class="sig-paren">(</span><em>aid</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnots.get_annot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnots.get_annot" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnots.rrr">
<code class="descname">rrr</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>reload_module=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnots.rrr" title="Permalink to this definition">¶</a></dt>
<dd><p>special class reloading function
This function is often injected as rrr of classes</p>
</dd></dl>

<dl class="attribute">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnots.wx_list">
<code class="descname">wx_list</code><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnots.wx_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnotsExtras">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.inverted_index.</code><code class="descname">InvertedAnnotsExtras</code><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnotsExtras"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnotsExtras" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="method">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnotsExtras.get_nbytes">
<code class="descname">get_nbytes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnotsExtras.get_nbytes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnotsExtras.get_nbytes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnotsExtras.get_patches">
<code class="descname">get_patches</code><span class="sig-paren">(</span><em>wx</em>, <em>ibs</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnotsExtras.get_patches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnotsExtras.get_patches" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads the patches assigned to a particular word in this stack</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">inva</span><span class="o">.</span><span class="n">wx_to_aids</span> <span class="o">=</span> <span class="n">inva</span><span class="o">.</span><span class="n">compute_inverted_list</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnotsExtras.get_size_info">
<code class="descname">get_size_info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnotsExtras.get_size_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnotsExtras.get_size_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnotsExtras.get_word_patch">
<code class="descname">get_word_patch</code><span class="sig-paren">(</span><em>wx</em>, <em>ibs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnotsExtras.get_word_patch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnotsExtras.get_word_patch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnotsExtras.print_size_info">
<code class="descname">print_size_info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnotsExtras.print_size_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnotsExtras.print_size_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnotsExtras.render_inverted_vocab">
<code class="descname">render_inverted_vocab</code><span class="sig-paren">(</span><em>ibs</em>, <em>use_data=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnotsExtras.render_inverted_vocab"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnotsExtras.render_inverted_vocab" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders the average patch of each word.
This is a visualization of the entire vocabulary.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m wbia.algo.smk.inverted_index render_inverted_vocab –show
python -m wbia.algo.smk.inverted_index render_inverted_vocab –show –use-data
python -m wbia.algo.smk.inverted_index render_inverted_vocab –show –debug-depc</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.inverted_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">inva</span> <span class="o">=</span> <span class="n">testdata_inva</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_words</span> <span class="o">=</span> <span class="n">inva</span><span class="o">.</span><span class="n">render_inverted_vocab</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">qt4ensure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">all_words</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.InvertedAnnotsExtras.render_inverted_vocab_word">
<code class="descname">render_inverted_vocab_word</code><span class="sig-paren">(</span><em>wx</em>, <em>ibs</em>, <em>fnum=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedAnnotsExtras.render_inverted_vocab_word"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedAnnotsExtras.render_inverted_vocab_word" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a visualization of a visual word. This includes the average patch,
the SIFT-like representation of the centroid, and some of the patches that
were assigned to it.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m wbia.algo.smk.inverted_index render_inverted_vocab_word –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.inverted_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">inva</span> <span class="o">=</span> <span class="n">testdata_inva</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inva</span><span class="o">.</span><span class="n">wx_to_aids</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx</span> <span class="o">=</span> <span class="n">wx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">qtensure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fnum</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fnum</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ensure_fnum</span><span class="p">(</span><span class="n">fnum</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Interactive visualization of many words</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">wx</span> <span class="ow">in</span> <span class="n">ut</span><span class="o">.</span><span class="n">InteractiveIter</span><span class="p">(</span><span class="n">wx_list</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">word_img</span> <span class="o">=</span> <span class="n">inva</span><span class="o">.</span><span class="n">render_inverted_vocab_word</span><span class="p">(</span><span class="n">wx</span><span class="p">,</span> <span class="n">ibs</span><span class="p">,</span> <span class="n">fnum</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">word_img</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Word </span><span class="si">%r</span><span class="s1">/</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wx</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">pt</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="wbia.algo.smk.inverted_index.InvertedIndexConfig">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.inverted_index.</code><code class="descname">InvertedIndexConfig</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#InvertedIndexConfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.InvertedIndexConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="wbia.dtool.html#wbia.dtool.base.Config" title="wbia.dtool.base.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">wbia.dtool.base.Config</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="wbia.algo.smk.inverted_index.SingleAnnot">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.inverted_index.</code><code class="descname">SingleAnnot</code><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#SingleAnnot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.SingleAnnot" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code></p>
<dl class="method">
<dt id="wbia.algo.smk.inverted_index.SingleAnnot.Phis_flags">
<code class="descname">Phis_flags</code><span class="sig-paren">(</span><em>idxs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#SingleAnnot.Phis_flags"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.SingleAnnot.Phis_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>get subset of aggregated residual vectors</p>
</dd></dl>

<dl class="classmethod">
<dt id="wbia.algo.smk.inverted_index.SingleAnnot.from_inva">
<em class="property">classmethod </em><code class="descname">from_inva</code><span class="sig-paren">(</span><em>inva</em>, <em>idx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#SingleAnnot.from_inva"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.SingleAnnot.from_inva" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.SingleAnnot.fxs">
<code class="descname">fxs</code><span class="sig-paren">(</span><em>c</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#SingleAnnot.fxs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.SingleAnnot.fxs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.SingleAnnot.maws">
<code class="descname">maws</code><span class="sig-paren">(</span><em>c</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#SingleAnnot.maws"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.SingleAnnot.maws" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.SingleAnnot.nbytes">
<code class="descname">nbytes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#SingleAnnot.nbytes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.SingleAnnot.nbytes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.SingleAnnot.nbytes_info">
<code class="descname">nbytes_info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#SingleAnnot.nbytes_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.SingleAnnot.nbytes_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.SingleAnnot.phis_flags_list">
<code class="descname">phis_flags_list</code><span class="sig-paren">(</span><em>idxs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#SingleAnnot.phis_flags_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.SingleAnnot.phis_flags_list" title="Permalink to this definition">¶</a></dt>
<dd><p>get subset of non-aggregated residual vectors</p>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.SingleAnnot.rrr">
<code class="descname">rrr</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>reload_module=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wbia.algo.smk.inverted_index.SingleAnnot.rrr" title="Permalink to this definition">¶</a></dt>
<dd><p>special class reloading function
This function is often injected as rrr of classes</p>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.inverted_index.SingleAnnot.to_dense">
<code class="descname">to_dense</code><span class="sig-paren">(</span><em>inva=None</em>, <em>out=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#SingleAnnot.to_dense"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.SingleAnnot.to_dense" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wbia.algo.smk.inverted_index.SingleAnnot.words">
<code class="descname">words</code><a class="headerlink" href="#wbia.algo.smk.inverted_index.SingleAnnot.words" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.inverted_index.compute_residual_assignments">
<code class="descclassname">wbia.algo.smk.inverted_index.</code><code class="descname">compute_residual_assignments</code><span class="sig-paren">(</span><em>depc</em>, <em>fid_list</em>, <em>vocab_id_list</em>, <em>config</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#compute_residual_assignments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.compute_residual_assignments" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd><dl class="first last docutils">
<dt>python -m wbia.control.IBEISControl show_depc_annot_table_input </dt>
<dd>–show –tablename=residuals</dd>
</dl>
</dd>
<dt>Ignore:</dt>
<dd>ibs.depc[‘vocab’].print_table()</dd>
<dt>Ignore:</dt>
<dd><p class="first">data = ibs.depc.get(‘inverted_agg_assign’, ([1, 2473], <a href="#id1"><span class="problematic" id="id2">qreq_</span></a>.daids), config=qreq_.config)
wxs1 = data[0][0]
wxs2 = data[1][0]</p>
<p class="last"># Lev Example
import wbia
ibs = wbia.opendb(‘Oxford’)
depc = ibs.depc
table = depc[‘inverted_agg_assign’]
table.print_table()
table.print_internal_info()</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.inverted_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Test depcache access</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">testdata_aids</span><span class="p">(</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_annot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;num_words&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;nAssign&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#input_tuple = (aid_list, [aid_list] * len(aid_list))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">aid_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">daids</span><span class="p">,</span> <span class="p">[</span><span class="n">daids</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rowid_kw</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tablename</span> <span class="o">=</span> <span class="s1">&#39;inverted_agg_assign&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target_tablename</span> <span class="o">=</span> <span class="n">tablename</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_ids</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_parent_rowids</span><span class="p">(</span><span class="n">tablename</span><span class="p">,</span> <span class="n">input_tuple</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vocab_id_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tablename</span><span class="p">,</span> <span class="n">input_tuple</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.inverted_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;Oxford&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="s1">&#39;oxford&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:proot=smk,nAssign=1,num_words=64000&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;num_words&#39;</span><span class="p">:</span> <span class="mi">64000</span><span class="p">,</span> <span class="s1">&#39;nAssign&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;int_rvec&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">depc</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">depc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">daids</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">daids</span><span class="p">,</span> <span class="p">[</span><span class="n">daids</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rowid_kw</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tablename</span> <span class="o">=</span> <span class="s1">&#39;inverted_agg_assign&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target_tablename</span> <span class="o">=</span> <span class="n">tablename</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_ids</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_parent_rowids</span><span class="p">(</span><span class="n">tablename</span><span class="p">,</span> <span class="n">input_tuple</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vocab_id_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.inverted_index.gen_residual_args">
<code class="descclassname">wbia.algo.smk.inverted_index.</code><code class="descname">gen_residual_args</code><span class="sig-paren">(</span><em>vocab</em>, <em>vecs_list</em>, <em>nAssign</em>, <em>int_rvec</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#gen_residual_args"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.gen_residual_args" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.inverted_index.residual_args">
<code class="descclassname">wbia.algo.smk.inverted_index.</code><code class="descname">residual_args</code><span class="sig-paren">(</span><em>vocab</em>, <em>vecs</em>, <em>nAssign</em>, <em>int_rvec</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#residual_args"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.residual_args" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.inverted_index.residual_worker">
<code class="descclassname">wbia.algo.smk.inverted_index.</code><code class="descname">residual_worker</code><span class="sig-paren">(</span><em>argtup</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#residual_worker"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.residual_worker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.inverted_index.testdata_inva">
<code class="descclassname">wbia.algo.smk.inverted_index.</code><code class="descname">testdata_inva</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/inverted_index.html#testdata_inva"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.inverted_index.testdata_inva" title="Permalink to this definition">¶</a></dt>
<dd><p>from wbia.algo.smk.inverted_index import *  # NOQA</p>
</dd></dl>

</div>
<div class="section" id="module-wbia.algo.smk.match_chips5">
<span id="wbia-algo-smk-match-chips5-module"></span><h2>wbia.algo.smk.match_chips5 module<a class="headerlink" href="#module-wbia.algo.smk.match_chips5" title="Permalink to this headline">¶</a></h2>
<p>TODO: semantic_uuids should be replaced with PCC-like hashes pertaining to
annotation clusters if any form of name scoring is used.</p>
<dl class="class">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.match_chips5.</code><code class="descname">EstimatorRequest</code><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code></p>
<dl class="attribute">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.dnids">
<code class="descname">dnids</code><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.dnids" title="Permalink to this definition">¶</a></dt>
<dd><p>save dnids in <a href="#id3"><span class="problematic" id="id4">qreq_</span></a> state</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">TODO</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.ensure_nids">
<code class="descname">ensure_nids</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest.ensure_nids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.ensure_nids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><em>qaids=None</em>, <em>prog_hook=None</em>, <em>use_cache=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest.execute"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.execute" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.extern_data_config2">
<code class="descname">extern_data_config2</code><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.extern_data_config2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.extern_query_config2">
<code class="descname">extern_query_config2</code><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.extern_query_config2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.get_cfgstr">
<code class="descname">get_cfgstr</code><span class="sig-paren">(</span><em>with_input=False</em>, <em>with_data=True</em>, <em>with_pipe=True</em>, <em>hash_pipe=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest.get_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.get_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.get_chipmatch_fpaths">
<code class="descname">get_chipmatch_fpaths</code><span class="sig-paren">(</span><em>qaid_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest.get_chipmatch_fpaths"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.get_chipmatch_fpaths" title="Permalink to this definition">¶</a></dt>
<dd><p>Efficient function to get a list of chipmatch paths</p>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.get_data_hashid">
<code class="descname">get_data_hashid</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest.get_data_hashid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.get_data_hashid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.get_nice_parts">
<code class="descname">get_nice_parts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest.get_nice_parts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.get_nice_parts" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.get_pipe_cfgstr">
<code class="descname">get_pipe_cfgstr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest.get_pipe_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.get_pipe_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.get_pipe_hashid">
<code class="descname">get_pipe_hashid</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest.get_pipe_hashid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.get_pipe_hashid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.get_qreq_annot_gids">
<code class="descname">get_qreq_annot_gids</code><span class="sig-paren">(</span><em>aids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest.get_qreq_annot_gids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.get_qreq_annot_gids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.get_qreq_annot_nids">
<code class="descname">get_qreq_annot_nids</code><span class="sig-paren">(</span><em>aids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest.get_qreq_annot_nids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.get_qreq_annot_nids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.get_query_hashid">
<code class="descname">get_query_hashid</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest.get_query_hashid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.get_query_hashid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.qnids">
<code class="descname">qnids</code><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.qnids" title="Permalink to this definition">¶</a></dt>
<dd><p>save qnids in <a href="#id5"><span class="problematic" id="id6">qreq_</span></a> state</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">TODO</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.match_chips5.EstimatorRequest.shallowcopy">
<code class="descname">shallowcopy</code><span class="sig-paren">(</span><em>qaids=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#EstimatorRequest.shallowcopy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.EstimatorRequest.shallowcopy" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a copy of qreq with the same qparams object and a subset of
the qx and dx objects.  used to generate chunks of vsone and vsmany
queries</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.match_chips5</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wbia</span><span class="p">,</span> <span class="n">smk</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">testdata_smk</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq2_</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">shallowcopy</span><span class="p">(</span><span class="n">qaids</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">daids</span> <span class="ow">is</span> <span class="n">qreq2_</span><span class="o">.</span><span class="n">daids</span><span class="p">,</span> <span class="s1">&#39;should be the same&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreq2_</span><span class="o">.</span><span class="n">qaids</span><span class="p">),</span> <span class="s1">&#39;should be diff&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#assert qreq_.metadata is not qreq2_.metadata</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.match_chips5.execute_and_save">
<code class="descclassname">wbia.algo.smk.match_chips5.</code><code class="descname">execute_and_save</code><span class="sig-paren">(</span><em>qreq_miss</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#execute_and_save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.execute_and_save" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.match_chips5.execute_bulk">
<code class="descclassname">wbia.algo.smk.match_chips5.</code><code class="descname">execute_bulk</code><span class="sig-paren">(</span><em>qreq_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#execute_bulk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.execute_bulk" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.match_chips5.execute_singles">
<code class="descclassname">wbia.algo.smk.match_chips5.</code><code class="descname">execute_singles</code><span class="sig-paren">(</span><em>qreq_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/match_chips5.html#execute_singles"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.match_chips5.execute_singles" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-wbia.algo.smk.pickle_flann">
<span id="wbia-algo-smk-pickle-flann-module"></span><h2>wbia.algo.smk.pickle_flann module<a class="headerlink" href="#module-wbia.algo.smk.pickle_flann" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="wbia.algo.smk.pickle_flann.PickleFLANN">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.pickle_flann.</code><code class="descname">PickleFLANN</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/pickle_flann.html#PickleFLANN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.pickle_flann.PickleFLANN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">pyflann.index.FLANN</span></code></p>
<p>Adds the ability to pickle a flann class on a unix system.
(Actually, pickle still wont work because we need the original point data.
But we can do a custom dumps and a loads)</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m wbia.algo.smk.pickle_flann PickleFLANN</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.pickle_flann</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flann</span> <span class="o">=</span> <span class="n">PickleFLANN</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flann</span><span class="o">.</span><span class="n">build_index</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index_bytes</span> <span class="o">=</span> <span class="n">flann</span><span class="o">.</span><span class="n">dumps</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flann2</span> <span class="o">=</span> <span class="n">PickleFLANN</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flann2</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">index_bytes</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">flann2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">flann</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">flann2</span><span class="o">.</span><span class="n">dumps</span><span class="p">()</span> <span class="o">==</span> <span class="n">index_bytes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx1</span> <span class="o">=</span> <span class="n">flann</span><span class="o">.</span><span class="n">nn_index</span><span class="p">(</span><span class="n">query</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx2</span> <span class="o">=</span> <span class="n">flann2</span><span class="o">.</span><span class="n">nn_index</span><span class="p">(</span><span class="n">query</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">idx1</span> <span class="o">==</span> <span class="n">idx2</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="wbia.algo.smk.pickle_flann.PickleFLANN.dumps">
<code class="descname">dumps</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/pickle_flann.html#PickleFLANN.dumps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.pickle_flann.PickleFLANN.dumps" title="Permalink to this definition">¶</a></dt>
<dd><p># Make a special wordflann pickle
<a class="reference external" href="http://www.linuxscrew.com/2010/03/24/fastest-way-to-create-ramdisk-in-ubuntulinux/">http://www.linuxscrew.com/2010/03/24/fastest-way-to-create-ramdisk-in-ubuntulinux/</a>
sudo mkdir /tmp/ramdisk; chmod 777 /tmp/ramdisk
sudo mount -t tmpfs -o size=256M tmpfs /tmp/ramdisk/
<a class="reference external" href="http://zeblog.co/?p=1588">http://zeblog.co/?p=1588</a></p>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.pickle_flann.PickleFLANN.loads">
<code class="descname">loads</code><span class="sig-paren">(</span><em>index_bytes</em>, <em>pts</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/pickle_flann.html#PickleFLANN.loads"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.pickle_flann.PickleFLANN.loads" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="wbia.algo.smk.pickle_flann.Win32CompatTempFile">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.pickle_flann.</code><code class="descname">Win32CompatTempFile</code><span class="sig-paren">(</span><em>delete=True</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/pickle_flann.html#Win32CompatTempFile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.pickle_flann.Win32CompatTempFile" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>mimics tempfile.NamedTemporaryFile but allows the file to be closed without
being deleted.  This lets a second process (like the FLANN) read/write to
the file in a win32 system. The file is instead deleted after the
Win32CompatTempFile object goes out of scope.</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.pickle_flann</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span> <span class="o">=</span> <span class="n">Win32CompatTempFile</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">b</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;10010&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data1</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data1 = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data1</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data2</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data2 = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data2</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">data</span> <span class="o">!=</span> <span class="n">data1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">data</span> <span class="o">==</span> <span class="n">data2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">temp</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="wbia.algo.smk.pickle_flann.Win32CompatTempFile.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/pickle_flann.html#Win32CompatTempFile.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.pickle_flann.Win32CompatTempFile.close" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wbia.algo.smk.pickle_flann.Win32CompatTempFile.name">
<code class="descname">name</code><a class="headerlink" href="#wbia.algo.smk.pickle_flann.Win32CompatTempFile.name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.pickle_flann.Win32CompatTempFile.read">
<code class="descname">read</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/pickle_flann.html#Win32CompatTempFile.read"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.pickle_flann.Win32CompatTempFile.read" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.pickle_flann.Win32CompatTempFile.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/pickle_flann.html#Win32CompatTempFile.write"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.pickle_flann.Win32CompatTempFile.write" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-wbia.algo.smk.script_smk">
<span id="wbia-algo-smk-script-smk-module"></span><h2>wbia.algo.smk.script_smk module<a class="headerlink" href="#module-wbia.algo.smk.script_smk" title="Permalink to this headline">¶</a></h2>
<p>Results so far without SV / fancyness
Using standard descriptors / vocabulary</p>
<p>proot=bow,nWords=1E6 -&gt; .594
proot=asmk,nWords=1E6 -&gt; .529</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="simple">
<li>Results from SMK Oxford Paper (mAP)</li>
</ul>
<p>ASMK nAssign=1, SV=False: .78
ASMK nAssign=5, SV=False: .82</p>
<p>Philbin with tf-idf ranking SV=False
SIFT: .636, RootSIFT: .683 (+.05)</p>
<p>Philbin with tf-idf ranking SV=True
SIFT: .672, RootSIFT: .720 (+.05)</p>
<ul class="simple">
<li>My Results (WITH BAD QUERY BBOXES)</li>
</ul>
<p>smk:nAssign=1,SV=True,: .58
smk:nAssign=1,SV=False,: .38</p>
<p>Yesterday I got
.22 when I fixed the bounding boxes
And now I’m getting
.08 and .32 (sv=[F,T]) after deleting and redoing everything (also removing junk images)
After fix of normalization I get
.38 and .44</p>
<p>Using oxford descriptors I get .51ish
Then changing to root-sift I
smk-bow = get=0.56294936807700813
Then using tfidf-bow2=0.56046968275748565
asmk-gets 0.54146</p>
<p>Going down to 8K words smk-BOW gets .153
Going down to 8K words tfidf-BOW gets .128
Going down to 8K words smk-asmk gets 0.374</p>
<p>Ok the 65K vocab smk-asmk gets mAP=0.461…
Ok, after recomputing a new 65K vocab with centered and root-sifted</p>
<blockquote>
<div>descriptors, using float32 precision (in most places), asmk
gets a new map score of:
mAP=.5275… :(
This is with permissive query kpts and oxford vocab.
Next step: ensure everything is float32.
Ensured float32
mAP=.5279, … better but indiciative of real error</div></blockquote>
<p>After that try again at Jegou’s data.
Ensure there are no smk algo bugs. There must be one.</p>
<p>FINALLY!
Got Jegou’s data working.
With jegou percmopute oxford feats, words, and assignments
And float32 version
asmk = .78415
bow = .545</p>
<p>asmk got 0.78415 with float32 version
bow got .545
bot2 got .551</p>
<p>vecs07, root_sift, approx assign, (either jegou or my words)
mAP=.673</p>
<p>Weird:
vecs07, root_sift, exact assign,
Maybe jegou words or maybe my words. Can’t quite tell.
Might have messed with a config.
mAP=0.68487357885738664</p>
<p>October 8
Still using the same descriptors, but my own vocab with approx assign
mAP  = 0.78032</p>
<p>my own vocab approx assign, no center
map = .793</p>
<p>The problem was minibatch params. Need higher batch size and init size.
Needed to modify sklearn to handle this requirement.</p>
<p>Using my own descriptors I got 0.7460. Seems good.</p>
<p>Now, back to the HS pipeline.
Getting a 0.638, so there is an inconsistency.
Should be getting .7460. Maybe I gotta root_sift it up?</p>
<p class="last">Turned off root_sift in script
got .769, so there is a problem in system script
minibatch  29566/270340… rate=0.86 Hz, eta=0:00:00, total=9:44:35, wall=05:24 EST inertia: mean batch=53730.923812, ewa=53853.439903
now need to try turning off float32</p>
</div>
<dl class="docutils">
<dt>Differences Between this and SMK:</dt>
<dd><ul class="first last simple">
<li>No RootSIFT</li>
<li>No SIFT Centering</li>
<li>No Independent Vocab</li>
<li>Chip RESIZE</li>
</ul>
</dd>
<dt>Differences between this and VLAD</dt>
<dd><ul class="first last simple">
<li>residual vectors are normalized</li>
<li>larger default vocabulary size</li>
</ul>
</dd>
</dl>
<div class="section" id="feat-info">
<h3>Feat Info<a class="headerlink" href="#feat-info" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="name-num-vecs-n-annots">
<h3>name     | num_vecs   | n_annots |<a class="headerlink" href="#name-num-vecs-n-annots" title="Permalink to this headline">¶</a></h3>
<p>Oxford13 | 12,534,635 |          |
Oxford07 | 16,334,970 |          |
mine1    |  8,997,955 |          |
mine2    | 13,516,721 |   5063   |
mine3    |  8,371,196 |   4728   |
mine4    |  8,482,137 |   4783   |</p>
</div>
<div class="section" id="cluster-algo-config">
<h3>Cluster Algo Config<a class="headerlink" href="#cluster-algo-config" title="Permalink to this headline">¶</a></h3>
<p>name       | algo             | init      | init_size      |  batch size  |
==========================================================================|
minibatch1 | minibatch kmeans | kmeans++  | num_words * 4  | 100          |
minibatch2 | minibatch kmeans | kmeans++  | num_words * 4  | 1000         |
given13    | Lloyd?           | kmeans++? | num_words * 8? | nan?         |</p>
</div>
<div class="section" id="assign-algo-config">
<h3>Assign Algo Config<a class="headerlink" href="#assign-algo-config" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="name-algo-trees-checks">
<h3>name   | algo   | trees | checks     |<a class="headerlink" href="#name-algo-trees-checks" title="Permalink to this headline">¶</a></h3>
<p>approx | kdtree |  8    | 1024       |
exact  | linear |  nan  | nan        |
exact  | linear |  nan  | nan        |</p>
</div>
<div class="section" id="smk-results">
<h3>SMK Results<a class="headerlink" href="#smk-results" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><blockquote>
<div><dl class="docutils">
<dt>tagid    | mAP   | train_feats | test_feats | center | rootSIFT | assign  | num_words | cluster methods | int | only_xy |</dt>
<dd><div class="first last line-block">
<div class="line">0.38  |  mine1      |   mine1    |        |          | approx  |  64000    | minibatch1      |     |         |</div>
<div class="line">0.541 |  oxford07   |   oxford07 |        |    X     | approx  |  2 ** 16  | minibatch1      |     |    X    |</div>
<div class="line">0.673 |  oxford13   |   oxford13 |   X    |    X     | approx  |  2 ** 16  | minibatch1      |     |    X    |</div>
<div class="line">0.684 |  oxford13   |   oxford13 |   X    |    X     | exact   |  2 ** 16  | minibatch1      |     |    X    |</div>
</div>
</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>mybest    | 0.793 |  oxford13   |   oxford13 |        |    X     | approx  |  2 ** 16  | minibatch2      |     |    X    |</dt>
<dd><blockquote class="first">
<div><div class="line-block">
<div class="line">0.780 |  oxford13   |   oxford13 |   X    |    X     | approx  |  2 ** 16  | minibatch2      |     |    X    |</div>
<div class="line">0.788 |  paras13    |   oxford13 |   X    |    X     | approx  |  2 ** 16  | given13         |     |    X    |</div>
</div>
</div></blockquote>
<p class="last">allgiven | 0.784 |  paras13    |   oxford13 |   X    |    X     | given13 |  2 ** 16  | given13         |     |    X    |</p>
</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>reported13 | 0.781 |  paras13    |   oxford13 |   X    |    X     | given13 |  2 ** 16  | given13         |     |    X    |</dt>
<dd><blockquote class="first">
<div></div></blockquote>
<p class="last">inhouse1 | 0.746 |     mine2   |      mine2 |        |    X     | approx  |  2 ** 16  | minibatch2      |     |    X    |
inhouse2 | 0.769 |     mine2   |      mine2 |        |          | approx  |  2 ** 16  | minibatch2      |     |    X    |
inhouse3 | 0.769 |     mine2   |      mine2 |        |          | approx  |  2 ** 16  | minibatch2      | X   |    X    |
inhouse4 | 0.751 |     mine2   |      mine2 |        |          | approx  |  2 ** 16  | minibatch2      | X   |         |</p>
</dd>
</dl>
<p>sysharn1   | 0.638 |     mine3   |      mine3 |        |          | approx  |  64000    | minibatch2      | X   |         |
sysharn2   | 0.713 |     mine3   |      mine4 |        |          | approx  |  64000    | minibatch2      | X   |         |</p>
<p>In the SMK paper they report 0.781 as shown in the table, but they also report a score of 0.820 when increasing
the number of features to from 12.5M to 19.2M by lowering feature detection thresholds.</p>
<dl class="class">
<dt id="wbia.algo.smk.script_smk.SMK">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">SMK</code><span class="sig-paren">(</span><em>wx_to_weight</em>, <em>method='asmk'</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#SMK"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.SMK" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code></p>
<dl class="method">
<dt id="wbia.algo.smk.script_smk.SMK.gamma">
<code class="descname">gamma</code><span class="sig-paren">(</span><em>X</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#SMK.gamma"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.SMK.gamma" title="Permalink to this definition">¶</a></dt>
<dd><p>gamma(X) = (M(X, X)) ** (-1/2)</p>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.script_smk.SMK.kernel_bow_tfidf">
<code class="descname">kernel_bow_tfidf</code><span class="sig-paren">(</span><em>X</em>, <em>Y</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#SMK.kernel_bow_tfidf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.SMK.kernel_bow_tfidf" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.script_smk.SMK.kernel_smk">
<code class="descname">kernel_smk</code><span class="sig-paren">(</span><em>X</em>, <em>Y</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#SMK.kernel_smk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.SMK.kernel_smk" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.script_smk.SMK.match_score_agg">
<code class="descname">match_score_agg</code><span class="sig-paren">(</span><em>X</em>, <em>Y</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#SMK.match_score_agg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.SMK.match_score_agg" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.script_smk.SMK.match_score_bow">
<code class="descname">match_score_bow</code><span class="sig-paren">(</span><em>X</em>, <em>Y</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#SMK.match_score_bow"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.SMK.match_score_bow" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.script_smk.SMK.match_score_sep">
<code class="descname">match_score_sep</code><span class="sig-paren">(</span><em>X</em>, <em>Y</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#SMK.match_score_sep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.SMK.match_score_sep" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.script_smk.SMK.word_isect">
<code class="descname">word_isect</code><span class="sig-paren">(</span><em>X</em>, <em>Y</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#SMK.word_isect"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.SMK.word_isect" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="wbia.algo.smk.script_smk.SparseVector">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">SparseVector</code><span class="sig-paren">(</span><em>_dict</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#SparseVector"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.SparseVector" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code></p>
<dl class="method">
<dt id="wbia.algo.smk.script_smk.SparseVector.dot">
<code class="descname">dot</code><span class="sig-paren">(</span><em>other</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#SparseVector.dot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.SparseVector.dot" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.bow_vector">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">bow_vector</code><span class="sig-paren">(</span><em>X</em>, <em>wx_to_weight</em>, <em>nwords</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#bow_vector"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.bow_vector" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.check_image_sizes">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">check_image_sizes</code><span class="sig-paren">(</span><em>data_uri_order</em>, <em>all_kpts</em>, <em>offset_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#check_image_sizes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.check_image_sizes" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if any keypoints go out of bounds wrt their associated images</p>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.compare_data">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">compare_data</code><span class="sig-paren">(</span><em>Y_list_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#compare_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.compare_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.ensure_tf">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">ensure_tf</code><span class="sig-paren">(</span><em>X</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#ensure_tf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.ensure_tf" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.get_annots_imgid">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">get_annots_imgid</code><span class="sig-paren">(</span><em>_annots</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#get_annots_imgid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.get_annots_imgid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.hyrule_vocab_test">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">hyrule_vocab_test</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#hyrule_vocab_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.hyrule_vocab_test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.kpts_inside_bbox">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">kpts_inside_bbox</code><span class="sig-paren">(</span><em>kpts</em>, <em>bbox</em>, <em>only_xy=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#kpts_inside_bbox"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.kpts_inside_bbox" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.load_internal_data">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">load_internal_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#load_internal_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.load_internal_data" title="Permalink to this definition">¶</a></dt>
<dd><p>wbia TestResult –db Oxford         -p smk:nWords=[64000],nAssign=[1],SV=[False],can_match_sameimg=True,dim_size=None         -a oxford         –dev-mode</p>
<p>wbia TestResult –db GZ_Master1         -p smk:nWords=[64000],nAssign=[1],SV=[False],fg_on=False         -a ctrl:qmingt=2         –dev-mode</p>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.load_ordered_annots">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">load_ordered_annots</code><span class="sig-paren">(</span><em>data_uri_order</em>, <em>query_uri_order</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#load_ordered_annots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.load_ordered_annots" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.load_oxford_2007">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">load_oxford_2007</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#load_oxford_2007"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.load_oxford_2007" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads data from
<a class="reference external" href="http://www.robots.ox.ac.uk:5000/~vgg/publications/2007/Philbin07/philbin07.pdf">http://www.robots.ox.ac.uk:5000/~vgg/publications/2007/Philbin07/philbin07.pdf</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.script_smk</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.load_oxford_2013">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">load_oxford_2013</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#load_oxford_2013"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.load_oxford_2013" title="Permalink to this definition">¶</a></dt>
<dd><p>Found this data in README of SMK publication
<a class="reference external" href="https://hal.inria.fr/hal-00864684/document">https://hal.inria.fr/hal-00864684/document</a>
<a class="reference external" href="http://people.rennes.inria.fr/Herve.Jegou/publications.html">http://people.rennes.inria.fr/Herve.Jegou/publications.html</a>
with download script</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd># Download oxford13 data
cd ~/work/Oxford
mkdir -p smk_data_iccv_2013
cd smk_data_iccv_2013
wget -nH –cut-dirs=4 -r -Pdata/ <a class="reference external" href="ftp://ftp.irisa.fr/local/texmex/corpus/iccv2013/">ftp://ftp.irisa.fr/local/texmex/corpus/iccv2013/</a></dd>
</dl>
<p>This dataset has 5063 images wheras 07 has 5062
This dataset seems to contain an extra junk image:</p>
<blockquote>
<div>ashmolean_000214</div></blockquote>
<p># Remember that matlab is 1 indexed!
# DONT FORGET TO CONVERT TO 0 INDEXING!</p>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.load_oxford_wbia">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">load_oxford_wbia</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#load_oxford_wbia"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.load_oxford_wbia" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.make_agg_vecs">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">make_agg_vecs</code><span class="sig-paren">(</span><em>X</em>, <em>words</em>, <em>fx_to_vecs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#make_agg_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.make_agg_vecs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.make_temporary_annot">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">make_temporary_annot</code><span class="sig-paren">(</span><em>aid</em>, <em>vocab</em>, <em>wx_to_weight</em>, <em>ibs</em>, <em>config</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#make_temporary_annot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.make_temporary_annot" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.new_external_annot">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">new_external_annot</code><span class="sig-paren">(</span><em>aid</em>, <em>fx_to_wxs</em>, <em>fx_to_maws</em>, <em>int_rvec</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#new_external_annot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.new_external_annot" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.oxford_conic_test">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">oxford_conic_test</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#oxford_conic_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.oxford_conic_test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.run_asmk_script">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">run_asmk_script</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#run_asmk_script"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.run_asmk_script" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.sanity_checks">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">sanity_checks</code><span class="sig-paren">(</span><em>offset_list</em>, <em>Y_list</em>, <em>query_annots</em>, <em>ibs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#sanity_checks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.sanity_checks" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.show_data_image">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">show_data_image</code><span class="sig-paren">(</span><em>data_uri_order</em>, <em>i</em>, <em>offset_list</em>, <em>all_kpts</em>, <em>all_vecs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#show_data_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.show_data_image" title="Permalink to this definition">¶</a></dt>
<dd><p>i = 12</p>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.script_smk.verify_score">
<code class="descclassname">wbia.algo.smk.script_smk.</code><code class="descname">verify_score</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/script_smk.html#verify_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.script_smk.verify_score" title="Permalink to this definition">¶</a></dt>
<dd><p>Recompute all SMK things for two annotations and compare scores.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.script_smk</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
</pre></div>
</div>
<p>cm.print_inspect_str(<a href="#id7"><span class="problematic" id="id8">qreq_</span></a>)
cm.show_single_annotmatch(<a href="#id9"><span class="problematic" id="id10">qreq_</span></a>, daid1)
cm.show_single_annotmatch(<a href="#id11"><span class="problematic" id="id12">qreq_</span></a>, daid2)</p>
</dd></dl>

</div>
</div>
<div class="section" id="module-wbia.algo.smk.smk_funcs">
<span id="wbia-algo-smk-smk-funcs-module"></span><h2>wbia.algo.smk.smk_funcs module<a class="headerlink" href="#module-wbia.algo.smk.smk_funcs" title="Permalink to this headline">¶</a></h2>
<p class="rubric">References</p>
<p>Jegou’s Source Code, Data, and Publications
<a class="reference external" href="http://people.rennes.inria.fr/Herve.Jegou/publications.html">http://people.rennes.inria.fr/Herve.Jegou/publications.html</a></p>
<p>To aggregate or not to aggregate: selective match kernels for image search
<a class="reference external" href="https://hal.inria.fr/hal-00864684/document">https://hal.inria.fr/hal-00864684/document</a></p>
<p>Image search with selective match kernels: aggregation across single and multiple images
<a class="reference external" href="http://image.ntua.gr/iva/files/Tolias_ijcv15_iasmk.pdf">http://image.ntua.gr/iva/files/Tolias_ijcv15_iasmk.pdf</a></p>
<p>Negative evidences and co-occurrences in image retrieval: the benefit of PCA and whitening
<a class="reference external" href="https://hal.inria.fr/file/index/docid/722626/filename/jegou_chum_eccv2012.pdf">https://hal.inria.fr/file/index/docid/722626/filename/jegou_chum_eccv2012.pdf</a></p>
<p>Revisiting the VLAD image representation
<a class="reference external" href="https://hal.inria.fr/file/index/docid/850249/filename/nextvlad_hal.pdf">https://hal.inria.fr/file/index/docid/850249/filename/nextvlad_hal.pdf</a></p>
<p>Aggregating local descriptors into a compact image representation
<a class="reference external" href="https://lear.inrialpes.fr/pubs/2010/JDSP10/jegou_compactimagerepresentation.pdf">https://lear.inrialpes.fr/pubs/2010/JDSP10/jegou_compactimagerepresentation.pdf</a></p>
<p>Large-scale image retrieval with compressed Fisher vectors
<a class="reference external" href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.401.9140&amp;rep=rep1&amp;type=pdf">http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.401.9140&amp;rep=rep1&amp;type=pdf</a></p>
<p>Improving Bag of Features
<a class="reference external" href="http://lear.inrialpes.fr/pubs/2010/JDS10a/jegou_improvingbof_preprint.pdf">http://lear.inrialpes.fr/pubs/2010/JDS10a/jegou_improvingbof_preprint.pdf</a></p>
<p>Lost in Quantization
<a class="reference external" href="http://www.robots.ox.ac.uk/~vgg/publications/papers/philbin08.ps.gz">http://www.robots.ox.ac.uk/~vgg/publications/papers/philbin08.ps.gz</a></p>
<p>A Context Dissimilarity Measure for Accurate and Efficient Image Search
<a class="reference external" href="https://lear.inrialpes.fr/pubs/2007/JHS07/jegou_cdm.pdf">https://lear.inrialpes.fr/pubs/2007/JHS07/jegou_cdm.pdf</a></p>
<p>Video Google: A text retrieval approach to object matching in videos
<a class="reference external" href="http://www.robots.ox.ac.uk/~vgg/publications/papers/sivic03.pdf">http://www.robots.ox.ac.uk/~vgg/publications/papers/sivic03.pdf</a></p>
<p>Hamming embedding and weak geometric consistency for large scale image search
<a class="reference external" href="https://lear.inrialpes.fr/pubs/2008/JDS08/jegou_hewgc08.pdf">https://lear.inrialpes.fr/pubs/2008/JDS08/jegou_hewgc08.pdf</a></p>
<p>Three things everyone should know to improve object retrieval
<a class="reference external" href="https://www.robots.ox.ac.uk/~vgg/publications/2012/Arandjelovic12/arandjelovic12.pdf">https://www.robots.ox.ac.uk/~vgg/publications/2012/Arandjelovic12/arandjelovic12.pdf</a></p>
<p>Object retrieval with large vocabularies and fast spatial matching
<a class="reference external" href="http://www.robots.ox.ac.uk:5000/~vgg/publications/2007/Philbin07/philbin07.pdf">http://www.robots.ox.ac.uk:5000/~vgg/publications/2007/Philbin07/philbin07.pdf</a></p>
<p>Aggregating Local Descriptors into Compact Codes
<a class="reference external" href="https://hal.inria.fr/file/index/docid/633013/filename/jegou_aggregate.pdf">https://hal.inria.fr/file/index/docid/633013/filename/jegou_aggregate.pdf</a></p>
<p>Local visual query expansion
<a class="reference external" href="https://hal.inria.fr/hal-00840721/PDF/RR-8325.pdf">https://hal.inria.fr/hal-00840721/PDF/RR-8325.pdf</a></p>
<p>Root SIFT technique
<a class="reference external" href="https://hal.inria.fr/hal-00688169/document">https://hal.inria.fr/hal-00688169/document</a></p>
<p>Fisher Kernel For Large Scale Classification
<a class="reference external" href="https://www.robots.ox.ac.uk/~vgg/rg/papers/peronnin_etal_ECCV10.pdf">https://www.robots.ox.ac.uk/~vgg/rg/papers/peronnin_etal_ECCV10.pdf</a></p>
<p>Orientation covariant aggregation of local descriptors with embeddings
<a class="reference external" href="https://arxiv.org/pdf/1407.2170.pdf">https://arxiv.org/pdf/1407.2170.pdf</a></p>
<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.aggregate_rvecs">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">aggregate_rvecs</code><span class="sig-paren">(</span><em>rvecs</em>, <em>maws</em>, <em>error_flags</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#aggregate_rvecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.aggregate_rvecs" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute aggregated residual vectors Phi(X_c)</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m wbia.algo.smk.smk_funcs aggregate_rvecs –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vecs</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">testdata_rvecs</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;vecs&#39;</span><span class="p">,</span> <span class="s1">&#39;words&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">word</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rvecs</span><span class="p">,</span> <span class="n">error_flags</span> <span class="o">=</span> <span class="n">compute_rvec</span><span class="p">(</span><span class="n">vecs</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">maws</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">rvecs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agg_rvec</span><span class="p">,</span> <span class="n">agg_flag</span> <span class="o">=</span> <span class="n">aggregate_rvecs</span><span class="p">(</span><span class="n">rvecs</span><span class="p">,</span> <span class="n">maws</span><span class="p">,</span> <span class="n">error_flags</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">qt4ensure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># recenter residuals for visualization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agg_cvec</span> <span class="o">=</span> <span class="n">agg_rvec</span> <span class="o">+</span> <span class="n">word</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cvecs</span> <span class="o">=</span> <span class="p">(</span><span class="n">rvecs</span> <span class="o">+</span> <span class="n">word</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;word&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">agg_cvec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">agg_cvec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;re-centered agg_rvec&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vecs</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vecs</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;original vecs&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cvecs</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cvecs</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;b.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;re-centered rvec&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">draw_line_segments2</span><span class="p">([</span><span class="n">word</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">cvecs</span><span class="p">),</span> <span class="n">cvecs</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">draw_line_segments2</span><span class="p">([</span><span class="n">word</span><span class="p">],</span> <span class="p">[</span><span class="n">agg_cvec</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.assign_to_words">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">assign_to_words</code><span class="sig-paren">(</span><em>vocab</em>, <em>idx_to_vec</em>, <em>nAssign</em>, <em>massign_alpha=1.2</em>, <em>massign_sigma=80.0</em>, <em>massign_equal_weights=False</em>, <em>verbose=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#assign_to_words"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.assign_to_words" title="Permalink to this definition">¶</a></dt>
<dd><p>Assigns descriptor-vectors to nearest word.</p>
<p class="rubric">Notes</p>
<p>Maybe move out of this file? The usage of vocab is out of this file
scope.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>wordflann</strong> (<em>FLANN</em>) – nearest neighbor index over words</li>
<li><strong>words</strong> (<em>ndarray</em>) – vocabulary words</li>
<li><strong>idx_to_vec</strong> (<em>ndarray</em>) – descriptors to assign</li>
<li><strong>nAssign</strong> (<em>int</em>) – number of words to assign each descriptor to</li>
<li><strong>massign_alpha</strong> (<em>float</em>) – multiple-assignment ratio threshold</li>
<li><strong>massign_sigma</strong> (<em>float</em>) – multiple-assignment gaussian variance</li>
<li><strong>massign_equal_weights</strong> (<em>bool</em>) – assign equal weight to all multiassigned words</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>inverted index, multi-assigned weights, and forward index
formated as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">wx_to_idxs</span> <span class="o">-</span> <span class="n">word</span> <span class="n">index</span>   <span class="o">-&gt;</span> <span class="n">vector</span> <span class="n">indexes</span>
<span class="o">*</span> <span class="n">wx_to_maws</span> <span class="o">-</span> <span class="n">word</span> <span class="n">index</span>   <span class="o">-&gt;</span> <span class="n">multi</span><span class="o">-</span><span class="n">assignment</span> <span class="n">weights</span>
<span class="o">*</span> <span class="n">idx2_wxs</span> <span class="o">-</span> <span class="n">vector</span> <span class="n">index</span> <span class="o">-&gt;</span> <span class="n">assigned</span> <span class="n">word</span> <span class="n">indexes</span>
</pre></div>
</div>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># xdoctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_vec</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">get_feat_vecs</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="mi">300</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">idx_to_vec</span><span class="p">,</span> <span class="n">vocab</span><span class="o">.</span><span class="n">wx_to_word</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nAssign</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massign_equal_weights</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massign_alpha</span> <span class="o">=</span> <span class="mf">1.2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massign_sigma</span> <span class="o">=</span> <span class="mf">80.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nAssign</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_wxs</span><span class="p">,</span> <span class="n">idx_to_maws</span> <span class="o">=</span> <span class="n">assign_to_words</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> <span class="n">idx_to_vec</span><span class="p">,</span> <span class="n">nAssign</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;idx_to_maws = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">idx_to_wxs</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;idx_to_wxs = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">idx_to_maws</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">),))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.build_matches_agg">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">build_matches_agg</code><span class="sig-paren">(</span><em>X_fxs</em>, <em>Y_fxs</em>, <em>X_maws</em>, <em>Y_maws</em>, <em>score_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#build_matches_agg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.build_matches_agg" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds explicit features matches. Break and distribute up each aggregate
score amongst its contributing features.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(fm, fs)</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m wbia.algo.smk.smk_funcs build_matches_agg –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">map_int</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">lmap</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">map_float</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">lmap</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X_fxs</span> <span class="o">=</span> <span class="n">map_int</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y_fxs</span> <span class="o">=</span> <span class="n">map_int</span><span class="p">([[</span><span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">99</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X_maws</span> <span class="o">=</span> <span class="n">map_float</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y_maws</span> <span class="o">=</span> <span class="n">map_float</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">fm</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span> <span class="o">=</span> <span class="n">build_matches_agg</span><span class="p">(</span><span class="n">X_fxs</span><span class="p">,</span> <span class="n">Y_fxs</span><span class="p">,</span> <span class="n">X_maws</span><span class="p">,</span> <span class="n">Y_maws</span><span class="p">,</span> <span class="n">score_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fm = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">fm</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fs = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">fs</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">score_list</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">fs</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.build_matches_sep">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">build_matches_sep</code><span class="sig-paren">(</span><em>X_fxs</em>, <em>Y_fxs</em>, <em>scores_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#build_matches_sep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.build_matches_sep" title="Permalink to this definition">¶</a></dt>
<dd><p>Just build matches. Scores have already been broken up. No need to do that.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(fm, fs)</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m wbia.algo.smk.smk_funcs build_matches_agg –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">map_int</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">lmap</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">map_float</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">lmap</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X_fxs</span> <span class="o">=</span> <span class="n">map_int</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y_fxs</span> <span class="o">=</span> <span class="n">map_int</span><span class="p">([[</span><span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">99</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scores_list</span> <span class="o">=</span> <span class="n">map_float</span><span class="p">([</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">[[</span><span class="o">.</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">.</span><span class="mi">2</span><span class="p">],],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">[[</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">.</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="o">.</span><span class="mi">4</span><span class="p">,</span> <span class="o">.</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">],],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">[[</span><span class="o">.</span><span class="mi">4</span><span class="p">]],</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">fm</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span> <span class="o">=</span> <span class="n">build_matches_sep</span><span class="p">(</span><span class="n">X_fxs</span><span class="p">,</span> <span class="n">Y_fxs</span><span class="p">,</span> <span class="n">scores_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fm = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">fm</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fs = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">fs</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">total_flatten</span><span class="p">(</span><span class="n">scores_list</span><span class="p">)),</span> <span class="n">fs</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.cast_residual_integer">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">cast_residual_integer</code><span class="sig-paren">(</span><em>rvecs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#cast_residual_integer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.cast_residual_integer" title="Permalink to this definition">¶</a></dt>
<dd><p>quantize residual vectors to 8-bits using the same trunctation hack as in
SIFT. values will typically not reach the maximum, so we can multiply by a
higher number for better fidelity.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>rvecs</strong> (<em>ndarray</em><em>[</em><em>float64_t</em><em>]</em>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">ndarray[uint8_t]</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m wbia.algo.smk.smk_funcs cast_residual_integer –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rvecs</span> <span class="o">=</span> <span class="n">testdata_rvecs</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">128</span><span class="p">)[</span><span class="s1">&#39;rvecs&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rvecs_int8</span> <span class="o">=</span> <span class="n">cast_residual_integer</span><span class="p">(</span><span class="n">rvecs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rvecs_float</span> <span class="o">=</span> <span class="n">uncast_residual_integer</span><span class="p">(</span><span class="n">rvecs_int8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Casting from float to int8 will result in a max quantization error</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">measured_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rvecs_float</span> <span class="o">-</span> <span class="n">rvecs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But there are limits on what this error can be</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cutoff</span> <span class="o">=</span> <span class="mi">127</span>  <span class="c1"># np.iinfo(np.int8).max</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fidelity</span> <span class="o">=</span> <span class="mf">255.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theory_error_in</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fidelity</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theory_error_out</span> <span class="o">=</span> <span class="p">(</span><span class="n">fidelity</span> <span class="o">-</span> <span class="n">cutoff</span><span class="p">)</span> <span class="o">/</span> <span class="n">fidelity</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Determine if any component values exceed the cutoff</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_inside</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rvecs</span> <span class="o">*</span> <span class="n">fidelity</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Check theoretical maximum for values inside and outside cutoff</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">error_stats_in</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="n">measured_error</span><span class="p">[</span><span class="n">is_inside</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">error_stats_out</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="n">measured_error</span><span class="p">[</span><span class="o">~</span><span class="n">is_inside</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;inside cutoff error stats: &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">error_stats_in</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;outside cutoff error stats: &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">error_stats_out</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">rvecs_int8</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">measured_error</span><span class="p">[</span><span class="n">is_inside</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">theory_error_in</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">measured_error</span><span class="p">[</span><span class="o">~</span><span class="n">is_inside</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">theory_error_out</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.compute_rvec">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">compute_rvec</code><span class="sig-paren">(</span><em>vecs</em>, <em>word</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#compute_rvec"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.compute_rvec" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute residual vectors phi(x_c)</p>
<p>Subtract each vector from its quantized word to get the resiudal, then
normalize residuals to unit length.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m wbia.algo.smk.smk_funcs compute_rvec –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vecs</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">testdata_rvecs</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;vecs&#39;</span><span class="p">,</span> <span class="s1">&#39;words&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">word</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rvecs</span><span class="p">,</span> <span class="n">error_flags</span> <span class="o">=</span> <span class="n">compute_rvec</span><span class="p">(</span><span class="n">vecs</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># recenter residuals for visualization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cvecs</span> <span class="o">=</span> <span class="p">(</span><span class="n">rvecs</span> <span class="o">+</span> <span class="n">word</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;word&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vecs</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vecs</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;original vecs&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cvecs</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cvecs</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;b.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;re-centered rvec&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">draw_line_segments2</span><span class="p">(</span><span class="n">cvecs</span><span class="p">,</span> <span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">cvecs</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.compute_stacked_agg_rvecs">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">compute_stacked_agg_rvecs</code><span class="sig-paren">(</span><em>words</em>, <em>flat_wxs_assign</em>, <em>flat_vecs</em>, <em>flat_offsets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#compute_stacked_agg_rvecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.compute_stacked_agg_rvecs" title="Permalink to this definition">¶</a></dt>
<dd><p>More efficient version of agg on a stacked structure</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>words</strong> (<em>ndarray</em>) – entire vocabulary of words</li>
<li><strong>flat_wxs_assign</strong> (<em>ndarray</em>) – maps a stacked index to word index</li>
<li><strong>flat_vecs</strong> (<em>ndarray</em>) – stacked SIFT descriptors</li>
<li><strong>flat_offsets</strong> (<em>ndarray</em>) – offset positions per annotation</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">testdata_rvecs</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nvecs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">nannots</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">words</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;words&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flat_offsets</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;offset_list&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flat_wxs_assign</span><span class="p">,</span> <span class="n">flat_vecs</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;idx_to_wx&#39;</span><span class="p">,</span> <span class="s1">&#39;vecs&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">compute_stacked_agg_rvecs</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">flat_wxs_assign</span><span class="p">,</span> <span class="n">flat_vecs</span><span class="p">,</span> <span class="n">flat_offsets</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_agg_vecs</span><span class="p">,</span> <span class="n">all_error_flags</span><span class="p">,</span> <span class="n">agg_offset_list</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agg_rvecs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_agg_vecs</span><span class="p">[</span><span class="n">l</span><span class="p">:</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ut</span><span class="o">.</span><span class="n">itertwo</span><span class="p">(</span><span class="n">agg_offset_list</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agg_flags_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_error_flags</span><span class="p">[</span><span class="n">l</span><span class="p">:</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ut</span><span class="o">.</span><span class="n">itertwo</span><span class="p">(</span><span class="n">agg_offset_list</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">agg_flags_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">flat_offsets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">testdata_rvecs</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nvecs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">nannots</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">words</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;words&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flat_offsets</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;offset_list&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flat_wxs_assign</span><span class="p">,</span> <span class="n">flat_vecs</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;idx_to_wx&#39;</span><span class="p">,</span> <span class="s1">&#39;vecs&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">compute_stacked_agg_rvecs</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">flat_wxs_assign</span><span class="p">,</span> <span class="n">flat_vecs</span><span class="p">,</span> <span class="n">flat_offsets</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_agg_vecs</span><span class="p">,</span> <span class="n">all_error_flags</span><span class="p">,</span> <span class="n">agg_offset_list</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agg_rvecs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_agg_vecs</span><span class="p">[</span><span class="n">l</span><span class="p">:</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ut</span><span class="o">.</span><span class="n">itertwo</span><span class="p">(</span><span class="n">agg_offset_list</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agg_flags_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_error_flags</span><span class="p">[</span><span class="n">l</span><span class="p">:</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ut</span><span class="o">.</span><span class="n">itertwo</span><span class="p">(</span><span class="n">agg_offset_list</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">agg_flags_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">flat_offsets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.gamma_agg">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">gamma_agg</code><span class="sig-paren">(</span><em>phisX</em>, <em>flagsX</em>, <em>weight_list</em>, <em>alpha</em>, <em>thresh</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#gamma_agg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.gamma_agg" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes gamma (self consistency criterion)
It is a scalar which ensures K(X, X) = 1</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">sccw self-consistency-criterion weight</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">float</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Math:</dt>
<dd>gamma(X) = (sum_{c in C} w_c M(X_c, X_c))^{-.5}</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">smk</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">=</span> <span class="n">testdata_smk</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qinva</span><span class="o">.</span><span class="n">grouped_annots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx_to_weight</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">wx_to_weight</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X.gamma = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="n">X</span><span class="p">),))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.gamma_sep">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">gamma_sep</code><span class="sig-paren">(</span><em>phisX_list</em>, <em>flagsX_list</em>, <em>weight_list</em>, <em>alpha</em>, <em>thresh</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#gamma_sep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.gamma_sep" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.inv_doc_freq">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">inv_doc_freq</code><span class="sig-paren">(</span><em>ndocs_total</em>, <em>ndocs_per_word</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#inv_doc_freq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.inv_doc_freq" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ndocs_total</strong> (<em>int</em>) – numer of unique documents</li>
<li><strong>ndocs_per_word</strong> (<em>ndarray</em>) – ndocs_per_word[i] should correspond to the
number of unique documents containing word[i]</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">idf_per_word</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarrary</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndocs_total</span> <span class="o">=</span> <span class="mi">21</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndocs_per_word</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idf_per_word</span> <span class="o">=</span> <span class="n">inv_doc_freq</span><span class="p">(</span><span class="n">ndocs_total</span><span class="p">,</span> <span class="n">ndocs_per_word</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">idf_per_word</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">np.array([0.  , 0.  , 0.05, 2.35, 0.34, 0.97, 0.56, 3.04, 2.35])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.invert_assigns">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">invert_assigns</code><span class="sig-paren">(</span><em>idx_to_wxs</em>, <em>idx_to_maws</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#invert_assigns"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.invert_assigns" title="Permalink to this definition">¶</a></dt>
<dd><p>Inverts assignment of
vectors-&gt;to-&gt;words into words-&gt;to-&gt;vectors.
Invert mapping – Group by word indexes</p>
<p>This gives a HUGE speedup over the old invert_assigns</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_wxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_wxs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_maws</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">[(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_maws</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">invert_assigns</span><span class="p">(</span><span class="n">idx_to_wxs</span><span class="p">,</span> <span class="n">idx_to_maws</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx_to_idxs</span><span class="p">,</span> <span class="n">wx_to_maws</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;wx_to_idxs = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">wx_to_idxs</span><span class="p">,</span> <span class="n">with_dtype</span><span class="o">=</span><span class="kc">True</span><span class="p">),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">wx_to_maws = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">wx_to_maws</span><span class="p">,</span> <span class="n">with_dtype</span><span class="o">=</span><span class="kc">True</span><span class="p">),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">wx_to_idxs = {</span>
<span class="go">    0: np.array([0, 2], dtype=np.int32),</span>
<span class="go">    2: np.array([1, 2], dtype=np.int32),</span>
<span class="go">    4: np.array([0], dtype=np.int32),</span>
<span class="go">}</span>
<span class="go">wx_to_maws = {</span>
<span class="go">    0: np.array([0.5, 0.5], dtype=np.float32),</span>
<span class="go">    2: np.array([1. , 0.5], dtype=np.float32),</span>
<span class="go">    4: np.array([1.], dtype=np.float32),</span>
<span class="go">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.invert_assigns_old">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">invert_assigns_old</code><span class="sig-paren">(</span><em>idx_to_wxs</em>, <em>idx_to_maws</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#invert_assigns_old"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.invert_assigns_old" title="Permalink to this definition">¶</a></dt>
<dd><p>Inverts assignment of vectors to words into words to vectors.</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_wxs</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_maws</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.5</span><span class="p">,</span>  <span class="mf">0.5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.5</span><span class="p">,</span>  <span class="mf">0.5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx_to_idxs</span><span class="p">,</span> <span class="n">wx_to_maws</span> <span class="o">=</span> <span class="n">invert_assigns_old</span><span class="p">(</span><span class="n">idx_to_wxs</span><span class="p">,</span> <span class="n">idx_to_maws</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;wx_to_idxs = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">wx_to_idxs</span><span class="p">,</span> <span class="n">with_dtype</span><span class="o">=</span><span class="kc">True</span><span class="p">),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">wx_to_maws = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">wx_to_maws</span><span class="p">,</span> <span class="n">with_dtype</span><span class="o">=</span><span class="kc">True</span><span class="p">),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">wx_to_idxs = {</span>
<span class="go">    0: np.array([0, 2], dtype=np.int32),</span>
<span class="go">    2: np.array([1, 2], dtype=np.int32),</span>
<span class="go">    4: np.array([0], dtype=np.int32),</span>
<span class="go">}</span>
<span class="go">wx_to_maws = {</span>
<span class="go">    0: np.array([0.5, 0.5], dtype=np.float32),</span>
<span class="go">    2: np.array([1. , 0.5], dtype=np.float32),</span>
<span class="go">    4: np.array([0.5], dtype=np.float32),</span>
<span class="go">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.invert_lists">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">invert_lists</code><span class="sig-paren">(</span><em>aids</em>, <em>wx_lists</em>, <em>all_wxs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#invert_lists"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.invert_lists" title="Permalink to this definition">¶</a></dt>
<dd><p>takes corresponding lists of (aids, wxs) and maps wxs to aids</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx_lists</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx_to_aids</span> <span class="o">=</span> <span class="n">invert_lists</span><span class="p">(</span><span class="n">aids</span><span class="p">,</span> <span class="n">wx_lists</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;wx_to_aids = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">wx_to_aids</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">wx_to_aids = {0: [1, 2], 1: [1, 2], 3: [3], 20: [2]}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.match_scores_agg">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">match_scores_agg</code><span class="sig-paren">(</span><em>PhisX</em>, <em>PhisY</em>, <em>flagsX</em>, <em>flagsY</em>, <em>alpha</em>, <em>thresh</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#match_scores_agg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.match_scores_agg" title="Permalink to this definition">¶</a></dt>
<dd><p>Scores matches to multiple words using aggregate residual vectors</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PhisX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mf">0.</span>        <span class="p">,</span>  <span class="mf">0.</span>        <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                  <span class="p">[</span><span class="o">-</span><span class="mf">1.</span>        <span class="p">,</span>  <span class="mf">0.</span>        <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                  <span class="p">[</span> <span class="mf">0.85085751</span><span class="p">,</span>  <span class="mf">0.52539652</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                  <span class="p">[</span><span class="o">-</span><span class="mf">0.89795083</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4400958</span> <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                  <span class="p">[</span><span class="o">-</span><span class="mf">0.99934547</span><span class="p">,</span>  <span class="mf">0.03617512</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PhisY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mf">0.88299408</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.46938411</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                  <span class="p">[</span><span class="o">-</span><span class="mf">0.12096522</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.99265675</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                  <span class="p">[</span><span class="o">-</span><span class="mf">0.99948266</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03216222</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                  <span class="p">[</span><span class="o">-</span><span class="mf">0.08394916</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.99647004</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                  <span class="p">[</span><span class="o">-</span><span class="mf">0.96414952</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.26535957</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flagsX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flagsY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thresh</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_list</span> <span class="o">=</span> <span class="n">match_scores_agg</span><span class="p">(</span><span class="n">PhisX</span><span class="p">,</span> <span class="n">PhisY</span><span class="p">,</span> <span class="n">flagsX</span><span class="p">,</span> <span class="n">flagsY</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;score_list = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">score_list</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">score_list = np.array([1.    , 0.0018, 0.    , 1.    , 0.868 ])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.match_scores_sep">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">match_scores_sep</code><span class="sig-paren">(</span><em>phisX_list</em>, <em>phisY_list</em>, <em>flagsX_list</em>, <em>flagsY_list</em>, <em>alpha</em>, <em>thresh</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#match_scores_sep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.match_scores_sep" title="Permalink to this definition">¶</a></dt>
<dd><p>Scores matches to multiple words using lists of separeated residual vectors</p>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.sccw_normalize">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">sccw_normalize</code><span class="sig-paren">(</span><em>scores</em>, <em>weight_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#sccw_normalize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.sccw_normalize" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.selective_match_score">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">selective_match_score</code><span class="sig-paren">(</span><em>phisX</em>, <em>phisY</em>, <em>flagsX</em>, <em>flagsY</em>, <em>alpha</em>, <em>thresh</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#selective_match_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.selective_match_score" title="Permalink to this definition">¶</a></dt>
<dd><p>computes the score of each feature match</p>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.selectivity">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">selectivity</code><span class="sig-paren">(</span><em>u</em>, <em>alpha=3.0</em>, <em>thresh=0.0</em>, <em>out=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#selectivity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.selectivity" title="Permalink to this definition">¶</a></dt>
<dd><p>The selectivity function thresholds and applies a power law.</p>
<p>This downweights weak matches.
The following is the exact definition from SMK paper.
sigma_alpha(u) = (sign(u) * (u ** alpha) if u &gt; thresh else 0)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>u</strong> (<em>ndarray</em>) – input score between (-1, +1)</li>
<li><strong>alpha</strong> (<em>float</em>) – power law (default = 3.0)</li>
<li><strong>thresh</strong> (<em>float</em>) – number between 0 and 1 (default = 0.0)</li>
<li><strong>out</strong> (<em>None</em>) – inplace output (default = None)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">score</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd><dl class="first docutils">
<dt>python -m wbia.plottool plot_func –show –range=-1,1  </dt>
<dd>–setup=”import wbia” –func wbia.algo.smk.smk_funcs.selectivity “lambda u: sign(u) * abs(u)**3.0 * greater_equal(u, 0)”</dd>
</dl>
<p class="last">python -m wbia.algo.smk.smk_funcs selectivity –show</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-.</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thresh</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score</span> <span class="o">=</span> <span class="n">selectivity</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">[0.0000, 0.0000, 0.0000, 0.0000, 0.0010, 0.1250, 1.0000]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.testdata_rvecs">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">testdata_rvecs</code><span class="sig-paren">(</span><em>dim=2</em>, <em>nvecs=13</em>, <em>nwords=5</em>, <em>nannots=4</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#testdata_rvecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.testdata_rvecs" title="Permalink to this definition">¶</a></dt>
<dd><p>two dimensional test data</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m wbia.algo.smk.smk_funcs testdata_rvecs –show</dd>
<dt>Ignore:</dt>
<dd>dim = 2
nvecs = 13
nwords = 5
nannots = 5</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">testdata_rvecs</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exec</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">execstr_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="k">import</span> <span class="n">Voronoi</span><span class="p">,</span> <span class="n">voronoi_plot_2d</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">qt4ensure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vor</span> <span class="o">=</span> <span class="n">Voronoi</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">words</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r*&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;words&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vecs</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vecs</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;b.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;vecs&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># lines showing assignments (and residuals)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pts1</span> <span class="o">=</span> <span class="n">vecs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pts2</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">idx_to_wx</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">draw_line_segments2</span><span class="p">(</span><span class="n">pts1</span><span class="p">,</span> <span class="n">pts2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vecs</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vecs</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;g.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;vecs&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">voronoi_plot_2d</span><span class="p">(</span><span class="n">vor</span><span class="p">,</span> <span class="n">show_vertices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extents</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">get_pointset_extents</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">vecs</span><span class="p">,</span> <span class="n">words</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extents</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">scale_extents</span><span class="p">(</span><span class="n">extents</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="n">extents</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">*</span><span class="n">extents</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.uncast_residual_integer">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">uncast_residual_integer</code><span class="sig-paren">(</span><em>rvecs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#uncast_residual_integer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.uncast_residual_integer" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>rvecs</strong> (<em>ndarray</em><em>[</em><em>uint8_t</em><em>]</em>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">ndarray[float64_t]</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_funcs.weight_multi_assigns">
<code class="descclassname">wbia.algo.smk.smk_funcs.</code><code class="descname">weight_multi_assigns</code><span class="sig-paren">(</span><em>_idx_to_wx</em>, <em>_idx_to_wdist</em>, <em>massign_alpha=1.2</em>, <em>massign_sigma=80.0</em>, <em>massign_equal_weights=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_funcs.html#weight_multi_assigns"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_funcs.weight_multi_assigns" title="Permalink to this definition">¶</a></dt>
<dd><p>Multi Assignment Weight Filtering from Improving Bag of Features</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>(</strong><strong>)</strong> (<em>massign_equal_weights</em>) – Turns off soft weighting. Gives all assigned
vectors weight 1</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">(idx_to_wxs, idx_to_maws)</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_idx_to_wx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_idx_to_wdist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">11</span><span class="p">],</span> <span class="p">[</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">],</span> <span class="p">[</span><span class="o">.</span><span class="mi">03</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massign_alpha</span> <span class="o">=</span> <span class="mf">1.2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massign_sigma</span> <span class="o">=</span> <span class="mf">80.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massign_equal_weights</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_wxs</span><span class="p">,</span> <span class="n">idx_to_maws</span> <span class="o">=</span> <span class="n">weight_multi_assigns</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">_idx_to_wx</span><span class="p">,</span> <span class="n">_idx_to_wdist</span><span class="p">,</span> <span class="n">massign_alpha</span><span class="p">,</span> <span class="n">massign_sigma</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">massign_equal_weights</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;idx_to_wxs = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">idx_to_wxs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">idx_to_maws = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">idx_to_maws</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">idx_to_wxs = np.ma.MaskedArray([[0., 1.],</span>
<span class="go">                   [2., inf],</span>
<span class="go">                   [4., inf],</span>
<span class="go">                   [2., 0.]])</span>
<span class="go">idx_to_maws = np.ma.MaskedArray([[0.5, 0.5],</span>
<span class="go">                   [1. , inf],</span>
<span class="go">                   [1. , inf],</span>
<span class="go">                   [0.5, 0.5]])</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_funcs</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_idx_to_wx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_idx_to_wdist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">11</span><span class="p">],</span> <span class="p">[</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">],</span> <span class="p">[</span><span class="o">.</span><span class="mi">03</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_idx_to_wx</span> <span class="o">=</span> <span class="n">_idx_to_wx</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_idx_to_wdist</span> <span class="o">=</span> <span class="n">_idx_to_wdist</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massign_alpha</span> <span class="o">=</span> <span class="mf">1.2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massign_sigma</span> <span class="o">=</span> <span class="mf">80.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massign_equal_weights</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_wxs</span><span class="p">,</span> <span class="n">idx_to_maws</span> <span class="o">=</span> <span class="n">weight_multi_assigns</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">_idx_to_wx</span><span class="p">,</span> <span class="n">_idx_to_wdist</span><span class="p">,</span> <span class="n">massign_alpha</span><span class="p">,</span> <span class="n">massign_sigma</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">massign_equal_weights</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;idx_to_wxs = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">idx_to_wxs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">idx_to_maws = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">idx_to_maws</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">idx_to_wxs = np.ma.MaskedArray([[0., 1.],</span>
<span class="go">                   [2., inf],</span>
<span class="go">                   [4., inf],</span>
<span class="go">                   [2., 0.]])</span>
<span class="go">idx_to_maws = np.ma.MaskedArray([[1., 1.],</span>
<span class="go">                   [1., inf],</span>
<span class="go">                   [1., inf],</span>
<span class="go">                   [1., 1.]])</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-wbia.algo.smk.smk_pipeline">
<span id="wbia-algo-smk-smk-pipeline-module"></span><h2>wbia.algo.smk.smk_pipeline module<a class="headerlink" href="#module-wbia.algo.smk.smk_pipeline" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Oxford Experiment:</dt>
<dd>wbia TestResult –db Oxford -p smk:nWords=[64000],nAssign=[1],SV=[False],can_match_sameimg=True -a oxford</dd>
<dt>Zebra Experiment:</dt>
<dd><p class="first">python -m wbia draw_rank_cmc –db GZ_Master1 –show         -p :proot=smk,num_words=[64000],fg_on=False,nAssign=[1],SV=[False]            :proot=vsmany,fg_on=False,SV=[False]         -a ctrl:qmingt=2</p>
<p class="last">python -m wbia draw_rank_cmc –db PZ_Master1 –show         -p :proot=smk,num_words=[64000],fg_on=False,nAssign=[1],SV=[False]            :proot=vsmany,fg_on=False,SV=[False]         -a ctrl:qmingt=2</p>
</dd>
</dl>
<dl class="class">
<dt id="wbia.algo.smk.smk_pipeline.MatchHeuristicsConfig">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.smk_pipeline.</code><code class="descname">MatchHeuristicsConfig</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#MatchHeuristicsConfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.MatchHeuristicsConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="wbia.dtool.html#wbia.dtool.base.Config" title="wbia.dtool.base.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">wbia.dtool.base.Config</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="wbia.algo.smk.smk_pipeline.SMK">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.smk_pipeline.</code><code class="descname">SMK</code><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#SMK"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.SMK" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code></p>
<p>Harness class that controls the execution of the SMK algorithm</p>
<p>K(X, Y) = gamma(X) * gamma(Y) * sum([Mc(Xc, Yc) for c in words])</p>
<dl class="method">
<dt id="wbia.algo.smk.smk_pipeline.SMK.match_single">
<code class="descname">match_single</code><span class="sig-paren">(</span><em>qaid</em>, <em>daids</em>, <em>qreq_</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#SMK.match_single"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.SMK.match_single" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first">python -m wbia.algo.smk.smk_pipeline SMK.match_single –profile
python -m wbia.algo.smk.smk_pipeline SMK.match_single –show</p>
<p class="last">python -m wbia SMK.match_single -a ctrl:qmingt=2 –profile –db PZ_Master1
python -m wbia SMK.match_single -a ctrl –profile –db GZ_ALL</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># FUTURE_ENABLE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">daids</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#ibs, daids = wbia.testdata_aids(defaultdb=&#39;PZ_MTEST&#39;, default_set=&#39;dcfg&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">SMKRequest</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">daids</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">daids</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;agg&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                            <span class="s1">&#39;num_words&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                            <span class="s1">&#39;sv_on&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">ensure_data</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">daids</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid</span> <span class="o">=</span> <span class="n">daids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">smk</span><span class="o">.</span><span class="n">match_single</span><span class="p">(</span><span class="n">qaid</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">qtensure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">ishow_analysis</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.smk_pipeline.SMK.predict_matches">
<code class="descname">predict_matches</code><span class="sig-paren">(</span><em>qreq_</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#SMK.predict_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.SMK.predict_matches" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">smk</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">testdata_smk</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.smk_pipeline.SMK.rrr">
<code class="descname">rrr</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>reload_module=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.SMK.rrr" title="Permalink to this definition">¶</a></dt>
<dd><p>special class reloading function
This function is often injected as rrr of classes</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="wbia.algo.smk.smk_pipeline.SMKRequest">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.smk_pipeline.</code><code class="descname">SMKRequest</code><span class="sig-paren">(</span><em>ibs=None</em>, <em>qaids=None</em>, <em>daids=None</em>, <em>config=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#SMKRequest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.SMKRequest" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#wbia.algo.smk.match_chips5.EstimatorRequest" title="wbia.algo.smk.match_chips5.EstimatorRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">wbia.algo.smk.match_chips5.EstimatorRequest</span></code></a></p>
<p><a href="#id13"><span class="problematic" id="id14">qreq_</span></a>-like object. Trying to work on becoming more scikit-ish</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first">python -m wbia.algo.smk.smk_pipeline SMKRequest –profile
python -m wbia.algo.smk.smk_pipeline SMKRequest –show</p>
<dl class="last docutils">
<dt>python -m wbia draw_rank_cmc –db GZ_ALL –show </dt>
<dd>-p :proot=smk,num_words=[64000,4000],nAssign=[1,5],sv_on=[False,True] -a ctrl:qmingt=2</dd>
<dt>python -m wbia draw_rank_cmc –db PZ_MTEST –show </dt>
<dd><dl class="first docutils">
<dt>-p :proot=smk,num_words=[64000,8000,4000],nAssign=[1,2,4],sv_on=[True,False] </dt>
<dd>default:proot=vsmany,sv_on=[True,False] </dd>
</dl>
<p class="last">-a default:qmingt=2</p>
</dd>
<dt>python -m wbia draw_rank_cmc –db PZ_MTEST –show </dt>
<dd><dl class="first docutils">
<dt>-p :proot=smk,num_words=[64000],nAssign=[1],sv_on=[True] </dt>
<dd>default:proot=vsmany,sv_on=[True] </dd>
</dl>
<p class="last">-a default:qmingt=2</p>
</dd>
<dt>python -m wbia draw_rank_cmc –db PZ_Master1 –show </dt>
<dd>-p :proot=smk,num_words=[64000],nAssign=[1],sv_on=[False] -a ctrl:qmingt=2</dd>
<dt>python -m wbia draw_rank_cmc –db PZ_Master1 </dt>
<dd>-p :proot=smk,num_words=[64000],nAssign=[1],sv_on=[True] -a ctrl:qmingt=2,qindex=60:80 –profile</dd>
<dt>python -m wbia draw_rank_cmc –db GZ_ALL </dt>
<dd>-p :proot=smk,num_words=[64000],nAssign=[1],sv_on=[True] -a ctrl:qmingt=2,qindex=40:60 –profile</dd>
</dl>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">testdata_aids</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">aid_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">aid_list</span><span class="p">[:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nAssign&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;num_words&#39;</span><span class="p">:</span> <span class="mi">64000</span><span class="p">,</span> <span class="s1">&#39;sv_on&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">SMKRequest</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">ensure_data</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">qtensure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ishow_analysis</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">viz_name_score</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ishow_analysis</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">viz_name_score</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="wbia.algo.smk.smk_pipeline.SMKRequest.dump_vectors">
<code class="descname">dump_vectors</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#SMKRequest.dump_vectors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.SMKRequest.dump_vectors" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">testdata_aids</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="s1">&#39;default:mingt=2,pername=2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">aid_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">aid_list</span><span class="p">[:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nAssign&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;num_words&#39;</span><span class="p">:</span> <span class="mi">8000</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>          <span class="s1">&#39;sv_on&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">SMKRequest</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">ensure_data</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.smk_pipeline.SMKRequest.ensure_data">
<code class="descname">ensure_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#SMKRequest.ensure_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.SMKRequest.ensure_data" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia</span>
<span class="go">qreq_ = wbia.testdata_qreq_(</span>
<span class="go">    defaultdb=&#39;Oxford&#39;, a=&#39;oxford&#39;,</span>
<span class="go">    p=&#39;default:proot=smk,nAssign=1,num_words=64000,SV=False,can_match_sameimg=True,dim_size=None&#39;)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.smk_pipeline.SMKRequest.execute_pipeline">
<code class="descname">execute_pipeline</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#SMKRequest.execute_pipeline"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.SMKRequest.execute_pipeline" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">smk</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">testdata_smk</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.smk_pipeline.SMKRequest.get_qreq_dannot_kpts">
<code class="descname">get_qreq_dannot_kpts</code><span class="sig-paren">(</span><em>daids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#SMKRequest.get_qreq_dannot_kpts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.SMKRequest.get_qreq_dannot_kpts" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.smk_pipeline.SMKRequest.get_qreq_qannot_kpts">
<code class="descname">get_qreq_qannot_kpts</code><span class="sig-paren">(</span><em>qaids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#SMKRequest.get_qreq_qannot_kpts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.SMKRequest.get_qreq_qannot_kpts" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.smk_pipeline.SMKRequest.rrr">
<code class="descname">rrr</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>reload_module=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.SMKRequest.rrr" title="Permalink to this definition">¶</a></dt>
<dd><p>special class reloading function
This function is often injected as rrr of classes</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="wbia.algo.smk.smk_pipeline.SMKRequestConfig">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.smk_pipeline.</code><code class="descname">SMKRequestConfig</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#SMKRequestConfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.SMKRequestConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="wbia.dtool.html#wbia.dtool.base.Config" title="wbia.dtool.base.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">wbia.dtool.base.Config</span></code></a></p>
<p>Figure out how to do this</p>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_pipeline.check_can_match">
<code class="descclassname">wbia.algo.smk.smk_pipeline.</code><code class="descname">check_can_match</code><span class="sig-paren">(</span><em>qaid</em>, <em>hit_daids</em>, <em>qreq_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#check_can_match"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.check_can_match" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_pipeline.match_kernel_agg">
<code class="descclassname">wbia.algo.smk.smk_pipeline.</code><code class="descname">match_kernel_agg</code><span class="sig-paren">(</span><em>X</em>, <em>Y</em>, <em>wx_to_weight</em>, <em>alpha</em>, <em>thresh</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#match_kernel_agg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.match_kernel_agg" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_pipeline.match_kernel_sep">
<code class="descclassname">wbia.algo.smk.smk_pipeline.</code><code class="descname">match_kernel_sep</code><span class="sig-paren">(</span><em>X</em>, <em>Y</em>, <em>wx_to_weight</em>, <em>alpha</em>, <em>thresh</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#match_kernel_sep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.match_kernel_sep" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_pipeline.testdata_smk">
<code class="descclassname">wbia.algo.smk.smk_pipeline.</code><code class="descname">testdata_smk</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#testdata_smk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.testdata_smk" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.smk_pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.smk_pipeline.word_isect">
<code class="descclassname">wbia.algo.smk.smk_pipeline.</code><code class="descname">word_isect</code><span class="sig-paren">(</span><em>X</em>, <em>Y</em>, <em>wx_to_weight</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/smk_pipeline.html#word_isect"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.smk_pipeline.word_isect" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-wbia.algo.smk.vocab_indexer">
<span id="wbia-algo-smk-vocab-indexer-module"></span><h2>wbia.algo.smk.vocab_indexer module<a class="headerlink" href="#module-wbia.algo.smk.vocab_indexer" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="wbia.algo.smk.vocab_indexer.VisualVocab">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.vocab_indexer.</code><code class="descname">VisualVocab</code><span class="sig-paren">(</span><em>words=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/vocab_indexer.html#VisualVocab"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.vocab_indexer.VisualVocab" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code></p>
<p>Class that maintains a list of visual words (cluster centers)
Also maintains a nearest neighbor index structure for finding words.
This class is build using the depcache</p>
<dl class="method">
<dt id="wbia.algo.smk.vocab_indexer.VisualVocab.build">
<code class="descname">build</code><span class="sig-paren">(</span><em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/vocab_indexer.html#VisualVocab.build"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.vocab_indexer.VisualVocab.build" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.vocab_indexer.VisualVocab.nn_index">
<code class="descname">nn_index</code><span class="sig-paren">(</span><em>idx_to_vec</em>, <em>nAssign</em>, <em>checks=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/vocab_indexer.html#VisualVocab.nn_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.vocab_indexer.VisualVocab.nn_index" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_vec</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">get_feat_vecs</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vocab</span> <span class="o">=</span> <span class="n">vocab</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nAssign</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.vocab_indexer.VisualVocab.render_vocab">
<code class="descname">render_vocab</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/vocab_indexer.html#VisualVocab.render_vocab"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.vocab_indexer.VisualVocab.render_vocab" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders the average patch of each word.
This is a quick visualization of the entire vocabulary.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m wbia.algo.smk.vocab_indexer render_vocab –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.vocab_indexer</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vocab</span> <span class="o">=</span> <span class="n">testdata_vocab</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">num_words</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_words</span> <span class="o">=</span> <span class="n">vocab</span><span class="o">.</span><span class="n">render_vocab</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">qt4ensure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">all_words</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="wbia.algo.smk.vocab_indexer.VisualVocab.rrr">
<code class="descname">rrr</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>reload_module=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wbia.algo.smk.vocab_indexer.VisualVocab.rrr" title="Permalink to this definition">¶</a></dt>
<dd><p>special class reloading function
This function is often injected as rrr of classes</p>
</dd></dl>

<dl class="attribute">
<dt id="wbia.algo.smk.vocab_indexer.VisualVocab.shape">
<code class="descname">shape</code><a class="headerlink" href="#wbia.algo.smk.vocab_indexer.VisualVocab.shape" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="wbia.algo.smk.vocab_indexer.VocabConfig">
<em class="property">class </em><code class="descclassname">wbia.algo.smk.vocab_indexer.</code><code class="descname">VocabConfig</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/vocab_indexer.html#VocabConfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.vocab_indexer.VocabConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="wbia.dtool.html#wbia.dtool.base.Config" title="wbia.dtool.base.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">wbia.dtool.base.Config</span></code></a></p>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.vocab_indexer.compute_vocab">
<code class="descclassname">wbia.algo.smk.vocab_indexer.</code><code class="descname">compute_vocab</code><span class="sig-paren">(</span><em>depc</em>, <em>fid_list</em>, <em>config</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/vocab_indexer.html#compute_vocab"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.vocab_indexer.compute_vocab" title="Permalink to this definition">¶</a></dt>
<dd><p>Depcache method for computing a new visual vocab</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first">python -m wbia.core_annots –exec-compute_neighbor_index –show
python -m wbia show_depc_annot_table_input –show –tablename=neighbor_index</p>
<p>python -m wbia.algo.smk.vocab_indexer –exec-compute_vocab:0
python -m wbia.algo.smk.vocab_indexer –exec-compute_vocab:1</p>
<p class="last"># FIXME make util_tests register
python -m wbia.algo.smk.vocab_indexer compute_vocab:0</p>
</dd>
<dt>Ignore:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Lev Oxford Debug Example</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s1">&#39;Oxford&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">depc</span><span class="p">[</span><span class="s1">&#39;vocab&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Check what currently exists in vocab table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">print_configs</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">print_table</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">print_internal_info</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Grab aids used to compute vocab</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.expt.experiment_helpers</span> <span class="k">import</span> <span class="n">get_annotcfg_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expanded_aids_list</span> <span class="o">=</span> <span class="n">get_annotcfg_list</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;oxford&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span> <span class="o">=</span> <span class="n">expanded_aids_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vocab_aids</span> <span class="o">=</span> <span class="n">daids</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;num_words&#39;</span><span class="p">:</span> <span class="mi">64000</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exists</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">check_rowids</span><span class="p">(</span><span class="s1">&#39;vocab&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">vocab_aids</span><span class="p">],</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exists = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exists</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vocab_rowid</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_rowids</span><span class="p">(</span><span class="s1">&#39;vocab&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">vocab_aids</span><span class="p">],</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;vocab_rowid = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vocab_rowid</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vocab</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_row_data</span><span class="p">([</span><span class="n">vocab_rowid</span><span class="p">],</span> <span class="s1">&#39;words&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;vocab = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vocab</span><span class="p">,))</span>
</pre></div>
</div>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.vocab_indexer</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Test depcache access</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">testdata_aids</span><span class="p">(</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_annot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_tuple</span> <span class="o">=</span> <span class="p">[</span><span class="n">aid_list</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rowid_kw</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tablename</span> <span class="o">=</span> <span class="s1">&#39;vocab&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vocabid_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_rowids</span><span class="p">(</span><span class="n">tablename</span><span class="p">,</span> <span class="n">input_tuple</span><span class="p">,</span> <span class="o">**</span><span class="n">rowid_kw</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vocab</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tablename</span><span class="p">,</span> <span class="n">input_tuple</span><span class="p">,</span> <span class="s1">&#39;words&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">vocab</span><span class="o">.</span><span class="n">wordflann</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">vocab</span><span class="o">.</span><span class="n">wordflann</span><span class="o">.</span><span class="n">_FLANN__curindex_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">vocab</span><span class="o">.</span><span class="n">wordflann</span><span class="o">.</span><span class="n">_FLANN__curindex_data</span> <span class="ow">is</span> <span class="n">vocab</span><span class="o">.</span><span class="n">wx_to_word</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.vocab_indexer</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span> <span class="o">=</span> <span class="n">wbia</span><span class="o">.</span><span class="n">testdata_aids</span><span class="p">(</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_annot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fid_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_rowids</span><span class="p">(</span><span class="s1">&#39;feat&#39;</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="n">VocabConfig</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vocab</span><span class="p">,</span> <span class="n">train_vecs</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">exec_func_src</span><span class="p">(</span><span class="n">compute_vocab</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;vocab&#39;</span><span class="p">,</span> <span class="s1">&#39;train_vecs&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_to_vec</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">get_feat_vecs</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span> <span class="o">=</span> <span class="n">vocab</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">train_vecs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">centroids</span> <span class="o">=</span> <span class="n">vocab</span><span class="o">.</span><span class="n">wx_to_word</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wbia.plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vt</span><span class="o">.</span><span class="n">plot_centroids</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">centroids</span><span class="p">,</span> <span class="n">num_pca_dims</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#config = ibs.depc_annot[&#39;vocab&#39;].configclass()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.vocab_indexer.testdata_vocab">
<code class="descclassname">wbia.algo.smk.vocab_indexer.</code><code class="descname">testdata_vocab</code><span class="sig-paren">(</span><em>defaultdb='testdb1'</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk/vocab_indexer.html#testdata_vocab"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.vocab_indexer.testdata_vocab" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wbia.algo.smk.vocab_indexer</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;num_words&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-wbia.algo.smk">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-wbia.algo.smk" title="Permalink to this headline">¶</a></h2>
<dl class="data">
<dt id="wbia.algo.smk.IMPORT_TUPLES">
<code class="descclassname">wbia.algo.smk.</code><code class="descname">IMPORT_TUPLES</code><em class="property"> = [('match_chips5', None), ('smk_pipeline', None), ('vocab_indexer', None)]</em><a class="headerlink" href="#wbia.algo.smk.IMPORT_TUPLES" title="Permalink to this definition">¶</a></dt>
<dd><p>cd /home/joncrall/code/wbia/wbia/algo/smk
makeinit.py –modname=wbia.algo.smk</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">Regen Command</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.reassign_submodule_attributes">
<code class="descclassname">wbia.algo.smk.</code><code class="descname">reassign_submodule_attributes</code><span class="sig-paren">(</span><em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk.html#reassign_submodule_attributes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.reassign_submodule_attributes" title="Permalink to this definition">¶</a></dt>
<dd><p>why reloading all the modules doesnt do this I don’t know</p>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.reload_subs">
<code class="descclassname">wbia.algo.smk.</code><code class="descname">reload_subs</code><span class="sig-paren">(</span><em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wbia/algo/smk.html#reload_subs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wbia.algo.smk.reload_subs" title="Permalink to this definition">¶</a></dt>
<dd><p>Reloads wbia.algo.smk and submodules</p>
</dd></dl>

<dl class="function">
<dt id="wbia.algo.smk.rrrr">
<code class="descclassname">wbia.algo.smk.</code><code class="descname">rrrr</code><span class="sig-paren">(</span><em>verbose=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wbia.algo.smk.rrrr" title="Permalink to this definition">¶</a></dt>
<dd><p>Reloads wbia.algo.smk and submodules</p>
</dd></dl>

</div>
</div>


          </div>

        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">wbia</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="wbia.html">wbia - Wildbook IA</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="wbia.algo.html">wbia.algo package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.control.html">wbia.control package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.dbio.html">wbia.dbio package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.detecttools.html">wbia.detecttools package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.dtool.html">wbia.dtool package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.expt.html">wbia.expt package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.gui.html">wbia.gui package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.guitool.html">wbia.guitool package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.init.html">wbia.init package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.other.html">wbia.other package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.plottool.html">wbia.plottool package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.scripts.html">wbia.scripts package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.templates.html">wbia.templates package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.tests.html">wbia.tests package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.viz.html">wbia.viz package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.web.html">wbia.web package</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#wbia-main">wbia.__main__</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia._devcmds_wbia">wbia._devcmds_wbia</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia._devscript">wbia._devscript</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia._wbia_object">wbia._wbia_object</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.annotmatch_funcs">wbia.annotmatch_funcs</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.annots">wbia.annots</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.constants">wbia.constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.core_annots">wbia.core_annots</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.core_images">wbia.core_images</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.core_parts">wbia.core_parts</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.demodata">wbia.demodata</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.dev">wbia.dev</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.filter_configs">wbia.filter_configs</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.images">wbia.images</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.main_module">wbia.main_module</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.params">wbia.params</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-wbia.tag_funcs">wbia.tag_funcs</a></li>
<li class="toctree-l2"><a class="reference internal" href="wbia.html#module-contents">Module contents</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="wbia.html">wbia - Wildbook IA</a><ul>
  <li><a href="wbia.algo.html">wbia.algo package</a><ul>
      <li>Previous: <a href="wbia.algo.preproc.html" title="previous chapter">wbia.algo.preproc package</a></li>
      <li>Next: <a href="wbia.algo.verif.html" title="next chapter">wbia.algo.verif package</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Wild Me.

      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>

      |
      <a href="_sources/wbia.algo.smk.rst.txt"
          rel="nofollow">Page source</a>
    </div>




  </body>
</html>
