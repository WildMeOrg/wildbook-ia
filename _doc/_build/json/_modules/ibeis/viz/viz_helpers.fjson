{"parents": [{"link": "../../../", "title": "Module code"}, {"link": "../../", "title": "ibeis"}, {"link": "../", "title": "ibeis.viz"}], "title": "ibeis.viz.viz_helpers", "body": "<h1>Source code for ibeis.viz.viz_helpers</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"c1\"># -*- coding: utf-8 -*-</span>\n<span class=\"kn\">from</span> <span class=\"nn\">__future__</span> <span class=\"k\">import</span> <span class=\"n\">absolute_import</span><span class=\"p\">,</span> <span class=\"n\">division</span><span class=\"p\">,</span> <span class=\"n\">print_function</span><span class=\"p\">,</span> <span class=\"n\">unicode_literals</span>\n<span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n<span class=\"kn\">import</span> <span class=\"nn\">utool</span> <span class=\"k\">as</span> <span class=\"nn\">ut</span>\n<span class=\"kn\">import</span> <span class=\"nn\">vtool.keypoint</span> <span class=\"k\">as</span> <span class=\"nn\">ktool</span>\n<span class=\"kn\">import</span> <span class=\"nn\">plottool.draw_func2</span> <span class=\"k\">as</span> <span class=\"nn\">df2</span>\n<span class=\"kn\">from</span> <span class=\"nn\">six.moves</span> <span class=\"k\">import</span> <span class=\"nb\">zip</span><span class=\"p\">,</span> <span class=\"nb\">map</span>\n<span class=\"kn\">from</span> <span class=\"nn\">plottool</span> <span class=\"k\">import</span> <span class=\"n\">plot_helpers</span> <span class=\"k\">as</span> <span class=\"n\">ph</span>\n<span class=\"kn\">from</span> <span class=\"nn\">ibeis.other</span> <span class=\"k\">import</span> <span class=\"n\">ibsfuncs</span>\n<span class=\"kn\">from</span> <span class=\"nn\">ibeis.control.accessor_decors</span> <span class=\"k\">import</span> <span class=\"n\">getter</span><span class=\"p\">,</span> <span class=\"n\">getter_vector_output</span>\n<span class=\"p\">(</span><span class=\"nb\">print</span><span class=\"p\">,</span> <span class=\"n\">rrr</span><span class=\"p\">,</span> <span class=\"n\">profile</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">inject2</span><span class=\"p\">(</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n\n\n<span class=\"n\">NO_LBL_OVERRIDE</span> <span class=\"o\">=</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">get_argval</span><span class=\"p\">(</span><span class=\"s1\">&#39;--no-lbl-override&#39;</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"o\">=</span><span class=\"nb\">bool</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n\n\n<span class=\"n\">FNUMS</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"p\">(</span><span class=\"n\">image</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">chip</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">res</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"n\">inspect</span><span class=\"o\">=</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"n\">special</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"mi\">6</span><span class=\"p\">)</span>\n\n<span class=\"n\">IN_IMAGE_OVERRIDE</span> <span class=\"o\">=</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">get_argval</span><span class=\"p\">(</span><span class=\"s1\">&#39;--in-image-override&#39;</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"o\">=</span><span class=\"nb\">bool</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n<span class=\"n\">SHOW_QUERY_OVERRIDE</span> <span class=\"o\">=</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">get_argval</span><span class=\"p\">(</span><span class=\"s1\">&#39;--show-query-override&#39;</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"o\">=</span><span class=\"nb\">bool</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n<span class=\"n\">NO_LBL_OVERRIDE</span> <span class=\"o\">=</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">get_argval</span><span class=\"p\">(</span><span class=\"s1\">&#39;--no-lbl-override&#39;</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"o\">=</span><span class=\"nb\">bool</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n\n<span class=\"n\">SIFT_OR_VECFIELD</span>  <span class=\"o\">=</span> <span class=\"n\">ph</span><span class=\"o\">.</span><span class=\"n\">SIFT_OR_VECFIELD</span>\n\n\n<div class=\"viewcode-block\" id=\"register_FNUMS\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.register_FNUMS\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">register_FNUMS</span><span class=\"p\">(</span><span class=\"n\">FNUMS_</span><span class=\"p\">):</span>\n    <span class=\"c1\"># DEPREICATE</span>\n    <span class=\"k\">global</span> <span class=\"n\">FNUMS</span>\n    <span class=\"n\">FNUMS</span> <span class=\"o\">=</span> <span class=\"n\">FNUMS_</span></div>\n\n<span class=\"n\">draw</span> <span class=\"o\">=</span> <span class=\"n\">ph</span><span class=\"o\">.</span><span class=\"n\">draw</span>\n<span class=\"n\">get_square_row_cols</span> <span class=\"o\">=</span> <span class=\"n\">ph</span><span class=\"o\">.</span><span class=\"n\">get_square_row_cols</span>\n<span class=\"n\">get_ibsdat</span> <span class=\"o\">=</span> <span class=\"n\">ph</span><span class=\"o\">.</span><span class=\"n\">get_plotdat</span>\n<span class=\"n\">set_ibsdat</span> <span class=\"o\">=</span> <span class=\"n\">ph</span><span class=\"o\">.</span><span class=\"n\">set_plotdat</span>\n\n\n<div class=\"viewcode-block\" id=\"get_annot_kpts_in_imgspace\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_annot_kpts_in_imgspace\">[docs]</a><span class=\"nd\">@getter_vector_output</span>\n<span class=\"k\">def</span> <span class=\"nf\">get_annot_kpts_in_imgspace</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"n\">config2_</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">ensure</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot; Transforms keypoints so they are plotable in imagespace &quot;&quot;&quot;</span>\n    <span class=\"n\">bbox_list</span>   <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_bboxes</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n    <span class=\"n\">theta_list</span>  <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_thetas</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">chipsz_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_chip_sizes</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"n\">ensure</span><span class=\"o\">=</span><span class=\"n\">ensure</span><span class=\"p\">)</span>\n    <span class=\"k\">except</span> <span class=\"ne\">AssertionError</span> <span class=\"k\">as</span> <span class=\"n\">ex</span><span class=\"p\">:</span>\n        <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">printex</span><span class=\"p\">(</span><span class=\"n\">ex</span><span class=\"p\">,</span> <span class=\"s1\">&#39;[!ibs.get_annot_kpts_in_imgspace]&#39;</span><span class=\"p\">)</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;[!ibs.get_annot_kpts_in_imgspace] aid_list = </span><span class=\"si\">%r</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">,))</span>\n        <span class=\"k\">raise</span>\n    <span class=\"n\">kpts_list</span>    <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_kpts</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"n\">ensure</span><span class=\"o\">=</span><span class=\"n\">ensure</span><span class=\"p\">,</span> <span class=\"n\">config2_</span><span class=\"o\">=</span><span class=\"n\">config2_</span><span class=\"p\">)</span>\n    <span class=\"n\">imgkpts_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">ktool</span><span class=\"o\">.</span><span class=\"n\">transform_kpts_to_imgspace</span><span class=\"p\">(</span><span class=\"n\">kpts</span><span class=\"p\">,</span> <span class=\"n\">bbox</span><span class=\"p\">,</span> <span class=\"n\">theta</span><span class=\"p\">,</span> <span class=\"n\">chipsz</span><span class=\"p\">)</span>\n                    <span class=\"k\">for</span> <span class=\"n\">kpts</span><span class=\"p\">,</span> <span class=\"n\">bbox</span><span class=\"p\">,</span> <span class=\"n\">theta</span><span class=\"p\">,</span> <span class=\"n\">chipsz</span>\n                    <span class=\"ow\">in</span> <span class=\"nb\">zip</span><span class=\"p\">(</span><span class=\"n\">kpts_list</span><span class=\"p\">,</span> <span class=\"n\">bbox_list</span><span class=\"p\">,</span> <span class=\"n\">theta_list</span><span class=\"p\">,</span> <span class=\"n\">chipsz_list</span><span class=\"p\">)]</span>\n    <span class=\"k\">return</span> <span class=\"n\">imgkpts_list</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_chips\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_chips\">[docs]</a><span class=\"nd\">@getter_vector_output</span>\n<span class=\"k\">def</span> <span class=\"nf\">get_chips</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"n\">in_image</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">config2_</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">as_fpath</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n    <span class=\"c1\">#print(&#39;config2_ = %r&#39; % (config2_,))</span>\n    <span class=\"k\">if</span> <span class=\"n\">as_fpath</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">in_image</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_image_paths</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_chip_fpath</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"n\">config2_</span><span class=\"o\">=</span><span class=\"n\">config2_</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">in_image</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_images</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_chips</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"n\">config2_</span><span class=\"o\">=</span><span class=\"n\">config2_</span><span class=\"p\">)</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_kpts\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_kpts\">[docs]</a><span class=\"nd\">@getter_vector_output</span>\n<span class=\"k\">def</span> <span class=\"nf\">get_kpts</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"n\">in_image</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">config2_</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">ensure</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n             <span class=\"n\">kpts_subset</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">kpts</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">kpts</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"n\">kpts</span><span class=\"p\">]</span>\n    <span class=\"k\">if</span> <span class=\"n\">in_image</span><span class=\"p\">:</span>\n        <span class=\"n\">kpts_list</span> <span class=\"o\">=</span> <span class=\"n\">get_annot_kpts_in_imgspace</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"n\">ensure</span><span class=\"o\">=</span><span class=\"n\">ensure</span><span class=\"p\">,</span> <span class=\"n\">config2_</span><span class=\"o\">=</span><span class=\"n\">config2_</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">kpts_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_kpts</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"n\">ensure</span><span class=\"o\">=</span><span class=\"n\">ensure</span><span class=\"p\">,</span> <span class=\"n\">config2_</span><span class=\"o\">=</span><span class=\"n\">config2_</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">kpts_subset</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"n\">kpts_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">spaced_items</span><span class=\"p\">(</span><span class=\"n\">kpts_</span><span class=\"p\">,</span> <span class=\"n\">kpts_subset</span><span class=\"p\">,</span> <span class=\"n\">trunc</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">kpts_</span> <span class=\"ow\">in</span> <span class=\"n\">kpts_list</span><span class=\"p\">]</span>\n    <span class=\"k\">return</span> <span class=\"n\">kpts_list</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_bboxes\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_bboxes\">[docs]</a><span class=\"nd\">@getter_vector_output</span>\n<span class=\"k\">def</span> <span class=\"nf\">get_bboxes</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"n\">offset_list</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"n\">bbox_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_bboxes</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">offset_list</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"k\">assert</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">offset_list</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">bbox_list</span><span class=\"p\">)</span>\n        <span class=\"c1\"># convert (ofx, ofy) offsets to (ofx, ofy, 0, 0) numpy arrays</span>\n        <span class=\"n\">np_offsts</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">offst</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">])</span> <span class=\"k\">for</span> <span class=\"n\">offst</span> <span class=\"ow\">in</span> <span class=\"n\">offset_list</span><span class=\"p\">]</span>\n        <span class=\"c1\"># add offsets to (x, y, w, h) bounding boxes</span>\n        <span class=\"n\">bbox_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">bbox</span> <span class=\"o\">+</span> <span class=\"n\">offst</span> <span class=\"k\">for</span> <span class=\"n\">bbox</span><span class=\"p\">,</span> <span class=\"n\">offst</span> <span class=\"ow\">in</span> <span class=\"nb\">zip</span><span class=\"p\">(</span><span class=\"n\">bbox_list</span><span class=\"p\">,</span> <span class=\"n\">np_offsts</span><span class=\"p\">)]</span>\n    <span class=\"k\">return</span> <span class=\"n\">bbox_list</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_aidstrs\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_aidstrs\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">get_aidstrs</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">isiterable</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"n\">ibsfuncs</span><span class=\"o\">.</span><span class=\"n\">aidstr</span><span class=\"p\">(</span><span class=\"n\">aid</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">aid</span> <span class=\"ow\">in</span> <span class=\"n\">aid_list</span><span class=\"p\">]</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">ibsfuncs</span><span class=\"o\">.</span><span class=\"n\">aidstr</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_nidstrs\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_nidstrs\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">get_nidstrs</span><span class=\"p\">(</span><span class=\"n\">nid_list</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">isiterable</span><span class=\"p\">(</span><span class=\"n\">nid_list</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"s1\">&#39;nid</span><span class=\"si\">%d</span><span class=\"s1\">&#39;</span> <span class=\"k\">for</span> <span class=\"n\">nid</span> <span class=\"ow\">in</span> <span class=\"n\">nid_list</span><span class=\"p\">]</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"s1\">&#39;nid</span><span class=\"si\">%d</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">nid_list</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_vsstr\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_vsstr\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">get_vsstr</span><span class=\"p\">(</span><span class=\"n\">qaid</span><span class=\"p\">,</span> <span class=\"n\">aid</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"s1\">&#39;qaid</span><span class=\"si\">%d</span><span class=\"s1\">-vs-aid</span><span class=\"si\">%d</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">qaid</span><span class=\"p\">,</span> <span class=\"n\">aid</span><span class=\"p\">)</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_bbox_centers\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_bbox_centers\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">get_bbox_centers</span><span class=\"p\">(</span><span class=\"n\">bbox_list</span><span class=\"p\">):</span>\n    <span class=\"n\">center_pts</span> <span class=\"o\">=</span> <span class=\"p\">[((</span><span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">w</span> <span class=\"o\">/</span> <span class=\"mi\">2</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">y</span> <span class=\"o\">+</span> <span class=\"n\">h</span> <span class=\"o\">/</span> <span class=\"mi\">2</span><span class=\"p\">))</span>\n                  <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">,</span> <span class=\"n\">w</span><span class=\"p\">,</span> <span class=\"n\">h</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"n\">bbox_list</span><span class=\"p\">]</span>\n    <span class=\"n\">center_pts</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">(</span><span class=\"n\">center_pts</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">center_pts</span></div>\n\n\n<div class=\"viewcode-block\" id=\"is_unknown\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.is_unknown\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">is_unknown</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">nid_list</span><span class=\"p\">):</span>\n    <span class=\"c1\"># this func seems unused</span>\n    <span class=\"k\">return</span> <span class=\"p\">[</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">nid</span><span class=\"p\">,</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">VALID_INT_TYPES</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">nid</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span> <span class=\"k\">for</span> <span class=\"n\">nid</span> <span class=\"ow\">in</span> <span class=\"n\">nid_list</span><span class=\"p\">]</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_truth_color\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_truth_color\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">get_truth_color</span><span class=\"p\">(</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"n\">base255</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">lighten_amount</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">ibeis.constants</span> <span class=\"k\">as</span> <span class=\"nn\">const</span>\n    <span class=\"n\">truth_colors</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"n\">const</span><span class=\"o\">.</span><span class=\"n\">EVIDENCE_DECISION</span><span class=\"o\">.</span><span class=\"n\">NEGATIVE</span><span class=\"p\">:</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">FALSE_RED</span><span class=\"p\">,</span>\n        <span class=\"n\">const</span><span class=\"o\">.</span><span class=\"n\">EVIDENCE_DECISION</span><span class=\"o\">.</span><span class=\"n\">POSITIVE</span><span class=\"p\">:</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">TRUE_BLUE</span><span class=\"p\">,</span>\n        <span class=\"n\">const</span><span class=\"o\">.</span><span class=\"n\">EVIDENCE_DECISION</span><span class=\"o\">.</span><span class=\"n\">INCOMPARABLE</span><span class=\"p\">:</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">YELLOW</span><span class=\"p\">,</span>\n        <span class=\"n\">const</span><span class=\"o\">.</span><span class=\"n\">EVIDENCE_DECISION</span><span class=\"o\">.</span><span class=\"n\">UNKNOWN</span><span class=\"p\">:</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">UNKNOWN_PURP</span><span class=\"p\">,</span>\n        <span class=\"n\">const</span><span class=\"o\">.</span><span class=\"n\">EVIDENCE_DECISION</span><span class=\"o\">.</span><span class=\"n\">UNREVIEWED</span><span class=\"p\">:</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">UNKNOWN_PURP</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span>\n    <span class=\"n\">color</span> <span class=\"o\">=</span> <span class=\"n\">truth_colors</span><span class=\"p\">[</span><span class=\"n\">truth</span><span class=\"p\">]</span>\n    <span class=\"k\">if</span> <span class=\"n\">lighten_amount</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"c1\">#print(&#39;color = %r, lighten_amount=%r&#39; % (color, lighten_amount))</span>\n        <span class=\"n\">color</span> <span class=\"o\">=</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">lighten_rgb</span><span class=\"p\">(</span><span class=\"n\">color</span><span class=\"p\">,</span> <span class=\"n\">lighten_amount</span><span class=\"p\">)</span>\n        <span class=\"c1\">#print(&#39;color = %r&#39; % (color))</span>\n    <span class=\"k\">if</span> <span class=\"n\">base255</span><span class=\"p\">:</span>\n        <span class=\"n\">color</span> <span class=\"o\">=</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">to_base255</span><span class=\"p\">(</span><span class=\"n\">color</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">color</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_timedelta_str\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_timedelta_str\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">get_timedelta_str</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">aid1</span><span class=\"p\">,</span> <span class=\"n\">aid2</span><span class=\"p\">):</span>\n    <span class=\"sa\">r</span><span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        ibs (IBEISController):  ibeis controller object</span>\n<span class=\"sd\">        aid1 (int):  annotation id</span>\n<span class=\"sd\">        aid2 (int):  annotation id</span>\n\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">        str: timedelta_str</span>\n\n<span class=\"sd\">    CommandLine:</span>\n<span class=\"sd\">        python -m ibeis.viz.viz_helpers --test-get_timedelta_str</span>\n\n<span class=\"sd\">    Example:</span>\n<span class=\"sd\">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>\n<span class=\"sd\">        &gt;&gt;&gt; from ibeis.viz.viz_helpers import *  # NOQA</span>\n<span class=\"sd\">        &gt;&gt;&gt; import ibeis</span>\n<span class=\"sd\">        &gt;&gt;&gt; ibs = ibeis.opendb(&#39;testdb1&#39;)</span>\n<span class=\"sd\">        &gt;&gt;&gt; aid1, aid2 = 1, 8</span>\n<span class=\"sd\">        &gt;&gt;&gt; timedelta_str = get_timedelta_str(ibs, aid1, aid2)</span>\n<span class=\"sd\">        &gt;&gt;&gt; result = str(timedelta_str)</span>\n<span class=\"sd\">        &gt;&gt;&gt; print(result)</span>\n<span class=\"sd\">        td(2 hours 28 minutes 22 seconds)</span>\n\n<span class=\"sd\">        td(+2:28:22)</span>\n<span class=\"sd\">        td(02:28:22)</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"n\">gid1</span><span class=\"p\">,</span> <span class=\"n\">gid2</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_gids</span><span class=\"p\">([</span><span class=\"n\">aid1</span><span class=\"p\">,</span> <span class=\"n\">aid2</span><span class=\"p\">])</span>\n    <span class=\"n\">unixtime1</span><span class=\"p\">,</span> <span class=\"n\">unixtime2</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_image_unixtime</span><span class=\"p\">([</span><span class=\"n\">gid1</span><span class=\"p\">,</span> <span class=\"n\">gid2</span><span class=\"p\">])</span>\n    <span class=\"k\">if</span> <span class=\"o\">-</span><span class=\"mi\">1</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"n\">unixtime1</span><span class=\"p\">,</span> <span class=\"n\">unixtime2</span><span class=\"p\">]:</span>\n        <span class=\"n\">timedelta_str_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;NA&#39;</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">unixtime_diff</span> <span class=\"o\">=</span> <span class=\"n\">unixtime2</span> <span class=\"o\">-</span> <span class=\"n\">unixtime1</span>\n        <span class=\"c1\">#timedelta_str_ = ut.get_posix_timedelta_str(unixtime_diff)</span>\n        <span class=\"n\">timedelta_str_</span> <span class=\"o\">=</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">get_unix_timedelta_str</span><span class=\"p\">(</span><span class=\"n\">unixtime_diff</span><span class=\"p\">)</span>\n    <span class=\"c1\">#timedelta_str = &#39;timedelta(%s)&#39; % (timedelta_str_)</span>\n    <span class=\"n\">timedelta_str</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;td(</span><span class=\"si\">%s</span><span class=\"s1\">)&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">timedelta_str_</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">timedelta_str</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_annot_texts\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_annot_texts\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">get_annot_texts</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot; Add each type of text_list to the strings list</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        ibs (IBEISController):  ibeis controller object</span>\n<span class=\"sd\">        aid_list (int):  list of annotation ids</span>\n\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">        list: annotation_text_list</span>\n\n<span class=\"sd\">    CommandLine:</span>\n<span class=\"sd\">        python -m ibeis.viz.viz_helpers --test-get_annot_texts</span>\n\n<span class=\"sd\">    Example:</span>\n<span class=\"sd\">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>\n<span class=\"sd\">        &gt;&gt;&gt; from ibeis.viz.viz_helpers import *  # NOQA</span>\n<span class=\"sd\">        &gt;&gt;&gt; import ibeis</span>\n<span class=\"sd\">        &gt;&gt;&gt; import collections</span>\n<span class=\"sd\">        &gt;&gt;&gt; ibs = ibeis.opendb(&#39;testdb1&#39;)</span>\n<span class=\"sd\">        &gt;&gt;&gt; # Default all kwargs to true</span>\n<span class=\"sd\">        &gt;&gt;&gt; class KwargsProxy(object):</span>\n<span class=\"sd\">        ...    def get(self, a, b):</span>\n<span class=\"sd\">        ...        return True</span>\n<span class=\"sd\">        &gt;&gt;&gt; kwargs_proxy = KwargsProxy()</span>\n<span class=\"sd\">        &gt;&gt;&gt; aid_list = ibs.get_valid_aids()[::3]</span>\n<span class=\"sd\">        &gt;&gt;&gt; # execute function</span>\n<span class=\"sd\">        &gt;&gt;&gt; annotation_text_list = get_annot_texts(ibs, aid_list, kwargs_proxy=kwargs_proxy)</span>\n<span class=\"sd\">        &gt;&gt;&gt; # verify results</span>\n<span class=\"sd\">        &gt;&gt;&gt; result = ut.repr2(annotation_text_list, nl=1)</span>\n<span class=\"sd\">        &gt;&gt;&gt; print(result)</span>\n<span class=\"sd\">        [</span>\n<span class=\"sd\">            &#39;aid1, gname=easy1.JPG, name=____, nid=-1, , nGt=0, quality=UNKNOWN, view=left&#39;,</span>\n<span class=\"sd\">            &#39;aid4, gname=hard1.JPG, name=____, nid=-4, , nGt=0, quality=UNKNOWN, view=left&#39;,</span>\n<span class=\"sd\">            &#39;aid7, gname=jeff.png, name=jeff, nid=3, EX, nGt=0, quality=UNKNOWN, view=unknown&#39;,</span>\n<span class=\"sd\">            &#39;aid10, gname=occl2.JPG, name=occl, nid=5, EX, nGt=0, quality=UNKNOWN, view=left&#39;,</span>\n<span class=\"sd\">            &#39;aid13, gname=zebra.jpg, name=zebra, nid=7, EX, nGt=0, quality=UNKNOWN, view=unknown&#39;,</span>\n<span class=\"sd\">        ]</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"c1\"># HACK FOR TEST</span>\n    <span class=\"k\">if</span> <span class=\"s1\">&#39;kwargs_proxy&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n        <span class=\"n\">kwargs</span> <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s1\">&#39;kwargs_proxy&#39;</span><span class=\"p\">]</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">ibsfuncs</span><span class=\"o\">.</span><span class=\"n\">assert_valid_aids</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"k\">assert</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">isiterable</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">),</span> <span class=\"s1\">&#39;input must be iterable&#39;</span>\n        <span class=\"k\">assert</span> <span class=\"nb\">all</span><span class=\"p\">([</span><span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">aid</span><span class=\"p\">,</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">VALID_INT_TYPES</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">aid</span> <span class=\"ow\">in</span> <span class=\"n\">aid_list</span><span class=\"p\">]),</span> <span class=\"s1\">&#39;invalid input&#39;</span>\n    <span class=\"k\">except</span> <span class=\"ne\">AssertionError</span> <span class=\"k\">as</span> <span class=\"n\">ex</span><span class=\"p\">:</span>\n        <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">printex</span><span class=\"p\">(</span><span class=\"n\">ex</span><span class=\"p\">,</span> <span class=\"s1\">&#39;invalid input&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;viz&#39;</span><span class=\"p\">,</span> <span class=\"n\">key_list</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;aid_list&#39;</span><span class=\"p\">])</span>\n        <span class=\"k\">raise</span>\n    <span class=\"n\">texts_list</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>  <span class=\"c1\"># list of lists of texts</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_aidstr&#39;</span><span class=\"p\">,</span> <span class=\"kc\">True</span><span class=\"p\">):</span>\n        <span class=\"n\">aidstr_list</span> <span class=\"o\">=</span> <span class=\"n\">get_aidstrs</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"n\">texts_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">aidstr_list</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_gname&#39;</span><span class=\"p\">,</span> <span class=\"kc\">False</span><span class=\"p\">):</span>\n        <span class=\"n\">gname_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_image_names</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"n\">texts_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">([</span><span class=\"s1\">&#39;gname=</span><span class=\"si\">%s</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">gname</span> <span class=\"k\">for</span> <span class=\"n\">gname</span> <span class=\"ow\">in</span> <span class=\"n\">gname_list</span><span class=\"p\">])</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_name&#39;</span><span class=\"p\">,</span> <span class=\"kc\">True</span><span class=\"p\">):</span>\n        <span class=\"n\">name_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_names</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"n\">texts_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">([</span><span class=\"s1\">&#39;name=</span><span class=\"si\">%s</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">name</span> <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">name_list</span><span class=\"p\">])</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_nid&#39;</span><span class=\"p\">,</span> <span class=\"kc\">False</span><span class=\"p\">):</span>\n        <span class=\"n\">nid_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_name_rowids</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"n\">texts_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">([</span><span class=\"s1\">&#39;nid=</span><span class=\"si\">%d</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">nid</span> <span class=\"k\">for</span> <span class=\"n\">nid</span> <span class=\"ow\">in</span> <span class=\"n\">nid_list</span><span class=\"p\">])</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_exemplar&#39;</span><span class=\"p\">,</span> <span class=\"kc\">True</span><span class=\"p\">):</span>\n        <span class=\"n\">flag_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_exemplar_flags</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"n\">texts_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">([</span><span class=\"s1\">&#39;EX&#39;</span> <span class=\"k\">if</span> <span class=\"n\">flag</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span> <span class=\"k\">for</span> <span class=\"n\">flag</span> <span class=\"ow\">in</span> <span class=\"n\">flag_list</span><span class=\"p\">])</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_num_gt&#39;</span><span class=\"p\">,</span> <span class=\"kc\">True</span><span class=\"p\">):</span>\n        <span class=\"c1\"># FIXME: This should be num_groundtruth with respect to the currently</span>\n        <span class=\"c1\"># allowed annotations</span>\n        <span class=\"n\">nGt_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_num_groundtruth</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"n\">texts_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">([</span><span class=\"s1\">&#39;nGt=</span><span class=\"si\">%r</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">nGt</span> <span class=\"k\">for</span> <span class=\"n\">nGt</span> <span class=\"ow\">in</span> <span class=\"n\">nGt_list</span><span class=\"p\">])</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_quality_text&#39;</span><span class=\"p\">,</span> <span class=\"kc\">False</span><span class=\"p\">):</span>\n        <span class=\"n\">qualtext_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_quality_texts</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"n\">texts_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"nb\">map</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">text</span><span class=\"p\">:</span> <span class=\"s1\">&#39;quality=</span><span class=\"si\">%s</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"n\">qualtext_list</span><span class=\"p\">)))</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_viewcode&#39;</span><span class=\"p\">,</span> <span class=\"kc\">False</span><span class=\"p\">):</span>\n        <span class=\"c1\"># FIXME: This should be num_groundtruth with respect to the currently</span>\n        <span class=\"c1\"># allowed annotations</span>\n        <span class=\"n\">viewcode_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_viewpoint_code</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"n\">texts_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"nb\">map</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">text</span><span class=\"p\">:</span> <span class=\"s1\">&#39;view=</span><span class=\"si\">%s</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"n\">viewcode_list</span><span class=\"p\">)))</span>\n    <span class=\"c1\"># zip them up to get a tuple for each chip and join the fields</span>\n    <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">texts_list</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n        <span class=\"n\">annotation_text_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;, &#39;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">tup</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">tup</span> <span class=\"ow\">in</span> <span class=\"nb\">zip</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">texts_list</span><span class=\"p\">)]</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"c1\"># no texts were specified return empty string for each input</span>\n        <span class=\"n\">annotation_text_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">annotation_text_list</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_image_titles\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_image_titles\">[docs]</a><span class=\"nd\">@getter</span>\n<span class=\"k\">def</span> <span class=\"nf\">get_image_titles</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">gid_list</span><span class=\"p\">):</span>\n    <span class=\"n\">gname_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_image_gnames</span><span class=\"p\">(</span><span class=\"n\">gid_list</span><span class=\"p\">)</span>\n    <span class=\"n\">title_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n        <span class=\"s1\">&#39;gname=</span><span class=\"si\">%r</span><span class=\"s1\">, gid=</span><span class=\"si\">%r</span><span class=\"s1\"> &#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">gname</span><span class=\"p\">),</span> <span class=\"n\">gid</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">gid</span><span class=\"p\">,</span> <span class=\"n\">gname</span> <span class=\"ow\">in</span> <span class=\"nb\">zip</span><span class=\"p\">(</span><span class=\"n\">gid_list</span><span class=\"p\">,</span> <span class=\"n\">gname_list</span><span class=\"p\">)</span>\n    <span class=\"p\">]</span>\n    <span class=\"k\">return</span> <span class=\"n\">title_list</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_annot_text\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_annot_text\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">get_annot_text</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">aid_list</span><span class=\"p\">,</span> <span class=\"n\">draw_lbls</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">draw_lbls</span><span class=\"p\">:</span>\n        <span class=\"n\">text_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_names</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">text_list</span> <span class=\"o\">=</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">alloc_nones</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">aid_list</span><span class=\"p\">))</span>\n    <span class=\"k\">return</span> <span class=\"n\">text_list</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_query_text\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.get_query_text\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">get_query_text</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">cm</span><span class=\"p\">,</span> <span class=\"n\">aid2</span><span class=\"p\">,</span> <span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    returns title based on the query chip and result</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        ibs (IBEISController):  ibeis controller object</span>\n<span class=\"sd\">        cm (ChipMatch):  object of feature correspondences and scores</span>\n<span class=\"sd\">        aid2 (int):  annotation id</span>\n<span class=\"sd\">        truth (int): 0, 1, 2</span>\n\n<span class=\"sd\">    Kwargs:</span>\n<span class=\"sd\">        qaid, score, rawscore, aid2_raw_rank, show_truth, name_score,</span>\n<span class=\"sd\">        name_rank, show_name_score, show_name_rank, show_timedelta</span>\n\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">        str: query_text</span>\n\n<span class=\"sd\">    CommandLine:</span>\n<span class=\"sd\">        python -m ibeis.viz.viz_helpers --exec-get_query_text</span>\n\n<span class=\"sd\">    Example:</span>\n<span class=\"sd\">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>\n<span class=\"sd\">        &gt;&gt;&gt; from ibeis.viz.viz_helpers import *  # NOQA</span>\n<span class=\"sd\">        &gt;&gt;&gt; import ibeis</span>\n<span class=\"sd\">        &gt;&gt;&gt; cm, qreq_ = ibeis.testdata_cm()</span>\n<span class=\"sd\">        &gt;&gt;&gt; aid2 = cm.get_top_aids()[0]</span>\n<span class=\"sd\">        &gt;&gt;&gt; truth = 1</span>\n<span class=\"sd\">        &gt;&gt;&gt; query_text = get_query_text(ibs, cm, aid2, truth)</span>\n<span class=\"sd\">        &gt;&gt;&gt; result = (&#39;query_text = %s&#39; % (str(query_text),))</span>\n<span class=\"sd\">        &gt;&gt;&gt; print(result)</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"n\">text_list</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"k\">if</span> <span class=\"n\">cm</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"n\">qaid</span> <span class=\"o\">=</span> <span class=\"n\">cm</span><span class=\"o\">.</span><span class=\"n\">qaid</span>\n        <span class=\"n\">score</span> <span class=\"o\">=</span> <span class=\"n\">cm</span><span class=\"o\">.</span><span class=\"n\">get_annot_scores</span><span class=\"p\">([</span><span class=\"n\">aid2</span><span class=\"p\">])[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n        <span class=\"n\">rawscore</span> <span class=\"o\">=</span> <span class=\"n\">cm</span><span class=\"o\">.</span><span class=\"n\">get_annot_scores</span><span class=\"p\">([</span><span class=\"n\">aid2</span><span class=\"p\">])[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n        <span class=\"n\">aid2_raw_rank</span> <span class=\"o\">=</span> <span class=\"n\">cm</span><span class=\"o\">.</span><span class=\"n\">get_annot_ranks</span><span class=\"p\">([</span><span class=\"n\">aid2</span><span class=\"p\">])[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">qaid</span>          <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;qaid&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">score</span>         <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;score&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">rawscore</span>      <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;rawscore&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">aid2_raw_rank</span> <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;aid2_raw_rank&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_truth&#39;</span><span class=\"p\">,</span> <span class=\"kc\">False</span><span class=\"p\">):</span>\n        <span class=\"n\">truth_str</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;*</span><span class=\"si\">%s</span><span class=\"s1\">*&#39;</span> <span class=\"o\">%</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">const</span><span class=\"o\">.</span><span class=\"n\">EVIDENCE_DECISION</span><span class=\"o\">.</span><span class=\"n\">INT_TO_NICE</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">text_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">truth_str</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_rank&#39;</span><span class=\"p\">,</span> <span class=\"n\">aid2_raw_rank</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"n\">cm</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"c1\">#aid2_raw_rank = cm.get_annot_ranks([aid2])[0]</span>\n            <span class=\"n\">aid2_rank</span> <span class=\"o\">=</span> <span class=\"n\">aid2_raw_rank</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"k\">if</span> <span class=\"n\">aid2_raw_rank</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"k\">else</span> <span class=\"kc\">None</span>\n            <span class=\"n\">rank_str</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;rank=</span><span class=\"si\">%s</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">aid2_rank</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"ne\">Exception</span> <span class=\"k\">as</span> <span class=\"n\">ex</span><span class=\"p\">:</span>\n            <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">printex</span><span class=\"p\">(</span><span class=\"n\">ex</span><span class=\"p\">)</span>\n            <span class=\"c1\">#ut.embed()</span>\n            <span class=\"k\">raise</span>\n        <span class=\"n\">text_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">rank_str</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_rawscore&#39;</span><span class=\"p\">,</span> <span class=\"n\">rawscore</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"n\">cm</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"n\">rawscore_str</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"s1\">&#39;rawscore=&#39;</span> <span class=\"o\">+</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">num_fmt</span><span class=\"p\">(</span><span class=\"n\">rawscore</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">text_list</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"n\">rawscore_str</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span> <span class=\"o\">+</span> <span class=\"n\">rawscore_str</span>\n        <span class=\"n\">text_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">rawscore_str</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_score&#39;</span><span class=\"p\">,</span> <span class=\"n\">score</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"n\">cm</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"n\">score_str</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"s1\">&#39;score=&#39;</span> <span class=\"o\">+</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">num_fmt</span><span class=\"p\">(</span><span class=\"n\">score</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">text_list</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"n\">score_str</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span> <span class=\"o\">+</span> <span class=\"n\">score_str</span>\n        <span class=\"n\">text_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">score_str</span><span class=\"p\">)</span>\n    <span class=\"n\">name_score</span> <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;name_score&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"n\">name_rank</span> <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;name_rank&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_name_score&#39;</span><span class=\"p\">,</span> <span class=\"kc\">True</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">name_score</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">text_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"s1\">&#39;name_score=&#39;</span> <span class=\"o\">+</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">num_fmt</span><span class=\"p\">(</span><span class=\"n\">name_score</span><span class=\"p\">))</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_name_rank&#39;</span><span class=\"p\">,</span> <span class=\"kc\">True</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">name_rank</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Make display one based</span>\n            <span class=\"n\">text_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"s1\">&#39;name_rank=#</span><span class=\"si\">%s</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">name_rank</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">),))</span>\n    <span class=\"c1\">#with ut.embed_on_exception_context:</span>\n    <span class=\"k\">if</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;show_timedelta&#39;</span><span class=\"p\">,</span> <span class=\"kc\">True</span><span class=\"p\">):</span>\n        <span class=\"k\">assert</span> <span class=\"n\">qaid</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"s1\">&#39;qaid cannot be None&#39;</span>\n        <span class=\"c1\"># TODO: fixme</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">aid2</span><span class=\"p\">,</span> <span class=\"nb\">list</span><span class=\"p\">):</span>\n            <span class=\"n\">aid2_</span> <span class=\"o\">=</span> <span class=\"n\">aid2</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">aid2_</span> <span class=\"o\">=</span> <span class=\"n\">aid2</span>\n        <span class=\"n\">timedelta_str</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span> <span class=\"o\">+</span> <span class=\"n\">get_timedelta_str</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">qaid</span><span class=\"p\">,</span> <span class=\"n\">aid2_</span><span class=\"p\">))</span>\n        <span class=\"n\">text_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">timedelta_str</span><span class=\"p\">)</span>\n    <span class=\"n\">query_text</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;, &#39;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">text_list</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">query_text</span></div>\n\n\n<span class=\"c1\">#==========================#</span>\n<span class=\"c1\">#  --- TESTING FUNCS ---   #</span>\n<span class=\"c1\">#==========================#</span>\n\n\n<div class=\"viewcode-block\" id=\"show_keypoint_gradient_orientations\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.show_keypoint_gradient_orientations\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">show_keypoint_gradient_orientations</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">aid</span><span class=\"p\">,</span> <span class=\"n\">fx</span><span class=\"p\">,</span> <span class=\"n\">fnum</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">pnum</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">config2_</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"c1\"># Draw the gradient vectors of a patch overlaying the keypoint</span>\n    <span class=\"k\">if</span> <span class=\"n\">fnum</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"n\">fnum</span> <span class=\"o\">=</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">next_fnum</span><span class=\"p\">()</span>\n    <span class=\"n\">rchip</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_chips</span><span class=\"p\">(</span><span class=\"n\">aid</span><span class=\"p\">,</span> <span class=\"n\">config2_</span><span class=\"o\">=</span><span class=\"n\">config2_</span><span class=\"p\">)</span>\n    <span class=\"n\">kp</span>    <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_kpts</span><span class=\"p\">(</span><span class=\"n\">aid</span><span class=\"p\">,</span> <span class=\"n\">config2_</span><span class=\"o\">=</span><span class=\"n\">config2_</span><span class=\"p\">)[</span><span class=\"n\">fx</span><span class=\"p\">]</span>\n    <span class=\"n\">sift</span>  <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_vecs</span><span class=\"p\">(</span><span class=\"n\">aid</span><span class=\"p\">,</span> <span class=\"n\">config2_</span><span class=\"o\">=</span><span class=\"n\">config2_</span><span class=\"p\">)[</span><span class=\"n\">fx</span><span class=\"p\">]</span>\n    <span class=\"n\">fig</span> <span class=\"o\">=</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">draw_keypoint_gradient_orientations</span><span class=\"p\">(</span><span class=\"n\">rchip</span><span class=\"p\">,</span> <span class=\"n\">kp</span><span class=\"p\">,</span> <span class=\"n\">sift</span><span class=\"o\">=</span><span class=\"n\">sift</span><span class=\"p\">,</span>\n                                                  <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"s1\">&#39;vec&#39;</span><span class=\"p\">,</span> <span class=\"n\">fnum</span><span class=\"o\">=</span><span class=\"n\">fnum</span><span class=\"p\">,</span> <span class=\"n\">pnum</span><span class=\"o\">=</span><span class=\"n\">pnum</span><span class=\"p\">)</span>\n    <span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">canvas</span><span class=\"o\">.</span><span class=\"n\">draw</span><span class=\"p\">()</span>\n    <span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">()</span>\n    <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">set_title</span><span class=\"p\">(</span><span class=\"s1\">&#39;Gradient orientation</span><span class=\"se\">\\n</span><span class=\"s1\"> </span><span class=\"si\">%s</span><span class=\"s1\">, fx=</span><span class=\"si\">%d</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">get_aidstrs</span><span class=\"p\">(</span><span class=\"n\">aid</span><span class=\"p\">),</span> <span class=\"n\">fx</span><span class=\"p\">))</span></div>\n\n\n<div class=\"viewcode-block\" id=\"kp_info\"><a class=\"viewcode-back\" href=\"../../../../ibeis.viz/#ibeis.viz.viz_helpers.kp_info\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">kp_info</span><span class=\"p\">(</span><span class=\"n\">kp</span><span class=\"p\">):</span>\n    <span class=\"n\">kpts</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">([</span><span class=\"n\">kp</span><span class=\"p\">])</span>\n    <span class=\"n\">xy_str</span>    <span class=\"o\">=</span> <span class=\"n\">ktool</span><span class=\"o\">.</span><span class=\"n\">get_xy_strs</span><span class=\"p\">(</span><span class=\"n\">kpts</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n    <span class=\"n\">shape_str</span> <span class=\"o\">=</span> <span class=\"n\">ktool</span><span class=\"o\">.</span><span class=\"n\">get_shape_strs</span><span class=\"p\">(</span><span class=\"n\">kpts</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n    <span class=\"n\">ori_</span> <span class=\"o\">=</span> <span class=\"n\">ktool</span><span class=\"o\">.</span><span class=\"n\">get_oris</span><span class=\"p\">(</span><span class=\"n\">kpts</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n    <span class=\"n\">ori_str</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;ori=</span><span class=\"si\">%.2f</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">ori_</span>\n    <span class=\"n\">scale</span> <span class=\"o\">=</span> <span class=\"n\">ktool</span><span class=\"o\">.</span><span class=\"n\">get_scales</span><span class=\"p\">(</span><span class=\"n\">kpts</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n    <span class=\"k\">return</span> <span class=\"n\">xy_str</span><span class=\"p\">,</span> <span class=\"n\">shape_str</span><span class=\"p\">,</span> <span class=\"n\">scale</span><span class=\"p\">,</span> <span class=\"n\">ori_str</span></div>\n<span class=\"c1\">#----</span>\n\n\n<span class=\"k\">if</span> <span class=\"vm\">__name__</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;__main__&#39;</span><span class=\"p\">:</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    CommandLine:</span>\n<span class=\"sd\">        python -m ibeis.viz.viz_helpers</span>\n<span class=\"sd\">        python -m ibeis.viz.viz_helpers --allexamples</span>\n<span class=\"sd\">        python -m ibeis.viz.viz_helpers --allexamples --noface --nosrc</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">multiprocessing</span>\n    <span class=\"n\">multiprocessing</span><span class=\"o\">.</span><span class=\"n\">freeze_support</span><span class=\"p\">()</span>  <span class=\"c1\"># for win32</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">utool</span> <span class=\"k\">as</span> <span class=\"nn\">ut</span>  <span class=\"c1\"># NOQA</span>\n    <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">doctest_funcs</span><span class=\"p\">()</span>\n</pre></div>", "current_page_name": "_modules/ibeis/viz/viz_helpers", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}