

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ibeis.viz.viz_graph2 &mdash; ibeis 1.9.0.vulcan documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> ibeis
          

          
          </a>

          
            
            
              <div class="version">
                1.9.0.vulcan
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ibeis.html">ibeis package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ibeis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../ibeis.html">ibeis</a> &raquo;</li>
        
          <li><a href="../viz.html">ibeis.viz</a> &raquo;</li>
        
      <li>ibeis.viz.viz_graph2</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ibeis.viz.viz_graph2</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CommandLine:</span>
<span class="sd">    ibeis make_qt_graph_interface --show</span>
<span class="sd">    ibeis make_qt_graph_interface --show --aids=1,2,3,4,5,6,7,8,9</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
<span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">dtool</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">it</span>
<span class="kn">import</span> <span class="nn">guitool</span> <span class="k">as</span> <span class="nn">gt</span>
<span class="kn">import</span> <span class="nn">plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="kn">import</span> <span class="nn">ibeis.constants</span> <span class="k">as</span> <span class="nn">const</span>
<span class="kn">from</span> <span class="nn">plottool</span> <span class="k">import</span> <span class="n">abstract_interaction</span>
<span class="kn">from</span> <span class="nn">guitool.__PYQT__</span> <span class="k">import</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">guitool.__PYQT__.QtCore</span> <span class="k">import</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">guitool</span> <span class="k">import</span> <span class="n">mpl_widget</span>
<span class="kn">from</span> <span class="nn">guitool</span> <span class="k">import</span> <span class="n">PrefWidget2</span>
<span class="kn">from</span> <span class="nn">ibeis.algo.graph.state</span> <span class="k">import</span> <span class="n">POSTV</span><span class="p">,</span> <span class="n">NEGTV</span><span class="p">,</span> <span class="n">INCMP</span><span class="p">,</span> <span class="n">UNREV</span><span class="p">,</span> <span class="n">UNKWN</span>  <span class="c1"># NOQA</span>

<span class="n">GRAPH_REVIEW_CFG_DEFAULTS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ranks_top&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;ranks_bot&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>

    <span class="s1">&#39;hack_min_review&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>

    <span class="s1">&#39;filter_reviewed&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;filter_photobombs&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>

    <span class="s1">&#39;filter_true_matches&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;filter_false_matches&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>

    <span class="s1">&#39;filter_nonmatch_between_ccs&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;filter_dup_namepairs&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>

    <span class="s1">&#39;show_match_thumb&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="AnnotPairDialog"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog">[docs]</a><span class="k">class</span> <span class="nc">AnnotPairDialog</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">GuitoolWidget</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    ibeis AnnotPairDialog --show</span>
<span class="sd">    python -m ibeis.algo.graph.mixin_loops qt_review_loop --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.viz.viz_graph2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import guitool as gt</span>
<span class="sd">        &gt;&gt;&gt; gt.ensure_qapp()</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(&#39;PZ_MTEST&#39;)</span>
<span class="sd">        &gt;&gt;&gt; win = AnnotPairDialog(ibs=ibs, edge=(1, 2),</span>
<span class="sd">        &gt;&gt;&gt;                       info_text=&#39;text describing this match&#39;)</span>
<span class="sd">        &gt;&gt;&gt; gt.qtapp_loop(qwin=win, freq=10)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.viz.viz_graph2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; import guitool as gt</span>
<span class="sd">        &gt;&gt;&gt; gt.ensure_qapp()</span>
<span class="sd">        &gt;&gt;&gt; infr = ibeis.AnnotInference(&#39;PZ_Master1&#39;, &#39;all&#39;)</span>
<span class="sd">        &gt;&gt;&gt; infr.reset_feedback(&#39;staging&#39;)</span>
<span class="sd">        &gt;&gt;&gt; edges = [(86, 16273), (86, 5245), (92, 16273), (559, 16240),</span>
<span class="sd">        &gt;&gt;&gt;         (559, 2111),]</span>
<span class="sd">        &gt;&gt;&gt; edge = edges[0]</span>
<span class="sd">        &gt;&gt;&gt; self = AnnotPairDialog(edge=edges, infr=infr, standalone=False)</span>
<span class="sd">        &gt;&gt;&gt; self.seek(0)</span>
<span class="sd">        &gt;&gt;&gt; self.show()</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># skipped = QtCore.pyqtSignal()</span>
    <span class="c1"># request = QtCore.pyqtSignal(tuple)</span>

<div class="viewcode-block" id="AnnotPairDialog.initialize"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">infr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ibs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">info_text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">cfgdict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">standalone</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # Args:</span>
<span class="sd">        #     standalone (bool):</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">ibeis.gui</span> <span class="k">import</span> <span class="n">inspect_gui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span> <span class="o">=</span> <span class="n">infr</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">oset</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">infr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ibs</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">ibs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">standalone</span> <span class="o">=</span> <span class="n">standalone</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">annot_state1</span> <span class="o">=</span> <span class="n">AnnotStateDialog</span><span class="p">(</span><span class="n">ibs</span><span class="o">=</span><span class="n">ibs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annot_state2</span> <span class="o">=</span> <span class="n">AnnotStateDialog</span><span class="p">(</span><span class="n">ibs</span><span class="o">=</span><span class="n">ibs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">annot_review</span> <span class="o">=</span> <span class="n">EdgeReviewDialog</span><span class="p">(</span>
            <span class="c1"># conf_editor=&#39;combo&#39;,</span>
            <span class="n">with_confirm</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuner</span> <span class="o">=</span> <span class="n">inspect_gui</span><span class="o">.</span><span class="n">make_vsone_tuner</span><span class="p">(</span>
            <span class="n">ibs</span><span class="p">,</span> <span class="n">autoupdate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">,</span> <span class="n">info_text</span><span class="o">=</span><span class="n">info_text</span><span class="p">)</span>

        <span class="n">splitter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewSplitter</span><span class="p">(</span><span class="n">ori</span><span class="o">=</span><span class="s1">&#39;horiz&#39;</span><span class="p">)</span>
        <span class="n">splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuner</span><span class="p">)</span>

        <span class="n">rbox</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">addNewWidget</span><span class="p">(</span><span class="n">ori</span><span class="o">=</span><span class="s1">&#39;vert&#39;</span><span class="p">)</span>

        <span class="n">rbox</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            .QFrame {</span>
<span class="sd">                border-width: 2px;</span>
<span class="sd">                border-color: black;</span>
<span class="sd">                border-style: outset;</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">)</span>

        <span class="n">gt</span><span class="o">.</span><span class="n">set_qt_object_names</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spoiler1</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">Spoiler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Aid1&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spoiler2</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">Spoiler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Aid2&#39;</span><span class="p">)</span>
            <span class="n">rbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spoiler1</span><span class="p">)</span>
            <span class="n">rbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spoiler2</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">spoiler1</span><span class="o">.</span><span class="n">setContentLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_state1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spoiler2</span><span class="o">.</span><span class="n">setContentLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_state2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frame1</span> <span class="o">=</span> <span class="n">rbox</span><span class="o">.</span><span class="n">addNewFrame</span><span class="p">()</span>
            <span class="n">frame2</span> <span class="o">=</span> <span class="n">rbox</span><span class="o">.</span><span class="n">addNewFrame</span><span class="p">()</span>

            <span class="n">frame1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_state1</span><span class="p">)</span>
            <span class="n">frame2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_state2</span><span class="p">)</span>

        <span class="n">frame3</span> <span class="o">=</span> <span class="n">rbox</span><span class="o">.</span><span class="n">addNewFrame</span><span class="p">()</span>
        <span class="n">frame3</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annot_review</span><span class="p">)</span>
        <span class="n">rbox</span><span class="o">.</span><span class="n">addNewSpacer</span><span class="p">(</span><span class="n">hPolicy</span><span class="o">=</span><span class="s1">&#39;Expanding&#39;</span><span class="p">,</span> <span class="n">vPolicy</span><span class="o">=</span><span class="s1">&#39;Expanding&#39;</span><span class="p">)</span>
        <span class="c1"># gt.print_widget_heirarchy(</span>
        <span class="c1">#     self, annot_state=[&#39;sizePolicy&#39;, &#39;minimumHeight&#39;], skip=True)</span>

        <span class="n">butbar</span> <span class="o">=</span> <span class="n">rbox</span><span class="o">.</span><span class="n">addNewHWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept_button</span> <span class="o">=</span> <span class="n">butbar</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Accept&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">standalone</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skip_but</span> <span class="o">=</span> <span class="n">butbar</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Skip&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">)</span>

        <span class="n">np_bar</span> <span class="o">=</span> <span class="n">rbox</span><span class="o">.</span><span class="n">addNewHWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">was_confirmed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">index_edit</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">edges</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">edge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ut</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">edges</span> <span class="o">=</span> <span class="n">edge</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_but</span> <span class="o">=</span> <span class="n">np_bar</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span>
                <span class="s1">&#39;Prev&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_by</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index_edit</span> <span class="o">=</span> <span class="n">np_bar</span><span class="o">.</span><span class="n">addNewLineEdit</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">editingFinishedSlot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_jump</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_but</span> <span class="o">=</span> <span class="n">np_bar</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span>
                <span class="s1">&#39;Next&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_by</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">standalone</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_but</span> <span class="o">=</span> <span class="n">np_bar</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span>
                <span class="s1">&#39;Prev&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_by</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index_edit</span> <span class="o">=</span> <span class="n">np_bar</span><span class="o">.</span><span class="n">addNewLineEdit</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">editingFinishedSlot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_jump</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_but</span> <span class="o">=</span> <span class="n">np_bar</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span>
                <span class="s1">&#39;Next&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_by</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_but</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_edit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> / </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_external</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;edge = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">edge</span><span class="p">,))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.total = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.standalone = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">standalone</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">edge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">info_text</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">standalone</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">_gen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">start_id_review</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">continue_review</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">standalone</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total</span>

<div class="viewcode-block" id="AnnotPairDialog.keyPressEvent"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.keyPressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">keyPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">gt</span><span class="o">.</span><span class="n">__PYQT__</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Return</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot_review</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotPairDialog.feedback_dict"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.feedback_dict">[docs]</a>    <span class="k">def</span> <span class="nf">feedback_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot_review</span><span class="o">.</span><span class="n">feedback_dict</span><span class="p">()</span>
        <span class="n">feedback</span><span class="p">[</span><span class="s1">&#39;annot1_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot_state1</span><span class="o">.</span><span class="n">current_annot_state</span><span class="p">()</span>
        <span class="n">feedback</span><span class="p">[</span><span class="s1">&#39;annot2_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot_state2</span><span class="o">.</span><span class="n">current_annot_state</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">feedback</span></div>

<div class="viewcode-block" id="AnnotPairDialog.skip"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.skip">[docs]</a>    <span class="k">def</span> <span class="nf">skip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot_review</span><span class="o">.</span><span class="n">edge</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">continue_review</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotPairDialog.accept"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.accept">[docs]</a>    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz] accept&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">was_confirmed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feedback_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standalone</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;feedback = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">feedback</span><span class="p">),))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Edge feedback not recoreded&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">goto_next</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">need_next</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.total = </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.count = </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;need_next = </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">need_next</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.last_external = </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_external</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_external</span><span class="p">:</span>
                <span class="c1"># always request next even if external</span>
                <span class="c1"># alg sent you back to rereview.</span>
                <span class="n">need_next</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">need_next</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">continue_review</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">need_next</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goto_next</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotPairDialog.continue_review"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.continue_review">[docs]</a>    <span class="k">def</span> <span class="nf">continue_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz] continue review&#39;</span><span class="p">)</span>
        <span class="n">user_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">continue_review</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;user_request = </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user_request</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">user_request</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_finished</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_review</span><span class="p">(</span><span class="n">user_request</span><span class="p">,</span> <span class="n">external</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotPairDialog.goto_next"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.goto_next">[docs]</a>    <span class="k">def</span> <span class="nf">goto_next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Move to the next item</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_by</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotPairDialog.set_edge"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.set_edge">[docs]</a>    <span class="k">def</span> <span class="nf">set_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">info_text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">external</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;set edge = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">edge</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_external</span> <span class="o">=</span> <span class="n">external</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">standalone</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">skip_but</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_but</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_but</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">index_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> / </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">was_confirmed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">edge_data</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">get_nonvisual_edge_data</span><span class="p">(</span><span class="n">edge</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuner</span><span class="o">.</span><span class="n">set_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">info_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annot_state1</span><span class="o">.</span><span class="n">set_aid</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annot_state2</span><span class="o">.</span><span class="n">set_aid</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annot_review</span><span class="o">.</span><span class="n">set_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annot_review</span><span class="o">.</span><span class="n">setFocus</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotPairDialog.edit_jump"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.edit_jump">[docs]</a>    <span class="k">def</span> <span class="nf">edit_jump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotPairDialog.step_by"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.step_by">[docs]</a>    <span class="k">def</span> <span class="nf">step_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="n">amount</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotPairDialog.seek"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.seek">[docs]</a>    <span class="k">def</span> <span class="nf">seek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;seek index = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standalone</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> / </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">))</span>
            <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_review</span><span class="p">([</span><span class="n">edge</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;standalone&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}],</span>
                                <span class="n">external</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;request edge = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">edge</span><span class="p">,))</span>
            <span class="n">user_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">emit_manual_review</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_review</span><span class="p">(</span><span class="n">user_request</span><span class="p">,</span> <span class="n">external</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotPairDialog.request_review"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.request_review">[docs]</a>    <span class="k">def</span> <span class="nf">request_review</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_request</span><span class="p">,</span> <span class="n">external</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">edge</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="n">user_request</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Got request for edge=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edge</span><span class="p">))</span>
        <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;edge=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">edge</span><span class="p">,)</span>
        <span class="n">info_text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">priority=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">priority</span><span class="p">,)</span>
        <span class="n">info_text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">edge_data</span><span class="p">,</span> <span class="n">si</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">info_text</span><span class="p">,</span> <span class="n">external</span><span class="o">=</span><span class="n">external</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotPairDialog.on_finished"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotPairDialog.on_finished">[docs]</a>    <span class="k">def</span> <span class="nf">on_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
            <span class="n">gt</span><span class="o">.</span><span class="n">user_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Review Complete&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AnnotStateDialog"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotStateDialog">[docs]</a><span class="k">class</span> <span class="nc">AnnotStateDialog</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">GuitoolWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    python -m ibeis.viz.viz_graph2 AnnotStateDialog --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.viz.viz_graph2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import guitool as gt</span>
<span class="sd">        &gt;&gt;&gt; gt.ensure_qapp()</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(&#39;PZ_MTEST&#39;)</span>
<span class="sd">        &gt;&gt;&gt; aid = 1</span>
<span class="sd">        &gt;&gt;&gt; self = AnnotStateDialog(ibs=ibs, aid=aid)</span>
<span class="sd">        &gt;&gt;&gt; gt.qtapp_loop(qwin=self, freq=10)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># kwargs.pop(&#39;ori&#39;, kwargs.pop(&#39;ori&#39;, &#39;vert&#39;))</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ori&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;grid&#39;</span>
        <span class="c1"># kwargs[&#39;margin&#39;] = 1</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AnnotStateDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="AnnotStateDialog.initialize"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotStateDialog.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibs</span><span class="p">,</span> <span class="n">aid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibs</span>

        <span class="n">const</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">const</span>
        <span class="n">valid_quals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">QUALITY_TEXT_TO_INT</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">valid_views</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">VIEW</span><span class="o">.</span><span class="n">CODE_TO_NICE</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">valid_quals</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial_order</span><span class="p">(</span><span class="n">valid_quals</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;good&#39;</span><span class="p">,</span> <span class="s1">&#39;poor&#39;</span><span class="p">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">])</span>
        <span class="n">valid_views</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial_order</span><span class="p">(</span><span class="n">valid_views</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;front&#39;</span><span class="p">])</span>

        <span class="n">row_counter</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_counter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Aid:&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aid_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="n">align</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_counter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Quality:&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qual_combo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewComboBox</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="n">valid_quals</span><span class="p">,</span> <span class="n">editor_mode</span><span class="o">=</span><span class="s1">&#39;hybrid&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">columnSpan</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">adjustSizePolicy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qual_combo</span><span class="p">,</span> <span class="n">hStretch</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_counter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Viewpoint:&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view_combo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewComboBox</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="n">valid_views</span><span class="p">,</span>  <span class="n">editor_mode</span><span class="o">=</span><span class="s1">&#39;hybrid&#39;</span><span class="p">,</span>
            <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">columnSpan</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">adjustSizePolicy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view_combo</span><span class="p">,</span> <span class="n">hStretch</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_counter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Multiple:&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ismulti_cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewCheckBox</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">columnSpan</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                              <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;RightToLeft&#39;</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_counter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Tags:&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="c1"># tag_box.addNewSpacer(hPolicy=&#39;Expanding&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_edit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewTagEdit</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">columnSpan</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_edit</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">newSizePolicy</span><span class="p">(</span>
            <span class="n">hSizePolicy</span><span class="o">=</span><span class="s1">&#39;Expanding&#39;</span><span class="p">,</span> <span class="n">vSizePolicy</span><span class="o">=</span><span class="s1">&#39;Fixed&#39;</span><span class="p">,</span>
            <span class="n">hStretch</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>

        <span class="c1"># self.addNewSpacer(hPolicy=&#39;Preferred&#39;, vPolicy=&#39;Preferred&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_all_margins</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># gt.set_qt_object_names(locals())</span>
        <span class="c1"># gt.set_qt_object_names(vars(self))</span>

        <span class="k">if</span> <span class="n">aid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_aid</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span></div>

    <span class="c1"># def _new_form_hbox(self, text, ori=&#39;horiz&#39;):</span>
    <span class="c1">#     # form_box = self.addNewWidget(ori=ori, margin=1)</span>
    <span class="c1">#     label = form_box.addNewLabel(text, align=&#39;left&#39;)</span>
    <span class="c1">#     # gt.adjustSizePolicy(label, hStretch=1)</span>
    <span class="c1">#     # label.setObjectName(&#39;form_box_label_&#39; + text)</span>
    <span class="c1">#     # form_box.addNewSpacer(hPolicy=&#39;Preferred&#39;, vPolicy=&#39;Preferred&#39;)</span>
    <span class="c1">#     return form_box</span>

<div class="viewcode-block" id="AnnotStateDialog.set_aid"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotStateDialog.set_aid">[docs]</a>    <span class="k">def</span> <span class="nf">set_aid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aid</span><span class="p">):</span>
        <span class="c1"># read ibeis state</span>
        <span class="c1"># TODO: allow read from infr graph node attributes</span>
        <span class="c1"># Set qt state</span>
        <span class="kn">import</span> <span class="nn">datetime</span>
        <span class="n">annot_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibeis_read</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>

        <span class="n">unixtime</span> <span class="o">=</span> <span class="n">annot_state</span><span class="p">[</span><span class="s1">&#39;image_unixtimes_asfloat&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">unixtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">unixtime</span><span class="p">):</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">unixtime</span><span class="p">)</span>
            <span class="n">timestr</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">timestr</span> <span class="o">=</span> <span class="s1">&#39;NaN&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">timestr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig_state</span> <span class="o">=</span> <span class="n">annot_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aid_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">annot_state</span><span class="p">[</span><span class="s1">&#39;aid&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qual_combo</span><span class="o">.</span><span class="n">setCurrentValue</span><span class="p">(</span><span class="n">annot_state</span><span class="p">[</span><span class="s1">&#39;quality_texts&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view_combo</span><span class="o">.</span><span class="n">setCurrentValue</span><span class="p">(</span><span class="n">annot_state</span><span class="p">[</span><span class="s1">&#39;viewpoint_code&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ismulti_cb</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">annot_state</span><span class="p">[</span><span class="s1">&#39;multiple&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_edit</span><span class="o">.</span><span class="n">setTags</span><span class="p">(</span><span class="n">annot_state</span><span class="p">[</span><span class="s1">&#39;case_tags&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="AnnotStateDialog.ibeis_read"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotStateDialog.ibeis_read">[docs]</a>    <span class="k">def</span> <span class="nf">ibeis_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aid</span><span class="p">):</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">annot</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">annots</span><span class="p">([</span><span class="n">aid</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">annot_dict</span> <span class="o">=</span> <span class="n">annot</span><span class="o">.</span><span class="n">_make_lazy_dict</span><span class="p">()</span>
        <span class="n">annot_state</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_subset</span><span class="p">(</span><span class="n">annot_dict</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;aid&#39;</span><span class="p">,</span> <span class="s1">&#39;quality_texts&#39;</span><span class="p">,</span> <span class="s1">&#39;viewpoint_code&#39;</span><span class="p">,</span> <span class="s1">&#39;case_tags&#39;</span><span class="p">,</span> <span class="s1">&#39;multiple&#39;</span><span class="p">,</span>
            <span class="s1">&#39;image_unixtimes_asfloat&#39;</span>
        <span class="p">])</span>
        <span class="k">if</span> <span class="n">annot_state</span><span class="p">[</span><span class="s1">&#39;quality_texts&#39;</span><span class="p">]</span>  <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">annot_state</span><span class="p">[</span><span class="s1">&#39;quality_texts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">QUAL_UNKNOWN</span>
        <span class="k">if</span> <span class="n">annot_state</span><span class="p">[</span><span class="s1">&#39;viewpoint_code&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">annot_state</span><span class="p">[</span><span class="s1">&#39;viewpoint_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">VIEW</span><span class="o">.</span><span class="n">CODE</span><span class="o">.</span><span class="n">UNKNOWN</span>
        <span class="k">return</span> <span class="n">annot_state</span></div>

<div class="viewcode-block" id="AnnotStateDialog.current_annot_state"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotStateDialog.current_annot_state">[docs]</a>    <span class="k">def</span> <span class="nf">current_annot_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;aid&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aid_label</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s1">&#39;quality_texts&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">qual_combo</span><span class="o">.</span><span class="n">currentValue</span><span class="p">(),</span>
            <span class="s1">&#39;viewpoint_code&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">view_combo</span><span class="o">.</span><span class="n">currentValue</span><span class="p">(),</span>
            <span class="s1">&#39;case_tags&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_edit</span><span class="o">.</span><span class="n">tags</span><span class="p">(),</span>
            <span class="s1">&#39;multiple&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ismulti_cb</span><span class="o">.</span><span class="n">isChecked</span><span class="p">(),</span>
        <span class="p">}</span></div></div>


<div class="viewcode-block" id="EdgeReviewDialog"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeReviewDialog">[docs]</a><span class="k">class</span> <span class="nc">EdgeReviewDialog</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">GuitoolWidget</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    python -m ibeis.viz.viz_graph2 EdgeReviewDialog --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.viz.viz_graph2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import guitool as gt</span>
<span class="sd">        &gt;&gt;&gt; gt.ensure_qapp()</span>
<span class="sd">        &gt;&gt;&gt; self = EdgeReviewDialog(edge=(1, 2))</span>
<span class="sd">        &gt;&gt;&gt; gt.qtapp_loop(qwin=self, freq=10)</span>
<span class="sd">        &gt;&gt;&gt; print(self.feedback_dict())</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># def _new_form_hbox(self, text):</span>
    <span class="c1">#     form_box = self.addNewWidget(ori=&#39;horiz&#39;, margin=1)</span>
    <span class="c1">#     label = form_box.addNewLabel(text, align=&#39;left&#39;)</span>
    <span class="c1">#     label.setObjectName(&#39;form_box_label_&#39; + text)</span>
    <span class="c1">#     gt.adjustSizePolicy(form_box, vStretch=1, vPolicy=&#39;Preferred&#39;)</span>
    <span class="c1">#     return form_box</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ori&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;grid&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EdgeReviewDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="EdgeReviewDialog.initialize"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeReviewDialog.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edge_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conf_editor</span><span class="o">=</span><span class="s1">&#39;hybrid&#39;</span><span class="p">,</span>
                   <span class="n">with_confirm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># from guitool.__PYQT__ import QtWidgets</span>
        <span class="kn">import</span> <span class="nn">ibeis</span>

        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_user_name</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;@&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_computer_name</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;:qt&#39;</span>

        <span class="n">EVIDENCE_DECISION</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">EVIDENCE_DECISION</span>
        <span class="c1"># TODO: meta decision</span>
        <span class="n">CONFIDENCE</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">CONFIDENCE</span>

        <span class="n">match_state_codes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">EVIDENCE_DECISION</span><span class="o">.</span><span class="n">CODE_TO_INT</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">user_conf_codes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">CONFIDENCE</span><span class="o">.</span><span class="n">CODE_TO_INT</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">match_state_codes</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial_order</span><span class="p">(</span><span class="n">match_state_codes</span><span class="p">,</span> <span class="p">[</span><span class="n">POSTV</span><span class="p">,</span> <span class="n">NEGTV</span><span class="p">])</span>
        <span class="n">user_conf_codes</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial_order</span><span class="p">(</span><span class="n">user_conf_codes</span><span class="p">,</span>
                                           <span class="c1"># [&#39;absolutely_sure&#39;, &#39;not_sure&#39;]</span>
                                           <span class="p">[</span><span class="s1">&#39;pretty_sure&#39;</span><span class="p">,</span> <span class="s1">&#39;not_sure&#39;</span><span class="p">]</span>
                                           <span class="p">)</span>
        <span class="n">match_state_options</span> <span class="o">=</span> <span class="p">[(</span><span class="n">EVIDENCE_DECISION</span><span class="o">.</span><span class="n">CODE_TO_NICE</span><span class="p">[</span><span class="n">code</span><span class="p">],</span> <span class="n">code</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">match_state_codes</span><span class="p">]</span>
        <span class="n">user_conf_options</span> <span class="o">=</span> <span class="p">[(</span><span class="n">CONFIDENCE</span><span class="o">.</span><span class="n">CODE_TO_NICE</span><span class="p">[</span><span class="n">code</span><span class="p">],</span> <span class="n">code</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">user_conf_codes</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_all_margins</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">row_counter</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_counter</span><span class="p">)</span>
        <span class="n">edge_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Edge:&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="n">align</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_counter</span><span class="p">)</span>
        <span class="n">state_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Decision:&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">match_state_combo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewComboBox</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="n">match_state_options</span><span class="p">,</span> <span class="n">editor_mode</span><span class="o">=</span><span class="s1">&#39;hybrid&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="c1"># self.match_state_combo.setStyleSheet(</span>
        <span class="c1">#     &#39;&#39;&#39;</span>
        <span class="c1">#     QRadioButton {</span>
        <span class="c1">#     text: &quot;Bottom&quot;</span>
        <span class="c1">#     }</span>
        <span class="c1">#     &#39;&#39;&#39;</span>
        <span class="c1"># )</span>

        <span class="c1"># tags_row = self.addNewWidget(ori=&#39;horiz&#39;, margin=1)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_counter</span><span class="p">)</span>
        <span class="n">tags_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Other:&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">tags_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewHWidget</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># tags_row.addNewSpacer(hPolicy=&#39;Expanding&#39;, vPolicy=&#39;Fixed&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_checkboxes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">tagname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;photobomb&#39;</span><span class="p">,</span> <span class="s1">&#39;scenerymatch&#39;</span><span class="p">]:</span>
            <span class="n">checkbox</span> <span class="o">=</span> <span class="n">tags_row</span><span class="o">.</span><span class="n">addNewCheckBox</span><span class="p">(</span><span class="n">tagname</span><span class="p">)</span>
            <span class="n">checkbox</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s1">&#39;tag_cb_&#39;</span> <span class="o">+</span> <span class="n">tagname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag_checkboxes</span><span class="p">[</span><span class="n">tagname</span><span class="p">]</span> <span class="o">=</span> <span class="n">checkbox</span>

        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_counter</span><span class="p">)</span>
        <span class="n">pairtag_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Tags:&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pairtag_edit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewTagEdit</span><span class="p">()</span>

        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_counter</span><span class="p">)</span>
        <span class="n">conf_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;Confidence:&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_combo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewComboBox</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="n">user_conf_options</span><span class="p">,</span> <span class="n">editor_mode</span><span class="o">=</span><span class="n">conf_editor</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span>
            <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_counter</span><span class="p">)</span>
        <span class="n">user_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;User-ID:&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_edit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewLineEdit</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># self.addNewSpacer(hPolicy=&#39;Expanding&#39;, vPolicy=&#39;Expanding&#39;)</span>

        <span class="k">if</span> <span class="n">with_confirm</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_counter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewWidget</span><span class="p">(</span><span class="n">ori</span><span class="o">=</span><span class="s1">&#39;horiz&#39;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span>
                                                <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">columnSpan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button_row</span><span class="o">.</span><span class="n">_guitool_layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignBottom</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">confirm_button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button_row</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span>
                <span class="s1">&#39;Confirm&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">confirm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancel_button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">button_row</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span>
                <span class="s1">&#39;Cancel&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
            <span class="c1"># gt.adjustSizePolicy(self.button_row, vStretch=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">was_confirmed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># gt.adjustSizePolicy(edge_row, vStretch=1)</span>
        <span class="c1"># gt.adjustSizePolicy(state_row, vStretch=1)</span>
        <span class="c1"># gt.adjustSizePolicy(tags_row, vStretch=1)</span>
        <span class="c1"># gt.adjustSizePolicy(conf_row, vStretch=1)</span>
        <span class="c1"># gt.adjustSizePolicy(user_row, vStretch=1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_all_margins</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">gt</span><span class="o">.</span><span class="n">set_qt_object_names</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">set_qt_object_names</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span></div>

<div class="viewcode-block" id="EdgeReviewDialog.keyPressEvent"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeReviewDialog.keyPressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">keyPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Got event&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">())</span>
        <span class="n">handled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">gt</span><span class="o">.</span><span class="n">__PYQT__</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_F</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">match_state_combo</span><span class="o">.</span><span class="n">setCurrentValue</span><span class="p">(</span><span class="n">NEGTV</span><span class="p">)</span>
            <span class="n">handled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">gt</span><span class="o">.</span><span class="n">__PYQT__</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_T</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">match_state_combo</span><span class="o">.</span><span class="n">setCurrentValue</span><span class="p">(</span><span class="n">POSTV</span><span class="p">)</span>
            <span class="n">handled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">gt</span><span class="o">.</span><span class="n">__PYQT__</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_N</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">match_state_combo</span><span class="o">.</span><span class="n">setCurrentValue</span><span class="p">(</span><span class="n">INCMP</span><span class="p">)</span>
            <span class="n">handled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">gt</span><span class="o">.</span><span class="n">__PYQT__</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_P</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">match_state_combo</span><span class="o">.</span><span class="n">setCurrentValue</span><span class="p">(</span><span class="n">NEGTV</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag_checkboxes</span><span class="p">[</span><span class="s1">&#39;photobomb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">handled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">handled</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">EdgeReviewDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="EdgeReviewDialog.read_edge_state"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeReviewDialog.read_edge_state">[docs]</a>    <span class="k">def</span> <span class="nf">read_edge_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">):</span>
        <span class="n">edge_state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;edge&#39;</span><span class="p">:</span> <span class="n">edge</span><span class="p">,</span>
            <span class="s1">&#39;evidence_decision&#39;</span><span class="p">:</span> <span class="n">UNREV</span><span class="p">,</span>
            <span class="s1">&#39;meta_decision&#39;</span><span class="p">:</span> <span class="s1">&#39;null&#39;</span><span class="p">,</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="s1">&#39;user:&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_edit</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
            <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;timestamp_c1&#39;</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_timestamp</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="n">isutc</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="c1"># &#39;confidence&#39;: &#39;unspecified&#39;</span>
            <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">const</span><span class="o">.</span><span class="n">CONFIDENCE</span><span class="o">.</span><span class="n">CODE</span><span class="o">.</span><span class="n">NOT_SURE</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;edge_data = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">edge_data</span><span class="p">),))</span>
        <span class="k">if</span> <span class="n">edge_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Read edge state from edge_data</span>
            <span class="n">edge_state</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">edge_state</span><span class="p">[</span><span class="s1">&#39;evidence_decision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;evidence_decision&#39;</span><span class="p">,</span> <span class="n">UNREV</span><span class="p">)</span>
            <span class="c1"># Use previous confidence if you are the same user</span>
            <span class="k">if</span> <span class="n">edge_state</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">edge_state</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s1">&#39;confidence&#39;</span><span class="p">,</span> <span class="n">edge_state</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">edge_state</span></div>

<div class="viewcode-block" id="EdgeReviewDialog.set_edge"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeReviewDialog.set_edge">[docs]</a>    <span class="k">def</span> <span class="nf">set_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">edge_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Set Edge State: edge=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">edge</span><span class="p">,))</span>
        <span class="n">edge_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_edge_state</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">edge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Edge must be 2 ints&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;edge_state = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">edge_state</span><span class="p">),))</span>
        <span class="c1"># set qt state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge</span> <span class="o">=</span> <span class="n">edge_state</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">edge_state</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">match_state_combo</span><span class="o">.</span><span class="n">setCurrentValue</span><span class="p">(</span><span class="n">edge_state</span><span class="p">[</span><span class="s1">&#39;evidence_decision&#39;</span><span class="p">])</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">edge_state</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">]</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tags</span><span class="p">[:]</span>
        <span class="n">remaining_tags</span> <span class="o">=</span> <span class="n">tags</span><span class="p">[:]</span>
        <span class="k">for</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">checkbox</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_checkboxes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">tagname</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
                <span class="n">checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">remaining_tags</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tagname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pairtag_edit</span><span class="o">.</span><span class="n">setTags</span><span class="p">(</span><span class="n">remaining_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_combo</span><span class="o">.</span><span class="n">setCurrentValue</span><span class="p">(</span><span class="n">edge_state</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_c1</span> <span class="o">=</span> <span class="n">edge_state</span><span class="p">[</span><span class="s1">&#39;timestamp_c1&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="EdgeReviewDialog.cancel"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeReviewDialog.cancel">[docs]</a>    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">was_confirmed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="EdgeReviewDialog.confirm"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeReviewDialog.confirm">[docs]</a>    <span class="k">def</span> <span class="nf">confirm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">was_confirmed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="EdgeReviewDialog.feedback_dict"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeReviewDialog.feedback_dict">[docs]</a>    <span class="k">def</span> <span class="nf">feedback_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">ibeis</span>
        <span class="n">decision_nice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_state_combo</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">conf_nice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_combo</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">decision_code</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">EVIDENCE_DECISION</span><span class="o">.</span><span class="n">NICE_TO_CODE</span><span class="p">[</span><span class="n">decision_nice</span><span class="p">]</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_checkboxes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">check</span><span class="o">.</span><span class="n">checkState</span><span class="p">()]</span>
        <span class="n">tags</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairtag_edit</span><span class="o">.</span><span class="n">tags</span><span class="p">()</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tags</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">confidence</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">CONFIDENCE</span><span class="o">.</span><span class="n">NICE_TO_CODE</span><span class="p">[</span><span class="n">conf_nice</span><span class="p">]</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;edge&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge</span><span class="p">,</span>
            <span class="c1"># &#39;aid1&#39;: self.edge[0],</span>
            <span class="c1"># &#39;aid2&#39;: self.edge[1],</span>
            <span class="s1">&#39;evidence_decision&#39;</span><span class="p">:</span> <span class="n">decision_code</span><span class="p">,</span>
            <span class="s1">&#39;timestamp_c1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_c1</span><span class="p">,</span>
            <span class="s1">&#39;timestamp_c2&#39;</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_timestamp</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="n">isutc</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="n">tags</span><span class="p">,</span>
            <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">confidence</span><span class="p">,</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="s1">&#39;user:&#39;</span> <span class="o">+</span> <span class="n">user_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">feedback</span></div></div>


<div class="viewcode-block" id="DevGraphWidget"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget">[docs]</a><span class="k">class</span> <span class="nc">DevGraphWidget</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">GuitoolWidget</span><span class="p">):</span>
    <span class="n">signal_graph_update</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>

<div class="viewcode-block" id="DevGraphWidget.emit_graph_update"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.emit_graph_update">[docs]</a>    <span class="k">def</span> <span class="nf">emit_graph_update</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">):</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">on_graph_update</span><span class="p">()</span></div>

<div class="viewcode-block" id="DevGraphWidget.init_signals_and_slots"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.init_signals_and_slots">[docs]</a>    <span class="k">def</span> <span class="nf">init_signals_and_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># https://doc.qt.io/archives/qtjambi-4.5.2_01/com/trolltech/qt/core/Qt.ConnectionType.html</span>
        <span class="c1"># connection_type = QtCore.Qt.AutoConnection</span>
        <span class="c1"># connection_type = QtCore.Qt.BlockingQueuedConnection</span>
        <span class="n">connection_type</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DirectConnection</span>
        <span class="c1"># connection_type = QtCore.Qt.QueuedConnection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal_graph_update</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_graph_update</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">connection_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="DevGraphWidget.initialize"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">,</span> <span class="n">use_image</span><span class="p">,</span> <span class="n">self_parent</span><span class="p">):</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">self_parent</span> <span class="o">=</span> <span class="n">self_parent</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">plotinfo</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_needs_update</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">addNewSplitter</span><span class="p">(</span>
            <span class="n">ori</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">ctrls_</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">addNewWidget</span><span class="p">(</span>
            <span class="n">ori</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">,</span> <span class="n">verticalStretch</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">ctrls</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">ctrls_</span><span class="o">.</span><span class="n">addNewSplitter</span><span class="p">(</span>
            <span class="n">ori</span><span class="o">=</span><span class="s1">&#39;vert&#39;</span><span class="p">)</span>

        <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span> <span class="o">=</span> <span class="n">mpl_widget</span><span class="o">.</span><span class="n">MatplotlibWidget</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">graph_widget</span><span class="p">,</span> <span class="n">horizontalStretch</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pan_and_zoom</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="p">)</span>

        <span class="n">ctrls</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">ctrls</span>
        <span class="n">bbar1</span> <span class="o">=</span> <span class="n">ctrls</span><span class="o">.</span><span class="n">addNewWidget</span><span class="p">(</span><span class="n">ori</span><span class="o">=</span><span class="s1">&#39;vert&#39;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bbar2</span> <span class="o">=</span> <span class="n">ctrls</span><span class="o">.</span><span class="n">addNewWidget</span><span class="p">(</span><span class="n">ori</span><span class="o">=</span><span class="s1">&#39;vert&#39;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">graph_widget</span><span class="o">.</span><span class="n">mark_state_funcs</span> <span class="o">=</span> <span class="n">self_parent</span><span class="o">.</span><span class="n">make_mark_state_funcs</span><span class="p">(</span>
            <span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_graph_pairs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">mark_state_funcs</span><span class="p">:</span>
            <span class="n">bbar1</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">pressed</span><span class="o">=</span><span class="n">func</span><span class="p">)</span>

        <span class="n">bbar1</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Deselect&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">deselect</span><span class="p">)</span>
        <span class="n">bbar1</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Show Annots&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">show_selected</span><span class="p">)</span>

        <span class="n">small_graph</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">self_parent</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">aids</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">20</span>

        <span class="kn">import</span> <span class="nn">ibeis</span>
        <span class="n">GraphVizConfig</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">AnnotInference</span><span class="o">.</span><span class="n">make_viz_config</span><span class="p">(</span><span class="n">use_image</span><span class="p">,</span> <span class="n">small_graph</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">on_graphviz_config_changed</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;pin_positions&#39;</span><span class="p">:</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">set_pin_state</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">graphviz_config</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">emit_graph_update</span><span class="p">()</span>

        <span class="n">graph_widget</span><span class="o">.</span><span class="n">graphviz_config</span> <span class="o">=</span> <span class="n">GraphVizConfig</span><span class="p">()</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">graphviz_config_widget</span> <span class="o">=</span> <span class="n">PrefWidget2</span><span class="o">.</span><span class="n">EditConfigWidget</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">graphviz_config</span><span class="p">,</span> <span class="n">with_buttons</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">changed</span><span class="o">=</span><span class="n">on_graphviz_config_changed</span><span class="p">)</span>
        <span class="c1"># remove headers</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">graphviz_config_widget</span><span class="o">.</span><span class="n">tree_view</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="n">bbar2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">graphviz_config_widget</span><span class="p">)</span>

        <span class="c1"># Connect signals and slots</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">click_inside_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">on_click_inside</span><span class="p">)</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">key_press_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">on_key_press</span><span class="p">)</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">pick_event_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">on_pick</span><span class="p">)</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">setSizes</span><span class="p">([</span><span class="mi">30</span><span class="p">,</span> <span class="mi">70</span><span class="p">])</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">init_signals_and_slots</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">infr</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">self_parent</span><span class="o">.</span><span class="n">infr</span>

<div class="viewcode-block" id="DevGraphWidget.on_graph_update"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.on_graph_update">[docs]</a>    <span class="k">def</span> <span class="nf">on_graph_update</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">):</span>
        <span class="c1"># ut.cprint(&#39;[graph] on_graph_update&#39;, &#39;green&#39;)</span>
        <span class="k">if</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">visibleRegion</span><span class="p">()</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="c1"># Flag that graph should draw next time it is visible</span>
            <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_needs_update</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Draw the graph because it is visible</span>
            <span class="n">graph_widget</span><span class="o">.</span><span class="n">draw_graph</span><span class="p">()</span></div>

<div class="viewcode-block" id="DevGraphWidget.draw_graph"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.draw_graph">[docs]</a>    <span class="k">def</span> <span class="nf">draw_graph</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">):</span>
        <span class="c1"># Is it possible to make things more responsive with threads?</span>
        <span class="c1"># http://stackoverflow.com/questions/20324804/how-to-use-qthread-correctly-in-pyqt-with-movetothread</span>
        <span class="c1"># self.my_thread = QtCore.QThread()</span>
        <span class="c1"># self.my_thread.start()</span>
        <span class="c1"># self.graph_widget.moveToThread(self.my_thread)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[graph] draw_graph&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_needs_update</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>

        <span class="n">visibility_kw</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">graphviz_config</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>

        <span class="n">visibility_kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pin_positions&#39;</span><span class="p">)</span>
        <span class="n">in_image</span> <span class="o">=</span> <span class="n">visibility_kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;in_image&#39;</span><span class="p">)</span>
        <span class="n">use_image</span> <span class="o">=</span> <span class="n">visibility_kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;show_image&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_image</span><span class="p">:</span>
            <span class="n">graph_widget</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">update_node_image_config</span><span class="p">(</span><span class="n">in_image</span><span class="o">=</span><span class="n">in_image</span><span class="p">)</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">update_visual_attrs</span><span class="p">(</span>
            <span class="o">**</span><span class="n">visibility_kw</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">graph_widget</span><span class="o">.</span><span class="n">plotinfo</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">show_nx</span><span class="p">(</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;custom&#39;</span><span class="p">,</span> <span class="n">as_directed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">use_image</span><span class="o">=</span><span class="n">use_image</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">graph_widget</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">initialize_visual_node_attrs</span><span class="p">()</span>
            <span class="n">graph_widget</span><span class="o">.</span><span class="n">plotinfo</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">show_nx</span><span class="p">(</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;custom&#39;</span><span class="p">,</span> <span class="n">as_directed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">use_image</span><span class="o">=</span><span class="n">use_image</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span><span class="p">:</span>
            <span class="n">graph_widget</span><span class="o">.</span><span class="n">highlight_aid</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=.</span><span class="mi">02</span><span class="p">,</span> <span class="n">top</span><span class="o">=.</span><span class="mi">98</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=.</span><span class="mi">02</span><span class="p">,</span>
                                                 <span class="n">right</span><span class="o">=.</span><span class="mi">85</span><span class="p">)</span></div>

<div class="viewcode-block" id="DevGraphWidget.set_pin_state"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.set_pin_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_pin_state</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pin&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">nx_delete_node_attr</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;pin&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DevGraphWidget.selected_graph_pairs"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.selected_graph_pairs">[docs]</a>    <span class="k">def</span> <span class="nf">selected_graph_pairs</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="DevGraphWidget.show_selected"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.show_selected">[docs]</a>    <span class="k">def</span> <span class="nf">show_selected</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[graph_widget] show_selected&#39;</span><span class="p">)</span>
        <span class="c1"># old = getattr(graph_widget, &#39;_figscope&#39;, None)</span>
        <span class="c1"># if old is not None:</span>
        <span class="c1">#     old.close()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">edge</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span><span class="p">))</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="n">AnnotPairDialog</span><span class="p">(</span><span class="n">infr</span><span class="o">=</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">infr</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="n">edge</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activateWindow</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
            <span class="n">graph_widget</span><span class="o">.</span><span class="n">_figscope</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># fnum = pt.ensure_fnum(10)</span>
            <span class="c1"># print(&#39;fnum = %r&#39; % (fnum,))</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">draw_aids</span><span class="p">(</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="c1"># fig = pt.figure(fnum=fnum)</span>
            <span class="c1"># viz_chip.show_many_chips(</span>
            <span class="c1">#     graph_widget.infr.ibs,</span>
            <span class="c1">#     graph_widget.selected_aids,</span>
            <span class="c1">#     fnum=fnum</span>
            <span class="c1"># )</span>
            <span class="c1">#fig.canvas.update()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="n">graph_widget</span><span class="o">.</span><span class="n">_figscope</span> <span class="o">=</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="DevGraphWidget.highlight_aid"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.highlight_aid">[docs]</a>    <span class="k">def</span> <span class="nf">highlight_aid</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">,</span> <span class="n">aid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># TODO: move to mpl widget</span>
        <span class="k">if</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">plotinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">aid</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">plotinfo</span><span class="p">[</span><span class="s1">&#39;patch_frame_dict&#39;</span><span class="p">][</span><span class="n">node</span><span class="p">]</span>
        <span class="n">node_dict</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">nx_node_dict</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>

        <span class="n">framewidth</span> <span class="o">=</span> <span class="n">node_dict</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;framewidth&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ORANGE</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">DARK_BLUE</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">node_dict</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ensure_nonhex_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">framewidth</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">framewidth</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span></div>

<div class="viewcode-block" id="DevGraphWidget.deselect"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.deselect">[docs]</a>    <span class="k">def</span> <span class="nf">deselect</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[graph_widget] deselect&#39;</span><span class="p">)</span>
        <span class="c1"># print(&#39;graph_widget.selected_aids = %r&#39; % (graph_widget.selected_aids,))</span>
        <span class="n">graph_widget</span><span class="o">.</span><span class="n">toggle_selected_aid</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span><span class="p">[:])</span></div>

<div class="viewcode-block" id="DevGraphWidget.toggle_selected_aid"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.toggle_selected_aid">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_selected_aid</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">,</span> <span class="n">aids</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[graph_widget] toggle_selected_aid&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">aids</span><span class="p">):</span>
            <span class="c1"># TODO: move to mpl widget</span>
            <span class="k">if</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span><span class="p">:</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
                <span class="c1">#graph_widget.highlight_aid(aid, pt.WHITE)</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">highlight_aid</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">highlight_aid</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;graph_widget.selected_aids = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="DevGraphWidget.show_popup_menu"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.show_popup_menu">[docs]</a>    <span class="k">def</span> <span class="nf">show_popup_menu</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        context menu</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
        <span class="n">qpoint</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">newQPoint</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">qwin</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_wgt</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">popup_menu</span><span class="p">(</span><span class="n">qwin</span><span class="p">,</span> <span class="n">qpoint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="DevGraphWidget.on_key_press"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.on_key_press">[docs]</a>    <span class="k">def</span> <span class="nf">on_key_press</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1"># called by matplotlib events</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">option_dict</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">make_option_dict</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">mark_state_funcs</span><span class="p">,</span>
                                          <span class="n">shortcuts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s1">&#39;D&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">option_dict</span>
        <span class="n">option_dict</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">deselect</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">option_dict</span><span class="p">:</span>
            <span class="n">option_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]()</span></div>

<div class="viewcode-block" id="DevGraphWidget.on_pick"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.on_pick">[docs]</a>    <span class="k">def</span> <span class="nf">on_pick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">artist</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">artist</span>
        <span class="n">plotdat</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">get_plotdat_dict</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>
        <span class="n">infr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">self_parent</span><span class="o">.</span><span class="n">infr</span>
        <span class="k">if</span> <span class="n">plotdat</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;node&#39;</span> <span class="ow">in</span> <span class="n">plotdat</span><span class="p">:</span>
                <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">all_node_data</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">sort_dict</span><span class="p">(</span><span class="n">plotdat</span><span class="p">[</span><span class="s1">&#39;node_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
                    <span class="n">visual_node_data</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_subset</span><span class="p">(</span><span class="n">all_node_data</span><span class="p">,</span> <span class="n">infr</span><span class="o">.</span><span class="n">visual_node_attrs</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">node_data</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">delete_dict_keys</span><span class="p">(</span><span class="n">all_node_data</span><span class="p">,</span> <span class="n">infr</span><span class="o">.</span><span class="n">visual_node_attrs</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;visual_node_data: &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">visual_node_data</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;node_data: &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">node_data</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;node: &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">plotdat</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="s1">&#39;edge&#39;</span> <span class="ow">in</span> <span class="n">plotdat</span><span class="p">:</span>
                <span class="n">all_edge_data</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">sort_dict</span><span class="p">(</span><span class="n">plotdat</span><span class="p">[</span><span class="s1">&#39;edge_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
                <span class="n">visual_edge_data</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_subset</span><span class="p">(</span><span class="n">all_edge_data</span><span class="p">,</span> <span class="n">infr</span><span class="o">.</span><span class="n">visual_edge_attrs</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">edge_data</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">delete_dict_keys</span><span class="p">(</span><span class="n">all_edge_data</span><span class="p">,</span> <span class="n">infr</span><span class="o">.</span><span class="n">visual_edge_attrs</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;visual_edge_data: &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">visual_edge_data</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;edge_data: &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">edge_data</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;edge: &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">plotdat</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unknown artist &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">plotdat</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;artist = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">artist</span><span class="p">,))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;event = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">event</span><span class="p">,))</span></div>

<div class="viewcode-block" id="DevGraphWidget.on_click_inside"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.on_click_inside">[docs]</a>    <span class="k">def</span> <span class="nf">on_click_inside</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">plotinfo</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pos_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_take</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>

        <span class="c1"># TODO: FIXME</span>
        <span class="c1">#x = 10</span>
        <span class="c1">#y = 10</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
        <span class="n">point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
        <span class="n">pos_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos_list</span><span class="p">)</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">closest_point</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">pos_list</span><span class="p">,</span> <span class="n">distfunc</span><span class="o">=</span><span class="n">vt</span><span class="o">.</span><span class="n">L2</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="n">node</span>
        <span class="n">context_shown</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">context_shown</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This funciton only work if exactly 2 are selected&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">context_shown</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">selected_aids</span>
                <span class="n">aid_pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">)]</span>
                <span class="n">options</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">self_parent</span><span class="o">.</span><span class="n">get_edge_options</span><span class="p">(</span><span class="n">aid_pairs</span><span class="p">)</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">show_popup_menu</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

        <span class="n">bbox</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">bbox_from_center_wh</span><span class="p">(</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">plotinfo</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="n">node</span><span class="p">],</span>
                                      <span class="n">graph_widget</span><span class="o">.</span><span class="n">plotinfo</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">][</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="n">node</span><span class="p">])</span>
        <span class="n">annot_selected</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">point_inside_bbox</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">bbox</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">annot_selected</span><span class="p">:</span>
            <span class="n">ibs</span> <span class="o">=</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">ibs</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_info</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                <span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gname</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">toggle_selected_aid</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">context_shown</span><span class="p">:</span>
                <span class="c1"># right click</span>
                <span class="kn">from</span> <span class="nn">ibeis.viz.interact</span> <span class="k">import</span> <span class="n">interact_chip</span>
                <span class="n">context_shown</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1">#refresh_func = functools.partial(viz.show_name, ibs, nid,</span>
                <span class="c1">#fnum=fnum, sel_aids=sel_aids)</span>
                <span class="n">refresh_func</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">config2_</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">options</span> <span class="o">=</span> <span class="n">interact_chip</span><span class="o">.</span><span class="n">build_annot_context_options</span><span class="p">(</span>
                    <span class="n">graph_widget</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid</span><span class="p">,</span> <span class="n">refresh_func</span><span class="o">=</span><span class="n">refresh_func</span><span class="p">,</span>
                    <span class="n">with_interact_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">config2_</span><span class="o">=</span><span class="n">config2_</span><span class="p">)</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">show_popup_menu</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="DevGraphWidget.eventFilter"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.DevGraphWidget.eventFilter">[docs]</a>    <span class="k">def</span> <span class="nf">eventFilter</span><span class="p">(</span><span class="n">graph_widget</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QEvent</span><span class="o">.</span><span class="n">Show</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">graph_widget</span><span class="o">.</span><span class="n">mpl_needs_update</span><span class="p">:</span>
                <span class="n">graph_widget</span><span class="o">.</span><span class="n">emit_graph_update</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DevGraphWidget</span><span class="p">,</span> <span class="n">graph_widget</span><span class="p">)</span><span class="o">.</span><span class="n">eventFilter</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AnnotGraphWidget"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget">[docs]</a><span class="k">class</span> <span class="nc">AnnotGraphWidget</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">GuitoolWidget</span><span class="p">):</span>
    <span class="n">signal_state_update</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

<div class="viewcode-block" id="AnnotGraphWidget.initialize"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">init_mode</span><span class="o">=</span><span class="s1">&#39;rereview&#39;</span><span class="p">,</span>
                   <span class="n">review_cfg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz_graph] initialize&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span> <span class="o">=</span> <span class="n">init_mode</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.init_mode = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span><span class="p">,))</span>

        <span class="k">if</span> <span class="n">review_cfg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;filtered&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span> <span class="o">==</span> <span class="s1">&#39;split&#39;</span> <span class="k">else</span> <span class="s1">&#39;unfiltered&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preset_config</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span> <span class="o">=</span> <span class="n">infr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_menus</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">graph_tab_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewTabWidget</span><span class="p">(</span><span class="n">verticalStretch</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statbar1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewWidget</span><span class="p">(</span>
            <span class="n">ori</span><span class="o">=</span><span class="s1">&#39;horiz&#39;</span><span class="p">,</span> <span class="n">verticalStretch</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statbar2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewWidget</span><span class="p">(</span>
            <span class="n">ori</span><span class="o">=</span><span class="s1">&#39;horiz&#39;</span><span class="p">,</span> <span class="n">verticalStretch</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewProgressBar</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_api_tabs</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statbar1</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Match and Score&#39;</span><span class="p">,</span> <span class="n">min_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">match_and_score_edges</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statbar1</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;ScoreVsOne&#39;</span><span class="p">,</span> <span class="n">min_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">score_edges_vsone</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statbar1</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Edit Filters&#39;</span><span class="p">,</span> <span class="n">min_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_filters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statbar1</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Repopulate&#39;</span><span class="p">,</span> <span class="n">min_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repopulate</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statbar2</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Reset DBState&#39;</span><span class="p">,</span> <span class="n">min_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_review</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statbar2</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Reset Rereview&#39;</span><span class="p">,</span> <span class="n">min_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_rereview</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_names_lbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statbar2</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;NUM_NAMES_LBL&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_lbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statbar2</span><span class="o">.</span><span class="n">addNewLabel</span><span class="p">(</span><span class="s1">&#39;STATE_LBL&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statbar2</span><span class="o">.</span><span class="n">addNewButton</span><span class="p">(</span><span class="s1">&#39;Accept&#39;</span><span class="p">,</span> <span class="n">pressed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>

        <span class="c1"># _show_graph = self.init_mode in [&#39;split&#39;, &#39;rereview&#39;, &#39;review&#39;]</span>
        <span class="n">_show_graph</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">_show_graph</span><span class="p">:</span>
            <span class="c1"># TODO: separate graph view into its own class</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_tab_widget</span><span class="o">.</span><span class="n">addNewTab</span><span class="p">(</span><span class="s1">&#39;Graph&#39;</span><span class="p">)</span>
            <span class="c1"># TODO: make this its own proper widget</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span> <span class="o">=</span> <span class="n">DevGraphWidget</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">self_parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                               <span class="n">use_image</span><span class="o">=</span><span class="n">use_image</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_tab</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span><span class="p">)</span>
            <span class="c1"># self.graph_widget.connect_kepress_to_slot</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_tab</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_signals_and_slots</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.init_signals_and_slots"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.init_signals_and_slots">[docs]</a>    <span class="k">def</span> <span class="nf">init_signals_and_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># https://doc.qt.io/archives/qtjambi-4.5.2_01/com/trolltech/qt/core/Qt.ConnectionType.html</span>
        <span class="c1"># connection_type = QtCore.Qt.AutoConnection</span>
        <span class="c1"># connection_type = QtCore.Qt.BlockingQueuedConnection</span>
        <span class="n">connection_type</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DirectConnection</span>
        <span class="c1"># connection_type = QtCore.Qt.QueuedConnection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal_state_update</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_state</span><span class="p">,</span>
                                         <span class="nb">type</span><span class="o">=</span><span class="n">connection_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.initialize_api_tabs"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.initialize_api_tabs">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_api_tabs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_tabs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_widgets</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span> <span class="nf">_add_item_widget_tab</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">view_class</span><span class="o">=</span><span class="s1">&#39;table&#39;</span><span class="p">):</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_tabs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_tab_widget</span><span class="o">.</span><span class="n">addNewTab</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">APIItemWidget</span><span class="p">(</span><span class="n">view_class</span><span class="o">=</span><span class="n">view_class</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_tabs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="n">_add_item_widget_tab</span><span class="p">(</span><span class="s1">&#39;edges&#39;</span><span class="p">)</span>
        <span class="n">_add_item_widget_tab</span><span class="p">(</span><span class="s1">&#39;nodes&#39;</span><span class="p">)</span>
        <span class="n">_add_item_widget_tab</span><span class="p">(</span><span class="s1">&#39;name_nodes&#39;</span><span class="p">,</span> <span class="n">view_class</span><span class="o">=</span><span class="s1">&#39;tree&#39;</span><span class="p">)</span>
        <span class="n">_add_item_widget_tab</span><span class="p">(</span><span class="s1">&#39;name_edges&#39;</span><span class="p">,</span> <span class="n">view_class</span><span class="o">=</span><span class="s1">&#39;tree&#39;</span><span class="p">)</span>

        <span class="n">node_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_widgets</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span>
        <span class="n">node_view</span><span class="o">.</span><span class="n">contextMenuClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_context</span><span class="p">)</span>
        <span class="n">node_view</span><span class="o">.</span><span class="n">connect_single_key_to_slot</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">ALT_KEY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_alt_pressed</span><span class="p">)</span>

        <span class="n">name_node_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_widgets</span><span class="p">[</span><span class="s1">&#39;name_nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span>
        <span class="n">name_node_view</span><span class="o">.</span><span class="n">contextMenuClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_context</span><span class="p">)</span>
        <span class="n">name_node_view</span><span class="o">.</span><span class="n">connect_single_key_to_slot</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">ALT_KEY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_alt_pressed</span><span class="p">)</span>

        <span class="n">edge_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_widgets</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span>
        <span class="n">edge_view</span><span class="o">.</span><span class="n">doubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_doubleclick</span><span class="p">)</span>
        <span class="n">edge_view</span><span class="o">.</span><span class="n">contextMenuClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_context</span><span class="p">)</span>
        <span class="n">edge_view</span><span class="o">.</span><span class="n">connect_keypress_to_slot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_keypress</span><span class="p">)</span>
        <span class="n">edge_view</span><span class="o">.</span><span class="n">connect_single_key_to_slot</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">ALT_KEY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_alt_pressed</span><span class="p">)</span>

        <span class="n">name_edge_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_widgets</span><span class="p">[</span><span class="s1">&#39;name_edges&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span>
        <span class="n">name_edge_view</span><span class="o">.</span><span class="n">doubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_doubleclick</span><span class="p">)</span>
        <span class="n">name_edge_view</span><span class="o">.</span><span class="n">contextMenuClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_context</span><span class="p">)</span>
        <span class="n">name_edge_view</span><span class="o">.</span><span class="n">connect_keypress_to_slot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_keypress</span><span class="p">)</span>
        <span class="n">name_edge_view</span><span class="o">.</span><span class="n">connect_single_key_to_slot</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">ALT_KEY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_alt_pressed</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.populate_edge_model"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.populate_edge_model">[docs]</a>    <span class="k">def</span> <span class="nf">populate_edge_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz_graph] populate_edge_model&#39;</span><span class="p">)</span>
        <span class="c1"># if self.init_mode is None:</span>
        <span class="c1">#     self.review_cfg[&#39;show_match_thumb&#39;] = False</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;edges&#39;</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_tabs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">make_edge_api</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="p">,</span> <span class="n">review_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">make_headers</span><span class="p">(</span><span class="n">tblnice</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">tblname</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">change_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">resize_headers</span><span class="p">(</span><span class="n">api</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">verticalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">widget</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">num_rows_total</span><span class="p">))</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">verticalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setDefaultSectionSize</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.populate_node_model"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.populate_node_model">[docs]</a>    <span class="k">def</span> <span class="nf">populate_node_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz_graph] populate_node_model&#39;</span><span class="p">)</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">make_node_api</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;nodes&#39;</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_tabs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">make_headers</span><span class="p">(</span><span class="n">tblnice</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">tblname</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">change_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">verticalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">verticalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setMovable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">verticalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setSectionsMovable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">widget</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">num_rows_total</span><span class="p">))</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.populate_name_node_model"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.populate_name_node_model">[docs]</a>    <span class="k">def</span> <span class="nf">populate_name_node_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">make_name_node_api</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="p">,</span> <span class="n">review_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;name_nodes&#39;</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_tabs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">make_headers</span><span class="p">(</span><span class="n">tblnice</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">tblname</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">change_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">widget</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">num_rows_total</span><span class="p">))</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.populate_name_edge_model"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.populate_name_edge_model">[docs]</a>    <span class="k">def</span> <span class="nf">populate_name_edge_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">make_name_edge_api</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="p">,</span> <span class="n">review_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;name_edges&#39;</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_tabs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">make_headers</span><span class="p">(</span><span class="n">tblnice</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">tblname</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">change_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">widget</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">num_rows_total</span><span class="p">))</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.initialize_menus"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.initialize_menus">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_menus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menubar</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">newMenubar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menus</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;Dev&#39;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menus</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menubar</span><span class="o">.</span><span class="n">newMenu</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">print_info</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">,</span> <span class="n">shortcut</span><span class="o">=</span><span class="s1">&#39;ctrl+shift+I&#39;</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_image_and_names</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_state_update</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">print_staging_table</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">print_annotmatch_table</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">print_deltas</span><span class="p">)</span>

        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;Actions&#39;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menus</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menubar</span><span class="o">.</span><span class="n">newMenu</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commit_to_staging</span><span class="p">)</span>

        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;Debug&#39;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menus</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menubar</span><span class="o">.</span><span class="n">newMenu</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_ibeis_names</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_staging</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_annotmatch</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ensure_full</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ensure_cliques</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">triggered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vsone_subset</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;relabel_using_reviews&#39;</span><span class="p">,</span> <span class="n">triggered</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">relabel_using_reviews</span><span class="p">())</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">newAction</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;apply_nondynamic_update&#39;</span><span class="p">,</span> <span class="n">triggered</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">apply_nondynamic_update</span><span class="p">())</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.preset_config"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.preset_config">[docs]</a>    <span class="k">def</span> <span class="nf">preset_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;filtered&#39;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[graph] preset_config mode=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;filtered&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span> <span class="o">=</span> <span class="n">GRAPH_REVIEW_CFG_DEFAULTS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;unfiltered&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span> <span class="o">=</span> <span class="n">GRAPH_REVIEW_CFG_DEFAULTS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;filter_&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.showEvent"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.showEvent">[docs]</a>    <span class="k">def</span> <span class="nf">showEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AnnotGraphWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">showEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="s1">&#39;[viz_graph] showEvent&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="c1"># Fire initialize event after we show the GUI</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_inference</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.init_inference"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.init_inference">[docs]</a>    <span class="k">def</span> <span class="nf">init_inference</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz_graph] init_inference mode=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span> <span class="o">==</span> <span class="s1">&#39;split&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preset_config</span><span class="p">(</span><span class="s1">&#39;filtered&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_split</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span> <span class="o">==</span> <span class="s1">&#39;rereview&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preset_config</span><span class="p">(</span><span class="s1">&#39;unfiltered&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_rereview</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span> <span class="o">==</span> <span class="s1">&#39;review&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_review</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown init_mode=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repopulate</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--graphtab&#39;</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_tab_widget</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_tab</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_tab_widget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="c1"># self.graph_tab_widget.setCurrentIndex(2)</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--match&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">ubelt</span> <span class="k">as</span> <span class="nn">ub</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ub</span><span class="o">.</span><span class="n">chunks</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_pair_state</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">POSTV</span><span class="p">)</span>
        <span class="n">nomatch</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--nomatch&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nomatch</span><span class="p">:</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ub</span><span class="o">.</span><span class="n">chunks</span><span class="p">(</span><span class="n">nomatch</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_pair_state</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">NEGTV</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.repopulate"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.repopulate">[docs]</a>    <span class="k">def</span> <span class="nf">repopulate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.update_state(structure_changed=True)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit_state_update</span><span class="p">(</span><span class="n">structure_changed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.emit_state_update"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.emit_state_update">[docs]</a>    <span class="k">def</span> <span class="nf">emit_state_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_changed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">disable_global_update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal_state_update</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">structure_changed</span><span class="p">,</span> <span class="n">disable_global_update</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.update_state"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.update_state">[docs]</a>    <span class="k">def</span> <span class="nf">update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_changed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">disable_global_update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz_graph] update_state mode=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span><span class="p">,))</span>
        <span class="c1">#if self.init_mode in [&#39;split&#39;, &#39;rereview&#39;]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">disable_global_update</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span> <span class="o">==</span> <span class="s1">&#39;split&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">apply_feedback_edges</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">relabel_using_reviews</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span> <span class="o">==</span> <span class="s1">&#39;rereview&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">apply_feedback_edges</span><span class="p">()</span>
                <span class="c1"># self.infr.apply_match_scores()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">relabel_using_reviews</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span> <span class="o">==</span> <span class="s1">&#39;review&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">apply_match_edges</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">ensure_mst</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">apply_feedback_edges</span><span class="p">()</span>
                <span class="c1"># self.infr.apply_match_scores()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">relabel_using_reviews</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">apply_nondynamic_update</span><span class="p">()</span>

        <span class="c1"># Set gui status indicators</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">connected_component_status</span><span class="p">()</span>
        <span class="n">truth_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">_get_truth_colors</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;num_inconsistent&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_lbl</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Inconsistent Names: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;num_inconsistent&#39;</span><span class="p">],))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_lbl</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">truth_colors</span><span class="p">[</span><span class="n">NEGTV</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_lbl</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Consistent&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_lbl</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">truth_colors</span><span class="p">[</span><span class="n">POSTV</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_names_lbl</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Names: max=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;num_names_max&#39;</span><span class="p">]))</span>

        <span class="c1"># print(&#39;[viz_graph] on_update_state mode=%s&#39; % (self.init_mode,))</span>
        <span class="k">if</span> <span class="n">structure_changed</span><span class="p">:</span>
            <span class="c1"># TODO: only make this API if the tab is clicked</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_node_model</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_edge_model</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_name_node_model</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_name_edge_model</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">emit_graph_update</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_widgets</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
            <span class="c1"># FIXME: should only clear cache in viewport</span>
            <span class="n">model</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
            <span class="n">model</span><span class="o">.</span><span class="n">layoutChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.ensure_cliques"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.ensure_cliques">[docs]</a>    <span class="k">def</span> <span class="nf">ensure_cliques</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">ensure_cliques</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">relabel_using_reviews</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">apply_nondynamic_update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repopulate</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.ensure_full"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.ensure_full">[docs]</a>    <span class="k">def</span> <span class="nf">ensure_full</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">ensure_full</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">relabel_using_reviews</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">apply_nondynamic_update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repopulate</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.match_and_score_edges"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.match_and_score_edges">[docs]</a>    <span class="k">def</span> <span class="nf">match_and_score_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">gt</span><span class="o">.</span><span class="n">GuiProgContext</span><span class="p">(</span><span class="s1">&#39;Scoring Edges&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
            <span class="c1"># TODO: add in a cfgdict here with settable params</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">exec_matching</span><span class="p">(</span><span class="n">prog_hook</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">prog_hook</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">apply_match_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span><span class="p">)</span>
            <span class="c1"># self.infr.apply_match_scores()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repopulate</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.score_edges_vsone"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.score_edges_vsone">[docs]</a>    <span class="k">def</span> <span class="nf">score_edges_vsone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># DEPRICATE</span>
        <span class="c1"># TODO: replace with new interface</span>
        <span class="k">with</span> <span class="n">gt</span><span class="o">.</span><span class="n">GuiProgContext</span><span class="p">(</span><span class="s1">&#39;Scoring Edges&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">exec_vsone_subset</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">prog_hook</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">prog_hook</span><span class="p">)</span>
            <span class="c1"># self.infr.exec_vsone(prog_hook=ctx.prog_hook)</span>
            <span class="c1"># self.infr.apply_match_scores()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repopulate</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.reset_review"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.reset_review">[docs]</a>    <span class="k">def</span> <span class="nf">reset_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz_graph] reset_review&#39;</span><span class="p">)</span>
        <span class="n">infr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span>
        <span class="k">with</span> <span class="n">gt</span><span class="o">.</span><span class="n">GuiProgContext</span><span class="p">(</span><span class="s1">&#39;Reset Review&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s1">&#39;reset_feedback&#39;</span><span class="p">):</span>
                <span class="n">infr</span><span class="o">.</span><span class="n">reset_feedback</span><span class="p">(</span><span class="s1">&#39;staging&#39;</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s1">&#39;reinit_name_labels&#39;</span><span class="p">):</span>
                <span class="n">infr</span><span class="o">.</span><span class="n">reset_labels_to_ibeis</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">set_pin_state</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s1">&#39;ensure_mst&#39;</span><span class="p">):</span>
                <span class="n">infr</span><span class="o">.</span><span class="n">ensure_mst</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s1">&#39;apply_match_edges&#39;</span><span class="p">):</span>
                <span class="n">infr</span><span class="o">.</span><span class="n">apply_match_edges</span><span class="p">()</span>
            <span class="c1"># with ut.Timer(&#39;apply_match_scores&#39;):</span>
            <span class="c1">#     infr.apply_match_scores()</span>
            <span class="c1"># with ut.Timer(&#39;relabel_using_reviews&#39;):</span>
            <span class="c1">#     self.infr.relabel_using_reviews()</span>
            <span class="c1"># with ut.Timer(&#39;apply_nondynamic_update&#39;):</span>
            <span class="c1">#     self.infr.apply_nondynamic_update()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repopulate</span><span class="p">()</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.reset_annotmatch"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.reset_annotmatch">[docs]</a>    <span class="k">def</span> <span class="nf">reset_annotmatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz_graph] reset_rereview&#39;</span><span class="p">)</span>
        <span class="n">infr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span>
        <span class="k">with</span> <span class="n">gt</span><span class="o">.</span><span class="n">GuiProgContext</span><span class="p">(</span><span class="s1">&#39;Reset Review&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">infr</span><span class="o">.</span><span class="n">reset_feedback</span><span class="p">(</span><span class="s1">&#39;annotmatch&#39;</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">infr</span><span class="o">.</span><span class="n">relabel_using_reviews</span><span class="p">()</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;repopulate&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repopulate</span><span class="p">()</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.reset_staging"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.reset_staging">[docs]</a>    <span class="k">def</span> <span class="nf">reset_staging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz_graph] reset_rereview&#39;</span><span class="p">)</span>
        <span class="n">infr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span>
        <span class="k">with</span> <span class="n">gt</span><span class="o">.</span><span class="n">GuiProgContext</span><span class="p">(</span><span class="s1">&#39;Reset Review&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">infr</span><span class="o">.</span><span class="n">reset_feedback</span><span class="p">(</span><span class="s1">&#39;staging&#39;</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">infr</span><span class="o">.</span><span class="n">relabel_using_reviews</span><span class="p">()</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;repopulate&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repopulate</span><span class="p">()</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.reset_rereview"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.reset_rereview">[docs]</a>    <span class="k">def</span> <span class="nf">reset_rereview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Goal:</span>
<span class="sd">            All names are removed.</span>
<span class="sd">            Reset edges so only reviewed edges are shown.</span>
<span class="sd">            You can change the state of those edges.</span>
<span class="sd">            They are not filtered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz_graph] reset_rereview&#39;</span><span class="p">)</span>
        <span class="n">infr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span> <span class="o">=</span> <span class="s1">&#39;rereview&#39;</span>
        <span class="k">with</span> <span class="n">gt</span><span class="o">.</span><span class="n">GuiProgContext</span><span class="p">(</span><span class="s1">&#39;Reset Review&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">infr</span><span class="o">.</span><span class="n">initialize_graph</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">set_pin_state</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;reset name labels&#39;</span><span class="p">)</span>
            <span class="n">infr</span><span class="o">.</span><span class="n">reset_name_labels</span><span class="p">()</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;reset feedback&#39;</span><span class="p">)</span>
            <span class="n">infr</span><span class="o">.</span><span class="n">reset_feedback</span><span class="p">(</span><span class="s1">&#39;staging&#39;</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;remove name labels&#39;</span><span class="p">)</span>
            <span class="n">infr</span><span class="o">.</span><span class="n">clear_name_labels</span><span class="p">()</span>
            <span class="c1"># ctx.set_progress(msg=&#39;apply match scores&#39;)</span>
            <span class="c1"># infr.apply_match_scores()</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;repopulate&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repopulate</span><span class="p">()</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.reset_split"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.reset_split">[docs]</a>    <span class="k">def</span> <span class="nf">reset_split</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">infr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_mode</span> <span class="o">=</span> <span class="s1">&#39;split&#39;</span>
        <span class="k">with</span> <span class="n">gt</span><span class="o">.</span><span class="n">GuiProgContext</span><span class="p">(</span><span class="s1">&#39;Initializing&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog_bar</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">infr</span><span class="o">.</span><span class="n">initialize_graph</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">set_pin_state</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">infr</span><span class="o">.</span><span class="n">remove_feedback</span><span class="p">()</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">infr</span><span class="o">.</span><span class="n">clear_name_labels</span><span class="p">()</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.edit_filters"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.edit_filters">[docs]</a>    <span class="k">def</span> <span class="nf">edit_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO: split up review configs / show thumbs etc...</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">dtool</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span><span class="p">)</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">ConfigConfirmWidget</span><span class="o">.</span><span class="n">as_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Edit Filters&#39;</span><span class="p">,</span>
                                               <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Edit Filters&#39;</span><span class="p">,</span>
                                               <span class="n">with_spoiler</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                               <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;config = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config</span><span class="p">,))</span>
        <span class="n">updated_config</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">config</span>  <span class="c1"># NOQA</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;updated_config = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">updated_config</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">review_cfg</span> <span class="o">=</span> <span class="n">updated_config</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repopulate</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.edge_doubleclick"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.edge_doubleclick">[docs]</a>    <span class="k">def</span> <span class="nf">edge_doubleclick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qtindex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        qtindex = qtindex = self.api_widgets[&#39;edges&#39;].view.get_row_and_qtindex_from_id(1)[0]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz_graph] DoubleClicked: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">qtype</span><span class="o">.</span><span class="n">qindexinfo</span><span class="p">(</span><span class="n">qtindex</span><span class="p">)))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">qtindex</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        <span class="n">aid1</span>  <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_header_data</span><span class="p">(</span><span class="s1">&#39;aid1&#39;</span><span class="p">,</span> <span class="n">qtindex</span><span class="p">)</span>
        <span class="n">aid2</span>  <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_header_data</span><span class="p">(</span><span class="s1">&#39;aid2&#39;</span><span class="p">,</span> <span class="n">qtindex</span><span class="p">)</span>
        <span class="n">cm</span><span class="p">,</span> <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">lookup_cm</span><span class="p">(</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cm</span><span class="o">.</span><span class="n">ishow_single_annotmatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">aid2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Hack</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">deselect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">toggle_selected_aid</span><span class="p">([</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">])</span>
            <span class="c1">#self.graph_widget.selected_aids = [aid1, aid2]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">show_selected</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.mark_pair_state"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.mark_pair_state">[docs]</a>    <span class="k">def</span> <span class="nf">mark_pair_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pairs</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">valid_states</span> <span class="o">=</span> <span class="p">{</span><span class="n">POSTV</span><span class="p">,</span> <span class="n">NEGTV</span><span class="p">,</span> <span class="n">INCMP</span><span class="p">,</span> <span class="n">UNREV</span><span class="p">}</span>
        <span class="n">statetags</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">statetags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">statetags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">statetags</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">assert</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">valid_states</span>
        <span class="k">for</span> <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_user_name</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;@&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_computer_name</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;:qt-mark&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">add_feedback</span><span class="p">((</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">),</span> <span class="n">state</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
                                   <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit_state_update</span><span class="p">(</span><span class="n">disable_global_update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.make_mark_state_funcs"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.make_mark_state_funcs">[docs]</a>    <span class="k">def</span> <span class="nf">make_mark_state_funcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection_func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_mark_selected_pair_state</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_pair_state</span><span class="p">(</span><span class="n">selection_func</span><span class="p">(),</span> <span class="n">state</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;Mark &amp;True&#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">_mark_selected_pair_state</span><span class="p">,</span> <span class="n">POSTV</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;Mark &amp;False&#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">_mark_selected_pair_state</span><span class="p">,</span> <span class="n">NEGTV</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;Mark &amp;Not-Comparable&#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">_mark_selected_pair_state</span><span class="p">,</span> <span class="n">INCMP</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;Mark &amp;Photobomb&#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">_mark_selected_pair_state</span><span class="p">,</span> <span class="s1">&#39;nomatch+photobomb&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;Mark &amp;SceneryMatch&#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">_mark_selected_pair_state</span><span class="p">,</span> <span class="s1">&#39;nomatch+scenerymatch&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;&amp;Unreview&#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">_mark_selected_pair_state</span><span class="p">,</span> <span class="n">UNREV</span><span class="p">)),</span>
            <span class="c1"># unreview will only remove internal feedback, anything commited will not change</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">options</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.name_selection"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.name_selection">[docs]</a>    <span class="k">def</span> <span class="nf">name_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="n">selected_qtindex_list_</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">selectedRows</span><span class="p">()</span>
        <span class="n">selected_qtindex_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">qtindex</span> <span class="ow">in</span> <span class="n">selected_qtindex_list_</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">qtindex</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;name_edges&#39;</span><span class="p">,</span> <span class="s1">&#39;name_nodes&#39;</span><span class="p">}:</span>
                <span class="n">level</span> <span class="o">=</span> <span class="n">qtindex</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span><span class="o">.</span><span class="n">level</span>
                <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">selected_qtindex_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qtindex</span><span class="p">)</span>
        <span class="n">name_labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">qtindex</span> <span class="ow">in</span> <span class="n">selected_qtindex_names</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">qtindex</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
            <span class="n">name_label</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_header_data</span><span class="p">(</span><span class="s1">&#39;name_label&#39;</span><span class="p">,</span> <span class="n">qtindex</span><span class="p">)</span>
            <span class="n">name_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name_labels</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.edge_selection"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.edge_selection">[docs]</a>    <span class="k">def</span> <span class="nf">edge_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="n">selected_qtindex_list_</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">selectedRows</span><span class="p">()</span>
        <span class="n">selected_qtindex_edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">qtindex</span> <span class="ow">in</span> <span class="n">selected_qtindex_list_</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">qtindex</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;name_edges&#39;</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">=</span> <span class="n">qtindex</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span><span class="o">.</span><span class="n">level</span>
                <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">selected_qtindex_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qtindex</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span>
                <span class="n">selected_qtindex_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qtindex</span><span class="p">)</span>
        <span class="n">aid_pairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">qtindex</span> <span class="ow">in</span> <span class="n">selected_qtindex_edges</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">qtindex</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
            <span class="n">aid1</span>  <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_header_data</span><span class="p">(</span><span class="s1">&#39;aid1&#39;</span><span class="p">,</span> <span class="n">qtindex</span><span class="p">)</span>
            <span class="n">aid2</span>  <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_header_data</span><span class="p">(</span><span class="s1">&#39;aid2&#39;</span><span class="p">,</span> <span class="n">qtindex</span><span class="p">)</span>
            <span class="n">aid_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">aid_pairs</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.node_selection"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.node_selection">[docs]</a>    <span class="k">def</span> <span class="nf">node_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="n">selected_qtindex_list</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">selectedRows</span><span class="p">()</span>
        <span class="n">aids</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">qtindex</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">get_header_data</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span> <span class="n">qtindex</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">qtindex</span> <span class="ow">in</span> <span class="n">selected_qtindex_list</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">aids</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.get_node_options"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.get_node_options">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Context-menu options for annotation nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.viz.interact</span> <span class="k">import</span> <span class="n">interact_chip</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">+=</span> <span class="n">interact_chip</span><span class="o">.</span><span class="n">build_annot_context_options</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">refresh_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">with_interact_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">config2_</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">aid_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">aids</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">options</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge_options</span><span class="p">(</span><span class="n">aid_pairs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">options</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.custom_review"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.custom_review">[docs]</a>    <span class="k">def</span> <span class="nf">custom_review</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aid_pairs</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_pairs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span> <span class="o">=</span> <span class="n">aid_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># import utool</span>
        <span class="c1"># utool.embed()</span>
        <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">get_nonvisual_edge_data</span><span class="p">((</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">))</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">EdgeReviewDialog</span><span class="o">.</span><span class="n">as_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="p">(</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">),</span>
                                         <span class="n">edge_data</span><span class="o">=</span><span class="n">edge_data</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">was_confirmed</span><span class="p">:</span>
            <span class="n">feedback</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">feedback_dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">add_feedback</span><span class="p">(</span><span class="o">**</span><span class="n">feedback</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.get_edge_options"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.get_edge_options">[docs]</a>    <span class="k">def</span> <span class="nf">get_edge_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aid_pairs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Context-menu options for annotation edges</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_pairs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_mark_state_funcs</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">aid_pairs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_pairs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;&amp;Custom Review&#39;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_review</span><span class="p">(</span><span class="n">aid_pairs</span><span class="p">)),</span>
            <span class="p">]</span>
            <span class="kn">from</span> <span class="nn">ibeis.gui</span> <span class="k">import</span> <span class="n">inspect_gui</span>
            <span class="n">ibs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">ibs</span>
            <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span> <span class="o">=</span> <span class="n">aid_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">qreq_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">qreq_</span>
            <span class="n">pair_tag_options</span> <span class="o">=</span> <span class="n">inspect_gui</span><span class="o">.</span><span class="n">make_aidpair_tag_context_options</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">)</span>
            <span class="n">chip_context_options</span> <span class="o">=</span> <span class="n">inspect_gui</span><span class="o">.</span><span class="n">make_annotpair_context_options</span><span class="p">(</span>
                <span class="n">ibs</span><span class="p">,</span> <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">=</span><span class="n">qreq_</span><span class="p">)</span>
            <span class="n">external_options</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">external_options</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;Match Ta&amp;gs&#39;</span><span class="p">,</span> <span class="n">pair_tag_options</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">external_options</span> <span class="o">+=</span> <span class="n">chip_context_options</span>
            <span class="n">options</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;External Options&#39;</span><span class="p">,</span> <span class="n">external_options</span><span class="p">),</span>
            <span class="p">]</span>

            <span class="n">nids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_nids</span><span class="p">([</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">]))</span>
            <span class="n">options</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;New Split Case Interaction&#39;</span><span class="p">,</span>
                 <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">make_qt_graph_interface</span><span class="p">,</span> <span class="n">ibs</span><span class="p">,</span> <span class="n">nids</span><span class="o">=</span><span class="n">nids</span><span class="p">)),</span>
            <span class="p">]</span>

            <span class="n">options</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;Tune Vsone(vt)&#39;</span><span class="p">,</span> <span class="n">inspect_gui</span><span class="o">.</span><span class="n">make_vsone_context_options</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">]</span>

        <span class="c1"># if len(selected_qtindex_names) &gt; 0:</span>
        <span class="c1">#     import utool</span>
        <span class="c1">#     utool.embed()</span>
        <span class="c1">#     options += [</span>
        <span class="c1">#         # TODO</span>
        <span class="c1">#         # (&#39;Restrict Graph To Names&#39;, lambda: self.restrict_graph_to_names),</span>
        <span class="c1">#         (&#39;Vsone subset&#39;, lambda: self.vsone_subset()),</span>
        <span class="c1">#     ]</span>
        <span class="c1"># else:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_pairs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;Vsone subset&#39;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsone_subset</span><span class="p">(</span><span class="n">aid_pairs</span><span class="p">)),</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="n">options</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.vsone_subset"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.vsone_subset">[docs]</a>    <span class="k">def</span> <span class="nf">vsone_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[graph] vsone_subset&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">exec_vsone_subset</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.restrict_graph_to_names"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.restrict_graph_to_names">[docs]</a>    <span class="k">def</span> <span class="nf">restrict_graph_to_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.edge_context"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.edge_context">[docs]</a>    <span class="nd">@gt</span><span class="o">.</span><span class="n">slot_</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QPoint</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">edge_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qtindex</span><span class="p">,</span> <span class="n">qpoint</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">)</span>
        <span class="c1">#print(&#39;option_dict = %s&#39; % (ut.repr3(option_dict, nl=2),))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">qtindex</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">view</span>
        <span class="n">aid_pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_selection</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge_options</span><span class="p">(</span><span class="n">aid_pairs</span><span class="p">)</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">popup_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qpoint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.node_context"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.node_context">[docs]</a>    <span class="nd">@gt</span><span class="o">.</span><span class="n">slot_</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QPoint</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">node_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qtindex</span><span class="p">,</span> <span class="n">qpoint</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">qtindex</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">view</span>
        <span class="n">aids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_selection</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_options</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">popup_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qpoint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.on_alt_pressed"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.on_alt_pressed">[docs]</a>    <span class="k">def</span> <span class="nf">on_alt_pressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">selected_qtindex_list</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">selectedRows</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_qtindex_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># popup context menu on alt</span>
            <span class="n">qtindex</span> <span class="o">=</span> <span class="n">selected_qtindex_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">qrect</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">visualRect</span><span class="p">(</span><span class="n">qtindex</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">qrect</span><span class="o">.</span><span class="n">center</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edge_context</span><span class="p">(</span><span class="n">qtindex</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.edge_keypress"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.edge_keypress">[docs]</a>    <span class="k">def</span> <span class="nf">edge_keypress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        view = self.api_widgets[&#39;edges&#39;].view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event_key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span>
        <span class="n">aid_pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_selection</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge_options</span><span class="p">(</span><span class="n">aid_pairs</span><span class="p">)</span>
        <span class="n">option_dict</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">make_option_dict</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">shortcuts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">handled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">option_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">event_key</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="p">,</span> <span class="s1">&#39;Key_&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
                <span class="n">func</span><span class="p">()</span>
                <span class="n">handled</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">handled</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Key  not handled </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">event_key</span><span class="p">,))</span>
            <span class="k">return</span>
        <span class="k">return</span> <span class="n">handled</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.print_staging_table"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.print_staging_table">[docs]</a>    <span class="k">def</span> <span class="nf">print_staging_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">staging</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">get_table_csv</span><span class="p">(</span><span class="s1">&#39;reviews&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.print_annotmatch_table"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.print_annotmatch_table">[docs]</a>    <span class="k">def</span> <span class="nf">print_annotmatch_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">db</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">get_table_csv</span><span class="p">(</span><span class="s1">&#39;annotmatch&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.commit_to_staging"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.commit_to_staging">[docs]</a>    <span class="k">def</span> <span class="nf">commit_to_staging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[graph] commit to staging&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">write_ibeis_staging_feedback</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.print_deltas"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.print_deltas">[docs]</a>    <span class="k">def</span> <span class="nf">print_deltas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;external&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="s1">&#39;annotmatch&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="s1">&#39;staging&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="s1">&#39;annotmatch&#39;</span><span class="p">,</span> <span class="s1">&#39;staging&#39;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;old = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">old</span><span class="p">,))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;new = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new</span><span class="p">,))</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">match_state_delta</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">))</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.use_ibeis_names"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.use_ibeis_names">[docs]</a>    <span class="k">def</span> <span class="nf">use_ibeis_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Hack</span>
        <span class="n">infr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span>
        <span class="n">num_names</span><span class="p">,</span> <span class="n">num_inconsistent</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">relabel_using_reviews</span><span class="p">()</span>
        <span class="n">aid_to_newname</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">get_ibeis_name_delta</span><span class="p">()</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;name_label&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">aid_to_newname</span><span class="p">[</span><span class="s1">&#39;new_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.hack_keep_old_tags"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.hack_keep_old_tags">[docs]</a>    <span class="k">def</span> <span class="nf">hack_keep_old_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Creates new reviews that rectify old tags in the annotmatch table</span>
        <span class="c1"># into the staging table.</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">internal_feedback</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">infr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span>
        <span class="n">edge_delta_df</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">match_state_delta</span><span class="p">(</span><span class="n">old</span><span class="o">=</span><span class="s1">&#39;annotmatch&#39;</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="s1">&#39;external&#39;</span><span class="p">)</span>
        <span class="c1"># Find those with tag changes</span>
        <span class="n">tag_flags</span> <span class="o">=</span> <span class="p">((</span><span class="n">edge_delta_df</span><span class="p">[</span><span class="s1">&#39;old_tags&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">edge_delta_df</span><span class="p">[</span><span class="s1">&#39;new_tags&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
                     <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">edge_delta_df</span><span class="p">[</span><span class="s1">&#39;am_rowid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())))</span>
        <span class="n">tag_delta_df</span> <span class="o">=</span> <span class="n">edge_delta_df</span><span class="p">[</span><span class="n">tag_flags</span><span class="p">]</span>
        <span class="n">aid_pairs</span> <span class="o">=</span> <span class="n">tag_delta_df</span><span class="o">.</span><span class="n">index</span>
        <span class="n">decision</span> <span class="o">=</span> <span class="n">tag_delta_df</span><span class="p">[</span><span class="s1">&#39;new_decision&#39;</span><span class="p">]</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">tag_delta_df</span><span class="p">[</span><span class="s1">&#39;old_tags&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">tag_delta_df</span><span class="p">[</span><span class="s1">&#39;new_tags&#39;</span><span class="p">]</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">unique</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">),</span> <span class="n">state</span><span class="p">,</span> <span class="n">tags</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">aid_pairs</span><span class="p">,</span> <span class="n">decision</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
            <span class="n">infr</span><span class="o">.</span><span class="n">add_feedback</span><span class="p">((</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">),</span> <span class="n">state</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>

        <span class="n">infr</span><span class="o">.</span><span class="n">apply_feedback_edges</span><span class="p">()</span>
        <span class="n">infr</span><span class="o">.</span><span class="n">apply_nondynamic_update</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.accept"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.accept">[docs]</a>    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        First determine deltas of what has changed between internal state +</span>
<span class="sd">        staging and the the annotations node names as well as the annotmatch</span>
<span class="sd">        edges. Then commit to staging, annotmatch, and the annotation table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[viz_graph] accept&#39;</span><span class="p">)</span>
        <span class="n">infr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span>

        <span class="c1"># Ensure internal state is up to date</span>
        <span class="n">infr</span><span class="o">.</span><span class="n">relabel_using_reviews</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">edge_delta_df</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">match_state_delta</span><span class="p">(</span><span class="n">old</span><span class="o">=</span><span class="s1">&#39;annotmatch&#39;</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="n">name_delta_df</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">get_ibeis_name_delta</span><span class="p">()</span>
        <span class="n">name_stats_df</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">name_group_stats</span><span class="p">()</span>
        <span class="n">name_delta_stats_df</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">ibeis_name_group_delta_info</span><span class="p">()</span>

        <span class="n">info</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">ibeis_delta_info</span><span class="p">(</span><span class="n">edge_delta_df</span><span class="p">,</span> <span class="n">name_delta_df</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">utool</span>
        <span class="k">with</span> <span class="n">utool</span><span class="o">.</span><span class="n">embed_on_exception_context</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;num_edges_added&#39;</span><span class="p">]</span> <span class="o">==</span>  <span class="n">info</span><span class="p">[</span><span class="s1">&#39;num_edges_added_to_am&#39;</span><span class="p">],</span> <span class="p">(</span>
                <span class="s1">&#39;should never happen when staging is moving into annotmatch&#39;</span>
            <span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Are you sure this is correct?</span>
<span class="sd">            strictly split {num_old_split} into {num_new_split} names.</span>
<span class="sd">            strictly merged {num_old_merge} into {num_new_merge} names.</span>
<span class="sd">            hybrid split/merged {num_old_hybrid} into {num_new_hybrid} names.</span>
<span class="sd">            #annot_names_changed={num_annots_with_names_changed}</span>
<span class="sd">            #edges_added={num_edges_added_to_am}</span>
<span class="sd">            #edges_modified={num_edges_modified}</span>
<span class="sd">            #inconsistent:consistent={num_inconsistent}:{num_consistent}</span>
<span class="sd">            #redundant:nonredundant={num_pos_redun}:{num_non_pos_redun}</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">info</span><span class="p">)</span>
        <span class="c1">#tags_modified={num_changed_tags}</span>
        <span class="c1">#tags+decisions_modified={num_changed_decision_and_tags}</span>
        <span class="c1">#decision_modified={num_changed_decision}</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">print_</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">append</span>
        <span class="n">print_</span><span class="p">(</span><span class="s1">&#39;=================&#39;</span><span class="p">)</span>
        <span class="n">print_</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">pdkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">print_</span><span class="p">(</span><span class="s1">&#39;---DATAFRAME</span><span class="se">\n</span><span class="s1">name_delta_stats_df =</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
               <span class="n">name_delta_stats_df</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="o">**</span><span class="n">pdkw</span><span class="p">))</span>
        <span class="n">print_</span><span class="p">(</span><span class="s1">&#39;---DATAFRAME</span><span class="se">\n</span><span class="s1">name_stats_df =</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
               <span class="n">name_stats_df</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="o">**</span><span class="n">pdkw</span><span class="p">))</span>

        <span class="n">pdkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">max_rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">name_delta_df</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">print_</span><span class="p">(</span><span class="s1">&#39;internal_feedback = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">infr</span><span class="o">.</span><span class="n">internal_feedback</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">print_</span><span class="p">(</span><span class="s1">&#39;---DATAFRAME</span><span class="se">\n</span><span class="s1">name_delta_df =</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">name_delta_df</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="o">**</span><span class="n">pdkw</span><span class="p">))</span>
        <span class="n">pdkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">max_rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">edge_delta_df</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">print_</span><span class="p">(</span><span class="s1">&#39;---DATAFRAME</span><span class="se">\n</span><span class="s1">edge_delta_df =</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">edge_delta_df</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="o">**</span><span class="n">pdkw</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">gt</span><span class="o">.</span><span class="n">are_you_sure</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Cancel&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>

        <span class="c1"># Write to staging then write to annotmatch and names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">write_ibeis_staging_feedback</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">write_ibeis_annotmatch_feedback</span><span class="p">(</span><span class="n">edge_delta_df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">write_ibeis_name_assignment</span><span class="p">(</span><span class="n">name_delta_df</span><span class="p">)</span>
        <span class="n">gt</span><span class="o">.</span><span class="n">user_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Name Change Complete&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.sizeHint"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.sizeHint">[docs]</a>    <span class="k">def</span> <span class="nf">sizeHint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.closeEvent"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.closeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">abstract_interaction</span><span class="o">.</span><span class="n">unregister_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AnnotGraphWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">closeEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.debug_annot_review_state"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.debug_annot_review_state">[docs]</a>    <span class="k">def</span> <span class="nf">debug_annot_review_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_columns</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">160</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="mi">30</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="n">aid</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;aid1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aid</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;aid2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;aid1&#39;</span><span class="p">,</span> <span class="s1">&#39;aid2&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Graph Edges&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">db</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">staging</span>
        <span class="n">rowids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_review_rowids_from_single</span><span class="p">([</span><span class="n">aid</span><span class="p">]))</span>
        <span class="n">tablename</span> <span class="o">=</span> <span class="s1">&#39;reviews&#39;</span>
        <span class="n">exclude_columns</span> <span class="o">=</span> <span class="s1">&#39;review_user_confidence review_user_identity&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_table_as_pandas</span><span class="p">(</span><span class="n">tablename</span><span class="p">,</span> <span class="n">rowids</span><span class="p">,</span> <span class="n">exclude_columns</span><span class="o">=</span><span class="n">exclude_columns</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;annot_1_rowid&#39;</span><span class="p">:</span> <span class="s1">&#39;aid1&#39;</span><span class="p">,</span> <span class="s1">&#39;annot_2_rowid&#39;</span><span class="p">:</span> <span class="s1">&#39;aid2&#39;</span><span class="p">})</span>
        <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;aid1&#39;</span><span class="p">,</span> <span class="s1">&#39;aid2&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Staging&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">db</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span>
        <span class="n">rowids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annotmatch_rowids_from_aid</span><span class="p">([</span><span class="n">aid</span><span class="p">]))</span>
        <span class="n">tablename</span> <span class="o">=</span> <span class="s1">&#39;annotmatch&#39;</span>
        <span class="n">exclude_columns</span> <span class="o">=</span> <span class="s1">&#39;annotmatch_confidence annotmatch_posixtime_modified annotmatch_reviewer&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_table_as_pandas</span><span class="p">(</span><span class="n">tablename</span><span class="p">,</span> <span class="n">rowids</span><span class="p">,</span> <span class="n">exclude_columns</span><span class="o">=</span><span class="n">exclude_columns</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;annot_rowid1&#39;</span><span class="p">:</span> <span class="s1">&#39;aid1&#39;</span><span class="p">,</span> <span class="s1">&#39;annot_rowid2&#39;</span><span class="p">:</span> <span class="s1">&#39;aid2&#39;</span><span class="p">})</span>
        <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;aid1&#39;</span><span class="p">,</span> <span class="s1">&#39;aid2&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Annot Match&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.print_info"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.print_info">[docs]</a>    <span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[graph] print_info&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;external_feedback = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">external_feedback</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;internal_feedback = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">internal_feedback</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">infr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;infr = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">infr</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">infr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">infr</span><span class="o">.</span><span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">graph_info</span><span class="p">(</span><span class="n">infr</span><span class="o">.</span><span class="n">simplify_graph</span><span class="p">())))</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.embed"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.embed">[docs]</a>    <span class="k">def</span> <span class="nf">embed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">infr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span>  <span class="c1"># NOQA</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">ibs</span>  <span class="c1"># NOQA</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">graph</span>  <span class="c1"># NOQA</span>
        <span class="kn">import</span> <span class="nn">utool</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">embed</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnnotGraphWidget.expand_image_and_names"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.AnnotGraphWidget.expand_image_and_names">[docs]</a>    <span class="k">def</span> <span class="nf">expand_image_and_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># call get_name_image_closure()</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">ibs</span>
        <span class="n">aids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">aids</span>
        <span class="n">annots</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">annots</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span>
        <span class="n">aids</span> <span class="o">=</span> <span class="n">annots</span><span class="o">.</span><span class="n">get_name_image_closure</span><span class="p">()</span>
        <span class="n">nids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_nids</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">ibeis</span>
        <span class="n">new_infr</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">AnnotInference</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aids</span><span class="p">,</span> <span class="n">nids</span><span class="p">,</span>
                                        <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">new_infr</span><span class="o">.</span><span class="n">initialize_graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span> <span class="o">=</span> <span class="n">new_infr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_inference</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="EdgeAPIHelper"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper">[docs]</a><span class="k">class</span> <span class="nc">EdgeAPIHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infr</span> <span class="o">=</span> <span class="n">infr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">ibs</span>

<div class="viewcode-block" id="EdgeAPIHelper.make_partial_edge_headers"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.make_partial_edge_headers">[docs]</a>    <span class="k">def</span> <span class="nf">make_partial_edge_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        These are partial api headers meant to augment edge headers</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">custom_edge_props</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># TODO: allow user to specify things like hardness / failed / passed or</span>
            <span class="c1"># whatever</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">,</span>
            <span class="s1">&#39;maybe_error&#39;</span><span class="p">,</span>
            <span class="s1">&#39;failed&#39;</span><span class="p">,</span>
            <span class="s1">&#39;hardness&#39;</span><span class="p">,</span>
            <span class="s1">&#39;normscore&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">edge_col_name_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1">#&#39;index&#39;,</span>
            <span class="s1">&#39;thumb1&#39;</span><span class="p">,</span> <span class="s1">&#39;thumb2&#39;</span><span class="p">,</span>
            <span class="s1">&#39;match_thumb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inference&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">,</span>
            <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tags&#39;</span><span class="p">,</span>
            <span class="s1">&#39;timedelta&#39;</span><span class="p">,</span>
            <span class="s1">&#39;kmdist&#39;</span><span class="p">,</span>
            <span class="s1">&#39;speed&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">edge_col_name_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">custom_edge_props</span><span class="p">)</span>
        <span class="n">edge_col_name_list</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="s1">&#39;cc_size1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cc_size2&#39;</span><span class="p">,</span>
            <span class="s1">&#39;aid1&#39;</span><span class="p">,</span> <span class="s1">&#39;aid2&#39;</span><span class="p">,</span>
            <span class="c1">#&#39;data&#39;,</span>
        <span class="p">]</span>

        <span class="n">col_getter_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">,</span>
            <span class="s1">&#39;timedelta&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge_timedelta</span><span class="p">,</span>
            <span class="s1">&#39;speed&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge_speed</span><span class="p">,</span>
            <span class="s1">&#39;kmdist&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge_kmdist</span><span class="p">,</span>
            <span class="s1">&#39;inference&#39;</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">get_inference_text</span><span class="p">,</span>
            <span class="s1">&#39;review&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_review_text</span><span class="p">,</span>
            <span class="s1">&#39;score&#39;</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">edge_attr_getter</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">),</span>
            <span class="s1">&#39;rank&#39;</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">edge_attr_getter</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pair_tags</span><span class="p">,</span>
            <span class="s1">&#39;cc_size1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">edge</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_other</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="s1">&#39;cc_size2&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">edge</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_other</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>

            <span class="s1">&#39;thumb1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chip_thumbtup</span><span class="p">,</span>
            <span class="s1">&#39;thumb2&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chip_thumbtup</span><span class="p">,</span>
            <span class="s1">&#39;match_thumb&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_match_thumbtup</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">custom_edge_props</span><span class="p">:</span>
            <span class="n">col_getter_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_attr_getter</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">col_ider_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;aid1&#39;</span><span class="p">,</span> <span class="s1">&#39;aid2&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">col_getter_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="c1"># col_ider_dict = ({</span>
        <span class="n">col_ider_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;thumb1&#39;</span><span class="p">:</span> <span class="s1">&#39;aid1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;thumb2&#39;</span><span class="p">:</span> <span class="s1">&#39;aid2&#39;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="n">col_types_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="s1">&#39;timedelta&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="s1">&#39;speed&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="s1">&#39;thumb1&#39;</span><span class="p">:</span> <span class="s1">&#39;PIXMAP&#39;</span><span class="p">,</span>
            <span class="s1">&#39;thumb2&#39;</span><span class="p">:</span> <span class="s1">&#39;PIXMAP&#39;</span><span class="p">,</span>
            <span class="s1">&#39;match_thumb&#39;</span><span class="p">:</span> <span class="s1">&#39;PIXMAP&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cc_size1&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="s1">&#39;cc_size2&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">col_display_role_func_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;timedelta&#39;</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_posix_timedelta_str</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">approx</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="s1">&#39;speed&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">speed</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1"> km/h&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">speed</span><span class="p">,),</span>
            <span class="s1">&#39;kmdist&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">speed</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1"> km&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">speed</span><span class="p">,),</span>
        <span class="p">}</span>

        <span class="n">col_bgrole_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;inference&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inference_bgrole</span><span class="p">,</span>
            <span class="s1">&#39;review&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_review_bgrole</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">col_width_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
            <span class="s1">&#39;aid1&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
            <span class="s1">&#39;aid2&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
            <span class="s1">&#39;cc_size1&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
            <span class="s1">&#39;cc_size2&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
            <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
            <span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
            <span class="c1">#&#39;timedelta&#39;: 65,</span>
        <span class="p">}</span>

        <span class="n">partial_headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;edge_col_name_list&#39;</span><span class="p">:</span> <span class="n">edge_col_name_list</span><span class="p">,</span>
            <span class="s1">&#39;col_getter_dict&#39;</span><span class="p">:</span> <span class="n">col_getter_dict</span><span class="p">,</span>
            <span class="s1">&#39;col_ider_dict&#39;</span><span class="p">:</span> <span class="n">col_ider_dict</span><span class="p">,</span>
            <span class="s1">&#39;col_ider_dict&#39;</span><span class="p">:</span> <span class="n">col_ider_dict</span><span class="p">,</span>
            <span class="s1">&#39;col_types_dict&#39;</span><span class="p">:</span> <span class="n">col_types_dict</span><span class="p">,</span>
            <span class="s1">&#39;col_display_role_func_dict&#39;</span><span class="p">:</span> <span class="n">col_display_role_func_dict</span><span class="p">,</span>
            <span class="s1">&#39;col_bgrole_dict&#39;</span><span class="p">:</span> <span class="n">col_bgrole_dict</span><span class="p">,</span>
            <span class="s1">&#39;col_width_dict&#39;</span><span class="p">:</span> <span class="n">col_width_dict</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">partial_headers</span></div>

<div class="viewcode-block" id="EdgeAPIHelper.get_edge_timedelta"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.get_edge_timedelta">[docs]</a>    <span class="k">def</span> <span class="nf">get_edge_timedelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_assert</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_unflat_annots_timedelta_list</span><span class="p">([</span><span class="n">edge</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="EdgeAPIHelper.get_edge_speed"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.get_edge_speed">[docs]</a>    <span class="k">def</span> <span class="nf">get_edge_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_assert</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_unflat_annots_speeds_list2</span><span class="p">([</span><span class="n">edge</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="EdgeAPIHelper.get_edge_kmdist"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.get_edge_kmdist">[docs]</a>    <span class="k">def</span> <span class="nf">get_edge_kmdist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_assert</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_unflat_annots_kmdists_list</span><span class="p">([</span><span class="n">edge</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="EdgeAPIHelper.get_edge_data"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.get_edge_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_edge_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span> <span class="o">=</span> <span class="n">edge</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">remove_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">visual_edge_attrs</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="s1">&#39;evidence_decision&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">remove_attrs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">delete_dict_keys</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="n">remove_attrs</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">explicit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nobr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="EdgeAPIHelper.edge_attr_getter"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.edge_attr_getter">[docs]</a>    <span class="k">def</span> <span class="nf">edge_attr_getter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">get_edge_attr</span><span class="p">(</span><span class="n">edge</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="o">*</span><span class="n">edge</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">get_edge_attr</span></div>

<div class="viewcode-block" id="EdgeAPIHelper.get_pair_tags"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.get_pair_tags">[docs]</a>    <span class="k">def</span> <span class="nf">get_pair_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span> <span class="o">=</span> <span class="n">edge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_assert</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="c1"># ibs = self.infr.ibs</span>
        <span class="c1"># # FIXME: use graph properties instead</span>
        <span class="c1"># am_rowids = ibs.get_annotmatch_rowid_from_undirected_superkey(</span>
        <span class="c1">#     [aid1], [aid2])</span>
        <span class="c1"># tag_text = ibs.get_annotmatch_tag_text(am_rowids)[0]</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="o">*</span><span class="n">edge</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tag_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tag_text</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">tag_text</span><span class="p">)</span></div>

<div class="viewcode-block" id="EdgeAPIHelper.edge_assert"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.edge_assert">[docs]</a>    <span class="k">def</span> <span class="nf">edge_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span> <span class="o">=</span> <span class="n">edge</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">aid1</span><span class="p">),</span> <span class="s1">&#39;aid1=</span><span class="si">%r</span><span class="s1">, aid2=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">aid2</span><span class="p">),</span> <span class="s1">&#39;aid1=</span><span class="si">%r</span><span class="s1">, aid2=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_inference_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span> <span class="o">=</span> <span class="n">edge</span>
        <span class="n">node_dict</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">nx_node_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">nid1</span> <span class="o">=</span> <span class="n">node_dict</span><span class="p">[</span><span class="n">aid1</span><span class="p">][</span><span class="s1">&#39;name_label&#39;</span><span class="p">]</span>
        <span class="n">nid2</span> <span class="o">=</span> <span class="n">node_dict</span><span class="p">[</span><span class="n">aid2</span><span class="p">][</span><span class="s1">&#39;name_label&#39;</span><span class="p">]</span>
        <span class="c1"># nid1, nid2 = self.infr.node_labels(aid1, aid2)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="o">*</span><span class="n">edge</span><span class="p">)</span>
        <span class="n">inferred_state</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;inferred_state&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">maybe_error</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maybe_error&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inferred_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
        <span class="k">elif</span> <span class="n">inferred_state</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;inconsistent&#39;</span><span class="p">):</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">inferred_state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inferred_state</span> <span class="o">==</span> <span class="n">INCMP</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">INCMP</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inferred_truth</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;same&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;diff&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}[</span><span class="n">inferred_state</span><span class="p">]</span>
                <span class="n">name_truth</span> <span class="o">=</span> <span class="p">(</span><span class="n">nid1</span> <span class="o">==</span> <span class="n">nid2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name_truth</span> <span class="o">!=</span> <span class="n">inferred_truth</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;disagree&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;same&#39;</span> <span class="k">if</span> <span class="n">nid1</span> <span class="o">==</span> <span class="n">nid2</span> <span class="k">else</span> <span class="s1">&#39;diff&#39;</span>

        <span class="n">text_parts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">maybe_error</span><span class="p">:</span>
            <span class="n">text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;(ERROR?)&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;inconsistent_external&#39;</span><span class="p">:</span>
            <span class="n">text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;inconsistent&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;inconsistent_internal&#39;</span><span class="p">:</span>
            <span class="n">text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;inconsistent&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nid1</span> <span class="o">==</span> <span class="n">nid2</span><span class="p">:</span>
            <span class="n">text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; nid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nid1</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; nids=</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nid1</span><span class="p">,</span> <span class="n">nid2</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;inconsistent_external&#39;</span><span class="p">:</span>
            <span class="n">text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;(external)&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;inconsistent_internal&#39;</span><span class="p">:</span>
            <span class="n">text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;(internal)&#39;</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text_parts</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">maybe_error</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">info</span>

<div class="viewcode-block" id="EdgeAPIHelper.get_inference_text"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.get_inference_text">[docs]</a>    <span class="k">def</span> <span class="nf">get_inference_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_inference_info</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="n">state</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">maybe_error</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">text</span></div>

<div class="viewcode-block" id="EdgeAPIHelper.get_review_text"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.get_review_text">[docs]</a>    <span class="k">def</span> <span class="nf">get_review_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="o">*</span><span class="n">edge</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;evidence_decision&#39;</span><span class="p">,</span> <span class="n">UNREV</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span></div>

<div class="viewcode-block" id="EdgeAPIHelper.get_inference_bgrole"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.get_inference_bgrole">[docs]</a>    <span class="k">def</span> <span class="nf">get_inference_bgrole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Background role for status column &quot;&quot;&quot;</span>
        <span class="n">state</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">maybe_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_inference_info</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;disagree&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">WHITE</span>
        <span class="k">elif</span> <span class="n">state</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;inconsistent&#39;</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ORANGE</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;inconsistent_external&#39;</span><span class="p">:</span>
                <span class="n">lighten_amount</span> <span class="o">=</span> <span class="o">.</span><span class="mi">55</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">lighten_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">lighten_amount</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">maybe_error</span><span class="p">:</span>
                <span class="n">lighten_amount</span> <span class="o">=</span> <span class="o">.</span><span class="mi">35</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">lighten_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">lighten_amount</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lighten_amount</span> <span class="o">=</span> <span class="o">.</span><span class="mi">35</span>
            <span class="n">truth_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">_get_truth_colors</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">:</span>
                <span class="n">lighten_amount</span> <span class="o">=</span> <span class="o">.</span><span class="mi">7</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">truth_colors</span><span class="p">[</span><span class="n">UNREV</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">truth_colors</span><span class="p">[</span><span class="n">POSTV</span><span class="p">]</span> <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;same&#39;</span> <span class="k">else</span> <span class="n">truth_colors</span><span class="p">[</span><span class="n">NEGTV</span><span class="p">]</span>
            <span class="c1">#self.graph.get_edge_data(*edge).get(&#39;evidence_decision&#39;, UNREV)]</span>
            <span class="k">if</span> <span class="n">lighten_amount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">lighten_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">lighten_amount</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">to_base255</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">color</span></div>

<div class="viewcode-block" id="EdgeAPIHelper.get_review_bgrole"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.get_review_bgrole">[docs]</a>    <span class="k">def</span> <span class="nf">get_review_bgrole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Background role for status column &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="o">*</span><span class="n">edge</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;evidence_decision&#39;</span><span class="p">,</span> <span class="n">UNREV</span><span class="p">)</span>
        <span class="n">truth_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">_get_truth_colors</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">UNREV</span><span class="p">:</span>
            <span class="n">inference_state</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">maybe_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_inference_info</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inference_state</span> <span class="o">==</span> <span class="s1">&#39;same&#39;</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">truth_colors</span><span class="p">[</span><span class="n">POSTV</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">inference_state</span> <span class="o">==</span> <span class="s1">&#39;diff&#39;</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">truth_colors</span><span class="p">[</span><span class="n">NEGTV</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">truth_colors</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">truth_colors</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
        <span class="n">lighten_amount</span> <span class="o">=</span> <span class="o">.</span><span class="mi">35</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">UNREV</span><span class="p">:</span>
            <span class="n">lighten_amount</span> <span class="o">=</span> <span class="o">.</span><span class="mi">7</span>
        <span class="k">if</span> <span class="n">lighten_amount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">lighten_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">lighten_amount</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">to_base255</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">color</span></div>

<div class="viewcode-block" id="EdgeAPIHelper.get_match_thumbtup"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.get_match_thumbtup">[docs]</a>    <span class="k">def</span> <span class="nf">get_match_thumbtup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">thumbsize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1">#sibs, qaid2_cm, qaids, daids, index, qreq_=None,</span>
        <span class="c1">#                   thumbsize=(128, 128), match_thumbtup_cache={}):</span>
        <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span> <span class="o">=</span> <span class="n">edge</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cm</span><span class="p">,</span> <span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">lookup_cm</span><span class="p">(</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="kn">from</span> <span class="nn">ibeis.gui</span> <span class="k">import</span> <span class="n">id_review_api</span>
        <span class="k">if</span> <span class="n">cm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># HACK: check if a PairwiseMatch exists</span>
            <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">vsone_matches</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">aid1</span><span class="p">,</span> <span class="n">aid2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fpath</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">func2</span> <span class="o">=</span> <span class="n">id_review_api</span><span class="o">.</span><span class="n">make_ensure_match_img_nosql_func</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">ibs</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">thumbdat</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;fpath&#39;</span><span class="p">:</span> <span class="n">fpath</span><span class="p">,</span>
                    <span class="s1">&#39;thread_func&#39;</span><span class="p">:</span> <span class="n">func</span><span class="p">,</span>
                    <span class="s1">&#39;main_func&#39;</span><span class="p">:</span> <span class="n">func2</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">thumbdat</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="c1">#assert cm.qaid == aid1, &#39;aids do not aggree&#39;</span>
        <span class="c1"># Hacky new way of drawing</span>
        <span class="n">fpath</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">func2</span> <span class="o">=</span> <span class="n">id_review_api</span><span class="o">.</span><span class="n">make_ensure_match_img_nosql_func</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">aid2</span><span class="p">)</span>
        <span class="n">thumbdat</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;fpath&#39;</span><span class="p">:</span> <span class="n">fpath</span><span class="p">,</span>
            <span class="s1">&#39;thread_func&#39;</span><span class="p">:</span> <span class="n">func</span><span class="p">,</span>
            <span class="s1">&#39;main_func&#39;</span><span class="p">:</span> <span class="n">func2</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">thumbdat</span></div>

<div class="viewcode-block" id="EdgeAPIHelper.get_num_other"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.EdgeAPIHelper.get_num_other">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_other</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aid</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">aid</span>
        <span class="n">node_to_name_label</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">get_node_attributes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;name_label&#39;</span><span class="p">)</span>
        <span class="n">name_label</span> <span class="o">=</span> <span class="n">node_to_name_label</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">node_to_name_label</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">labels</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">name_label</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="make_name_edge_api"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.make_name_edge_api">[docs]</a><span class="k">def</span> <span class="nf">make_name_edge_api</span><span class="p">(</span><span class="n">infr</span><span class="p">,</span> <span class="n">review_cfg</span><span class="o">=</span><span class="p">{}):</span>
    <span class="n">node_to_name</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">get_node_attrs</span><span class="p">(</span><span class="s1">&#39;name_label&#39;</span><span class="p">)</span>
    <span class="n">name_to_nodes</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">group_items</span><span class="p">(</span><span class="n">node_to_name</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">node_to_name</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="n">name_to_edges</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>
                     <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">name_to_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">name_to_edges</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">flat_edges</span><span class="p">,</span> <span class="n">grouped_edge_idxs</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">invertible_flatten1</span><span class="p">(</span><span class="n">name_to_edges</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">grouped_edges</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">apply_grouping</span><span class="p">(</span><span class="n">flat_edges</span><span class="p">,</span> <span class="n">grouped_edge_idxs</span><span class="p">)</span>
    <span class="n">n_annots_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">edges</span><span class="p">)))</span> <span class="k">for</span> <span class="n">edges</span> <span class="ow">in</span> <span class="n">grouped_edges</span><span class="p">]</span>

    <span class="n">nid_col_name_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name_label&#39;</span><span class="p">,</span> <span class="s1">&#39;n_annots&#39;</span><span class="p">,</span> <span class="s1">&#39;n_edges&#39;</span><span class="p">]</span>

    <span class="bp">self</span> <span class="o">=</span> <span class="n">EdgeAPIHelper</span><span class="p">(</span><span class="n">infr</span><span class="p">)</span>
    <span class="n">partial_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_partial_edge_headers</span><span class="p">()</span>
    <span class="n">edge_col_name_list</span> <span class="o">=</span> <span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;edge_col_name_list&#39;</span><span class="p">]</span>

    <span class="n">col_name_list</span> <span class="o">=</span> <span class="n">nid_col_name_list</span> <span class="o">+</span> <span class="n">edge_col_name_list</span>
    <span class="n">col_level_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">nid_col_name_list</span><span class="p">:</span>
        <span class="n">col_level_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">edge_col_name_list</span><span class="p">:</span>
        <span class="n">col_level_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">iders</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">))),</span>
        <span class="n">grouped_edge_idxs</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">col_getter_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name_label&#39;</span><span class="p">:</span> <span class="n">names</span><span class="p">,</span>
        <span class="s1">&#39;n_edges&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">grouped_edge_idxs</span><span class="p">)),</span>
        <span class="s1">&#39;n_annots&#39;</span><span class="p">:</span> <span class="n">n_annots_list</span><span class="p">,</span>
        <span class="s1">&#39;aid1&#39;</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">flat_edges</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;aid2&#39;</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">flat_edges</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">col_getter_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;col_getter_dict&#39;</span><span class="p">])</span>

    <span class="n">col_display_role_func_dict</span> <span class="o">=</span> <span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;col_display_role_func_dict&#39;</span><span class="p">]</span>
    <span class="n">col_bgrole_dict</span> <span class="o">=</span> <span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;col_bgrole_dict&#39;</span><span class="p">]</span>

    <span class="n">col_ider_dict</span> <span class="o">=</span> <span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;col_ider_dict&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">name_bg_role</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">name_to_edges</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">WHITE</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="o">*</span><span class="n">edge</span><span class="p">)</span>
            <span class="n">inferred_state</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;inferred_state&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">inferred_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">inferred_state</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;inconsistent&#39;</span><span class="p">)):</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ORANGE</span>
                <span class="k">break</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">to_base255</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">color</span>

    <span class="n">col_bgrole_dict</span><span class="p">[</span><span class="s1">&#39;name_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name_bg_role</span>
    <span class="n">col_bgrole_dict</span><span class="p">[</span><span class="s1">&#39;n_edges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name_bg_role</span>
    <span class="n">col_bgrole_dict</span><span class="p">[</span><span class="s1">&#39;n_annots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name_bg_role</span>

    <span class="n">name_api</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">CustomAPI</span><span class="p">(</span>
        <span class="n">col_name_list</span><span class="p">,</span>
        <span class="n">col_ider_dict</span><span class="o">=</span><span class="n">col_ider_dict</span><span class="p">,</span>
        <span class="n">col_types_dict</span><span class="o">=</span><span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;col_types_dict&#39;</span><span class="p">],</span>
        <span class="n">col_getter_dict</span><span class="o">=</span><span class="n">col_getter_dict</span><span class="p">,</span>
        <span class="n">col_bgrole_dict</span><span class="o">=</span><span class="n">col_bgrole_dict</span><span class="p">,</span>
        <span class="n">col_display_role_func_dict</span><span class="o">=</span><span class="n">col_display_role_func_dict</span><span class="p">,</span>
        <span class="n">col_width_dict</span><span class="o">=</span><span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;col_width_dict&#39;</span><span class="p">],</span>
        <span class="n">get_thumb_size</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">221</span><span class="p">,</span>
        <span class="n">col_level_dict</span><span class="o">=</span><span class="n">col_level_dict</span><span class="p">,</span>
        <span class="n">iders</span><span class="o">=</span><span class="n">iders</span><span class="p">,</span>
        <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;n_edges&#39;</span><span class="p">,</span>
        <span class="n">sort_reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="c1">#sortby=&#39;aid1&#39;,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">name_api</span></div>


<div class="viewcode-block" id="make_edge_api"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.make_edge_api">[docs]</a><span class="k">def</span> <span class="nf">make_edge_api</span><span class="p">(</span><span class="n">infr</span><span class="p">,</span> <span class="n">review_cfg</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO:</span>
<span class="sd">        mark an edge that would cause an inconsistency</span>
<span class="sd">        to be marked as a deeper red.</span>
<span class="sd">        These are edges we currently believe to be false</span>
<span class="sd">        By default edges should not be red. they should be a light unknown yellow.</span>
<span class="sd">        Dark unknown yellow is for noncomparable annotations</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">review_cfg</span><span class="p">[</span><span class="s1">&#39;hack_min_review&#39;</span><span class="p">]:</span>
        <span class="k">assert</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edges_and_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">infr</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">review_cfg</span><span class="p">[</span><span class="s1">&#39;filter_photobombs&#39;</span><span class="p">]:</span>
            <span class="n">edges_and_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">edge</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">edges_and_data</span>
                              <span class="k">if</span> <span class="s1">&#39;photobomb&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">review_cfg</span><span class="p">[</span><span class="s1">&#39;filter_reviewed&#39;</span><span class="p">]:</span>
            <span class="n">edges_and_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">edge</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">edges_and_data</span>
                              <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;evidence_decision&#39;</span><span class="p">,</span> <span class="n">UNREV</span><span class="p">)</span> <span class="o">!=</span> <span class="n">UNREV</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">review_cfg</span><span class="p">[</span><span class="s1">&#39;filter_true_matches&#39;</span><span class="p">]:</span>
            <span class="n">edges_and_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">edge</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">edges_and_data</span>
                              <span class="k">if</span> <span class="ow">not</span> <span class="n">infr</span><span class="o">.</span><span class="n">pos_redun_edge_flag</span><span class="p">(</span><span class="n">edge</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">review_cfg</span><span class="p">[</span><span class="s1">&#39;filter_false_matches&#39;</span><span class="p">]:</span>
            <span class="n">edges_and_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">edge</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">edges_and_data</span>
                              <span class="k">if</span> <span class="ow">not</span> <span class="n">infr</span><span class="o">.</span><span class="n">neg_redun_edge_flag</span><span class="p">(</span><span class="o">*</span><span class="n">edge</span><span class="p">)]</span>
        <span class="n">aids1</span><span class="p">,</span> <span class="n">aids2</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">listT</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">edges_and_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># aids1, aids2 = infr.get_filtered_edges(review_cfg)</span>

    <span class="bp">self</span> <span class="o">=</span> <span class="n">EdgeAPIHelper</span><span class="p">(</span><span class="n">infr</span><span class="p">)</span>
    <span class="n">partial_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_partial_edge_headers</span><span class="p">()</span>
    <span class="c1"># from six import next</span>
    <span class="c1"># data = next(infr.graph.edges(data=True))[-1]</span>

    <span class="c1">#if not DEVELOPER_MODE:</span>
    <span class="c1">#    col_name_list.remove(&#39;data&#39;)</span>
    <span class="n">col_name_list</span> <span class="o">=</span> <span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;edge_col_name_list&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">review_cfg</span><span class="p">[</span><span class="s1">&#39;show_match_thumb&#39;</span><span class="p">]:</span>
        <span class="c1"># FIXME: do one-vs-one scoring instead</span>
        <span class="n">col_name_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;match_thumb&#39;</span><span class="p">)</span>

    <span class="n">col_getter_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aids1</span><span class="p">)),</span>
        <span class="s1">&#39;aid1&#39;</span><span class="p">:</span> <span class="n">aids1</span><span class="p">,</span>
        <span class="s1">&#39;aid2&#39;</span><span class="p">:</span> <span class="n">aids2</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">col_getter_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;col_getter_dict&#39;</span><span class="p">])</span>

    <span class="n">edge_api</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">CustomAPI</span><span class="p">(</span>
        <span class="n">col_name_list</span><span class="p">,</span>
        <span class="n">col_ider_dict</span><span class="o">=</span><span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;col_ider_dict&#39;</span><span class="p">],</span>
        <span class="n">col_types_dict</span><span class="o">=</span><span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;col_types_dict&#39;</span><span class="p">],</span>
        <span class="n">col_getter_dict</span><span class="o">=</span><span class="n">col_getter_dict</span><span class="p">,</span>
        <span class="n">col_bgrole_dict</span><span class="o">=</span><span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;col_bgrole_dict&#39;</span><span class="p">],</span>
        <span class="n">col_display_role_func_dict</span><span class="o">=</span><span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;col_display_role_func_dict&#39;</span><span class="p">],</span>
        <span class="n">col_width_dict</span><span class="o">=</span><span class="n">partial_headers</span><span class="p">[</span><span class="s1">&#39;col_width_dict&#39;</span><span class="p">],</span>
        <span class="n">get_thumb_size</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">221</span><span class="p">,</span>
        <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span>
        <span class="c1">#sortby=&#39;aid1&#39;,</span>
        <span class="n">sort_reverse</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="c1"># api = edge_api</span>
    <span class="k">return</span> <span class="n">edge_api</span></div>


<div class="viewcode-block" id="make_node_api"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.make_node_api">[docs]</a><span class="k">def</span> <span class="nf">make_node_api</span><span class="p">(</span><span class="n">infr</span><span class="p">):</span>
    <span class="n">aids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">()))</span>
    <span class="n">col_name_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span> <span class="s1">&#39;thumb&#39;</span><span class="p">,</span> <span class="s1">&#39;name_label&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_node_data</span><span class="p">(</span><span class="n">aid</span><span class="p">):</span>
        <span class="n">node_dict</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">nx_node_dict</span><span class="p">(</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">node_dict</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">delete_dict_keys</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">infr</span><span class="o">.</span><span class="n">visual_node_attrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">node_dict</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">nx_node_dict</span><span class="p">(</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
    <span class="n">col_getter_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;aid&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aids</span><span class="p">),</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">get_node_data</span><span class="p">,</span>
        <span class="s1">&#39;thumb&#39;</span><span class="p">:</span> <span class="n">infr</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chip_thumbtup</span><span class="p">,</span>
        <span class="s1">&#39;name_label&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name_label&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">col_ider_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;thumb&#39;</span><span class="p">:</span> <span class="s1">&#39;aid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;aid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name_label&#39;</span><span class="p">:</span> <span class="s1">&#39;aid&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">col_types_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;thumb&#39;</span><span class="p">:</span> <span class="s1">&#39;PIXMAP&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">node_api</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">CustomAPI</span><span class="p">(</span><span class="n">col_name_list</span><span class="p">,</span>
                            <span class="n">col_ider_dict</span><span class="o">=</span><span class="n">col_ider_dict</span><span class="p">,</span>
                            <span class="n">col_types_dict</span><span class="o">=</span><span class="n">col_types_dict</span><span class="p">,</span>
                            <span class="n">col_getter_dict</span><span class="o">=</span><span class="n">col_getter_dict</span><span class="p">,</span>
                            <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span> <span class="n">sort_reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">node_api</span></div>


<div class="viewcode-block" id="make_name_node_api"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.make_name_node_api">[docs]</a><span class="k">def</span> <span class="nf">make_name_node_api</span><span class="p">(</span><span class="n">infr</span><span class="p">,</span> <span class="n">review_cfg</span><span class="o">=</span><span class="p">{}):</span>
    <span class="c1"># TODO: only make this API if the tab is clicked</span>
    <span class="n">node_to_name</span> <span class="o">=</span> <span class="n">infr</span><span class="o">.</span><span class="n">get_node_attrs</span><span class="p">(</span><span class="s1">&#39;name_label&#39;</span><span class="p">)</span>
    <span class="n">name_to_nodes</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">group_items</span><span class="p">(</span><span class="n">node_to_name</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">node_to_name</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="bp">self</span> <span class="o">=</span> <span class="n">EdgeAPIHelper</span><span class="p">(</span><span class="n">infr</span><span class="p">)</span>

    <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">name_to_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">flat_aids</span><span class="p">,</span> <span class="n">grouped_aid_idxs</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">invertible_flatten1</span><span class="p">(</span><span class="n">name_to_nodes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="n">col_name_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;name_label&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_annots&#39;</span><span class="p">,</span>
        <span class="s1">&#39;aid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;thumb&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name_label2&#39;</span>
    <span class="p">]</span>
    <span class="n">col_level_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name_label&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;n_annots&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;aid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;thumb&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;name_label2&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">iders</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">))),</span>
        <span class="n">grouped_aid_idxs</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">node_dict</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">nx_node_dict</span><span class="p">(</span><span class="n">infr</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
    <span class="n">col_getter_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;thumb&#39;</span><span class="p">:</span> <span class="n">infr</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chip_thumbtup</span><span class="p">,</span>
        <span class="s1">&#39;name_label&#39;</span><span class="p">:</span> <span class="n">names</span><span class="p">,</span>
        <span class="s1">&#39;n_annots&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">grouped_aid_idxs</span><span class="p">)),</span>
        <span class="s1">&#39;aid&#39;</span><span class="p">:</span> <span class="n">flat_aids</span><span class="p">,</span>
        <span class="s1">&#39;name_label2&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name_label&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">col_ider_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;thumb&#39;</span><span class="p">:</span> <span class="s1">&#39;aid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name_label2&#39;</span><span class="p">:</span> <span class="s1">&#39;aid&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">col_types_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;thumb&#39;</span><span class="p">:</span> <span class="s1">&#39;PIXMAP&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">col_bgrole_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;inference&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inference_bgrole</span><span class="p">,</span>
        <span class="s1">&#39;review&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_review_bgrole</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">name_api</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">CustomAPI</span><span class="p">(</span>
        <span class="n">col_name_list</span><span class="p">,</span>
        <span class="n">iders</span><span class="o">=</span><span class="n">iders</span><span class="p">,</span>
        <span class="c1"># col_types_dict=col_types_dict,</span>
        <span class="n">col_ider_dict</span><span class="o">=</span><span class="n">col_ider_dict</span><span class="p">,</span>
        <span class="n">col_getter_dict</span><span class="o">=</span><span class="n">col_getter_dict</span><span class="p">,</span>
        <span class="n">col_types_dict</span><span class="o">=</span><span class="n">col_types_dict</span><span class="p">,</span>
        <span class="n">col_bgrole_dict</span><span class="o">=</span><span class="n">col_bgrole_dict</span><span class="p">,</span>
        <span class="c1"># col_display_role_func_dict=col_display_role_func_dict,</span>
        <span class="c1"># col_width_dict=col_width_dict,</span>
        <span class="n">get_thumb_size</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">221</span><span class="p">,</span>
        <span class="n">col_level_dict</span><span class="o">=</span><span class="n">col_level_dict</span><span class="p">,</span>
        <span class="n">sortby</span><span class="o">=</span><span class="s1">&#39;n_annots&#39;</span><span class="p">,</span>
        <span class="n">sort_reverse</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">name_api</span></div>


<div class="viewcode-block" id="make_qt_graph_review"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.make_qt_graph_review">[docs]</a><span class="k">def</span> <span class="nf">make_qt_graph_review</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        ibeis make_qt_graph_review --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.viz.viz_graph2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import guitool as gt</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; defaultdb = &#39;PZ_MTEST&#39;</span>
<span class="sd">        &gt;&gt;&gt; qreq_ = ibeis.testdata_qreq_(defaultdb=defaultdb)</span>
<span class="sd">        &gt;&gt;&gt; cm_list = qreq_.execute()</span>
<span class="sd">        &gt;&gt;&gt; gt.ensure_qtapp()</span>
<span class="sd">        &gt;&gt;&gt; win = make_qt_graph_review(qreq_, cm_list)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; gt.qtapp_loop(qwin=win, freq=10)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gt</span><span class="o">.</span><span class="n">ensure_qtapp</span><span class="p">()</span>
    <span class="kn">import</span> <span class="nn">ibeis</span>
    <span class="n">infr</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">AnnotInference</span><span class="o">.</span><span class="n">from_qreq_</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">)</span>

    <span class="n">gt</span><span class="o">.</span><span class="n">ensure_qtapp</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;infr = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">infr</span><span class="p">,))</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">AnnotGraphWidget</span><span class="p">(</span><span class="n">infr</span><span class="o">=</span><span class="n">infr</span><span class="p">,</span> <span class="n">use_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">init_mode</span><span class="o">=</span><span class="s1">&#39;review&#39;</span><span class="p">)</span>
    <span class="n">abstract_interaction</span><span class="o">.</span><span class="n">register_interaction</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>
    <span class="n">win</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">win</span></div>


<div class="viewcode-block" id="make_qt_graph_interface"><a class="viewcode-back" href="../../../ibeis.viz.html#ibeis.viz.viz_graph2.make_qt_graph_interface">[docs]</a><span class="k">def</span> <span class="nf">make_qt_graph_interface</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">init_mode</span><span class="o">=</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="n">graph_tab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        ibeis make_qt_graph_interface --dbdir ~/lev/media/hdd/work/WWF_Lynx/ --show --nids=281 --graphtab</span>
<span class="sd">        ibeis make_qt_graph_interface --dbdir ~/lev/media/hdd/work/WWF_Lynx/ --show --gids=2289 --graphtab</span>

<span class="sd">        ibeis make_qt_graph_interface --dbdir ~/lev/media/hdd/work/WWF_Lynx/ --show --graph-tab --aids=2587,2398</span>
<span class="sd">        ibeis make_qt_graph_interface --show</span>
<span class="sd">        ibeis make_qt_graph_interface --show --db PZ_PB_RF_TRAIN</span>

<span class="sd">        ibeis make_qt_graph_interface --show --aids=1,2,3,4,5,6,7,8,9 --graph-tab</span>
<span class="sd">        ibeis make_qt_graph_interface --show --aids=1,2,3,4,5,6,7,8,9</span>
<span class="sd">        ibeis make_qt_graph_interface --show</span>

<span class="sd">        ibeis make_qt_graph_interface --show --db RotanTurtles --aids=610,716</span>

<span class="sd">        ibeis make_qt_graph_interface --db LEWA_splits --nids=1 --show --sample</span>

<span class="sd">        ibeis make_qt_graph_interface --db PZ_MTEST --nids=1 --show --init-mode=rereview</span>

<span class="sd">        ibeis make_qt_graph_interface --dbdir=~/lev/media/danger/GGR/GGR-IBEIS --nids=2300 --show</span>
<span class="sd">        ibeis make_qt_graph_interface --dbdir=~/lev/media/danger/GGR/GGR-IBEIS --nids=4617 --show</span>

<span class="sd">        # unmount</span>
<span class="sd">        fusermount -u ~/lev</span>
<span class="sd">        # mount</span>
<span class="sd">        sshfs -o idmap=user lev:/ ~/lev</span>
<span class="sd">        ibeis make_qt_graph_interface --dbdir=/home/joncrall/lev/media/hdd/work/EWT_Cheetahs --show -a default:view=right;frontright;backright</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.viz.viz_graph2 import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import guitool as gt</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; defaultdb = &#39;PZ_MTEST&#39;</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(defaultdb=defaultdb)</span>
<span class="sd">        &gt;&gt;&gt; aids = ut.get_argval(&#39;--aids&#39;, type_=list, default=None)</span>
<span class="sd">        &gt;&gt;&gt; nids = ut.get_argval(&#39;--nids&#39;, type_=list, default=None)</span>
<span class="sd">        &gt;&gt;&gt; gids = ut.get_argval(&#39;--gids&#39;, type_=list, default=None)</span>
<span class="sd">        &gt;&gt;&gt; init_mode = ut.get_argval(&#39;--init_mode&#39;, default=&#39;review&#39;)</span>
<span class="sd">        &gt;&gt;&gt; graph_tab = ut.get_argflag(&#39;--graph-tab&#39;)</span>
<span class="sd">        &gt;&gt;&gt; gt.ensure_qtapp()</span>
<span class="sd">        &gt;&gt;&gt; win = make_qt_graph_interface(ibs, aids, nids, gids, init_mode, graph_tab)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; gt.qtapp_loop(qwin=win, freq=10)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[qt_graph] make_qt_graph_interface init()&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[qt_graph] nids = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">trunc_repr</span><span class="p">(</span><span class="n">nids</span><span class="p">),))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[qt_graph] aids = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">trunc_repr</span><span class="p">(</span><span class="n">aids</span><span class="p">),))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[qt_graph] gids = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">trunc_repr</span><span class="p">(</span><span class="n">gids</span><span class="p">),))</span>
    <span class="k">if</span> <span class="n">gids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_image_nids</span><span class="p">(</span><span class="n">gids</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">nids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">aids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">aids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_name_aids</span><span class="p">(</span><span class="n">nids</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">aids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># import ibeis</span>
        <span class="c1"># aids = ibeis.testdata_aids(ibs=ibs)</span>
        <span class="c1"># [&#39;right&#39;, &#39;frontright&#39;, &#39;backright&#39;]</span>
        <span class="n">aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
        <span class="c1"># aids = ibs.filter_annots_general(max_pername=2, min_pername=2)</span>
        <span class="c1"># aids = ibs.filter_annots_general(view=[&#39;right&#39;, &#39;frontright&#39;, &#39;backright&#39;])</span>
        <span class="c1"># [0:20]</span>
    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--sample&#39;</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="n">aids</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">aids</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;make_qt_graph_interface aids = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aids</span><span class="p">,))</span>
    <span class="n">nids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_name_rowids</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">ibeis</span>
    <span class="c1"># infr = ibeis.AnnotInference(ibs, aids, nids, verbose=ut.VERBOSE)</span>
    <span class="n">infr</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">AnnotInference</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aids</span><span class="p">,</span> <span class="n">nids</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">infr</span><span class="o">.</span><span class="n">initialize_graph</span><span class="p">()</span>

    <span class="n">gt</span><span class="o">.</span><span class="n">ensure_qtapp</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;infr = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">infr</span><span class="p">,))</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">AnnotGraphWidget</span><span class="p">(</span><span class="n">infr</span><span class="o">=</span><span class="n">infr</span><span class="p">,</span> <span class="n">use_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">init_mode</span><span class="o">=</span><span class="n">init_mode</span><span class="p">)</span>
    <span class="n">abstract_interaction</span><span class="o">.</span><span class="n">register_interaction</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>
    <span class="n">win</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">graph_tab</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">win</span><span class="o">.</span><span class="n">graph_tab_widget</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">graph_tab</span><span class="p">)</span>
        <span class="n">win</span><span class="o">.</span><span class="n">graph_tab_widget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;win.graph_widget.use_image_cb.setChecked = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">win</span><span class="o">.</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">use_image_cb</span><span class="o">.</span><span class="n">setChecked</span><span class="p">,))</span>
        <span class="n">win</span><span class="o">.</span><span class="n">graph_widget</span><span class="o">.</span><span class="n">use_image_cb</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># match = ut.get_argval(&#39;--match&#39;, type_=list, default=None)</span>
    <span class="c1"># print(&#39;match = %r&#39; % (match,))</span>
    <span class="c1"># if match:</span>
    <span class="c1">#     win.mark_pair_state([match], POSTV)</span>

    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">win</span><span class="o">.</span><span class="n">expand_image_and_names</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">win</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.viz.viz_graph2</span>
<span class="sd">        python -m ibeis.viz.viz_graph2 --allexamples</span>
<span class="sd">        ibeis make_qt_graph_interface --show --aids=1,2,3,4,5,6,7,8,9 --graph</span>

<span class="sd">        python -m ibeis.viz.viz_graph2 make_qt_graph_interface --show --aids=1,2,3,4,5,6,7 --graph --match=1,4 --nomatch=3,1,5,7</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>
    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c1"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>  <span class="c1"># NOQA</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Wild Me

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>