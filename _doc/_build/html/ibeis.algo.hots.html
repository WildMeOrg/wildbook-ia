

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ibeis.algo.hots package &mdash; ibeis 1.9.0.vulcan documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ibeis.algo.preproc package" href="ibeis.algo.preproc.html" />
    <link rel="prev" title="ibeis.algo.graph.tests package" href="ibeis.algo.graph.tests.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> ibeis
          

          
          </a>

          
            
            
              <div class="version">
                1.9.0.vulcan
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="ibeis.html">ibeis package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="ibeis.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="ibeis.algo.html">ibeis.algo package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="ibeis.algo.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibeis.algo.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibeis.algo.html#module-ibeis.algo.Config">ibeis.algo.Config module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibeis.algo.html#module-ibeis.algo">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ibeis.control.html">ibeis.control package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibeis.dbio.html">ibeis.dbio package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibeis.expt.html">ibeis.expt package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibeis.gui.html">ibeis.gui package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibeis.init.html">ibeis.init package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibeis.other.html">ibeis.other package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibeis.scripts.html">ibeis.scripts package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibeis.templates.html">ibeis.templates package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibeis.tests.html">ibeis.tests package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibeis.viz.html">ibeis.viz package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibeis.web.html">ibeis.web package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.__main__">ibeis.__main__ module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis._devcmds_ibeis">ibeis._devcmds_ibeis module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis._devscript">ibeis._devscript module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis._ibeis_object">ibeis._ibeis_object module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.annotmatch_funcs">ibeis.annotmatch_funcs module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.annots">ibeis.annots module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.constants">ibeis.constants module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.core_annots">ibeis.core_annots module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.core_images">ibeis.core_images module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.core_parts">ibeis.core_parts module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.dev">ibeis.dev module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.filter_configs">ibeis.filter_configs module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.images">ibeis.images module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.main_module">ibeis.main_module module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.params">ibeis.params module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis.tag_funcs">ibeis.tag_funcs module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.html#module-ibeis">Module contents</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ibeis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="ibeis.html">ibeis package</a> &raquo;</li>
        
          <li><a href="ibeis.algo.html">ibeis.algo package</a> &raquo;</li>
        
      <li>ibeis.algo.hots package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ibeis.algo.hots.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ibeis-algo-hots-package">
<h1>ibeis.algo.hots package<a class="headerlink" href="#ibeis-algo-hots-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-ibeis.algo.hots._pipeline_helpers">
<span id="ibeis-algo-hots-pipeline-helpers-module"></span><h2>ibeis.algo.hots._pipeline_helpers module<a class="headerlink" href="#module-ibeis.algo.hots._pipeline_helpers" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.algo.hots._pipeline_helpers.testdata_post_sver">
<code class="descclassname">ibeis.algo.hots._pipeline_helpers.</code><code class="descname">testdata_post_sver</code><span class="sig-paren">(</span><em>defaultdb='PZ_MTEST'</em>, <em>qaid_list=None</em>, <em>daid_list=None</em>, <em>codename='vsmany'</em>, <em>cfgdict=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/_pipeline_helpers.html#testdata_post_sver"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots._pipeline_helpers.testdata_post_sver" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots._pipeline_helpers</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots._pipeline_helpers.testdata_pre">
<code class="descclassname">ibeis.algo.hots._pipeline_helpers.</code><code class="descname">testdata_pre</code><span class="sig-paren">(</span><em>stopnode, defaultdb='testdb1', p=['default'], a=['default:qindex=0:1,dindex=0:5'], **kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/_pipeline_helpers.html#testdata_pre"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots._pipeline_helpers.testdata_pre" title="Permalink to this definition">¶</a></dt>
<dd><p>New (1-1-2016) generic pipeline node testdata getter</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stopnode</strong> (<em>str</em>) – name of pipeline function to be tested</li>
<li><strong>defaultdb</strong> (<em>str</em>) – (default = u’testdb1’)</li>
<li><strong>p</strong> (<em>list</em>) – (default = [u’default:’])</li>
<li><strong>a</strong> (<em>list</em>) – (default = [u’default:qsize=1,dsize=4’])</li>
<li><strong>**kwargs</strong> – passed to <a href="#id1"><span class="problematic" id="id2">testdata_qreq_</span></a>
qaid_override, daid_override</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">(ibs, <a href="#id3"><span class="problematic" id="id4">qreq_</span></a>, args)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots._pipeline_helpers –exec-testdata_pre –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots._pipeline_helpers</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stopnode</span> <span class="o">=</span> <span class="s1">&#39;build_chipmatches&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">defaultdb</span> <span class="o">=</span> <span class="s1">&#39;testdb1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;default:&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;default:qindex=0:1,dindex=0:5&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">testdata_pre</span><span class="p">(</span><span class="n">stopnode</span><span class="p">,</span> <span class="n">defaultdb</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots._pipeline_helpers.testdata_pre_baselinefilter">
<code class="descclassname">ibeis.algo.hots._pipeline_helpers.</code><code class="descname">testdata_pre_baselinefilter</code><span class="sig-paren">(</span><em>defaultdb='testdb1'</em>, <em>qaid_list=None</em>, <em>daid_list=None</em>, <em>codename='vsmany'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/_pipeline_helpers.html#testdata_pre_baselinefilter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots._pipeline_helpers.testdata_pre_baselinefilter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots._pipeline_helpers.testdata_pre_sver">
<code class="descclassname">ibeis.algo.hots._pipeline_helpers.</code><code class="descname">testdata_pre_sver</code><span class="sig-paren">(</span><em>defaultdb='PZ_MTEST'</em>, <em>qaid_list=None</em>, <em>daid_list=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/_pipeline_helpers.html#testdata_pre_sver"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots._pipeline_helpers.testdata_pre_sver" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots._pipeline_helpers</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots._pipeline_helpers.testdata_sparse_matchinfo_nonagg">
<code class="descclassname">ibeis.algo.hots._pipeline_helpers.</code><code class="descname">testdata_sparse_matchinfo_nonagg</code><span class="sig-paren">(</span><em>defaultdb='testdb1', p=['default']</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/_pipeline_helpers.html#testdata_sparse_matchinfo_nonagg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots._pipeline_helpers.testdata_sparse_matchinfo_nonagg" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots._pipeline_helpers.testrun_pipeline_upto">
<code class="descclassname">ibeis.algo.hots._pipeline_helpers.</code><code class="descname">testrun_pipeline_upto</code><span class="sig-paren">(</span><em>qreq_</em>, <em>stop_node='end'</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/_pipeline_helpers.html#testrun_pipeline_upto"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots._pipeline_helpers.testrun_pipeline_upto" title="Permalink to this definition">¶</a></dt>
<dd><p>Main tester function. Runs the pipeline by mirroring
<cite>request_ibeis_query_L0</cite>, but stops at a requested breakpoint and returns
the local variables.</p>
<p>convinience: runs pipeline for tests
this should mirror request_ibeis_query_L0</p>
<dl class="docutils">
<dt>Ignore:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># TODO: autogenerate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The following is a stub that starts the autogeneration process</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots</span> <span class="k">import</span> <span class="n">pipeline</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">source</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_func_sourcecode</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">request_ibeis_query_L0</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                <span class="n">strip_docstr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stripdef</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                <span class="n">strip_comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">re</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">source</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*$\n&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">replace_between_tags</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">sentinal</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.chip_match">
<span id="ibeis-algo-hots-chip-match-module"></span><h2>ibeis.algo.hots.chip_match module<a class="headerlink" href="#module-ibeis.algo.hots.chip_match" title="Permalink to this headline">¶</a></h2>
<p>python -m utool.util_inspect check_module_usage –pat=”chip_match.py”</p>
<dl class="class">
<dt id="ibeis.algo.hots.chip_match.AnnotMatch">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">AnnotMatch</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#AnnotMatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.AnnotMatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#ibeis.algo.hots.chip_match.MatchBaseIO" title="ibeis.algo.hots.chip_match.MatchBaseIO"><code class="xref py py-class docutils literal notranslate"><span class="pre">ibeis.algo.hots.chip_match.MatchBaseIO</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ibeis.algo.hots.chip_match._BaseVisualization</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ibeis.algo.hots.chip_match._AnnotMatchConvenienceGetter</span></code></p>
<p>This implements part the match between whole annotations and the other
annotaions / names. This does not include algorithm specific feature
matches.</p>
<dl class="method">
<dt id="ibeis.algo.hots.chip_match.AnnotMatch.evaluate_dnids">
<code class="descname">evaluate_dnids</code><span class="sig-paren">(</span><em>qreq_=None</em>, <em>ibs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#AnnotMatch.evaluate_dnids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.AnnotMatch.evaluate_dnids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="ibeis.algo.hots.chip_match.AnnotMatch.from_dict">
<em class="property">classmethod </em><code class="descname">from_dict</code><span class="sig-paren">(</span><em>class_dict</em>, <em>ibs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#AnnotMatch.from_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.AnnotMatch.from_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert dict of arguments back to ChipMatch object</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.AnnotMatch.initialize">
<code class="descname">initialize</code><span class="sig-paren">(</span><em>qaid=None</em>, <em>daid_list=None</em>, <em>score_list=None</em>, <em>dnid_list=None</em>, <em>qnid=None</em>, <em>unique_nids=None</em>, <em>name_score_list=None</em>, <em>annot_score_list=None</em>, <em>autoinit=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#AnnotMatch.initialize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.AnnotMatch.initialize" title="Permalink to this definition">¶</a></dt>
<dd><p>qaid and daid_list are not optional. fm_list and fsv_list are strongly
encouraged and will probalby break things if they are not there.</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.AnnotMatch.set_cannonical_annot_score">
<code class="descname">set_cannonical_annot_score</code><span class="sig-paren">(</span><em>annot_score_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#AnnotMatch.set_cannonical_annot_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.AnnotMatch.set_cannonical_annot_score" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.AnnotMatch.set_cannonical_name_score">
<code class="descname">set_cannonical_name_score</code><span class="sig-paren">(</span><em>annot_score_list</em>, <em>name_score_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#AnnotMatch.set_cannonical_name_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.AnnotMatch.set_cannonical_name_score" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.AnnotMatch.to_dict">
<code class="descname">to_dict</code><span class="sig-paren">(</span><em>ibs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#AnnotMatch.to_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.AnnotMatch.to_dict" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ibeis.algo.hots.chip_match.ChipMatch">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">ChipMatch</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ibeis.algo.hots.chip_match._ChipMatchVisualization</span></code>, <a class="reference internal" href="#ibeis.algo.hots.chip_match.AnnotMatch" title="ibeis.algo.hots.chip_match.AnnotMatch"><code class="xref py py-class docutils literal notranslate"><span class="pre">ibeis.algo.hots.chip_match.AnnotMatch</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ibeis.algo.hots.chip_match._ChipMatchScorers</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ibeis.algo.hots.old_chip_match._OldStyleChipMatchSimulator</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ibeis.algo.hots.chip_match._ChipMatchConvenienceGetter</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ibeis.algo.hots.chip_match._ChipMatchDebugger</span></code></p>
<p>behaves as as the ChipMatchOldTup named tuple until we
completely replace the old structure</p>
<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.append_featscore_column">
<code class="descname">append_featscore_column</code><span class="sig-paren">(</span><em>filtkey</em>, <em>filtweight_list</em>, <em>inplace=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.append_featscore_column"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.append_featscore_column" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.arraycast_self">
<code class="descname">arraycast_self</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.arraycast_self"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.arraycast_self" title="Permalink to this definition">¶</a></dt>
<dd><p>Ensures internal structure is in numpy array formats
TODO: come up with better name
Remove old initialize method and rename to initialize?</p>
</dd></dl>

<dl class="classmethod">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.combine_cms">
<em class="property">classmethod </em><code class="descname">combine_cms</code><span class="sig-paren">(</span><em>cm_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.combine_cms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.combine_cms" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.core_annots</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">depc</span><span class="p">,</span> <span class="n">aid_list</span> <span class="o">=</span> <span class="n">testdata_core</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">new_request</span><span class="p">(</span><span class="s1">&#39;vsone&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;dim_size&#39;</span><span class="p">:</span> <span class="mi">450</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rawres_list2</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">postprocess</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">rawres_list2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">ChipMatch</span><span class="o">.</span><span class="n">combine_cms</span><span class="p">(</span><span class="n">cm_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span><span class="o">.</span><span class="n">score_name_nsum</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span><span class="o">.</span><span class="n">ishow_analysis</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.compress_annots">
<code class="descname">compress_annots</code><span class="sig-paren">(</span><em>flags</em>, <em>inplace=False</em>, <em>keepscores=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.compress_annots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.compress_annots" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.compress_results">
<code class="descname">compress_results</code><span class="sig-paren">(</span><em>inplace=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.compress_results"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.compress_results" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.compress_top_feature_matches">
<code class="descname">compress_top_feature_matches</code><span class="sig-paren">(</span><em>num=10</em>, <em>rng=&lt;module 'numpy.random' from '/Users/jason.parham/virtualenv/wildme3/lib/python3.6/site-packages/numpy/random/__init__.py'&gt;</em>, <em>use_random=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.compress_top_feature_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.compress_top_feature_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>DO NOT USE</p>
<p>FIXME: Use boolean lists</p>
<p>Removes all but the best feature matches for testing purposes
rng = np.random.RandomState(0)</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.extend_results">
<code class="descname">extend_results</code><span class="sig-paren">(</span><em>qreq_</em>, <em>other_aids=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.extend_results"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.extend_results" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new ChipMatch containing empty data for an extended set of
aids</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<em>ibeis.QueryRequest</em>) – query request object with hyper-parameters</li>
<li><strong>other_aids</strong> (<em>None</em>) – (default = None)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">out</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ibeis.ChipMatch</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.chip_match –exec-extend_results –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.chip_match</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_cm</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                              <span class="n">a</span><span class="o">=</span><span class="s1">&#39;default:dindex=0:10,qindex=0:1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                              <span class="n">t</span><span class="o">=</span><span class="s1">&#39;best:SV=False&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">daid_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">assert_self</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">other_aids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">extend_results</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">other_aids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">daid_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">118</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span><span class="o">.</span><span class="n">assert_self</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.from_dict">
<em class="property">classmethod </em><code class="descname">from_dict</code><span class="sig-paren">(</span><em>class_dict</em>, <em>ibs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.from_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.from_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert dict of arguments back to ChipMatch object</p>
</dd></dl>

<dl class="classmethod">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.from_json">
<em class="property">classmethod </em><code class="descname">from_json</code><span class="sig-paren">(</span><em>json_str</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.from_json"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.from_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert json string back to ChipMatch object</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd># FIXME: util_test is broken with classmethods
python -m ibeis.algo.hots.chip_match –test-from_json –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.chip_match</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm1</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_cm</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_str</span> <span class="o">=</span> <span class="n">cm1</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">ChipMatch</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">score_name_nsum</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">show_single_namematch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.get_fpath">
<code class="descname">get_fpath</code><span class="sig-paren">(</span><em>qreq_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.get_fpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.get_fpath" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.initialize">
<code class="descname">initialize</code><span class="sig-paren">(</span><em>qaid=None</em>, <em>daid_list=None</em>, <em>fm_list=None</em>, <em>fsv_list=None</em>, <em>fk_list=None</em>, <em>score_list=None</em>, <em>H_list=None</em>, <em>fsv_col_lbls=None</em>, <em>dnid_list=None</em>, <em>qnid=None</em>, <em>unique_nids=None</em>, <em>name_score_list=None</em>, <em>annot_score_list=None</em>, <em>autoinit=True</em>, <em>filtnorm_aids=None</em>, <em>filtnorm_fxs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.initialize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.initialize" title="Permalink to this definition">¶</a></dt>
<dd><p>qaid and daid_list are not optional. fm_list and fsv_list are strongly
encouraged and will probalby break things if they are not there.</p>
</dd></dl>

<dl class="classmethod">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.load_from_fpath">
<em class="property">classmethod </em><code class="descname">load_from_fpath</code><span class="sig-paren">(</span><em>fpath</em>, <em>verbose=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.load_from_fpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.load_from_fpath" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.rrr">
<code class="descname">rrr</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>reload_module=True</em><span class="sig-paren">)</span><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.rrr" title="Permalink to this definition">¶</a></dt>
<dd><p>special class reloading function
This function is often injected as rrr of classes</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.save">
<code class="descname">save</code><span class="sig-paren">(</span><em>qreq_</em>, <em>verbose=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.save" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.shortlist_subset">
<code class="descname">shortlist_subset</code><span class="sig-paren">(</span><em>top_aids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.shortlist_subset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.shortlist_subset" title="Permalink to this definition">¶</a></dt>
<dd><p>returns a new cmtup_old with only the requested daids
TODO: rectify with take_feature_matches</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.sortself">
<code class="descname">sortself</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.sortself"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.sortself" title="Permalink to this definition">¶</a></dt>
<dd><p>reorders the internal data using cm.score_list</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.take_annots">
<code class="descname">take_annots</code><span class="sig-paren">(</span><em>idx_list</em>, <em>inplace=False</em>, <em>keepscores=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.take_annots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.take_annots" title="Permalink to this definition">¶</a></dt>
<dd><p>Keeps results only for the selected annotation indices.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.chip_match take_annots</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.chip_match</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_cm</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                              <span class="n">a</span><span class="o">=</span><span class="s1">&#39;default:dindex=0:10,qindex=0:1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                              <span class="n">t</span><span class="o">=</span><span class="s1">&#39;best:sv=False&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">num_daids</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">keepscores</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">other</span> <span class="o">=</span> <span class="n">out</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">take_annots</span><span class="p">(</span><span class="n">idx_list</span><span class="p">,</span> <span class="n">inplace</span><span class="p">,</span> <span class="n">keepscores</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;out = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">1</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Because the subset was all aids in order, the output</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ChipMatch should be exactly the same.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">cm</span><span class="o">.</span><span class="n">inspect_difference</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="s1">&#39;Should be exactly equal!&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.chip_match</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_cm</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                              <span class="n">a</span><span class="o">=</span><span class="s1">&#39;default:dindex=0:10,qindex=0:1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                              <span class="n">t</span><span class="o">=</span><span class="s1">&#39;best:SV=False&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">keepscores</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">other</span> <span class="o">=</span> <span class="n">out</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">take_annots</span><span class="p">(</span><span class="n">idx_list</span><span class="p">,</span> <span class="n">inplace</span><span class="p">,</span> <span class="n">keepscores</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;out = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">1</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.take_feature_matches">
<code class="descname">take_feature_matches</code><span class="sig-paren">(</span><em>indicies_list</em>, <em>inplace=False</em>, <em>keepscores=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.take_feature_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.take_feature_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes outlier feature matches
TODO: rectify with shortlist_subset</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>indicies_list</strong> (<em>list</em>) – list of lists of indicies to keep.
if an item is None, the match to the corresponding daid is
removed.</li>
<li><strong>inplace</strong> (<em>bool</em>) – (default = False)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">out</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ibeis.ChipMatch</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.chip_match –exec-take_feature_matches –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.chip_match</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_cm</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="s1">&#39;default:dindex=0:10,qindex=0:1&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s1">&#39;best:SV=False&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">indicies_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">num_daids</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">keepscores</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">take_feature_matches</span><span class="p">(</span><span class="n">indicies_list</span><span class="p">,</span> <span class="n">inplace</span><span class="p">,</span> <span class="n">keepscores</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">cm</span><span class="o">.</span><span class="n">inspect_difference</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="s1">&#39;should be different&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;out = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">out</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.ChipMatch.to_json">
<code class="descname">to_json</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#ChipMatch.to_json"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.ChipMatch.to_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Serialize ChipMatch object as JSON string</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.chip_match –test-ChipMatch.to_json:0
python -m ibeis.algo.hots.chip_match –test-ChipMatch.to_json
python -m ibeis.algo.hots.chip_match –test-ChipMatch.to_json:1 –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Simple doctest demonstrating the json format</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.chip_match</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_cm</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">compress_top_feature_matches</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Serialize</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Raw ChipMatch JSON:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_str</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Pretty ChipMatch JSON:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Pretty String Formatting</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dictrep</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dictrep</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">delete_dict_keys</span><span class="p">(</span><span class="n">dictrep</span><span class="p">,</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dictrep</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span>  <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2_json</span><span class="p">(</span><span class="n">dictrep</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">key_order_metric</span><span class="o">=</span><span class="s1">&#39;strlen&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># test to convert back and forth from json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.chip_match</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_cm</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm1</span> <span class="o">=</span> <span class="n">cm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Serialize</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_str</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">json_str</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Unserialize</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">ChipMatch</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Show if it works</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">score_name_nsum</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">show_single_namematch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># result = (&#39;json_str = \n%s&#39; % (str(json_str),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># print(result)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ibeis.algo.hots.chip_match.MatchBaseIO">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">MatchBaseIO</code><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#MatchBaseIO"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.MatchBaseIO" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="method">
<dt id="ibeis.algo.hots.chip_match.MatchBaseIO.copy">
<code class="descname">copy</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#MatchBaseIO.copy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.MatchBaseIO.copy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="ibeis.algo.hots.chip_match.MatchBaseIO.load_from_fpath">
<em class="property">classmethod </em><code class="descname">load_from_fpath</code><span class="sig-paren">(</span><em>fpath</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#MatchBaseIO.load_from_fpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.MatchBaseIO.load_from_fpath" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.MatchBaseIO.save_to_fpath">
<code class="descname">save_to_fpath</code><span class="sig-paren">(</span><em>fpath</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#MatchBaseIO.save_to_fpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.MatchBaseIO.save_to_fpath" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python ibeis –tf MatchBaseIO.save_to_fpath –verbtest –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.chip_match</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="mi">18</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre_sver</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="p">[</span><span class="n">qaid</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">score_name_nsum</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_app_resource_dir</span><span class="p">(</span><span class="s1">&#39;ibeis&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="s1">&#39;tmp_chipmatch.cPkl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">save_to_fpath</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm2</span> <span class="o">=</span> <span class="n">ChipMatch</span><span class="o">.</span><span class="n">load_from_fpath</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">cm</span> <span class="o">==</span> <span class="n">cm2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">ishow_analysis</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="exception">
<dt id="ibeis.algo.hots.chip_match.NeedRecomputeError">
<em class="property">exception </em><code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">NeedRecomputeError</code><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#NeedRecomputeError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.NeedRecomputeError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="class">
<dt id="ibeis.algo.hots.chip_match.TestLogger">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">TestLogger</code><span class="sig-paren">(</span><em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#TestLogger"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.TestLogger" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="method">
<dt id="ibeis.algo.hots.chip_match.TestLogger.context">
<code class="descname">context</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#TestLogger.context"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.TestLogger.context" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.TestLogger.end_test">
<code class="descname">end_test</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#TestLogger.end_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.TestLogger.end_test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.TestLogger.log_failed">
<code class="descname">log_failed</code><span class="sig-paren">(</span><em>msg</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#TestLogger.log_failed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.TestLogger.log_failed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.TestLogger.log_passed">
<code class="descname">log_passed</code><span class="sig-paren">(</span><em>msg</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#TestLogger.log_passed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.TestLogger.log_passed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.TestLogger.log_skipped">
<code class="descname">log_skipped</code><span class="sig-paren">(</span><em>msg</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#TestLogger.log_skipped"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.TestLogger.log_skipped" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.TestLogger.skip_test">
<code class="descname">skip_test</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#TestLogger.skip_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.TestLogger.skip_test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.chip_match.TestLogger.start_test">
<code class="descname">start_test</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#TestLogger.start_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.TestLogger.start_test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.aslist">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">aslist</code><span class="sig-paren">(</span><em>arr</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#aslist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.aslist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.check_arrs_eq">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">check_arrs_eq</code><span class="sig-paren">(</span><em>arr1</em>, <em>arr2</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#check_arrs_eq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.check_arrs_eq" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.convert_numpy">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">convert_numpy</code><span class="sig-paren">(</span><em>arr</em>, <em>dtype</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#convert_numpy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.convert_numpy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.convert_numpy_lists">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">convert_numpy_lists</code><span class="sig-paren">(</span><em>arr_list</em>, <em>dtype</em>, <em>dims=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#convert_numpy_lists"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.convert_numpy_lists" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.extend_nplists">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">extend_nplists</code><span class="sig-paren">(</span><em>x_list</em>, <em>num</em>, <em>shape</em>, <em>dtype</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#extend_nplists"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.extend_nplists" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.extend_nplists_">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">extend_nplists_</code><span class="sig-paren">(</span><em>x_list</em>, <em>num</em>, <em>shape</em>, <em>dtype</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#extend_nplists_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.extend_nplists_" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.extend_pylist">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">extend_pylist</code><span class="sig-paren">(</span><em>x_list</em>, <em>num</em>, <em>val</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#extend_pylist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.extend_pylist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.extend_pylist_">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">extend_pylist_</code><span class="sig-paren">(</span><em>x_list</em>, <em>num</em>, <em>val</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#extend_pylist_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.extend_pylist_" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.extend_scores">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">extend_scores</code><span class="sig-paren">(</span><em>vals</em>, <em>num</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#extend_scores"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.extend_scores" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.filtnorm_op">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">filtnorm_op</code><span class="sig-paren">(</span><em>filtnorm_</em>, <em>op_</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#filtnorm_op"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.filtnorm_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.get_chipmatch_fname">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">get_chipmatch_fname</code><span class="sig-paren">(</span><em>qaid</em>, <em>qreq_</em>, <em>qauuid=None</em>, <em>cfgstr=None</em>, <em>TRUNCATE_UUIDS=False</em>, <em>MAX_FNAME_LEN=200</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#get_chipmatch_fname"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.get_chipmatch_fname" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.chip_match –test-get_chipmatch_fname</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.chip_match</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;spatial_verification&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:sqrd_dist_on=True&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">cm_list_FILT</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fname</span> <span class="o">=</span> <span class="n">get_chipmatch_fname</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">qaid</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">qauuid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                            <span class="n">TRUNCATE_UUIDS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MAX_FNAME_LEN</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">fname</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>qaid=18_cm_cvgrsbnffsgifyom_quuid=a126d459-b730-573e-7a21-92894b016565.cPkl</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.prepare_dict_uuids">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">prepare_dict_uuids</code><span class="sig-paren">(</span><em>class_dict</em>, <em>ibs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#prepare_dict_uuids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.prepare_dict_uuids" title="Permalink to this definition">¶</a></dt>
<dd><p>Hacks to ensure proper uuid conversion</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.safe_check_lens_eq">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">safe_check_lens_eq</code><span class="sig-paren">(</span><em>None</em>, <em>1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#safe_check_lens_eq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.safe_check_lens_eq" title="Permalink to this definition">¶</a></dt>
<dd><p>safe_check_lens_eq([3], [2, 4])</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.safe_check_nested_lens_eq">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">safe_check_nested_lens_eq</code><span class="sig-paren">(</span><em>None</em>, <em>1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#safe_check_nested_lens_eq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.safe_check_nested_lens_eq" title="Permalink to this definition">¶</a></dt>
<dd><p>safe_check_nested_lens_eq([[3, 4]], [[2, 4]])
safe_check_nested_lens_eq([[1, 2, 3], [1, 2]], [[1, 2, 3], [1, 2]])
safe_check_nested_lens_eq([[1, 2, 3], [1, 2]], [[1, 2, 3], [1]])</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.safecast_numpy_lists">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">safecast_numpy_lists</code><span class="sig-paren">(</span><em>arr_list</em>, <em>dtype=None</em>, <em>dims=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#safecast_numpy_lists"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.safecast_numpy_lists" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.safeop">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">safeop</code><span class="sig-paren">(</span><em>op_</em>, <em>xs</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#safeop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.safeop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.chip_match.testdata_cm">
<code class="descclassname">ibeis.algo.hots.chip_match.</code><code class="descname">testdata_cm</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/chip_match.html#testdata_cm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.chip_match.testdata_cm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.exceptions">
<span id="ibeis-algo-hots-exceptions-module"></span><h2>ibeis.algo.hots.exceptions module<a class="headerlink" href="#module-ibeis.algo.hots.exceptions" title="Permalink to this headline">¶</a></h2>
<dl class="exception">
<dt id="ibeis.algo.hots.exceptions.HotsCacheMissError">
<em class="property">exception </em><code class="descclassname">ibeis.algo.hots.exceptions.</code><code class="descname">HotsCacheMissError</code><a class="reference internal" href="_modules/ibeis/algo/hots/exceptions.html#HotsCacheMissError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.exceptions.HotsCacheMissError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="exception">
<dt id="ibeis.algo.hots.exceptions.HotsNeedsRecomputeError">
<em class="property">exception </em><code class="descclassname">ibeis.algo.hots.exceptions.</code><code class="descname">HotsNeedsRecomputeError</code><a class="reference internal" href="_modules/ibeis/algo/hots/exceptions.html#HotsNeedsRecomputeError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.exceptions.HotsNeedsRecomputeError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.exceptions.NoDescriptorsException">
<code class="descclassname">ibeis.algo.hots.exceptions.</code><code class="descname">NoDescriptorsException</code><span class="sig-paren">(</span><em>ibs</em>, <em>qaid</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/exceptions.html#NoDescriptorsException"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.exceptions.NoDescriptorsException" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ibeis.algo.hots.exceptions.QueryException">
<em class="property">exception </em><code class="descclassname">ibeis.algo.hots.exceptions.</code><code class="descname">QueryException</code><span class="sig-paren">(</span><em>msg</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/exceptions.html#QueryException"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.exceptions.QueryException" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.hstypes">
<span id="ibeis-algo-hots-hstypes-module"></span><h2>ibeis.algo.hots.hstypes module<a class="headerlink" href="#module-ibeis.algo.hots.hstypes" title="Permalink to this headline">¶</a></h2>
<p>hstypes
Todo:
* SIFT: Root_SIFT -&gt; L2 normalized -&gt; Centering.
# <a class="reference external" href="http://hal.archives-ouvertes.fr/docs/00/84/07/21/PDF/RR-8325.pdf">http://hal.archives-ouvertes.fr/docs/00/84/07/21/PDF/RR-8325.pdf</a>
The devil is in the deatails
<a class="reference external" href="http://www.robots.ox.ac.uk/~vilem/bmvc2011.pdf">http://www.robots.ox.ac.uk/~vilem/bmvc2011.pdf</a>
This says dont clip, do rootsift instead
# <a class="reference external" href="http://hal.archives-ouvertes.fr/docs/00/68/81/69/PDF/hal_v1.pdf">http://hal.archives-ouvertes.fr/docs/00/68/81/69/PDF/hal_v1.pdf</a>
* Quantization of residual vectors
* Burstiness normalization for N-SMK
* Implemented A-SMK
* Incorporate Spatial Verification
* Implement correct cfgstrs based on algorithm input
for cached computations.
* Color by word
* Profile on hyrule
* Train vocab on paris
* Remove self matches.
* New SIFT parameters for pyhesaff (root, powerlaw, meanwhatever, output_dtype)</p>
<p>Issues:
* 10GB are in use when performing query on Oxford 5K
* errors when there is a word without any database vectors.
currently a weight of zero is hacked in</p>
<dl class="class">
<dt id="ibeis.algo.hots.hstypes.FiltKeys">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.hstypes.</code><code class="descname">FiltKeys</code><a class="reference internal" href="_modules/ibeis/algo/hots/hstypes.html#FiltKeys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.hstypes.FiltKeys" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="attribute">
<dt id="ibeis.algo.hots.hstypes.FiltKeys.BARL2">
<code class="descname">BARL2</code><em class="property"> = 'bar_l2'</em><a class="headerlink" href="#ibeis.algo.hots.hstypes.FiltKeys.BARL2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.hstypes.FiltKeys.DIST">
<code class="descname">DIST</code><em class="property"> = 'dist'</em><a class="headerlink" href="#ibeis.algo.hots.hstypes.FiltKeys.DIST" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.hstypes.FiltKeys.DISTINCTIVENESS">
<code class="descname">DISTINCTIVENESS</code><em class="property"> = 'distinctiveness'</em><a class="headerlink" href="#ibeis.algo.hots.hstypes.FiltKeys.DISTINCTIVENESS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.hstypes.FiltKeys.FG">
<code class="descname">FG</code><em class="property"> = 'fg'</em><a class="headerlink" href="#ibeis.algo.hots.hstypes.FiltKeys.FG" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.hstypes.FiltKeys.HOMOGERR">
<code class="descname">HOMOGERR</code><em class="property"> = 'homogerr'</em><a class="headerlink" href="#ibeis.algo.hots.hstypes.FiltKeys.HOMOGERR" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.hstypes.FiltKeys.LNBNN">
<code class="descname">LNBNN</code><em class="property"> = 'lnbnn'</em><a class="headerlink" href="#ibeis.algo.hots.hstypes.FiltKeys.LNBNN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.hstypes.FiltKeys.RATIO">
<code class="descname">RATIO</code><em class="property"> = 'ratio'</em><a class="headerlink" href="#ibeis.algo.hots.hstypes.FiltKeys.RATIO" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="data">
<dt id="ibeis.algo.hots.hstypes.PSEUDO_UINT8_MAX_SQRD">
<code class="descclassname">ibeis.algo.hots.hstypes.</code><code class="descname">PSEUDO_UINT8_MAX_SQRD</code><em class="property"> = 262144.0</em><a class="headerlink" href="#ibeis.algo.hots.hstypes.PSEUDO_UINT8_MAX_SQRD" title="Permalink to this definition">¶</a></dt>
<dd><p>vt.distance.understanding_pseudomax_props</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">SeeAlso</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.match_chips4">
<span id="ibeis-algo-hots-match-chips4-module"></span><h2>ibeis.algo.hots.match_chips4 module<a class="headerlink" href="#module-ibeis.algo.hots.match_chips4" title="Permalink to this headline">¶</a></h2>
<p>Runs functions in pipeline to get query reuslts and does some caching.</p>
<dl class="function">
<dt id="ibeis.algo.hots.match_chips4.execute_query2">
<code class="descclassname">ibeis.algo.hots.match_chips4.</code><code class="descname">execute_query2</code><span class="sig-paren">(</span><em>qreq_</em>, <em>verbose</em>, <em>save_qcache</em>, <em>batch_size=None</em>, <em>use_supercache=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/match_chips4.html#execute_query2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.match_chips4.execute_query2" title="Permalink to this definition">¶</a></dt>
<dd><p>Breaks up query request into several subrequests
to process “more efficiently” and safer as well.</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.match_chips4.execute_query_and_save_L1">
<code class="descclassname">ibeis.algo.hots.match_chips4.</code><code class="descname">execute_query_and_save_L1</code><span class="sig-paren">(</span><em>qreq_</em>, <em>use_cache</em>, <em>save_qcache</em>, <em>verbose=True</em>, <em>batch_size=None</em>, <em>use_supercache=False</em>, <em>invalidate_supercache=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/match_chips4.html#execute_query_and_save_L1"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.match_chips4.execute_query_and_save_L1" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<em>ibeis.QueryRequest</em>) – </li>
<li><strong>use_cache</strong> (<em>bool</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">qaid2_cm</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.match_chips4 execute_query_and_save_L1:0
python -m ibeis.algo.hots.match_chips4 execute_query_and_save_L1:1
python -m ibeis.algo.hots.match_chips4 execute_query_and_save_L1:2
python -m ibeis.algo.hots.match_chips4 execute_query_and_save_L1:3</dd>
<dt>Example0:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># xdoctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.match_chips4</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s1">&#39;vsmany&#39;</span><span class="p">,</span> <span class="n">sv_on</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_cfg_lbl</span><span class="p">(</span><span class="n">cfgdict1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">main_helpers</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span><span class="p">,</span> <span class="n">save_qcache</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_cm</span> <span class="o">=</span> <span class="n">execute_query_and_save_L1</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">,</span> <span class="n">save_qcache</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qaid2_cm</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># xdoctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.match_chips4</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s1">&#39;vsone&#39;</span><span class="p">,</span> <span class="n">sv_on</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_cfg_lbl</span><span class="p">(</span><span class="n">cfgdict1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">main_helpers</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span><span class="p">,</span> <span class="n">save_qcache</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_cm</span> <span class="o">=</span> <span class="n">execute_query_and_save_L1</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">,</span> <span class="n">save_qcache</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qaid2_cm</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># xdoctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># TEST SAVE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.match_chips4</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s1">&#39;vsmany&#39;</span><span class="p">,</span> <span class="n">sv_on</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_cfg_lbl</span><span class="p">(</span><span class="n">cfgdict1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">main_helpers</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span><span class="p">,</span> <span class="n">save_qcache</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_cm</span> <span class="o">=</span> <span class="n">execute_query_and_save_L1</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">,</span> <span class="n">save_qcache</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qaid2_cm</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># xdoctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># TEST LOAD</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.match_chips4</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s1">&#39;vsmany&#39;</span><span class="p">,</span> <span class="n">sv_on</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_cfg_lbl</span><span class="p">(</span><span class="n">cfgdict1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">main_helpers</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span><span class="p">,</span> <span class="n">save_qcache</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_cm</span> <span class="o">=</span> <span class="n">execute_query_and_save_L1</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">,</span> <span class="n">save_qcache</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qaid2_cm</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># TEST PARTIAL HIT</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.match_chips4</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s1">&#39;vsmany&#39;</span><span class="p">,</span> <span class="n">sv_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prescore_method</span><span class="o">=</span><span class="s1">&#39;csum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_cfg_lbl</span><span class="p">(</span><span class="n">cfgdict1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">main_helpers</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                              <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                              <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span><span class="p">,</span> <span class="n">save_qcache</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_cm</span> <span class="o">=</span> <span class="n">execute_query_and_save_L1</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                     <span class="n">save_qcache</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                     <span class="n">batch_size</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">qaid2_cm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">get_fpath</span><span class="p">(</span><span class="n">qreq_</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">qaid2_cm</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">get_fpath</span><span class="p">(</span><span class="n">qreq_</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">qaid2_cm</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">get_fpath</span><span class="p">(</span><span class="n">qreq_</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">qaid2_cm</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">get_fpath</span><span class="p">(</span><span class="n">qreq_</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Re-execute&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_cm_</span> <span class="o">=</span> <span class="n">execute_query_and_save_L1</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                      <span class="n">save_qcache</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                      <span class="n">batch_size</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">qaid2_cm_</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span> <span class="o">==</span> <span class="n">qaid2_cm</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span> <span class="k">for</span> <span class="n">qaid</span> <span class="ow">in</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">ut</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_chipmatch_fpaths</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">)]</span>
</pre></div>
</div>
</dd>
<dt>Ignore:</dt>
<dd>other = <a href="#id5"><span class="problematic" id="id6">cm_</span></a> = qaid2_cm_[qaid]
cm = qaid2_cm[qaid]</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.match_chips4.submit_query_request">
<code class="descclassname">ibeis.algo.hots.match_chips4.</code><code class="descname">submit_query_request</code><span class="sig-paren">(</span><em>qreq_</em>, <em>use_cache=None</em>, <em>use_bigcache=None</em>, <em>verbose=None</em>, <em>save_qcache=None</em>, <em>use_supercache=None</em>, <em>invalidate_supercache=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/match_chips4.html#submit_query_request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.match_chips4.submit_query_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Called from <a href="#id7"><span class="problematic" id="id8">qreq_</span></a>.execute</p>
<p>Checks a big cache for qaid2_cm.  If cache miss, tries to load each cm
individually.  On an individual cache miss, it preforms the query.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.match_chips4 –test-submit_query_request</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># xdoctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.match_chips4</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_bigcache</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">submit_query_request</span><span class="p">(</span><span class="n">qreq_</span><span class="o">=</span><span class="n">qreq_</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.name_scoring">
<span id="ibeis-algo-hots-name-scoring-module"></span><h2>ibeis.algo.hots.name_scoring module<a class="headerlink" href="#module-ibeis.algo.hots.name_scoring" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ibeis.algo.hots.name_scoring.NameScoreTup">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.name_scoring.</code><code class="descname">NameScoreTup</code><span class="sig-paren">(</span><em>sorted_nids</em>, <em>sorted_nscore</em>, <em>sorted_aids</em>, <em>sorted_scores</em><span class="sig-paren">)</span><a class="headerlink" href="#ibeis.algo.hots.name_scoring.NameScoreTup" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></p>
<dl class="attribute">
<dt id="ibeis.algo.hots.name_scoring.NameScoreTup.sorted_aids">
<code class="descname">sorted_aids</code><a class="headerlink" href="#ibeis.algo.hots.name_scoring.NameScoreTup.sorted_aids" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.name_scoring.NameScoreTup.sorted_nids">
<code class="descname">sorted_nids</code><a class="headerlink" href="#ibeis.algo.hots.name_scoring.NameScoreTup.sorted_nids" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.name_scoring.NameScoreTup.sorted_nscore">
<code class="descname">sorted_nscore</code><a class="headerlink" href="#ibeis.algo.hots.name_scoring.NameScoreTup.sorted_nscore" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.name_scoring.NameScoreTup.sorted_scores">
<code class="descname">sorted_scores</code><a class="headerlink" href="#ibeis.algo.hots.name_scoring.NameScoreTup.sorted_scores" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.name_scoring.align_name_scores_with_annots">
<code class="descclassname">ibeis.algo.hots.name_scoring.</code><code class="descname">align_name_scores_with_annots</code><span class="sig-paren">(</span><em>annot_score_list</em>, <em>annot_aid_list</em>, <em>daid2_idx</em>, <em>name_groupxs</em>, <em>name_score_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/name_scoring.html#align_name_scores_with_annots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.name_scoring.align_name_scores_with_annots" title="Permalink to this definition">¶</a></dt>
<dd><p>takes name scores and gives them to the best annotation</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">list of scores aligned with cm.daid_list and cm.dnid_list</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">score_list</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>annot_score_list</strong> (<em>list</em>) – score associated with each annot</li>
<li><strong>name_groupxs</strong> (<em>list</em>) – groups annot_score lists into groups compatible with name_score_list</li>
<li><strong>name_score_list</strong> (<em>list</em>) – score assocated with name</li>
<li><strong>nid2_nidx</strong> (<em>dict</em>) – mapping from nids to index in name score list</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.name_scoring –test-align_name_scores_with_annots
python -m ibeis.algo.hots.name_scoring –test-align_name_scores_with_annots –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.name_scoring</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_post_sver</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">evaluate_csum_annot_score</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">evaluate_nsum_name_score</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Annot aligned lists</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">annot_score_list</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">algo_annot_scores</span><span class="p">[</span><span class="s1">&#39;csum&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">annot_aid_list</span>   <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">daid_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_idx</span>        <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">daid2_idx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Name aligned lists</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_score_list</span>  <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">algo_name_scores</span><span class="p">[</span><span class="s1">&#39;nsum&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_groupxs</span>     <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">name_groupxs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Execute Function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_list</span> <span class="o">=</span> <span class="n">align_name_scores_with_annots</span><span class="p">(</span><span class="n">annot_score_list</span><span class="p">,</span> <span class="n">annot_aid_list</span><span class="p">,</span> <span class="n">daid2_idx</span><span class="p">,</span> <span class="n">name_groupxs</span><span class="p">,</span> <span class="n">name_score_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Check that the correct name gets the highest score</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">name_score_list</span><span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">nid2_nidx</span><span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">qnid</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">score_list</span> <span class="o">==</span> <span class="n">target</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">score_list</span> <span class="o">=</span> <span class="n">score_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_name_rowids</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">daid_list</span><span class="p">[</span><span class="n">test_index</span><span class="p">]),</span> <span class="n">cm</span><span class="o">.</span><span class="n">qnid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">ut</span><span class="o">.</span><span class="n">isunique</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">dnid_list</span><span class="p">[</span><span class="n">score_list</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;bad name score&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_idx</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">algo_name_scores</span><span class="p">[</span><span class="s1">&#39;nsum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_top_nids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cm</span><span class="o">.</span><span class="n">unique_nids</span><span class="p">[</span><span class="n">top_idx</span><span class="p">],</span> <span class="s1">&#39;bug in alignment&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">show_ranked_matches</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.name_scoring</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">annot_score_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">annot_aid_list</span>   <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_idx</span>        <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Name aligned lists</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_score_list</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_groupxs</span>     <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Execute Function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_list</span> <span class="o">=</span> <span class="n">align_name_scores_with_annots</span><span class="p">(</span><span class="n">annot_score_list</span><span class="p">,</span> <span class="n">annot_aid_list</span><span class="p">,</span> <span class="n">daid2_idx</span><span class="p">,</span> <span class="n">name_groupxs</span><span class="p">,</span> <span class="n">name_score_list</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.name_scoring.compute_fmech_score">
<code class="descclassname">ibeis.algo.hots.name_scoring.</code><code class="descname">compute_fmech_score</code><span class="sig-paren">(</span><em>cm</em>, <em>qreq_=None</em>, <em>hack_single_ori=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/name_scoring.html#compute_fmech_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.name_scoring.compute_fmech_score" title="Permalink to this definition">¶</a></dt>
<dd><p>nsum. This is the fmech scoring mechanism.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>cm</strong> (<em>ibeis.ChipMatch</em>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">(unique_nids, nsum_score_list)</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.name_scoring –test-compute_fmech_score
python -m ibeis.algo.hots.name_scoring –test-compute_fmech_score:0
python -m ibeis.algo.hots.name_scoring –test-compute_fmech_score:2
utprof.py -m ibeis.algo.hots.name_scoring –test-compute_fmech_score:2
utprof.py -m ibeis.algo.hots.pipeline –test-request_ibeis_query_L0:0 –db PZ_Master1 -a timectrl:qindex=0:256</dd>
<dt>Example0:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.name_scoring</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">testdata_chipmatch</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nsum_score_list</span> <span class="o">=</span> <span class="n">compute_fmech_score</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">nsum_score_list</span> <span class="o">==</span> <span class="p">[</span> <span class="mf">4.</span><span class="p">,</span>  <span class="mf">7.</span><span class="p">,</span>  <span class="mf">5.</span><span class="p">])</span>
</pre></div>
</div>
</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.name_scoring</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_post_sver</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">evaluate_dnids</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">_cast_scores</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#cm.qnid = 1   # Hack for testdb1 names</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nsum_score_list</span> <span class="o">=</span> <span class="n">compute_fmech_score</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#assert np.all(nsum_nid_list == cm.unique_nids), &#39;nids out of alignment&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">unique_nids</span> <span class="o">==</span> <span class="n">cm</span><span class="o">.</span><span class="n">qnid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">max_true</span> <span class="o">=</span> <span class="n">nsum_score_list</span><span class="p">[</span><span class="n">flags</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">max_false</span> <span class="o">=</span> <span class="n">nsum_score_list</span><span class="p">[</span><span class="o">~</span><span class="n">flags</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">max_true</span> <span class="o">&gt;</span> <span class="n">max_false</span><span class="p">,</span> <span class="s1">&#39;is this truely a hard case?&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">max_true</span> <span class="o">&gt;</span> <span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;score=</span><span class="si">%r</span><span class="s1"> should be higher for aid=18&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">max_true</span><span class="p">,)</span>
</pre></div>
</div>
</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.name_scoring</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_post_sver</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">cfgdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">query_rotation_heuristic</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">score_name_nsum</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">show_ranked_matches</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">ori</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example3:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.name_scoring</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#ibs, qreq_, cm_list = plh.testdata_pre_sver(&#39;testdb1&#39;, qaid_list=[1])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_post_sver</span><span class="p">(</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cfgdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">query_rotation_heuristic</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">score_name_nsum</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">show_ranked_matches</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">ori</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.name_scoring.get_chipmatch_namescore_nonvoting_feature_flags">
<code class="descclassname">ibeis.algo.hots.name_scoring.</code><code class="descname">get_chipmatch_namescore_nonvoting_feature_flags</code><span class="sig-paren">(</span><em>cm</em>, <em>qreq_=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/name_scoring.html#get_chipmatch_namescore_nonvoting_feature_flags"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.name_scoring.get_chipmatch_namescore_nonvoting_feature_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>DEPRICATE</p>
<p>Computes flags to desribe which features can or can not vote</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.name_scoring –exec-get_chipmatch_namescore_nonvoting_feature_flags</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># FIXME: breaks when fg_on=True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.name_scoring</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots</span> <span class="k">import</span> <span class="n">name_scoring</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Test to make sure name score and chips score are equal when per_name=1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;spatial_verification&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:dpername=1,qsize=1,dsize=10&#39;</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:K=1,fg_on=True&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">cm_list_FILT</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">evaluate_dnids</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">featflat_list</span> <span class="o">=</span> <span class="n">get_chipmatch_namescore_nonvoting_feature_flags</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">,</span> <span class="n">featflat_list</span><span class="p">))),</span> <span class="s1">&#39;all features should be able to vote in K=1, per_name=1 case&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.name_scoring.get_namescore_nonvoting_feature_flags">
<code class="descclassname">ibeis.algo.hots.name_scoring.</code><code class="descname">get_namescore_nonvoting_feature_flags</code><span class="sig-paren">(</span><em>fm_list</em>, <em>fs_list</em>, <em>dnid_list</em>, <em>name_groupxs</em>, <em>kpts1=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/name_scoring.html#get_namescore_nonvoting_feature_flags"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.name_scoring.get_namescore_nonvoting_feature_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>DEPRICATE</p>
<p>fm_list = [fm[:min(len(fm), 10)] for fm in fm_list]
fs_list = [fs[:min(len(fs), 10)] for fs in fs_list]</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.name_scoring.testdata_chipmatch">
<code class="descclassname">ibeis.algo.hots.name_scoring.</code><code class="descname">testdata_chipmatch</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/name_scoring.html#testdata_chipmatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.name_scoring.testdata_chipmatch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.neighbor_index">
<span id="ibeis-algo-hots-neighbor-index-module"></span><h2>ibeis.algo.hots.neighbor_index module<a class="headerlink" href="#module-ibeis.algo.hots.neighbor_index" title="Permalink to this headline">¶</a></h2>
<p>multi_index.py as well</p>
<p><a class="reference external" href="https://github.com/spotify/annoy">https://github.com/spotify/annoy</a></p>
<dl class="class">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.neighbor_index.</code><code class="descname">NeighborIndex</code><span class="sig-paren">(</span><em>flann_params</em>, <em>cfgstr</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>wrapper class around flann
stores flann index and data it needs to index into</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_nnindexer</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.add_ibeis_support">
<code class="descname">add_ibeis_support</code><span class="sig-paren">(</span><em>qreq_</em>, <em>new_daid_list</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.add_ibeis_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.add_ibeis_support" title="Permalink to this definition">¶</a></dt>
<dd><p># TODO: ensure that the memcache changes appropriately</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.add_support">
<code class="descname">add_support</code><span class="sig-paren">(</span><em>new_daid_list</em>, <em>new_vecs_list</em>, <em>new_fgws_list</em>, <em>new_fxs_list</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.add_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.add_support" title="Permalink to this definition">¶</a></dt>
<dd><p>adds support data (aka data to be indexed)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>new_daid_list</strong> (<em>list</em>) – list of annotation ids that are being added</li>
<li><strong>new_vecs_list</strong> (<em>list</em>) – list of descriptor vectors for each annotation</li>
<li><strong>new_fgws_list</strong> (<em>list</em>) – list of weights per vector for each annotation</li>
<li><strong>verbose</strong> (<em>bool</em>) – verbosity flag(default = True)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index –test-add_support</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_nnindexer</span><span class="p">(</span><span class="n">use_memcache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_daid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">config2_</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_query_config2</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># get before data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx1</span><span class="p">,</span> <span class="n">qfx2_dist1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_vecs_list</span><span class="p">,</span> <span class="n">new_fgws_list</span><span class="p">,</span> <span class="n">new_fxs_list</span> <span class="o">=</span> <span class="n">get_support_data</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">new_daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># execute test function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="o">.</span><span class="n">add_support</span><span class="p">(</span><span class="n">new_daid_list</span><span class="p">,</span> <span class="n">new_vecs_list</span><span class="p">,</span> <span class="n">new_fgws_list</span><span class="p">,</span> <span class="n">new_fxs_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># test before data vs after data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx2</span><span class="p">,</span> <span class="n">qfx2_dist2</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qfx2_idx2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">qfx2_idx1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.batch_knn">
<code class="descname">batch_knn</code><span class="sig-paren">(</span><em>vecs</em>, <em>K</em>, <em>chunksize=4096</em>, <em>label='batch knn'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.batch_knn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.batch_knn" title="Permalink to this definition">¶</a></dt>
<dd><p>Works like <cite>indexer.knn</cite> but the input is split into batches and
progress is reported to give an esimated time remaining.</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.build_and_save">
<code class="descname">build_and_save</code><span class="sig-paren">(</span><em>cachedir</em>, <em>verbose=True</em>, <em>memtrack=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.build_and_save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.build_and_save" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.debug_nnindexer">
<code class="descname">debug_nnindexer</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.debug_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.debug_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes sure the indexer has valid SIFT descriptors</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.empty_neighbors">
<code class="descname">empty_neighbors</code><span class="sig-paren">(</span><em>nQfx</em>, <em>K</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.empty_neighbors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.empty_neighbors" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.ensure_indexer">
<code class="descname">ensure_indexer</code><span class="sig-paren">(</span><em>cachedir</em>, <em>verbose=True</em>, <em>force_rebuild=False</em>, <em>memtrack=None</em>, <em>prog_hook=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.ensure_indexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.ensure_indexer" title="Permalink to this definition">¶</a></dt>
<dd><p>Ensures that you get a neighbor indexer. It either loads a chached
indexer or rebuilds a new one.</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.ext">
<code class="descname">ext</code><em class="property"> = '.flann'</em><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.ext" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_cfgstr">
<code class="descname">get_cfgstr</code><span class="sig-paren">(</span><em>noquery=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd><p>returns string which uniquely identified configuration and support data</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>noquery</strong> (<em>bool</em>) – if True cfgstr is only relevant to building the
index. No search params are returned (default = False)</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">flann_cfgstr</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index –test-get_cfgstr</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fg_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:fg_on=False&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">load_indexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">indexer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">noquery</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flann_cfgstr</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">(</span><span class="n">noquery</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;flann_cfgstr = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">flann_cfgstr</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">flann_cfgstr = _FLANN((algo=kdtree,seed=42,t=8,))_VECS((11260,128)gj5nea@ni0%f3aja)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_dtype">
<code class="descname">get_dtype</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_dtype"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_dtype" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_fname">
<code class="descname">get_fname</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_fname"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_fname" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_fpath">
<code class="descname">get_fpath</code><span class="sig-paren">(</span><em>cachedir</em>, <em>cfgstr=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_fpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_fpath" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_indexed_aids">
<code class="descname">get_indexed_aids</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_indexed_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_indexed_aids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_indexed_vecs">
<code class="descname">get_indexed_vecs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_indexed_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_indexed_vecs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_nn_aids">
<code class="descname">get_nn_aids</code><span class="sig-paren">(</span><em>qfx2_nnidx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_nn_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_nn_aids" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qfx2_nnidx</strong> – (N x K) qfx2_idx[n][k] is the index of the kth
approximate nearest data vector</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="docutils">
<dt>(N x K) qfx2_fx[n][k] is the annotation id index of the</dt>
<dd>kth approximate nearest data vector</dd>
</dl>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">qfx2_aid</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index –exec-get_nn_aids</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fg_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:fg_on=False,dim_size=450,resize_dim=area&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">load_indexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">indexer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">config2_</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_query_config2</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_neighbors</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_nnidx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">num_neighbors</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_aid</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">get_nn_aids</span><span class="p">(</span><span class="n">qfx2_nnidx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qfx2_aid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_neighbors</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;qfx2_aid.shape = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qfx2_aid</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qfx2_aid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">qfx2_aid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">1300</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_nn_axs">
<code class="descname">get_nn_axs</code><span class="sig-paren">(</span><em>qfx2_nnidx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_nn_axs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_nn_axs" title="Permalink to this definition">¶</a></dt>
<dd><p>gets matching internal annotation indices</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_nn_featxs">
<code class="descname">get_nn_featxs</code><span class="sig-paren">(</span><em>qfx2_nnidx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_nn_featxs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_nn_featxs" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qfx2_nnidx</strong> – (N x K) qfx2_idx[n][k] is the index of the kth
approximate nearest data vector</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="docutils">
<dt>(N x K) qfx2_fx[n][k] is the feature index (w.r.t the</dt>
<dd>source annotation) of the kth approximate
nearest data vector</dd>
</dl>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">qfx2_fx</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_nn_fgws">
<code class="descname">get_nn_fgws</code><span class="sig-paren">(</span><em>qfx2_nnidx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_nn_fgws"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_nn_fgws" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets forground weights of neighbors</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis –tf NeighborIndex.get_nn_fgws</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qfx2_nnidx</strong> – (N x K) qfx2_idx[n][k] is the index of the kth
approximate nearest data vector</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="docutils">
<dt>(N x K) qfx2_fgw[n][k] is the annotation id index of the</dt>
<dd>kth forground weight</dd>
</dl>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">qfx2_fgw</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_nnindexer</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_nnidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_fgw</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">get_nn_fgws</span><span class="p">(</span><span class="n">qfx2_nnidx</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_nn_nids">
<code class="descname">get_nn_nids</code><span class="sig-paren">(</span><em>qfx2_nnidx</em>, <em>qreq_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_nn_nids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_nn_nids" title="Permalink to this definition">¶</a></dt>
<dd><p>iccv hack, todo: make faster by direct lookup from idx</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_nn_vecs">
<code class="descname">get_nn_vecs</code><span class="sig-paren">(</span><em>qfx2_nnidx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_nn_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_nn_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>gets matching vectors</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_prefix">
<code class="descname">get_prefix</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_prefix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_prefix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.get_removed_idxs">
<code class="descname">get_removed_idxs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.get_removed_idxs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.get_removed_idxs" title="Permalink to this definition">¶</a></dt>
<dd><p>__removed_ids = nnindexer.flann._FLANN__removed_ids
invalid_idxs = nnindexer.get_removed_idxs()
assert len(np.intersect1d(invalid_idxs, __removed_ids)) == len(__removed_ids)</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.init_support">
<code class="descname">init_support</code><span class="sig-paren">(</span><em>aid_list</em>, <em>vecs_list</em>, <em>fgws_list</em>, <em>fxs_list</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.init_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.init_support" title="Permalink to this definition">¶</a></dt>
<dd><p>prepares inverted indicies and FLANN data structure</p>
<p>flattens vecs_list and builds a reverse index from the flattened indices
(idx) to the original aids and fxs</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.knn">
<code class="descname">knn</code><span class="sig-paren">(</span><em>qfx2_vec</em>, <em>K</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.knn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.knn" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the indices and squared distance to the nearest K neighbors.
The distance is noramlized between zero and one using
VEC_PSEUDO_MAX_DISTANCE = (np.sqrt(2) * VEC_PSEUDO_MAX)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>qfx2_vec</strong> – (N x D) an array of N, D-dimensional query vectors</li>
<li><strong>K</strong> – number of approximate nearest neighbors to find</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Returns: tuple of (qfx2_idx, qfx2_dist)</dt>
<dd><dl class="first last docutils">
<dt>ndarray <span class="classifier-delimiter">:</span> <span class="classifier">qfx2_idx[n][k] (N x K) is the index of the kth</span></dt>
<dd>approximate nearest data vector w.r.t qfx2_vec[n]</dd>
<dt>ndarray <span class="classifier-delimiter">:</span> <span class="classifier">qfx2_dist[n][k] (N x K) is the distance to the kth</span></dt>
<dd>approximate nearest data vector w.r.t. qfx2_vec[n]
distance is normalized squared euclidean distance.</dd>
</dl>
</dd>
<dt>CommandLine:</dt>
<dd>python -m ibeis –tf NeighborIndex.knn:0 –debug2
python -m ibeis –tf NeighborIndex.knn:1</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">indexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_nnindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">config2_</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_query_config2</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">indexer</span><span class="o">.</span><span class="n">debug_nnindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">vt</span><span class="o">.</span><span class="n">check_sift_validity</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">),</span> <span class="s1">&#39;bad SIFT properties&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qfx2_dist</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;qfx2_vec.dtype = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qfx2_vec</span><span class="o">.</span><span class="n">dtype</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;indexer.max_distance_sqrd = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indexer</span><span class="o">.</span><span class="n">max_distance_sqrd</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">qfx2_dist</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="s1">&#39;distance should be less than 1. got </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qfx2_dist</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Ensure distance calculations are correct</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_dvec</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="n">idx2_vec</span><span class="p">[</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">targetdist</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">L2_sift</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">qfx2_dvec</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">**</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rawdist</span>    <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">L2_sqrd</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">qfx2_dvec</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">qfx2_dist</span> <span class="o">*</span> <span class="n">indexer</span><span class="o">.</span><span class="n">max_distance_sqrd</span> <span class="o">==</span> <span class="n">rawdist</span><span class="p">),</span> <span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="s1">&#39;inconsistant distance calculations&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">targetdist</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">),</span> <span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="s1">&#39;inconsistant distance calculations&#39;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Example2:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">indexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_nnindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">indexer</span><span class="o">.</span><span class="n">get_dtype</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qfx2_dist</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">(0, 2) (0, 2)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.load">
<code class="descname">load</code><span class="sig-paren">(</span><em>cachedir=None</em>, <em>fpath=None</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads a cached flann neighbor indexer from disk (not the data)</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.num_indexed_annots">
<code class="descname">num_indexed_annots</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.num_indexed_annots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.num_indexed_annots" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.num_indexed_vecs">
<code class="descname">num_indexed_vecs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.num_indexed_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.num_indexed_vecs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.prefix1">
<code class="descname">prefix1</code><em class="property"> = 'flann'</em><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.prefix1" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.reindex">
<code class="descname">reindex</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>memtrack=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.reindex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.reindex" title="Permalink to this definition">¶</a></dt>
<dd><p>indexes all vectors with FLANN.</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.remove_ibeis_support">
<code class="descname">remove_ibeis_support</code><span class="sig-paren">(</span><em>qreq_</em>, <em>remove_daid_list</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.remove_ibeis_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.remove_ibeis_support" title="Permalink to this definition">¶</a></dt>
<dd><p># TODO: ensure that the memcache changes appropriately</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.remove_support">
<code class="descname">remove_support</code><span class="sig-paren">(</span><em>remove_daid_list</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.remove_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.remove_support" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index –test-remove_support</dd>
<dt>SeeAlso:</dt>
<dd>~/code/flann/src/python/pyflann/index.py</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># xdoctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># (IMPORTANT)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_nnindexer</span><span class="p">(</span><span class="n">use_memcache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">remove_daid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">config2_</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_query_config2</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># get before data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx1</span><span class="p">,</span> <span class="n">qfx2_dist1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># execute test function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="o">.</span><span class="n">remove_support</span><span class="p">(</span><span class="n">remove_daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># test before data vs after data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx2</span><span class="p">,</span> <span class="n">qfx2_dist2</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax2_nvecs</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_take</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">dict_hist</span><span class="p">(</span><span class="n">nnindexer</span><span class="o">.</span><span class="n">idx2_ax</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nnindexer</span><span class="o">.</span><span class="n">ax2_aid</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qfx2_idx2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">ax2_nvecs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;should only get points from aid 7&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qfx2_idx1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">ax2_nvecs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;should get points from everyone&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.requery_knn">
<code class="descname">requery_knn</code><span class="sig-paren">(</span><em>qfx2_vec</em>, <em>K</em>, <em>pad</em>, <em>impossible_aids</em>, <em>recover=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.requery_knn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.requery_knn" title="Permalink to this definition">¶</a></dt>
<dd><p>hack for iccv - this is a highly coupled function</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index requery_knn</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">load_indexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">indexer</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">indexer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qannot</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">internal_qannots</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">qannot</span><span class="o">.</span><span class="n">vecs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pad</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qannot</span><span class="o">.</span><span class="n">aid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">impossible_aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_groundtruth</span><span class="p">(</span><span class="n">qaid</span><span class="p">,</span> <span class="n">noself</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">impossible_aids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="n">requery_knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">pad</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                          <span class="n">impossible_aids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#indexer.get_nn_axs(qfx2_idx)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">qfx2_dist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.rrr">
<code class="descname">rrr</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>reload_module=True</em><span class="sig-paren">)</span><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.rrr" title="Permalink to this definition">¶</a></dt>
<dd><p>special class reloading function
This function is often injected as rrr of classes</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex.save">
<code class="descname">save</code><span class="sig-paren">(</span><em>cachedir=None</em>, <em>fpath=None</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Caches a flann neighbor indexer to disk (not the data)</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex2">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.neighbor_index.</code><code class="descname">NeighborIndex2</code><span class="sig-paren">(</span><em>flann_params=None</em>, <em>cfgstr=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex2" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#ibeis.algo.hots.neighbor_index.NeighborIndex" title="ibeis.algo.hots.neighbor_index.NeighborIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">ibeis.algo.hots.neighbor_index.NeighborIndex</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code></p>
<dl class="staticmethod">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex2.get_support">
<em class="property">static </em><code class="descname">get_support</code><span class="sig-paren">(</span><em>depc</em>, <em>aid_list</em>, <em>config</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex2.get_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex2.get_support" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex2.on_load">
<code class="descname">on_load</code><span class="sig-paren">(</span><em>depc</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex2.on_load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex2.on_load" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex2.on_save">
<code class="descname">on_save</code><span class="sig-paren">(</span><em>depc</em>, <em>fpath</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#NeighborIndex2.on_save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex2.on_save" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index.NeighborIndex2.rrr">
<code class="descname">rrr</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>reload_module=True</em><span class="sig-paren">)</span><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.NeighborIndex2.rrr" title="Permalink to this definition">¶</a></dt>
<dd><p>special class reloading function
This function is often injected as rrr of classes</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index.get_support_data">
<code class="descclassname">ibeis.algo.hots.neighbor_index.</code><code class="descname">get_support_data</code><span class="sig-paren">(</span><em>qreq_</em>, <em>daid_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#get_support_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.get_support_data" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index get_support_data –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;:fgw_thresh=.9,maxscale_thresh=10&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="s1">&#39;:size=2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">daids</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span>  <span class="o">=</span> <span class="n">get_support_data</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vecs_list</span><span class="p">,</span> <span class="n">fgws_list</span><span class="p">,</span> <span class="n">fxs_list</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">fgws</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">9</span><span class="p">)</span> <span class="k">for</span> <span class="n">fgws</span> <span class="ow">in</span> <span class="n">fgws_list</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;depth_profile = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">depth_profile</span><span class="p">(</span><span class="n">tup</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>depth_profile = [[(128, 128), (174, 128)], [128, 174], [128, 174]]</p>
<p>I can’t figure out why this tests isn’t determenistic all the time and
I can’t get it to reproduce non-determenism.</p>
<p>This could be due to theano.</p>
<p>depth_profile = [[(39, 128), (22, 128)], [39, 22], [39, 22]]
depth_profile = [[(35, 128), (24, 128)], [35, 24], [35, 24]]
depth_profile = [[(34, 128), (31, 128)], [34, 31], [34, 31]]
depth_profile = [[(83, 128), (129, 128)], [83, 129], [83, 129]]
depth_profile = [[(13, 128), (104, 128)], [13, 104], [13, 104]]</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index.in1d_shape">
<code class="descclassname">ibeis.algo.hots.neighbor_index.</code><code class="descname">in1d_shape</code><span class="sig-paren">(</span><em>arr1</em>, <em>arr2</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#in1d_shape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.in1d_shape" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index.invert_index">
<code class="descclassname">ibeis.algo.hots.neighbor_index.</code><code class="descname">invert_index</code><span class="sig-paren">(</span><em>vecs_list</em>, <em>fgws_list</em>, <em>ax_list</em>, <em>fxs_list</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#invert_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.invert_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregates descriptors of input annotations and returns inverted information</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>vecs_list</strong> (<em>list</em>) – </li>
<li><strong>fgws_list</strong> (<em>list</em>) – </li>
<li><strong>ax_list</strong> (<em>list</em>) – </li>
<li><strong>fxs_list</strong> (<em>list</em>) – </li>
<li><strong>verbose</strong> (<em>bool</em>) – verbosity flag(default = True)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">(idx2_vec, idx2_fgw, idx2_ax, idx2_fx)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index invert_index</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DIM_SIZE</span> <span class="o">=</span> <span class="mi">16</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nFeat_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vecs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">rng</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nFeat</span><span class="p">,</span> <span class="n">DIM_SIZE</span><span class="p">)</span> <span class="k">for</span> <span class="n">nFeat</span> <span class="ow">in</span> <span class="n">nFeat_list</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fgws_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">rng</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nFeat</span><span class="p">)</span> <span class="k">for</span> <span class="n">nFeat</span> <span class="ow">in</span> <span class="n">nFeat_list</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fxs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nFeat</span><span class="p">)</span> <span class="k">for</span> <span class="n">nFeat</span> <span class="ow">in</span> <span class="n">nFeat_list</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vecs_list</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fgws_list</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">invert_index</span><span class="p">(</span><span class="n">vecs_list</span><span class="p">,</span> <span class="n">fgws_list</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">,</span> <span class="n">fxs_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">idx2_vec</span><span class="p">,</span> <span class="n">idx2_fgw</span><span class="p">,</span> <span class="n">idx2_ax</span><span class="p">,</span> <span class="n">idx2_fx</span><span class="p">)</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;output depth_profile = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">depth_profile</span><span class="p">(</span><span class="n">tup</span><span class="p">),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">output depth_profile = [(8, 16), 1, 8, 8]</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="s1">&#39;default:species=zebra_plains&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:fgw_thresh=.999&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vecs_list</span><span class="p">,</span> <span class="n">fgws_list</span><span class="p">,</span> <span class="n">fxs_list</span> <span class="o">=</span> <span class="n">get_support_data</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vecs_list</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_</span> <span class="o">=</span> <span class="n">vecs_list</span><span class="p">,</span> <span class="n">fgws_list</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">,</span> <span class="n">fxs_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;input depth_profile = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">depth_profile</span><span class="p">(</span><span class="n">input_</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">invert_index</span><span class="p">(</span><span class="o">*</span><span class="n">input_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">idx2_vec</span><span class="p">,</span> <span class="n">idx2_fgw</span><span class="p">,</span> <span class="n">idx2_ax</span><span class="p">,</span> <span class="n">idx2_fx</span><span class="p">)</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;output depth_profile = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">depth_profile</span><span class="p">(</span><span class="n">tup</span><span class="p">),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>output depth_profile = [(1912, 128), 1912, 1912, 1912]</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index.testdata_nnindexer">
<code class="descclassname">ibeis.algo.hots.neighbor_index.</code><code class="descname">testdata_nnindexer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index.html#testdata_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index.testdata_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.neighbor_index_cache">
<span id="ibeis-algo-hots-neighbor-index-cache-module"></span><h2>ibeis.algo.hots.neighbor_index_cache module<a class="headerlink" href="#module-ibeis.algo.hots.neighbor_index_cache" title="Permalink to this headline">¶</a></h2>
<p>NEEDS CLEANUP</p>
<dl class="class">
<dt id="ibeis.algo.hots.neighbor_index_cache.UUIDMapHyrbridCache">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">UUIDMapHyrbridCache</code><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#UUIDMapHyrbridCache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.UUIDMapHyrbridCache" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Class that lets multiple ways of writing to the uuid_map
be swapped in and out interchangably</p>
<p>TODO: the global read / write should periodically sync itself to disk and it
should be loaded from disk initially</p>
<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index_cache.UUIDMapHyrbridCache.dump">
<code class="descname">dump</code><span class="sig-paren">(</span><em>cachedir</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#UUIDMapHyrbridCache.dump"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.UUIDMapHyrbridCache.dump" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index_cache.UUIDMapHyrbridCache.init">
<code class="descname">init</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#UUIDMapHyrbridCache.init"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.UUIDMapHyrbridCache.init" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index_cache.UUIDMapHyrbridCache.load">
<code class="descname">load</code><span class="sig-paren">(</span><em>cachedir</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#UUIDMapHyrbridCache.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.UUIDMapHyrbridCache.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a cache UUIDMap</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index_cache.UUIDMapHyrbridCache.read_uuid_map_dict">
<code class="descname">read_uuid_map_dict</code><span class="sig-paren">(</span><em>uuid_map_fpath</em>, <em>min_reindex_thresh</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#UUIDMapHyrbridCache.read_uuid_map_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.UUIDMapHyrbridCache.read_uuid_map_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>uses in memory dictionary instead of disk</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.neighbor_index_cache.UUIDMapHyrbridCache.write_uuid_map_dict">
<code class="descname">write_uuid_map_dict</code><span class="sig-paren">(</span><em>uuid_map_fpath</em>, <em>visual_uuid_list</em>, <em>daids_hashid</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#UUIDMapHyrbridCache.write_uuid_map_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.UUIDMapHyrbridCache.write_uuid_map_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>uses in memory dictionary instead of disk</p>
<p>let the multi-indexer know about any big caches we’ve made multi-indexer.
Also lets nnindexer know about other prebuilt indexers so it can attempt to
just add points to them as to avoid a rebuild.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.background_flann_func">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">background_flann_func</code><span class="sig-paren">(</span><em>cachedir</em>, <em>daid_list</em>, <em>vecs_list</em>, <em>fgws_list</em>, <em>fxs_list</em>, <em>flann_params</em>, <em>cfgstr</em>, <em>uuid_map_fpath</em>, <em>daids_hashid</em>, <em>visual_uuid_list</em>, <em>min_reindex_thresh</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#background_flann_func"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.background_flann_func" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME: Duplicate code</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.build_nnindex_cfgstr">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">build_nnindex_cfgstr</code><span class="sig-paren">(</span><em>qreq_</em>, <em>daid_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#build_nnindex_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.build_nnindex_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd><p>builds a string that  uniquely identified an indexer built with parameters
from the input query requested and indexing descriptor from the input
annotation ids</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<a class="reference internal" href="#ibeis.algo.hots.query_request.QueryRequest" title="ibeis.algo.hots.query_request.QueryRequest"><em>QueryRequest</em></a>) – query request object with hyper-parameters</li>
<li><strong>daid_list</strong> (<em>list</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">nnindex_cfgstr</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">str</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index_cache –test-build_nnindex_cfgstr</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">TEST_SPECIES</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fg_on</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindex_cfgstr</span> <span class="o">=</span> <span class="n">build_nnindex_cfgstr</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nnindex_cfgstr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>_VUUIDS((6)ylydksaqdigdecdd)_FLANN(8_kdtrees)_FeatureWeight(detector=cnn,sz256,thresh=20,ksz=20,enabled=False)_FeatureWeight(detector=cnn,sz256,thresh=20,ksz=20,enabled=False)</p>
<p>_VUUIDS((6)ylydksaqdigdecdd)_FLANN(8_kdtrees)_FEATWEIGHT(OFF)_FEAT(<a href="#id9"><span class="problematic" id="id10">hesaff+sift_</span></a>)_CHIP(sz450)</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.can_request_background_nnindexer">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">can_request_background_nnindexer</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#can_request_background_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.can_request_background_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.check_background_process">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">check_background_process</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#check_background_process"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.check_background_process" title="Permalink to this definition">¶</a></dt>
<dd><p>checks to see if the process has finished and then
writes the uuid map to disk</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.clear_memcache">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">clear_memcache</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#clear_memcache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.clear_memcache" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.clear_uuid_cache">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">clear_uuid_cache</code><span class="sig-paren">(</span><em>qreq_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#clear_uuid_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.clear_uuid_cache" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index_cache –test-clear_uuid_cache</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:fg_on=True&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fgws_list</span> <span class="o">=</span> <span class="n">clear_uuid_cache</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fgws_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.get_data_cfgstr">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">get_data_cfgstr</code><span class="sig-paren">(</span><em>ibs</em>, <em>daid_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#get_data_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.get_data_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd><p>part 2 data hash id</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.get_nnindexer_uuid_map_fpath">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">get_nnindexer_uuid_map_fpath</code><span class="sig-paren">(</span><em>qreq_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#get_nnindexer_uuid_map_fpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.get_nnindexer_uuid_map_fpath" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index_cache get_nnindexer_uuid_map_fpath</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:fgw_thresh=.3&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uuid_map_fpath</span> <span class="o">=</span> <span class="n">get_nnindexer_uuid_map_fpath</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">path_ndir_split</span><span class="p">(</span><span class="n">uuid_map_fpath</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>…/_ibeis_cache/flann/uuid_map_mzwwsbjisbkdxorl.cPkl
…/_ibeis_cache/flann/uuid_map_FLANN(8_kdtrees_fgwthrsh=0.3)_Feat(hesaff+sift)_Chip(sz700,width).cPkl
…/_ibeis_cache/flann/uuid_map_FLANN(8_kdtrees)_Feat(hesaff+sift)_Chip(sz700,width).cPkl
…/_ibeis_cache/flann/uuid_map_FLANN(8_kdtrees)_FEAT(<a href="#id11"><span class="problematic" id="id12">hesaff+sift_</span></a>)_CHIP(sz450).cPkl</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.group_daids_by_cached_nnindexer">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">group_daids_by_cached_nnindexer</code><span class="sig-paren">(</span><em>qreq_</em>, <em>daid_list</em>, <em>min_reindex_thresh</em>, <em>max_covers=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#group_daids_by_cached_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.group_daids_by_cached_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index_cache –test-group_daids_by_cached_nnindexer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ZEB_PLAIN</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">TEST_SPECIES</span><span class="o">.</span><span class="n">ZEB_PLAIN</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Set the params a bit lower</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">max_covers</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">min_reindex_thresh</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">min_reindex_thresh</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">min_reindex_thresh</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># STEP 0: CLEAR THE CACHE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clear_uuid_cache</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># STEP 1: ASSERT EMPTY INDEX</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ZEB_PLAIN</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span> <span class="o">=</span> <span class="n">group_daids_by_cached_nnindexer</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">min_reindex_thresh</span><span class="p">,</span> <span class="n">max_covers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result1</span> <span class="o">=</span> <span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">result1</span><span class="p">,</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[]),</span> <span class="s1">&#39;pre request&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># TEST 2: SHOULD MAKE 123 COVERED</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">request_memcached_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span> <span class="o">=</span> <span class="n">group_daids_by_cached_nnindexer</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">min_reindex_thresh</span><span class="p">,</span> <span class="n">max_covers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result2</span> <span class="o">=</span> <span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">result2</span><span class="p">,</span> <span class="p">([],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]),</span> <span class="s1">&#39;post request&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.new_neighbor_index">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">new_neighbor_index</code><span class="sig-paren">(</span><em>daid_list</em>, <em>vecs_list</em>, <em>fgws_list</em>, <em>fxs_list</em>, <em>flann_params</em>, <em>cachedir</em>, <em>cfgstr</em>, <em>force_rebuild=False</em>, <em>verbose=True</em>, <em>memtrack=None</em>, <em>prog_hook=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#new_neighbor_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.new_neighbor_index" title="Permalink to this definition">¶</a></dt>
<dd><p>constructs neighbor index independent of ibeis</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>daid_list</strong> (<em>list</em>) – </li>
<li><strong>vecs_list</strong> (<em>list</em>) – </li>
<li><strong>fgws_list</strong> (<em>list</em>) – </li>
<li><strong>flann_params</strong> (<em>dict</em>) – </li>
<li><strong>flann_cachedir</strong> (<em>None</em>) – </li>
<li><strong>nnindex_cfgstr</strong> (<em>str</em>) – </li>
<li><strong>use_memcache</strong> (<em>bool</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">nnindexer</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index_cache –test-new_neighbor_index</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="s1">&#39;default:species=zebra_plains&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:fgw_thresh=.999&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">daids</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindex_cfgstr</span> <span class="o">=</span> <span class="n">build_nnindex_cfgstr</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">exec_funckw</span><span class="p">(</span><span class="n">new_neighbor_index</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgstr</span> <span class="o">=</span> <span class="n">nnindex_cfgstr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cachedir</span>     <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_flann_cachedir</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flann_params</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">flann_params</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get annot descriptors to index</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vecs_list</span><span class="p">,</span> <span class="n">fgws_list</span><span class="p">,</span> <span class="n">fxs_list</span> <span class="o">=</span> <span class="n">get_support_data</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">new_neighbor_index</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">vecs_list</span><span class="p">,</span> <span class="n">fgws_list</span><span class="p">,</span> <span class="n">fxs_list</span><span class="p">,</span> <span class="n">flann_params</span><span class="p">,</span> <span class="n">cachedir</span><span class="p">,</span> <span class="n">cfgstr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;nnindexer.ax2_aid = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nnindexer</span><span class="o">.</span><span class="n">ax2_aid</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">nnindexer.ax2_aid = [1 2 3 4 5 6]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.print_uuid_cache">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">print_uuid_cache</code><span class="sig-paren">(</span><em>qreq_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#print_uuid_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.print_uuid_cache" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index_cache –test-print_uuid_cache</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_Master0&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:fg_on=False&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_uuid_cache</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nnindexer</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.request_augmented_ibeis_nnindexer">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">request_augmented_ibeis_nnindexer</code><span class="sig-paren">(</span><em>qreq_</em>, <em>daid_list</em>, <em>verbose=True</em>, <em>use_memcache=True</em>, <em>force_rebuild=False</em>, <em>memtrack=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#request_augmented_ibeis_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.request_augmented_ibeis_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p>DO NOT USE. THIS FUNCTION CAN CURRENTLY CAUSE A SEGFAULT</p>
<p>tries to give you an indexer for the requested daids using the least amount
of computation possible. By loading and adding to a partially build nnindex
if possible and if that fails fallbs back to request_memcache.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<a class="reference internal" href="#ibeis.algo.hots.query_request.QueryRequest" title="ibeis.algo.hots.query_request.QueryRequest"><em>QueryRequest</em></a>) – query request object with hyper-parameters</li>
<li><strong>daid_list</strong> (<em>list</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">nnindex_cfgstr</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">str</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index_cache –test-request_augmented_ibeis_nnindexer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ZEB_PLAIN</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">TEST_SPECIES</span><span class="o">.</span><span class="n">ZEB_PLAIN</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_memcache</span><span class="p">,</span> <span class="n">max_covers</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ZEB_PLAIN</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">min_reindex_thresh</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">min_reindex_thresh</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">min_reindex_thresh</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># CLEAR CACHE for clean test</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clear_uuid_cache</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># LOAD 3 AIDS INTO CACHE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ZEB_PLAIN</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Should fallback</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">request_augmented_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># assert the fallback</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span> <span class="o">=</span> <span class="n">group_daids_by_cached_nnindexer</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">min_reindex_thresh</span><span class="p">,</span> <span class="n">max_covers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result2</span> <span class="o">=</span> <span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">result2</span><span class="p">,</span> <span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]),</span> <span class="s1">&#39;pre augment&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Should augment</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">request_augmented_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span> <span class="o">=</span> <span class="n">group_daids_by_cached_nnindexer</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">min_reindex_thresh</span><span class="p">,</span> <span class="n">max_covers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result3</span> <span class="o">=</span> <span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">result3</span><span class="p">,</span> <span class="p">([],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]),</span> <span class="s1">&#39;post augment&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Should fallback</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer2</span> <span class="o">=</span> <span class="n">request_augmented_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">nnindexer</span> <span class="ow">is</span> <span class="n">nnindexer2</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.request_background_nnindexer">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">request_background_nnindexer</code><span class="sig-paren">(</span><em>qreq_</em>, <em>daid_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#request_background_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.request_background_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME: Duplicate code</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>qreq</strong> (<a class="reference internal" href="#ibeis.algo.hots.query_request.QueryRequest" title="ibeis.algo.hots.query_request.QueryRequest"><em>QueryRequest</em></a>) – query request object with hyper-parameters</li>
<li><strong>daid_list</strong> (<em>list</em>) – </li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index_cache –test-request_background_nnindexer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">TEST_SPECIES</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request_background_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.request_diskcached_ibeis_nnindexer">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">request_diskcached_ibeis_nnindexer</code><span class="sig-paren">(</span><em>qreq_</em>, <em>daid_list</em>, <em>nnindex_cfgstr=None</em>, <em>verbose=True</em>, <em>force_rebuild=False</em>, <em>memtrack=None</em>, <em>prog_hook=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#request_diskcached_ibeis_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.request_diskcached_ibeis_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p>builds new NeighborIndexer which will try to use a disk cached flann if
available</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<a class="reference internal" href="#ibeis.algo.hots.query_request.QueryRequest" title="ibeis.algo.hots.query_request.QueryRequest"><em>QueryRequest</em></a>) – query request object with hyper-parameters</li>
<li><strong>daid_list</strong> (<em>list</em>) – </li>
<li><strong>nnindex_cfgstr</strong> – </li>
<li><strong>verbose</strong> (<em>bool</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">nnindexer</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">NeighborIndexer</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index_cache –test-request_diskcached_ibeis_nnindexer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">TEST_SPECIES</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindex_cfgstr</span> <span class="o">=</span> <span class="n">build_nnindex_cfgstr</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">request_diskcached_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">nnindex_cfgstr</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nnindexer</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.request_ibeis_nnindexer">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">request_ibeis_nnindexer</code><span class="sig-paren">(</span><em>qreq_</em>, <em>verbose=True</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#request_ibeis_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.request_ibeis_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p>CALLED BY QUERYREQUST::LOAD_INDEXER
IBEIS interface into neighbor_index_cache</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<a class="reference internal" href="#ibeis.algo.hots.query_request.QueryRequest" title="ibeis.algo.hots.query_request.QueryRequest"><em>QueryRequest</em></a>) – hyper-parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">nnindexer</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">NeighborIndexer</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index_cache request_ibeis_nnindexer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_nnindexer</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">request_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.request_memcached_ibeis_nnindexer">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">request_memcached_ibeis_nnindexer</code><span class="sig-paren">(</span><em>qreq_</em>, <em>daid_list</em>, <em>use_memcache=True</em>, <em>verbose=True</em>, <em>veryverbose=False</em>, <em>force_rebuild=False</em>, <em>memtrack=None</em>, <em>prog_hook=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#request_memcached_ibeis_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.request_memcached_ibeis_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p>FOR INTERNAL USE ONLY
takes custom daid list. might not be the same as what is in <a href="#id13"><span class="problematic" id="id14">qreq_</span></a></p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.neighbor_index_cache –test-request_memcached_ibeis_nnindexer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">min_reindex_thresh</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ZEB_PLAIN</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">TEST_SPECIES</span><span class="o">.</span><span class="n">ZEB_PLAIN</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ZEB_PLAIN</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_memcache</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">request_memcached_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">use_memcache</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nnindexer</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.neighbor_index_cache.testdata_nnindexer">
<code class="descclassname">ibeis.algo.hots.neighbor_index_cache.</code><code class="descname">testdata_nnindexer</code><span class="sig-paren">(</span><em>dbname='testdb1'</em>, <em>with_indexer=True</em>, <em>use_memcache=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/neighbor_index_cache.html#testdata_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.neighbor_index_cache.testdata_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Ignore:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_nnindexer</span><span class="p">(</span><span class="s1">&#39;PZ_Master1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">nnindexer</span><span class="o">.</span><span class="n">idx2_vec</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">ensureqt</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index_cache</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_nnindexer</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.nn_weights">
<span id="ibeis-algo-hots-nn-weights-module"></span><h2>ibeis.algo.hots.nn_weights module<a class="headerlink" href="#module-ibeis.algo.hots.nn_weights" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.all_normalized_weights_test">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">all_normalized_weights_test</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#all_normalized_weights_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.all_normalized_weights_test" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.nn_weights –exec-all_normalized_weights_test</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_normalized_weights_test</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.apply_normweight">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">apply_normweight</code><span class="sig-paren">(</span><em>normweight_fn</em>, <em>neighb_normk</em>, <em>neighb_idx</em>, <em>neighb_dist</em>, <em>Knorm</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#apply_normweight"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.apply_normweight" title="Permalink to this definition">¶</a></dt>
<dd><p>helper applies the normalized weight function to one query annotation</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>normweight_fn</strong> (<em>func</em>) – chosen weight function e.g. lnbnn</li>
<li><strong>qaid</strong> (<em>int</em>) – query annotation id</li>
<li><strong>neighb_idx</strong> (<em>ndarray</em><em>[</em><em>int32_t</em><em>, </em><em>ndims=2</em><em>]</em>) – mapping from query feature
index to db neighbor index</li>
<li><strong>neighb_dist</strong> (<em>ndarray</em>) – mapping from query feature index to dist</li>
<li><strong>Knorm</strong> (<em>int</em>) – </li>
<li><strong>qreq</strong> (<a class="reference internal" href="#ibeis.algo.hots.query_request.QueryRequest" title="ibeis.algo.hots.query_request.QueryRequest"><em>QueryRequest</em></a>) – query request object with hyper-parameters</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">neighb_normweight</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.nn_weights –test-apply_normweight</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots</span> <span class="k">import</span> <span class="n">nn_weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#cfgdict = {&#39;K&#39;:10, &#39;Knorm&#39;: 10, &#39;normalizer_rule&#39;: &#39;name&#39;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#           &#39;dim_size&#39;: 450, &#39;resize_dim&#39;: &#39;area&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#tup = plh.testdata_pre_weight_neighbors(cfgdict=cfgdict)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;weight_neighbors&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:K=10,Knorm=10,normalizer_rule=name,dim_size=450,resize_dim=area&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Knorm</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">Knorm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normweight_fn</span> <span class="o">=</span> <span class="n">lnbnn_fn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer_rule</span>  <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">normalizer_rule</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">neighb_idx</span><span class="p">,</span> <span class="n">neighb_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">nns_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neighb_normk</span> <span class="o">=</span> <span class="n">get_normk</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">neighb_idx</span><span class="p">,</span> <span class="n">Knorm</span><span class="p">,</span> <span class="n">normalizer_rule</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neighb_normweight</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">apply_normweight</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">normweight_fn</span><span class="p">,</span> <span class="n">neighb_normk</span><span class="p">,</span> <span class="n">neighb_idx</span><span class="p">,</span> <span class="n">neighb_dist</span><span class="p">,</span> <span class="n">Knorm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">neighb_normweight</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">950</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.bar_l2_fn">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">bar_l2_fn</code><span class="sig-paren">(</span><em>vdist</em>, <em>ndist</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#bar_l2_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.bar_l2_fn" title="Permalink to this definition">¶</a></dt>
<dd><p>The feature weight is (1 - the euclidian distance
between the features). The normalizers are unused.</p>
<p>(not really a normaalized function)</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span> <span class="o">=</span> <span class="n">testdata_vn_dists</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">bar_l2_fn</span><span class="p">(</span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">hz_str</span><span class="p">(</span><span class="s1">&#39;barl2  = &#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">barl2  = np.array([[1.  , 0.6 , 0.41],</span>
<span class="go">                   [0.83, 0.7 , 0.49],</span>
<span class="go">                   [0.87, 0.58, 0.27],</span>
<span class="go">                   [0.88, 0.63, 0.46],</span>
<span class="go">                   [0.82, 0.53, 0.5 ]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.const_match_weighter">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">const_match_weighter</code><span class="sig-paren">(</span><em>nns_list</em>, <em>nnvalid0_list</em>, <em>qreq_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#const_match_weighter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.const_match_weighter" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#tup = plh.testdata_pre_weight_neighbors(&#39;PZ_MTEST&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;weight_neighbors&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">constvote_weight_list</span> <span class="o">=</span> <span class="n">const_match_weighter</span><span class="p">(</span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;constvote_weight_list = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">constvote_weight_list</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.fg_match_weighter">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">fg_match_weighter</code><span class="sig-paren">(</span><em>nns_list</em>, <em>nnvalid0_list</em>, <em>qreq_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#fg_match_weighter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.fg_match_weighter" title="Permalink to this definition">¶</a></dt>
<dd><p>foreground feature match weighting</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.nn_weights –exec-fg_match_weighter</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#tup = plh.testdata_pre_weight_neighbors(&#39;PZ_MTEST&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#ibs, qreq_, nns_list, nnvalid0_list = tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;weight_neighbors&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">sorted_</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">fg_on</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;bug setting custom params fg_on&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fgvotes_list</span> <span class="o">=</span> <span class="n">fg_match_weighter</span><span class="p">(</span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fgvotes_list = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fgvotes_list</span><span class="p">,))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.get_name_normalizers">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">get_name_normalizers</code><span class="sig-paren">(</span><em>qaid</em>, <em>qreq_</em>, <em>Knorm</em>, <em>neighb_idx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#get_name_normalizers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.get_name_normalizers" title="Permalink to this definition">¶</a></dt>
<dd><p>helper normalizers for ‘name’ normalizer_rule</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qaid</strong> (<em>int</em>) – query annotation id</li>
<li><strong>qreq</strong> (<em>ibeis.QueryRequest</em>) – hyper-parameters</li>
<li><strong>Knorm</strong> (<em>int</em>) – </li>
<li><strong>neighb_idx</strong> (<em>ndarray</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">neighb_normk</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots</span> <span class="k">import</span> <span class="n">nn_weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#cfgdict = {&#39;K&#39;:10, &#39;Knorm&#39;: 10, &#39;normalizer_rule&#39;: &#39;name&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#tup = plh.testdata_pre_weight_neighbors(cfgdict=cfgdict)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;weight_neighbors&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:K=10,Knorm=10,normalizer_rule=name&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Knorm</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">Knorm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">neighb_idx</span><span class="p">,</span> <span class="n">neighb_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">nns_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neighb_normk</span> <span class="o">=</span> <span class="n">get_name_normalizers</span><span class="p">(</span><span class="n">qaid</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">Knorm</span><span class="p">,</span> <span class="n">neighb_idx</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.get_normk">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">get_normk</code><span class="sig-paren">(</span><em>qreq_</em>, <em>qaid</em>, <em>neighb_idx</em>, <em>Knorm</em>, <em>normalizer_rule</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#get_normk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.get_normk" title="Permalink to this definition">¶</a></dt>
<dd><p>Get positions of the LNBNN/ratio tests normalizers</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;K&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;Knorm&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;normalizer_rule&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>           <span class="s1">&#39;dim_size&#39;</span><span class="p">:</span> <span class="mi">450</span><span class="p">,</span> <span class="s1">&#39;resize_dim&#39;</span><span class="p">:</span> <span class="s1">&#39;area&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#tup = plh.testdata_pre_weight_neighbors(cfgdict=cfgdict)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;weight_neighbors&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:K=10,Knorm=10,normalizer_rule=name,dim_size=450,resize_dim=area&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">neighb_idx</span><span class="p">,</span> <span class="n">neighb_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">nns_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">K</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Knorm</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">Knorm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neighb_normk1</span> <span class="o">=</span> <span class="n">get_normk</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">neighb_idx</span><span class="p">,</span> <span class="n">Knorm</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neighb_normk2</span> <span class="o">=</span> <span class="n">get_normk</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">neighb_idx</span><span class="p">,</span> <span class="n">Knorm</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">neighb_normk1</span> <span class="o">==</span> <span class="n">Knorm</span> <span class="o">+</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">neighb_normk2</span> <span class="o">&lt;=</span> <span class="n">Knorm</span> <span class="o">+</span> <span class="n">K</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">neighb_normk2</span> <span class="o">&gt;</span> <span class="n">K</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.gravity_match_weighter">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">gravity_match_weighter</code><span class="sig-paren">(</span><em>nns_list</em>, <em>nnvalid0_list</em>, <em>qreq_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#gravity_match_weighter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.gravity_match_weighter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.lnbnn_fn">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">lnbnn_fn</code><span class="sig-paren">(</span><em>vdist</em>, <em>ndist</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#lnbnn_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.lnbnn_fn" title="Permalink to this definition">¶</a></dt>
<dd><p>Locale Naive Bayes Nearest Neighbor weighting</p>
<p class="rubric">References</p>
<p><a class="reference external" href="http://www.cs.ubc.ca/~lowe/papers/12mccannCVPR.pdf">http://www.cs.ubc.ca/~lowe/papers/12mccannCVPR.pdf</a>
<a class="reference external" href="http://www.cs.ubc.ca/~sanchom/local-naive-bayes-nearest-neighbor">http://www.cs.ubc.ca/~sanchom/local-naive-bayes-nearest-neighbor</a></p>
<dl class="docutils">
<dt>Sympy:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sympy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#https://github.com/sympy/sympy/pull/10247</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">log</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy.stats</span> <span class="k">import</span> <span class="n">P</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">Die</span><span class="p">,</span> <span class="n">Normal</span><span class="p">,</span> <span class="n">FiniteRV</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span><span class="p">,</span> <span class="n">Cbar</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;C Cbar&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d_i</span> <span class="o">=</span> <span class="n">Die</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;di&#39;</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">log</span><span class="p">(</span><span class="n">P</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span> <span class="o">/</span> <span class="n">P</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">Cbar</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PdiC</span><span class="p">,</span> <span class="n">PdiCbar</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;PdiC, PdiCbar&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">oddsC</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">PdiC</span> <span class="o">/</span> <span class="n">PdiCbar</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">oddsC</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vt</span><span class="o">.</span><span class="n">check_expr_eq</span><span class="p">(</span><span class="n">oddsC</span><span class="p">,</span> <span class="n">log</span><span class="p">(</span><span class="n">PdiC</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">PdiCbar</span><span class="p">))</span>
</pre></div>
</div>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span> <span class="o">=</span> <span class="n">testdata_vn_dists</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">lnbnn_fn</span><span class="p">(</span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">hz_str</span><span class="p">(</span><span class="s1">&#39;lnbnn  = &#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">lnbnn  = np.array([[0.62, 0.22, 0.03],</span>
<span class="go">                   [0.35, 0.22, 0.01],</span>
<span class="go">                   [0.87, 0.58, 0.27],</span>
<span class="go">                   [0.67, 0.42, 0.25],</span>
<span class="go">                   [0.59, 0.3 , 0.27]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.loglnbnn_fn">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">loglnbnn_fn</code><span class="sig-paren">(</span><em>vdist</em>, <em>ndist</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#loglnbnn_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.loglnbnn_fn" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Ignore:</dt>
<dd>import vtool as vt
vt.check_expr_eq(‘log(d) - log(n)’, ‘log(d / n)’)   # True
vt.check_expr_eq(‘log(d) / log(n)’, ‘log(d - n)’)</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span> <span class="o">=</span> <span class="n">testdata_vn_dists</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">loglnbnn_fn</span><span class="p">(</span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">hz_str</span><span class="p">(</span><span class="s1">&#39;loglnbnn  = &#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">loglnbnn  = np.array([[0.48, 0.2 , 0.03],</span>
<span class="go">                      [0.3 , 0.2 , 0.01],</span>
<span class="go">                      [0.63, 0.46, 0.24],</span>
<span class="go">                      [0.51, 0.35, 0.22],</span>
<span class="go">                      [0.46, 0.26, 0.24]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.logratio_fn">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">logratio_fn</code><span class="sig-paren">(</span><em>vdist</em>, <em>ndist</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#logratio_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.logratio_fn" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span> <span class="o">=</span> <span class="n">testdata_vn_dists</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">normonly_fn</span><span class="p">(</span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">np.array([[0.62, 0.62, 0.62],</span>
<span class="go">          [0.52, 0.52, 0.52],</span>
<span class="go">          [1.  , 1.  , 1.  ],</span>
<span class="go">          [0.79, 0.79, 0.79],</span>
<span class="go">          [0.77, 0.77, 0.77]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.mark_name_valid_normalizers">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">mark_name_valid_normalizers</code><span class="sig-paren">(</span><em>qnid</em>, <em>neighb_topnid</em>, <em>neighb_normnid</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#mark_name_valid_normalizers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.mark_name_valid_normalizers" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper func that allows matches only to the first result for a name</p>
<p>Each query feature finds its K matches and Kn normalizing matches. These
are the candidates from which it can choose a set of matches and a single
normalizer.</p>
<p>A normalizer is marked as invalid if it belongs to a name that was also in
its feature’s candidate matching set.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>neighb_topnid</strong> (<em>ndarray</em>) – marks the names a feature matches</li>
<li><strong>neighb_normnid</strong> (<em>ndarray</em>) – marks the names of the feature normalizers</li>
<li><strong>qnid</strong> (<em>int</em>) – query name id</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">neighb_selnorm - index of the selected normalizer for each query feature</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.nn_weights –exec-mark_name_valid_normalizers</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qnid</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neighb_topnid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>                        <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
<span class="gp">... </span>                        <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
<span class="gp">... </span>                        <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
<span class="gp">... </span>                        <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<span class="gp">... </span>                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neighb_normnid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>                         <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>                         <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>                         <span class="p">[</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<span class="gp">... </span>                         <span class="p">[</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
<span class="gp">... </span>                         <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<span class="gp">... </span>                         <span class="p">[</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>                         <span class="p">[</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neighb_selnorm</span> <span class="o">=</span> <span class="n">mark_name_valid_normalizers</span><span class="p">(</span><span class="n">qnid</span><span class="p">,</span> <span class="n">neighb_topnid</span><span class="p">,</span> <span class="n">neighb_normnid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighb_topnid</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Knorm</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighb_normnid</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neighb_normk_</span> <span class="o">=</span> <span class="n">neighb_selnorm</span> <span class="o">+</span> <span class="p">(</span><span class="n">Knorm</span><span class="p">)</span>  <span class="c1"># convert form negative to pos indexes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">neighb_normk_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">[2 1 2 0 0 0 2 0]</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore:</dt>
<dd>print(ut.doctest_repr(neighb_normnid, ‘neighb_normnid’, verbose=False))
print(ut.doctest_repr(neighb_topnid, ‘neighb_topnid’, verbose=False))</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.nn_normalized_weight">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">nn_normalized_weight</code><span class="sig-paren">(</span><em>normweight_fn</em>, <em>nns_list</em>, <em>nnvalid0_list</em>, <em>qreq_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#nn_normalized_weight"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.nn_normalized_weight" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic function to weight nearest neighbors</p>
<p>ratio, lnbnn, and other nearest neighbor based functions use this</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>normweight_fn</strong> (<em>func</em>) – chosen weight function e.g. lnbnn</li>
<li><strong>nns_list</strong> (<em>dict</em>) – query descriptor nearest neighbors and distances.</li>
<li><strong>nnvalid0_list</strong> (<em>list</em>) – list of neighbors preflagged as valid</li>
<li><strong>qreq</strong> (<a class="reference internal" href="#ibeis.algo.hots.query_request.QueryRequest" title="ibeis.algo.hots.query_request.QueryRequest"><em>QueryRequest</em></a>) – hyper-parameters</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">weights_list</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.nn_weights nn_normalized_weight –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#tup = plh.testdata_pre_weight_neighbors(&#39;PZ_MTEST&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#ibs, qreq_, nns_list, nnvalid0_list = tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;weight_neighbors&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normweight_fn</span> <span class="o">=</span> <span class="n">lnbnn_fn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights_list1</span><span class="p">,</span> <span class="n">normk_list1</span> <span class="o">=</span> <span class="n">nn_normalized_weight</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">normweight_fn</span><span class="p">,</span> <span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights1</span> <span class="o">=</span> <span class="n">weights_list1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn_normonly_weight</span> <span class="o">=</span> <span class="n">NN_WEIGHT_FUNC_DICT</span><span class="p">[</span><span class="s1">&#39;lnbnn&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights_list2</span><span class="p">,</span> <span class="n">normk_list2</span> <span class="o">=</span> <span class="n">nn_normonly_weight</span><span class="p">(</span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights2</span> <span class="o">=</span> <span class="n">weights_list2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">weights1</span> <span class="o">==</span> <span class="n">weights2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">weights1</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">510</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#tup = plh.testdata_pre_weight_neighbors(&#39;PZ_MTEST&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;weight_neighbors&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normweight_fn</span> <span class="o">=</span> <span class="n">ratio_fn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights_list1</span><span class="p">,</span> <span class="n">normk_list1</span> <span class="o">=</span> <span class="n">nn_normalized_weight</span><span class="p">(</span><span class="n">normweight_fn</span><span class="p">,</span> <span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights1</span> <span class="o">=</span> <span class="n">weights_list1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn_normonly_weight</span> <span class="o">=</span> <span class="n">NN_WEIGHT_FUNC_DICT</span><span class="p">[</span><span class="s1">&#39;ratio&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights_list2</span><span class="p">,</span> <span class="n">normk_list2</span> <span class="o">=</span> <span class="n">nn_normonly_weight</span><span class="p">(</span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights2</span> <span class="o">=</span> <span class="n">weights_list2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">weights1</span> <span class="o">==</span> <span class="n">weights2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">weights1</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">4500</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.normonly_fn">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">normonly_fn</code><span class="sig-paren">(</span><em>vdist</em>, <em>ndist</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#normonly_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.normonly_fn" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span> <span class="o">=</span> <span class="n">testdata_vn_dists</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">normonly_fn</span><span class="p">(</span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">np.array([[0.62, 0.62, 0.62],</span>
<span class="go">          [0.52, 0.52, 0.52],</span>
<span class="go">          [1.  , 1.  , 1.  ],</span>
<span class="go">          [0.79, 0.79, 0.79],</span>
<span class="go">          [0.77, 0.77, 0.77]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.print">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">print</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ibeis.algo.hots.nn_weights.print" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME: <a href="#id15"><span class="problematic" id="id16">qfx2_</span></a> no longer applies due to fgw_thresh. Need to change names in this file</p>
<p>TODO: replace testdata_pre_weight_neighbors with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;weight_neighbors&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:qindex=0:1,dindex=0:5,hackerrors=False&#39;</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:codename=vsmany,bar_l2_on=True,fg_on=False&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.profile">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">profile</code><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#ibeis.algo.hots.nn_weights.profile" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME: <a href="#id17"><span class="problematic" id="id18">qfx2_</span></a> no longer applies due to fgw_thresh. Need to change names in this file</p>
<p>TODO: replace testdata_pre_weight_neighbors with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;weight_neighbors&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:qindex=0:1,dindex=0:5,hackerrors=False&#39;</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:codename=vsmany,bar_l2_on=True,fg_on=False&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.ratio_fn">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">ratio_fn</code><span class="sig-paren">(</span><em>vdist</em>, <em>ndist</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#ratio_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.ratio_fn" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>vdist</strong> (<em>ndarray</em>) – voting array</li>
<li><strong>ndist</strong> (<em>ndarray</em>) – normalizing array</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">out</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Example1:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span> <span class="o">=</span> <span class="n">testdata_vn_dists</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">ratio_fn</span><span class="p">(</span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">hz_str</span><span class="p">(</span><span class="s1">&#39;ratio = &#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">ratio = np.array([[0.  , 0.65, 0.95],</span>
<span class="go">                  [0.33, 0.58, 0.98],</span>
<span class="go">                  [0.13, 0.42, 0.73],</span>
<span class="go">                  [0.15, 0.47, 0.68],</span>
<span class="go">                  [0.23, 0.61, 0.65]])</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.rrr">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">rrr</code><span class="sig-paren">(</span><em>verbose=True</em><span class="sig-paren">)</span><a class="headerlink" href="#ibeis.algo.hots.nn_weights.rrr" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME: <a href="#id19"><span class="problematic" id="id20">qfx2_</span></a> no longer applies due to fgw_thresh. Need to change names in this file</p>
<p>TODO: replace testdata_pre_weight_neighbors with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;weight_neighbors&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:qindex=0:1,dindex=0:5,hackerrors=False&#39;</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:codename=vsmany,bar_l2_on=True,fg_on=False&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.nn_weights.testdata_vn_dists">
<code class="descclassname">ibeis.algo.hots.nn_weights.</code><code class="descname">testdata_vn_dists</code><span class="sig-paren">(</span><em>nfeats=5</em>, <em>K=3</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/nn_weights.html#testdata_vn_dists"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.nn_weights.testdata_vn_dists" title="Permalink to this definition">¶</a></dt>
<dd><p>Test voting and normalizing distances</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(vdist, ndist) - test voting distances and normalizer distances</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.nn_weights</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span> <span class="o">=</span> <span class="n">testdata_vn_dists</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">hz_str</span><span class="p">(</span><span class="s1">&#39;vdist = &#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">vdist</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">hz_str</span><span class="p">(</span><span class="s1">&#39;ndist = &#39;</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">ndist</span><span class="p">)))</span>
<span class="go">vdist = np.array([[0.  , 0.4 , 0.59],</span>
<span class="go">                  [0.17, 0.3 , 0.51],</span>
<span class="go">                  [0.13, 0.42, 0.73],</span>
<span class="go">                  [0.12, 0.37, 0.54],</span>
<span class="go">                  [0.18, 0.47, 0.5 ]])</span>
<span class="go">ndist = np.array([[0.62],</span>
<span class="go">                  [0.52],</span>
<span class="go">                  [1.  ],</span>
<span class="go">                  [0.79],</span>
<span class="go">                  [0.77]])</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.old_chip_match">
<span id="ibeis-algo-hots-old-chip-match-module"></span><h2>ibeis.algo.hots.old_chip_match module<a class="headerlink" href="#module-ibeis.algo.hots.old_chip_match" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ibeis.algo.hots.old_chip_match.AlignedListDictProxy">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.old_chip_match.</code><code class="descname">AlignedListDictProxy</code><span class="sig-paren">(</span><em>key2_idx</em>, <em>key_list</em>, <em>val_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/old_chip_match.html#AlignedListDictProxy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.old_chip_match.AlignedListDictProxy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.DictLike_old</span></code></p>
<p>simulates a dict when using parallel lists the point of this class is that
when there are many instances of this class, then key2_idx can be shared between
them. Ideally this class wont be used and will disappear when the parallel
lists are being used properly.</p>
<p>DEPCIRATE AlignedListDictProxy’s defaultdict behavior is weird</p>
<dl class="method">
<dt id="ibeis.algo.hots.old_chip_match.AlignedListDictProxy.iteritems">
<code class="descname">iteritems</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/old_chip_match.html#AlignedListDictProxy.iteritems"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.old_chip_match.AlignedListDictProxy.iteritems" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.old_chip_match.AlignedListDictProxy.iterkeys">
<code class="descname">iterkeys</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/old_chip_match.html#AlignedListDictProxy.iterkeys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.old_chip_match.AlignedListDictProxy.iterkeys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.old_chip_match.AlignedListDictProxy.itervalues">
<code class="descname">itervalues</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/old_chip_match.html#AlignedListDictProxy.itervalues"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.old_chip_match.AlignedListDictProxy.itervalues" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.old_chip_match.AlignedListDictProxy.pop">
<code class="descname">pop</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/old_chip_match.html#AlignedListDictProxy.pop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.old_chip_match.AlignedListDictProxy.pop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.pipeline">
<span id="ibeis-algo-hots-pipeline-module"></span><h2>ibeis.algo.hots.pipeline module<a class="headerlink" href="#module-ibeis.algo.hots.pipeline" title="Permalink to this headline">¶</a></h2>
<p>Hotspotter pipeline module</p>
<dl class="docutils">
<dt>Module Notation and Concepts::</dt>
<dd><p class="first">PREFIXES:
qaid2_XXX - prefix mapping query chip index to
qfx2_XXX  - prefix mapping query chip feature index to</p>
<blockquote>
<div><ul class="simple">
<li>nns    - a (qfx2_idx, qfx2_dist) tuple</li>
<li>idx    - the index into the nnindexers descriptors</li>
<li>qfx    - query feature index wrt the query chip</li>
<li>dfx    - query feature index wrt the database chip</li>
<li>dist   - the distance to a corresponding feature</li>
<li>fm     - a list of feature match pairs / correspondences (qfx, dfx)</li>
<li>fsv    - a score vector of a corresponding feature</li>
<li>valid  - a valid bit for a corresponding feature</li>
</ul>
</div></blockquote>
<p>PIPELINE_VARS::
nns_list - maping from query chip index to nns</p>
<blockquote>
<div><ul class="simple">
<li>qfx2_idx   - ranked list of query feature indexes to database feature indexes</li>
<li>qfx2_dist - ranked list of query feature indexes to database feature indexes</li>
</ul>
</div></blockquote>
<ul class="last simple">
<li><dl class="first docutils">
<dt>qaid2_norm_weight - mapping from qaid to (qfx2_normweight, qfx2_selnorm)</dt>
<dd>= qaid2_nnfiltagg[qaid]</dd>
</dl>
</li>
</ul>
</dd>
<dt>CommandLine:</dt>
<dd><p class="first">To see the ouput of a complete pipeline run use</p>
<p># Set to whichever database you like
python main.py –db PZ_MTEST –setdb
python main.py –db NAUT_test –setdb
python main.py –db testdb1 –setdb</p>
<p class="last"># Then run whichever configuration you like
python main.py –query 1 –yes –noqcache -t default:codename=vsmany
python main.py –query 1 –yes –noqcache -t default:codename=vsmany_nsum</p>
</dd>
</dl>
<dl class="class">
<dt id="ibeis.algo.hots.pipeline.Neighbors">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">Neighbors</code><span class="sig-paren">(</span><em>qaid</em>, <em>idxs</em>, <em>dists</em>, <em>qfxs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#Neighbors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.Neighbors" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code></p>
<dl class="attribute">
<dt id="ibeis.algo.hots.pipeline.Neighbors.neighb_dists">
<code class="descname">neighb_dists</code><a class="headerlink" href="#ibeis.algo.hots.pipeline.Neighbors.neighb_dists" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.pipeline.Neighbors.neighb_idxs">
<code class="descname">neighb_idxs</code><a class="headerlink" href="#ibeis.algo.hots.pipeline.Neighbors.neighb_idxs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.pipeline.Neighbors.num_query_feats">
<code class="descname">num_query_feats</code><a class="headerlink" href="#ibeis.algo.hots.pipeline.Neighbors.num_query_feats" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.pipeline.Neighbors.qaid">
<code class="descname">qaid</code><a class="headerlink" href="#ibeis.algo.hots.pipeline.Neighbors.qaid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.pipeline.Neighbors.qfx_list">
<code class="descname">qfx_list</code><a class="headerlink" href="#ibeis.algo.hots.pipeline.Neighbors.qfx_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.pipeline.WeightRet_">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">WeightRet_</code><a class="headerlink" href="#ibeis.algo.hots.pipeline.WeightRet_" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">ibeis.algo.hots.pipeline.weight_ret</span></code></p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.pipeline.baseline_neighbor_filter">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">baseline_neighbor_filter</code><span class="sig-paren">(</span><em>qreq_</em>, <em>nns_list</em>, <em>impossible_daids_list</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#baseline_neighbor_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.baseline_neighbor_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes matches to self, the same image, or the same name.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.pipeline –test-baseline_neighbor_filter</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>   <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;baseline_neighbor_filter&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">daid_override</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:QRH=False,requery=False,can_match_samename=False&#39;</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list</span><span class="p">,</span> <span class="n">impossible_daids_list</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnvalid0_list</span> <span class="o">=</span> <span class="n">baseline_neighbor_filter</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">nns_list</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                         <span class="n">impossible_daids_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nnvalid0_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nnvalid0_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]),</span> <span class="p">(</span>
<span class="gp">... </span>   <span class="s1">&#39;first col should be all invalid because of self match&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">nnvalid0_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">(</span>
<span class="gp">... </span>   <span class="s1">&#39;second col should have some good matches&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">nnvalid0_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.pipeline.build_chipmatches">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">build_chipmatches</code><span class="sig-paren">(</span><em>qreq_</em>, <em>nns_list</em>, <em>nnvalid0_list</em>, <em>filtkey_list</em>, <em>filtweights_list</em>, <em>filtvalids_list</em>, <em>filtnormks_list</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#build_chipmatches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.build_chipmatches" title="Permalink to this definition">¶</a></dt>
<dd><p>pipeline step 4 - builds sparse chipmatches</p>
<p>Takes the dense feature matches from query feature to (what could be any)
database features and builds sparse matching pairs for each annotation to
annotation match.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis build_chipmatches
python -m ibeis build_chipmatches:0 –show
python -m ibeis build_chipmatches:1 –show
python -m ibeis build_chipmatches:2 –show</dd>
<dt>Example0:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;build_chipmatches&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:codename=vsmany&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">filtkey_list</span><span class="p">,</span> <span class="n">filtweights_list</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtvalids_list</span><span class="p">,</span> <span class="n">filtnormks_list</span><span class="p">)</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">build_chipmatches</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">assert_self</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span> <span class="k">for</span> <span class="n">cm</span> <span class="ow">in</span> <span class="n">cm_list</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">fm_list</span><span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">daid2_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_matches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;vsmany num_matches = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">num_matches</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">num_matches</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="s1">&#39;vsmany nmatches out of bounds&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">score_annot_csum</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ishow_single_annotmatch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Test to make sure filtering by feature weights works</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;build_chipmatches&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:codename=vsmany,fgw_thresh=.9&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">filtkey_list</span><span class="p">,</span> <span class="n">filtweights_list</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">filtvalids_list</span><span class="p">,</span> <span class="n">filtnormks_list</span><span class="p">)</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">build_chipmatches</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">assert_self</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span> <span class="k">for</span> <span class="n">cm</span> <span class="ow">in</span> <span class="n">cm_list</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">fm_list</span><span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">daid2_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_matches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;num_matches = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">num_matches</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">num_matches</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">401</span><span class="p">,</span> <span class="s1">&#39;vsmany nmatches out of bounds&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">score_annot_csum</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ishow_single_annotmatch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;build_chipmatches&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:requery=True&#39;</span><span class="p">],</span> <span class="n">a</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">filtkey_list</span><span class="p">,</span> <span class="n">filtweights_list</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtvalids_list</span><span class="p">,</span> <span class="n">filtnormks_list</span><span class="p">)</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">build_chipmatches</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">assert_self</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span> <span class="k">for</span> <span class="n">cm</span> <span class="ow">in</span> <span class="n">cm_list</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scoring</span><span class="o">.</span><span class="n">score_chipmatch_list</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">,</span> <span class="s1">&#39;csum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">cm</span> <span class="ow">in</span> <span class="n">cm_list</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># should be positive for LNBNN</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">score_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">score_list</span><span class="p">)]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.pipeline.build_impossible_daids_list">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">build_impossible_daids_list</code><span class="sig-paren">(</span><em>qreq_</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#build_impossible_daids_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.build_impossible_daids_list" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<a class="reference internal" href="#ibeis.algo.hots.query_request.QueryRequest" title="ibeis.algo.hots.query_request.QueryRequest"><em>QueryRequest</em></a>) – query request object with hyper-parameters</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.pipeline –test-build_impossible_daids_list</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">a</span><span class="o">=</span><span class="s1">&#39;default:species=zebra_plains,qhackerrors=True&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:use_k_padding=True,can_match_sameimg=False,can_match_samename=False&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">impossible_daids_list</span><span class="p">,</span> <span class="n">Kpad_list</span> <span class="o">=</span> <span class="n">build_impossible_daids_list</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">impossible_daids_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">impossible_daids_list</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vals</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_subset</span><span class="p">(</span><span class="nb">locals</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;impossible_daids_list&#39;</span><span class="p">,</span> <span class="s1">&#39;Kpad_list&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">explicit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nobr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">daids</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="go">impossible_daids_list=[[1], [4], [5, 6], [5, 6]],</span>
<span class="go">Kpad_list=[1, 1, 2, 2],</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.pipeline.cachemiss_nn_compute_fn">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">cachemiss_nn_compute_fn</code><span class="sig-paren">(</span><em>flags_list</em>, <em>qreq_</em>, <em>Kpad_list</em>, <em>impossible_daids_list</em>, <em>K</em>, <em>Knorm</em>, <em>requery</em>, <em>verbose</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#cachemiss_nn_compute_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.cachemiss_nn_compute_fn" title="Permalink to this definition">¶</a></dt>
<dd><p>Logic for computing neighbors if there is a cache miss</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">flags_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Kpad_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flags_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.pipeline.compute_matching_dlen_extent">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">compute_matching_dlen_extent</code><span class="sig-paren">(</span><em>qreq_</em>, <em>fm_list</em>, <em>kpts_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#compute_matching_dlen_extent"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.compute_matching_dlen_extent" title="Permalink to this definition">¶</a></dt>
<dd><p>helper for spatial verification, computes the squared diagonal length of
matching chips</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.pipeline –test-compute_matching_dlen_extent</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre_sver</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">set_cannonical_annot_score</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">get_num_matches_list</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">sortself</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fm_list</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">fm_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kpts_list</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_qreq_dannot_kpts</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">daid_list</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">topx2_dlen_sqrd</span> <span class="o">=</span> <span class="n">compute_matching_dlen_extent</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">fm_list</span><span class="p">,</span> <span class="n">kpts_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">topx2_dlen_sqrd</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">1500</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.pipeline.get_sparse_matchinfo_nonagg">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">get_sparse_matchinfo_nonagg</code><span class="sig-paren">(</span><em>qreq_</em>, <em>nns</em>, <em>neighb_valid0</em>, <em>neighb_score_list</em>, <em>neighb_valid_list</em>, <em>neighb_normk_list</em>, <em>Knorm</em>, <em>fsv_col_lbls</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#get_sparse_matchinfo_nonagg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.get_sparse_matchinfo_nonagg" title="Permalink to this definition">¶</a></dt>
<dd><p>builds sparse iterator that generates feature match pairs, scores, and ranks</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><dl class="docutils">
<dt>vmt a tuple of corresponding lists. Each item in the</dt>
<dd>list corresponds to a daid, dfx, scorevec, rank, norm_aid, norm_fx…</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a href="#id21"><span class="problematic" id="id22">ValidMatchTup_</span></a></td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first">python -m ibeis.algo.hots.pipeline –test-get_sparse_matchinfo_nonagg –show
python -m ibeis.algo.hots.pipeline –test-get_sparse_matchinfo_nonagg:1 –show</p>
<p class="last">utprof.py -m ibeis.algo.hots.pipeline –test-get_sparse_matchinfo_nonagg</p>
</dd>
<dt>Example0:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">daid</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_sparse_matchinfo_nonagg</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:Knorm=3,normalizer_rule=name,const_on=True,ratio_thresh=.2,sqrd_dist_on=True&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns</span><span class="p">,</span> <span class="n">neighb_valid0</span><span class="p">,</span> <span class="n">neighb_score_list</span><span class="p">,</span> <span class="n">neighb_valid_list</span><span class="p">,</span> <span class="n">neighb_normk_list</span><span class="p">,</span> <span class="n">Knorm</span><span class="p">,</span> <span class="n">fsv_col_lbls</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">get_sparse_matchinfo_nonagg</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qannot</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">annots</span><span class="p">([</span><span class="n">qaid</span><span class="p">],</span> <span class="n">config</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dannot</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">annots</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">assert_self</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">score_annot_csum</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">show_single_annotmatch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.pipeline.nearest_neighbor_cacheid2">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">nearest_neighbor_cacheid2</code><span class="sig-paren">(</span><em>qreq_</em>, <em>Kpad_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#nearest_neighbor_cacheid2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.nearest_neighbor_cacheid2" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a hacky cacheid for neighbor configs.
DEPRICATE: This will be replaced by dtool caching</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<a class="reference internal" href="#ibeis.algo.hots.query_request.QueryRequest" title="ibeis.algo.hots.query_request.QueryRequest"><em>QueryRequest</em></a>) – query request object with hyper-parameters</li>
<li><strong>Kpad_list</strong> (<em>list</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">(nn_mid_cacheid_list, nn_cachedir)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.pipeline –exec-nearest_neighbor_cacheid2
python -m ibeis.algo.hots.pipeline –exec-nearest_neighbor_cacheid2 –superstrict</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">Knorm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">checks</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">use_k_padding</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># test 1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_cfg_lbl</span><span class="p">(</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">daid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s1">&#39;nearest_neighbors&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Kpad_list</span><span class="p">,</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_take</span><span class="p">(</span><span class="n">locals_</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Kpad_list&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">nearest_neighbor_cacheid2</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">Kpad_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">nn_cachedir</span><span class="p">,</span> <span class="n">nn_mid_cacheid_list</span><span class="p">)</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result1</span> <span class="o">=</span> <span class="s1">&#39;nn_mid_cacheid_list1 = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">nn_mid_cacheid_list</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># test 2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Knorm</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">use_k_padding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_cfg_lbl</span><span class="p">(</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="n">p2</span><span class="p">],</span> <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">daid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s1">&#39;nearest_neighbors&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Kpad_list</span><span class="p">,</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_take</span><span class="p">(</span><span class="n">locals_</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Kpad_list&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">nearest_neighbor_cacheid2</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">Kpad_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">nn_cachedir</span><span class="p">,</span> <span class="n">nn_mid_cacheid_list</span><span class="p">)</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result2</span> <span class="o">=</span> <span class="s1">&#39;nn_mid_cacheid_list2 = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">nn_mid_cacheid_list</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">result1</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">result2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">nn_mid_cacheid_list1 = [</span>
<span class="go">    &#39;nnobj_8687dcb6-1f1f-fdd3-8b72-8f36f9f41905_DVUUIDS((5)oavtblnlrtocnrpm)_NN(single,cks800)_Chip(sz700,maxwh)_Feat(hesaff+sift)_FLANN(8_kdtrees)_truek6&#39;,</span>
<span class="go">    &#39;nnobj_a2aef668-20c1-1897-d8f3-09a47a73f26a_DVUUIDS((5)oavtblnlrtocnrpm)_NN(single,cks800)_Chip(sz700,maxwh)_Feat(hesaff+sift)_FLANN(8_kdtrees)_truek6&#39;,</span>
<span class="go">]</span>
<span class="go">nn_mid_cacheid_list2 = [</span>
<span class="go">    &#39;nnobj_8687dcb6-1f1f-fdd3-8b72-8f36f9f41905_DVUUIDS((5)oavtblnlrtocnrpm)_NN(single,cks800)_Chip(sz700,maxwh)_Feat(hesaff+sift)_FLANN(8_kdtrees)_truek6&#39;,</span>
<span class="go">    &#39;nnobj_a2aef668-20c1-1897-d8f3-09a47a73f26a_DVUUIDS((5)oavtblnlrtocnrpm)_NN(single,cks800)_Chip(sz700,maxwh)_Feat(hesaff+sift)_FLANN(8_kdtrees)_truek6&#39;,</span>
<span class="go">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.pipeline.nearest_neighbors">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">nearest_neighbors</code><span class="sig-paren">(</span><em>qreq_</em>, <em>Kpad_list</em>, <em>impossible_daids_list=None</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#nearest_neighbors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.nearest_neighbors" title="Permalink to this definition">¶</a></dt>
<dd><p>Plain Nearest Neighbors
Tries to load nearest neighbors from a cache instead of recomputing them.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.pipeline –test-nearest_neighbors
python -m ibeis.algo.hots.pipeline –test-nearest_neighbors –db PZ_MTEST –qaids=1:100
utprof.py -m ibeis.algo.hots.pipeline –test-nearest_neighbors –db PZ_MTEST –qaids=1:100</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s1">&#39;nearest_neighbors&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Kpad_list</span><span class="p">,</span> <span class="n">impossible_daids_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_take</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">locals_</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Kpad_list&#39;</span><span class="p">,</span> <span class="s1">&#39;impossible_daids_list&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list</span> <span class="o">=</span> <span class="n">nearest_neighbors</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">Kpad_list</span><span class="p">,</span> <span class="n">impossible_daids_list</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">internal_qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn</span> <span class="o">=</span> <span class="n">nns_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">nn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_neighbors</span> <span class="o">=</span> <span class="n">Kpad_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">K</span> <span class="o">+</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">Knorm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Assert nns tuple is valid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_neighbors</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s1">&#39;nearest_neighbors&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Kpad_list</span><span class="p">,</span> <span class="n">impossible_daids_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_take</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">locals_</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Kpad_list&#39;</span><span class="p">,</span> <span class="s1">&#39;impossible_daids_list&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list</span> <span class="o">=</span> <span class="n">nearest_neighbors</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">Kpad_list</span><span class="p">,</span> <span class="n">impossible_daids_list</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">internal_qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn</span> <span class="o">=</span> <span class="n">nns_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">nn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_neighbors</span> <span class="o">=</span> <span class="n">Kpad_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">K</span> <span class="o">+</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">Knorm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Assert nns tuple is valid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_neighbors</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">custom_nid_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq1_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:K=2,requery=True,can_match_samename=False&#39;</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">daid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">custom_nid_lookup</span><span class="o">=</span><span class="n">custom_nid_lookup</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq1_</span><span class="p">,</span> <span class="s1">&#39;nearest_neighbors&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Kpad_list</span><span class="p">,</span> <span class="n">impossible_daids_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_take</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">locals_</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Kpad_list&#39;</span><span class="p">,</span> <span class="s1">&#39;impossible_daids_list&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list1</span> <span class="o">=</span> <span class="n">nearest_neighbors</span><span class="p">(</span><span class="n">qreq1_</span><span class="p">,</span> <span class="n">Kpad_list</span><span class="p">,</span> <span class="n">impossible_daids_list</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                              <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn1</span> <span class="o">=</span> <span class="n">nns_list1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnvalid0_list1</span> <span class="o">=</span> <span class="n">baseline_neighbor_filter</span><span class="p">(</span><span class="n">qreq1_</span><span class="p">,</span> <span class="n">nns_list1</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                          <span class="n">impossible_daids_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">nnvalid0_list1</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="s1">&#39;requery should never produce impossible results&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compare versus not using requery</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq2_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:K=2,requery=False&#39;</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">daid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq2_</span><span class="p">,</span> <span class="s1">&#39;nearest_neighbors&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Kpad_list</span><span class="p">,</span> <span class="n">impossible_daids_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_take</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">locals_</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Kpad_list&#39;</span><span class="p">,</span> <span class="s1">&#39;impossible_daids_list&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list2</span> <span class="o">=</span> <span class="n">nearest_neighbors</span><span class="p">(</span><span class="n">qreq2_</span><span class="p">,</span> <span class="n">Kpad_list</span><span class="p">,</span> <span class="n">impossible_daids_list</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                              <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn2</span> <span class="o">=</span> <span class="n">nns_list2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn1</span><span class="o">.</span><span class="n">neighb_dists</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn2</span><span class="o">.</span><span class="n">neighb_dists</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq1_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:K=5,requery=True,can_match_samename=False&#39;</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">daid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq1_</span><span class="p">,</span> <span class="s1">&#39;nearest_neighbors&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Kpad_list</span><span class="p">,</span> <span class="n">impossible_daids_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_take</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">locals_</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Kpad_list&#39;</span><span class="p">,</span> <span class="s1">&#39;impossible_daids_list&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list1</span> <span class="o">=</span> <span class="n">nearest_neighbors</span><span class="p">(</span><span class="n">qreq1_</span><span class="p">,</span> <span class="n">Kpad_list</span><span class="p">,</span> <span class="n">impossible_daids_list</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                              <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn1</span> <span class="o">=</span> <span class="n">nns_list1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnvalid0_list1</span> <span class="o">=</span> <span class="n">baseline_neighbor_filter</span><span class="p">(</span><span class="n">qreq1_</span><span class="p">,</span> <span class="n">nns_list1</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                          <span class="n">impossible_daids_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">nnvalid0_list1</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;should always be valid&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.pipeline.request_ibeis_query_L0">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">request_ibeis_query_L0</code><span class="sig-paren">(</span><em>ibs</em>, <em>qreq_</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#request_ibeis_query_L0"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.request_ibeis_query_L0" title="Permalink to this definition">¶</a></dt>
<dd><p>Driver logic of query pipeline</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure _pipeline_helpres.testrun_pipeline_upto reflects what happens
in this function.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ibs</strong> (<em>ibeis.IBEISController</em>) – IBEIS database object to be queried.
technically this object already lives inside of <a href="#id23"><span class="problematic" id="id24">qreq_</span></a>.</li>
<li><strong>qreq</strong> (<em>ibeis.QueryRequest</em>) – hyper-parameters. use
<code class="docutils literal notranslate"><span class="pre">ibs.new_query_request</span></code> to create one</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">cm_list containing <code class="docutils literal notranslate"><span class="pre">ibeis.ChipMatch</span></code> objects</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first">python -m ibeis.algo.hots.pipeline –test-request_ibeis_query_L0:0 –show
python -m ibeis.algo.hots.pipeline –test-request_ibeis_query_L0:1 –show</p>
<p>python -m ibeis.algo.hots.pipeline –test-request_ibeis_query_L0:0 –db testdb1 –qaid 325
python -m ibeis.algo.hots.pipeline –test-request_ibeis_query_L0:0 –db testdb3 –qaid 325
# background match
python -m ibeis.algo.hots.pipeline –test-request_ibeis_query_L0:0 –db NNP_Master3 –qaid 12838</p>
<p class="last">python -m ibeis.algo.hots.pipeline –test-request_ibeis_query_L0:0
python -m ibeis.algo.hots.pipeline –test-request_ibeis_query_L0:0 –db PZ_MTEST -a timectrl:qindex=0:256
python    -m ibeis.algo.hots.pipeline –test-request_ibeis_query_L0:0 –db PZ_Master1 -a timectrl:qindex=0:256
utprof.py -m ibeis.algo.hots.pipeline –test-request_ibeis_query_L0:0 –db PZ_Master1 -a timectrl:qindex=0:256</p>
</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">main_helpers</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:qindex=0:2,dindex=0:10&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">query_cfgstr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">request_ibeis_query_L0</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">ishow_analysis</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">make_figtitle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.pipeline.spatial_verification">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">spatial_verification</code><span class="sig-paren">(</span><em>qreq_</em>, <em>cm_list_FILT</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#spatial_verification"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.spatial_verification" title="Permalink to this definition">¶</a></dt>
<dd><p>pipeline step 5 - spatially verify feature matches</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">cm_listSVER - new list of spatially verified chipmatches</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.pipeline –test-spatial_verification –show
python -m ibeis.algo.hots.pipeline –test-spatial_verification –show –qaid 1
python -m ibeis.algo.hots.pipeline –test-spatial_verification:0</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre_sver</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scoring</span><span class="o">.</span><span class="n">score_chipmatch_list</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">prescore_method</span><span class="p">)</span>  <span class="c1"># HACK</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_nids</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_top_nids</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list_SVER</span> <span class="o">=</span> <span class="n">spatial_verification</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Test Results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmSV</span> <span class="o">=</span> <span class="n">cm_list_SVER</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scoring</span><span class="o">.</span><span class="n">score_chipmatch_list</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list_SVER</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">score_method</span><span class="p">)</span>  <span class="c1"># HACK</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_nids_SV</span> <span class="o">=</span> <span class="n">cmSV</span><span class="o">.</span><span class="n">get_top_nids</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">print_csv</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmSV</span><span class="o">.</span><span class="n">print_csv</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gt_daids</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">get_groundtruth_daids</span><span class="p">(),</span> <span class="n">cmSV</span><span class="o">.</span><span class="n">get_groundtruth_daids</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fm_list</span>   <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_annot_fm</span><span class="p">(</span><span class="n">gt_daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fmSV_list</span> <span class="o">=</span> <span class="n">cmSV</span><span class="o">.</span><span class="n">get_annot_fm</span><span class="p">(</span><span class="n">gt_daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">maplen</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">list_</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">list_</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">gt_daids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ground truth did not survive&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_lessthan</span><span class="p">(</span><span class="n">maplen</span><span class="p">(</span><span class="n">fmSV_list</span><span class="p">),</span> <span class="n">maplen</span><span class="p">(</span><span class="n">fm_list</span><span class="p">)),</span> <span class="s1">&#39;feature matches were not filtered&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmSV</span><span class="o">.</span><span class="n">show_daids_matches</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">gt_daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#homog_tup = (refined_inliers, H)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#aff_tup = (aff_inliers, Aff)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#pt.draw_sv.show_sv(rchip1, rchip2, kpts1, kpts2, fm, aff_tup=aff_tup, homog_tup=homog_tup, refine_method=refine_method)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.pipeline.sver_single_chipmatch">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">sver_single_chipmatch</code><span class="sig-paren">(</span><em>qreq_</em>, <em>cm</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#sver_single_chipmatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.sver_single_chipmatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Spatially verifies a shortlist of a single chipmatch</p>
<p>TODO: move to chip match?</p>
<p>loops over a shortlist of results for a specific query annotation</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<a class="reference internal" href="#ibeis.algo.hots.query_request.QueryRequest" title="ibeis.algo.hots.query_request.QueryRequest"><em>QueryRequest</em></a>) – query request object with hyper-parameters</li>
<li><strong>cm</strong> (<a class="reference internal" href="#ibeis.algo.hots.chip_match.ChipMatch" title="ibeis.algo.hots.chip_match.ChipMatch"><em>ChipMatch</em></a>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">cmSV</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ibeis.ChipMatch</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd><dl class="first docutils">
<dt>python -m ibeis draw_rank_cmc –db PZ_Master1 –show </dt>
<dd>-t best:refine_method=[homog,affine,cv2-homog,cv2-ransac-homog,cv2-lmeds-homog] -a timectrlhard —acfginfo –veryverbtd</dd>
<dt>python -m ibeis draw_rank_cmc –db PZ_Master1 –show </dt>
<dd>-t best:refine_method=[homog,cv2-lmeds-homog],full_homog_checks=[True,False] -a timectrlhard —acfginfo –veryverbtd</dd>
<dt>python -m ibeis sver_single_chipmatch –show </dt>
<dd>-t default:full_homog_checks=True -a default –qaid 18</dd>
<dt>python -m ibeis sver_single_chipmatch –show </dt>
<dd>-t default:refine_method=affine -a default –qaid 18</dd>
<dt>python -m ibeis sver_single_chipmatch –show </dt>
<dd>-t default:refine_method=cv2-homog -a default –qaid 18</dd>
<dt>python -m ibeis sver_single_chipmatch –show </dt>
<dd>-t default:refine_method=cv2-homog,full_homog_checks=True -a default –qaid 18</dd>
<dt>python -m ibeis sver_single_chipmatch –show </dt>
<dd>-t default:refine_method=cv2-homog,full_homog_checks=False -a default –qaid 18</dd>
<dt>python -m ibeis sver_single_chipmatch –show </dt>
<dd>-t default:refine_method=cv2-lmeds-homog,full_homog_checks=False -a default –qaid 18</dd>
<dt>python -m ibeis sver_single_chipmatch –show </dt>
<dd>-t default:refine_method=cv2-ransac-homog,full_homog_checks=False -a default –qaid 18</dd>
<dt>python -m ibeis sver_single_chipmatch –show </dt>
<dd>-t default:full_homog_checks=False -a default –qaid 18</dd>
</dl>
<p class="last">python -m ibeis sver_single_chipmatch –show –qaid=18 –y=0
python -m ibeis sver_single_chipmatch –show –qaid=18 –y=1</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Visualization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span><span class="s1">&#39;spatial_verification&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">)</span>  <span class="c1">#, qaid_list=[18])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">cm_list_FILT</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scoring</span><span class="o">.</span><span class="n">score_chipmatch_list</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">prescore_method</span><span class="p">)</span>  <span class="c1"># HACK</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#locals_ = ut.exec_func_src(sver_single_chipmatch, key_list=[&#39;svtup_list&#39;], sentinal=&#39;# &lt;SENTINAL&gt;&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#svtup_list1, = locals_</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">source</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_func_sourcecode</span><span class="p">(</span><span class="n">sver_single_chipmatch</span><span class="p">,</span> <span class="n">stripdef</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">strip_docstr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">source</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">replace_between_tags</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;# &lt;SENTINAL&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;# &lt;/SENTINAL&gt;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">globals_</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exec</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">globals_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">svtup_list</span> <span class="o">=</span> <span class="n">globals_</span><span class="p">[</span><span class="s1">&#39;svtup_list&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gt_daids</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_groundtruth_daids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--y&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#print(&#39;x = %r&#39; % (x,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#daid = daids[x % len(daids)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">notnone_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">not_list</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">flag_None_items</span><span class="p">(</span><span class="n">svtup_list</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">notnone_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_daids</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">daid_list</span><span class="p">[</span><span class="n">valid_idxs</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_daids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;cannot spatially verify&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_gt_daids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">gt_daids</span><span class="p">,</span> <span class="n">valid_daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#assert len(valid_gt_daids) == 0, &#39;no sver groundtruth&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid</span> <span class="o">=</span> <span class="n">valid_gt_daids</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_gt_daids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">valid_daids</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">daid2_idx</span><span class="p">[</span><span class="n">daid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">svtup</span> <span class="o">=</span> <span class="n">svtup_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">svtup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;SV TUP IS NONE&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">refined_inliers</span><span class="p">,</span> <span class="n">refined_errors</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">svtup</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aff_inliers</span><span class="p">,</span> <span class="n">aff_errors</span><span class="p">,</span> <span class="n">Aff</span> <span class="o">=</span> <span class="n">svtup</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">homog_tup</span> <span class="o">=</span> <span class="p">(</span><span class="n">refined_inliers</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aff_tup</span> <span class="o">=</span> <span class="p">(</span><span class="n">aff_inliers</span><span class="p">,</span> <span class="n">Aff</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">fm_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aid1</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">qaid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aid2</span> <span class="o">=</span> <span class="n">daid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rchip1</span><span class="p">,</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chips</span><span class="p">([</span><span class="n">aid1</span><span class="p">],</span> <span class="n">config2_</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">extern_query_config2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kpts1</span><span class="p">,</span>  <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_kpts</span><span class="p">([</span><span class="n">aid1</span><span class="p">],</span> <span class="n">config2_</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">extern_query_config2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rchip2</span><span class="p">,</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chips</span><span class="p">([</span><span class="n">aid2</span><span class="p">],</span> <span class="n">config2_</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">extern_data_config2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kpts2</span><span class="p">,</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_kpts</span><span class="p">([</span><span class="n">aid2</span><span class="p">],</span> <span class="n">config2_</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">extern_data_config2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.scripts.thesis</span> <span class="k">import</span> <span class="n">TMP_RC</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TMP_RC</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show_aff</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--noaff&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">refine_method</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">refine_method</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--norefinelbl&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">draw_sv</span><span class="o">.</span><span class="n">show_sv</span><span class="p">(</span><span class="n">rchip1</span><span class="p">,</span> <span class="n">rchip2</span><span class="p">,</span> <span class="n">kpts1</span><span class="p">,</span> <span class="n">kpts2</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">aff_tup</span><span class="o">=</span><span class="n">aff_tup</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                   <span class="n">homog_tup</span><span class="o">=</span><span class="n">homog_tup</span><span class="p">,</span> <span class="n">show_aff</span><span class="o">=</span><span class="n">show_aff</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                   <span class="n">refine_method</span><span class="o">=</span><span class="n">refine_method</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.pipeline.weight_neighbors">
<code class="descclassname">ibeis.algo.hots.pipeline.</code><code class="descname">weight_neighbors</code><span class="sig-paren">(</span><em>qreq_</em>, <em>nns_list</em>, <em>nnvalid0_list</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/pipeline.html#weight_neighbors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.pipeline.weight_neighbors" title="Permalink to this definition">¶</a></dt>
<dd><p>pipeline step 3 -
assigns weights to feature matches based on the active filter list</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first">python -m ibeis.algo.hots.pipeline –test-weight_neighbors
python -m ibeis.algo.hots.pipeline –test-weight_neighbors:0 –verbose –verbtd –ainfo –nocache –veryverbose
python -m ibeis.algo.hots.pipeline –test-weight_neighbors:0 –show
python -m ibeis.algo.hots.pipeline –test-weight_neighbors:1 –show</p>
<p class="last">python -m ibeis.algo.hots.pipeline –test-weight_neighbors:0 –show -t default:lnbnn_normer=lnbnn_fg_0.9__featscore,lnbnn_norm_thresh=.9</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;weight_neighbors&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:qindex=0:3,dindex=0:5,hackerrors=False&#39;</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:codename=vsmany,bar_l2_on=True,fg_on=False&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weight_ret</span> <span class="o">=</span> <span class="n">weight_neighbors</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtkey_list</span><span class="p">,</span> <span class="n">filtweights_list</span><span class="p">,</span> <span class="n">filtvalids_list</span><span class="p">,</span> <span class="n">filtnormks_list</span> <span class="o">=</span> <span class="n">weight_ret</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">build_chipmatches</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">qreq_</span><span class="p">,</span> <span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">filtkey_list</span><span class="p">,</span> <span class="n">filtweights_list</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">filtvalids_list</span><span class="p">,</span> <span class="n">filtnormks_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">score_name_nsum</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">ishow_analysis</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.pipeline</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;weight_neighbors&#39;</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:qindex=0:3,dindex=0:5,hackerrors=False&#39;</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default:codename=vsmany,bar_l2_on=True,fg_on=False&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weight_ret</span> <span class="o">=</span> <span class="n">weight_neighbors</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtkey_list</span><span class="p">,</span> <span class="n">filtweights_list</span><span class="p">,</span> <span class="n">filtvalids_list</span><span class="p">,</span> <span class="n">filtnormks_list</span> <span class="o">=</span> <span class="n">weight_ret</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nInternAids</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nFiltKeys</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtkey_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtweight_depth</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">depth_profile</span><span class="p">(</span><span class="n">filtweights_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtvalid_depth</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">depth_profile</span><span class="p">(</span><span class="n">filtvalids_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">nInternAids</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtweights_list</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">nInternAids</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtvalids_list</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_list_column</span><span class="p">(</span><span class="n">filtweight_depth</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">[</span><span class="n">nFiltKeys</span><span class="p">]</span> <span class="o">*</span> <span class="n">nInternAids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">filtvalid_depth</span><span class="p">,</span> <span class="p">(</span><span class="n">nInternAids</span><span class="p">,</span> <span class="n">nFiltKeys</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">filtvalids_list</span><span class="p">,</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">filtkey_list</span><span class="p">,</span> <span class="p">[</span><span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">LNBNN</span><span class="p">,</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">BARL2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">build_chipmatches</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">qreq_</span><span class="p">,</span> <span class="n">nns_list</span><span class="p">,</span> <span class="n">nnvalid0_list</span><span class="p">,</span> <span class="n">filtkey_list</span><span class="p">,</span> <span class="n">filtweights_list</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">filtvalids_list</span><span class="p">,</span> <span class="n">filtnormks_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">score_name_nsum</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">ishow_analysis</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.query_params">
<span id="ibeis-algo-hots-query-params-module"></span><h2>ibeis.algo.hots.query_params module<a class="headerlink" href="#module-ibeis.algo.hots.query_params" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ibeis.algo.hots.query_params.QueryParams">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.query_params.</code><code class="descname">QueryParams</code><span class="sig-paren">(</span><em>query_cfg=None</em>, <em>cfgdict=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_params.html#QueryParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_params.QueryParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Mapping</span></code></p>
<dl class="method">
<dt id="ibeis.algo.hots.query_params.QueryParams.copy">
<code class="descname">copy</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_params.html#QueryParams.copy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_params.QueryParams.copy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_params.QueryParams.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>key</em>, <em>*d</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_params.html#QueryParams.get"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_params.QueryParams.get" title="Permalink to this definition">¶</a></dt>
<dd><p>get a paramater value by string</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_params.QueryParams.get_postsver_filtkey_list">
<code class="descname">get_postsver_filtkey_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_params.html#QueryParams.get_postsver_filtkey_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_params.QueryParams.get_postsver_filtkey_list" title="Permalink to this definition">¶</a></dt>
<dd><p>HACK: gets columns of fsv post spatial verification.  This will
eventually be incorporated into cmtup_old instead and will not be
dependant on specifically where you are in the pipeline</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_params.QueryParams.hack_lnbnn_config_trail">
<code class="descname">hack_lnbnn_config_trail</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_params.html#QueryParams.hack_lnbnn_config_trail"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_params.QueryParams.hack_lnbnn_config_trail" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.query_request">
<span id="ibeis-algo-hots-query-request-module"></span><h2>ibeis.algo.hots.query_request module<a class="headerlink" href="#module-ibeis.algo.hots.query_request" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ibeis.algo.hots.query_request.QueryRequest">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.query_request.</code><code class="descname">QueryRequest</code><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code></p>
<p>Request object for pipline parameter run</p>
<dl class="attribute">
<dt id="ibeis.algo.hots.query_request.QueryRequest.daids">
<code class="descname">daids</code><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.daids" title="Permalink to this definition">¶</a></dt>
<dd><p>These are the users daids in vsone mode</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.query_request.QueryRequest.dannots">
<code class="descname">dannots</code><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.dannots" title="Permalink to this definition">¶</a></dt>
<dd><p>external query annotation objects</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.query_request.QueryRequest.dnids">
<code class="descname">dnids</code><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.dnids" title="Permalink to this definition">¶</a></dt>
<dd><p>save dnids in <a href="#id25"><span class="problematic" id="id26">qreq_</span></a> state</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">TODO</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.ensure_chips">
<code class="descname">ensure_chips</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>num_retries=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.ensure_chips"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.ensure_chips" title="Permalink to this definition">¶</a></dt>
<dd><p>ensure chips are computed (used in expt, not used in pipeline)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>verbose</strong> (<em>bool</em>) – verbosity flag(default = True)</li>
<li><strong>num_retries</strong> (<em>int</em>) – (default = 0)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.query_request –test-ensure_chips</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Delete chips (accidentally), then try to run a query</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_retries</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qchip_fpaths</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chip_fpath</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">config2_</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">extern_query_config2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dchip_fpaths</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chip_fpath</span><span class="p">(</span><span class="n">daids</span><span class="p">,</span> <span class="n">config2_</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">extern_data_config2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">remove_file_list</span><span class="p">(</span><span class="n">qchip_fpaths</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">remove_file_list</span><span class="p">(</span><span class="n">dchip_fpaths</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ensure_chips</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="n">num_retries</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.ensure_features">
<code class="descname">ensure_features</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>prog_hook=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.ensure_features"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.ensure_features" title="Permalink to this definition">¶</a></dt>
<dd><p>ensure features are computed
:param verbose: verbosity flag(default = True)
:type verbose: bool</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.query_request –test-ensure_features</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="o">.</span><span class="n">delete_annot_feats</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span>  <span class="n">config2_</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">extern_query_config2</span><span class="p">)</span>  <span class="c1"># Remove the chips</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">remove_file_list</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chip_fpath</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">config2_</span><span class="o">=</span><span class="n">qreq_</span><span class="o">.</span><span class="n">extern_query_config2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ensure_features</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.ensure_featweights">
<code class="descname">ensure_featweights</code><span class="sig-paren">(</span><em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.ensure_featweights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.ensure_featweights" title="Permalink to this definition">¶</a></dt>
<dd><p>ensure feature weights are computed</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><em>qaids=None</em>, <em>prog_hook=None</em>, <em>use_cache=None</em>, <em>invalidate_supercache=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.execute"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.execute" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the hotspotter pipeline and returns chip match objects.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.query_request execute –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># xdoctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">ishow_analysis</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.query_request.QueryRequest.extern_data_config2">
<code class="descname">extern_data_config2</code><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.extern_data_config2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.query_request.QueryRequest.extern_query_config2">
<code class="descname">extern_query_config2</code><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.extern_query_config2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_big_cacher">
<code class="descname">get_big_cacher</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_big_cacher"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_big_cacher" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_bigcache_info">
<code class="descname">get_bigcache_info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_bigcache_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_bigcache_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_cfgstr">
<code class="descname">get_cfgstr</code><span class="sig-paren">(</span><em>with_input=False</em>, <em>with_data=True</em>, <em>with_pipe=True</em>, <em>hash_pipe=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd><p>main cfgstring used to identify the ‘querytype’
FIXME: name params + data</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>with_input</strong> (<em>bool</em>) – (default = False)</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">cfgstr</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.query_request –exec-get_cfgstr</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:fgw_thresh=.3&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="n">a</span><span class="o">=</span><span class="s1">&#39;default:species=zebra_plains&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">with_input</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgstr</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">(</span><span class="n">with_input</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;cfgstr = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cfgstr</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_chipmatch_fpaths">
<code class="descname">get_chipmatch_fpaths</code><span class="sig-paren">(</span><em>qaid_list</em>, <em>super_qres_cache=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_chipmatch_fpaths"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_chipmatch_fpaths" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates chipmatch paths for input query annotation rowids</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_data_hashid">
<code class="descname">get_data_hashid</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_data_hashid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_data_hashid" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.query_request –exec-QueryRequest.get_query_hashid –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_hashid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_data_hashid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;data_hashid = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">data_hashid</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_external_query_groundtruth">
<code class="descname">get_external_query_groundtruth</code><span class="sig-paren">(</span><em>qaids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_external_query_groundtruth"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_external_query_groundtruth" title="Permalink to this definition">¶</a></dt>
<dd><p>gets groundtruth that are accessible via this query</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_full_cfgstr">
<code class="descname">get_full_cfgstr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_full_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_full_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd><p>main cfgstring used to identify the ‘querytype’
FIXME: name
params + data + query</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_infostr">
<code class="descname">get_infostr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_infostr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_infostr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_internal_daids">
<code class="descname">get_internal_daids</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_internal_daids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_internal_daids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_internal_data_config2">
<code class="descname">get_internal_data_config2</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_internal_data_config2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_internal_data_config2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_internal_qaids">
<code class="descname">get_internal_qaids</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_internal_qaids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_internal_qaids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_internal_query_config2">
<code class="descname">get_internal_query_config2</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_internal_query_config2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_internal_query_config2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_pipe_cfgstr">
<code class="descname">get_pipe_cfgstr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_pipe_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_pipe_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME: name
params only</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_pipe_hashid">
<code class="descname">get_pipe_hashid</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_pipe_hashid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_pipe_hashid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_qreq_annot_nids">
<code class="descname">get_qreq_annot_nids</code><span class="sig-paren">(</span><em>aids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_qreq_annot_nids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_qreq_annot_nids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_qreq_annot_visual_uuids">
<code class="descname">get_qreq_annot_visual_uuids</code><span class="sig-paren">(</span><em>aids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_qreq_annot_visual_uuids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_qreq_annot_visual_uuids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_qreq_dannot_fgweights">
<code class="descname">get_qreq_dannot_fgweights</code><span class="sig-paren">(</span><em>daids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_qreq_dannot_fgweights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_qreq_dannot_fgweights" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_qreq_dannot_kpts">
<code class="descname">get_qreq_dannot_kpts</code><span class="sig-paren">(</span><em>daids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_qreq_dannot_kpts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_qreq_dannot_kpts" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_qreq_pcc_hashes">
<code class="descname">get_qreq_pcc_hashes</code><span class="sig-paren">(</span><em>aids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_qreq_pcc_hashes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_qreq_pcc_hashes" title="Permalink to this definition">¶</a></dt>
<dd><p>aids = [1, 2, 3]</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_qreq_pcc_hashid">
<code class="descname">get_qreq_pcc_hashid</code><span class="sig-paren">(</span><em>aids</em>, <em>prefix=''</em>, <em>with_nids=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_qreq_pcc_hashid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_qreq_pcc_hashid" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets a combined hash of a group of aids. Each aid hash represents
itself in the context of the query database.</p>
<p>only considers grouping of database names</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.query_request –test-get_qreq_pcc_hashid:0</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;default:K=2,nameknn=True&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">defaultdb</span> <span class="o">=</span> <span class="s1">&#39;testdb1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Test that UUIDS change when you change the name lookup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">,</span> <span class="n">defaultdb</span><span class="o">=</span><span class="n">defaultdb</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                  <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># All diff names</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq1</span> <span class="o">=</span> <span class="n">new_</span><span class="p">(</span><span class="n">daid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>             <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>             <span class="n">custom_nid_lookup</span><span class="o">=</span><span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">)})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># All same names</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq2</span> <span class="o">=</span> <span class="n">new_</span><span class="p">(</span><span class="n">daid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>             <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>             <span class="n">custom_nid_lookup</span><span class="o">=</span><span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">)})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Change the PCC, removing a query (data should NOT change)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># because the thing being queried against is the same</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq3</span> <span class="o">=</span> <span class="n">new_</span><span class="p">(</span><span class="n">daid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>             <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>             <span class="n">custom_nid_lookup</span><span class="o">=</span><span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">)})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Now remove a database object (query SHOULD change)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># because the results are different depending on</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># nameing of database (maybe they shouldnt change...)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq4</span> <span class="o">=</span> <span class="n">new_</span><span class="p">(</span><span class="n">daid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>             <span class="n">qaid_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>             <span class="n">custom_nid_lookup</span><span class="o">=</span><span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">)})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qreq1</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">(</span><span class="n">with_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_pipe</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qreq2</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">(</span><span class="n">with_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_pipe</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qreq3</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">(</span><span class="n">with_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_pipe</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qreq4</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">(</span><span class="n">with_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_pipe</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq3</span><span class="o">.</span><span class="n">get_data_hashid</span><span class="p">()</span> <span class="o">==</span> <span class="n">qreq2</span><span class="o">.</span><span class="n">get_data_hashid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq1</span><span class="o">.</span><span class="n">get_data_hashid</span><span class="p">()</span> <span class="o">!=</span> <span class="n">qreq2</span><span class="o">.</span><span class="n">get_data_hashid</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_qreq_pcc_uuids">
<code class="descname">get_qreq_pcc_uuids</code><span class="sig-paren">(</span><em>aids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_qreq_pcc_uuids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_qreq_pcc_uuids" title="Permalink to this definition">¶</a></dt>
<dd><p>TODO. dont use uuids anymore. they are slow</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_qreq_qannot_fgweights">
<code class="descname">get_qreq_qannot_fgweights</code><span class="sig-paren">(</span><em>qaids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_qreq_qannot_fgweights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_qreq_qannot_fgweights" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_qreq_qannot_kpts">
<code class="descname">get_qreq_qannot_kpts</code><span class="sig-paren">(</span><em>qaids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_qreq_qannot_kpts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_qreq_qannot_kpts" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_qresdir">
<code class="descname">get_qresdir</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_qresdir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_qresdir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_query_hashid">
<code class="descname">get_query_hashid</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_query_hashid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_query_hashid" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.query_request –exec-QueryRequest.get_query_hashid –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query_hashid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_query_hashid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;query_hashid = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">query_hashid</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_shortinfo_cfgstr">
<code class="descname">get_shortinfo_cfgstr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_shortinfo_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_shortinfo_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_shortinfo_parts">
<code class="descname">get_shortinfo_parts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_shortinfo_parts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_shortinfo_parts" title="Permalink to this definition">¶</a></dt>
<dd><p>Rename to get_nice_parts</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.get_unique_species">
<code class="descname">get_unique_species</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.get_unique_species"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.get_unique_species" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.query_request.QueryRequest.internal_dannots">
<code class="descname">internal_dannots</code><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.internal_dannots" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.query_request.QueryRequest.internal_qannots">
<code class="descname">internal_qannots</code><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.internal_qannots" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.lazy_load">
<code class="descname">lazy_load</code><span class="sig-paren">(</span><em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.lazy_load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.lazy_load" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs preloading of all data needed for a batch of queries</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.lazy_preload">
<code class="descname">lazy_preload</code><span class="sig-paren">(</span><em>prog_hook=None</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.lazy_preload"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.lazy_preload" title="Permalink to this definition">¶</a></dt>
<dd><p>feature weights and normalizers should be loaded before vsone queries
are issued. They do not depened only on qparams</p>
<p>Load non-query specific normalizers / weights</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.load_indexer">
<code class="descname">load_indexer</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>force=False</em>, <em>prog_hook=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.load_indexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.load_indexer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="ibeis.algo.hots.query_request.QueryRequest.new_query_request">
<em class="property">classmethod </em><code class="descname">new_query_request</code><span class="sig-paren">(</span><em>qaid_list</em>, <em>daid_list</em>, <em>qparams</em>, <em>qresdir</em>, <em>ibs</em>, <em>query_config2_</em>, <em>data_config2_</em>, <em>_indexer_request_params</em>, <em>custom_nid_lookup=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.new_query_request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.new_query_request" title="Permalink to this definition">¶</a></dt>
<dd><p>old way of calling new</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qaid_list</strong> (<em>list</em>) – </li>
<li><strong>daid_list</strong> (<em>list</em>) – </li>
<li><strong>qparams</strong> (<a class="reference internal" href="#ibeis.algo.hots.query_params.QueryParams" title="ibeis.algo.hots.query_params.QueryParams"><em>QueryParams</em></a>) – query hyper-parameters</li>
<li><strong>qresdir</strong> (<em>str</em>) – </li>
<li><strong>ibs</strong> (<em>ibeis.IBEISController</em>) – image analysis api</li>
<li><strong>_indexer_request_params</strong> (<em>dict</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">ibeis.QueryRequest</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.query_request.QueryRequest.qaids">
<code class="descname">qaids</code><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.qaids" title="Permalink to this definition">¶</a></dt>
<dd><p>These are the users qaids in vsone mode</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.query_request.QueryRequest.qannots">
<code class="descname">qannots</code><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.qannots" title="Permalink to this definition">¶</a></dt>
<dd><p>internal query annotation objects</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.algo.hots.query_request.QueryRequest.qnids">
<code class="descname">qnids</code><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.qnids" title="Permalink to this definition">¶</a></dt>
<dd><p>save qnids in <a href="#id27"><span class="problematic" id="id28">qreq_</span></a> state</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">TODO</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.rrr">
<code class="descname">rrr</code><span class="sig-paren">(</span><em>verbose=True</em>, <em>reload_module=True</em><span class="sig-paren">)</span><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.rrr" title="Permalink to this definition">¶</a></dt>
<dd><p>special class reloading function
This function is often injected as rrr of classes</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.set_external_daids">
<code class="descname">set_external_daids</code><span class="sig-paren">(</span><em>daid_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.set_external_daids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.set_external_daids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.set_external_qaid_mask">
<code class="descname">set_external_qaid_mask</code><span class="sig-paren">(</span><em>masked_qaid_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.set_external_qaid_mask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.set_external_qaid_mask" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qaid_list</strong> (<em>list</em>) – </td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.query_request –test-set_external_qaid_mask</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">masked_qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">set_external_qaid_mask</span><span class="p">(</span><span class="n">masked_qaid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">[1 3]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.set_external_qaids">
<code class="descname">set_external_qaids</code><span class="sig-paren">(</span><em>qaid_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.set_external_qaids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.set_external_qaids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.set_internal_masked_daids">
<code class="descname">set_internal_masked_daids</code><span class="sig-paren">(</span><em>masked_daid_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.set_internal_masked_daids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.set_internal_masked_daids" title="Permalink to this definition">¶</a></dt>
<dd><p>used by the pipeline to execute a subset of the query request
without modifying important state</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.set_internal_masked_qaids">
<code class="descname">set_internal_masked_qaids</code><span class="sig-paren">(</span><em>masked_qaid_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.set_internal_masked_qaids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.set_internal_masked_qaids" title="Permalink to this definition">¶</a></dt>
<dd><p>used by the pipeline to execute a subset of the query request
without modifying important state</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">qaid_override</span><span class="o">=</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_override</span><span class="o">=</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;default:sv_on=True&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_lists_eq</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">qaids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">masked_qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">set_internal_masked_qaids</span><span class="p">(</span><span class="n">masked_qaid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_internal_aids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_lists_eq</span><span class="p">(</span><span class="n">new_internal_aids</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.query_request.QueryRequest.shallowcopy">
<code class="descname">shallowcopy</code><span class="sig-paren">(</span><em>qaids=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#QueryRequest.shallowcopy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.QueryRequest.shallowcopy" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a copy of qreq with the same qparams object and a subset of the
qx and dx objects.  used to generate chunks of vsmany queries</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.query_request QueryRequest.shallowcopy</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">default_qaids</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq2_</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">shallowcopy</span><span class="p">(</span><span class="n">qaids</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">daids</span> <span class="ow">is</span> <span class="n">qreq2_</span><span class="o">.</span><span class="n">daids</span><span class="p">,</span> <span class="s1">&#39;should be the same&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreq2_</span><span class="o">.</span><span class="n">qaids</span><span class="p">),</span> <span class="s1">&#39;should be diff&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#assert qreq_.metadata is not qreq2_.metadata</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.query_request.apply_species_with_detector_hack">
<code class="descclassname">ibeis.algo.hots.query_request.</code><code class="descname">apply_species_with_detector_hack</code><span class="sig-paren">(</span><em>ibs</em>, <em>cfgdict</em>, <em>qaids</em>, <em>daids</em>, <em>verbose=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#apply_species_with_detector_hack"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.apply_species_with_detector_hack" title="Permalink to this definition">¶</a></dt>
<dd><p>HACK turns of featweights if they cannot be applied</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.query_request.cfg_deepcopy_test">
<code class="descclassname">ibeis.algo.hots.query_request.</code><code class="descname">cfg_deepcopy_test</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#cfg_deepcopy_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.cfg_deepcopy_test" title="Permalink to this definition">¶</a></dt>
<dd><p>TESTING FUNCTION</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">cfg_deepcopy_test</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.query_request.new_ibeis_query_request">
<code class="descclassname">ibeis.algo.hots.query_request.</code><code class="descname">new_ibeis_query_request</code><span class="sig-paren">(</span><em>ibs</em>, <em>qaid_list</em>, <em>daid_list</em>, <em>cfgdict=None</em>, <em>verbose=None</em>, <em>unique_species=None</em>, <em>use_memcache=True</em>, <em>query_cfg=None</em>, <em>custom_nid_lookup=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#new_ibeis_query_request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.new_ibeis_query_request" title="Permalink to this definition">¶</a></dt>
<dd><p>ibeis entry point to create a new query request object</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ibs</strong> (<em>ibeis.IBEISController</em>) – image analysis api</li>
<li><strong>qaid_list</strong> (<em>list</em>) – query ids</li>
<li><strong>daid_list</strong> (<em>list</em>) – database ids</li>
<li><strong>cfgdict</strong> (<em>dict</em>) – pipeline dictionary config</li>
<li><strong>query_cfg</strong> (<em>dtool.Config</em>) – Pipeline Config Object</li>
<li><strong>unique_species</strong> (<em>None</em>) – (default = None)</li>
<li><strong>use_memcache</strong> (<em>bool</em>) – (default = True)</li>
<li><strong>verbose</strong> (<em>bool</em>) – verbosity flag(default = True)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">ibeis.QueryRequest</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.query_request –test-new_ibeis_query_request:0
python -m ibeis.algo.hots.query_request –test-new_ibeis_query_request:1</dd>
<dt>Example0:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span> <span class="o">=</span> <span class="n">testdata_newqreq</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unique_species</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">NOT_QUIET</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sv_on&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;fg_on&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>  <span class="c1"># &#39;fw_detector&#39;: &#39;rf&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">new_ibeis_query_request</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">sv_on</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="s1">&#39;qreq_.qparams.sv_on = </span><span class="si">%r</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">sv_on</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_dbname</span><span class="p">()</span> <span class="o">+</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_data_hashid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">PZ_MTEST_DPCC_UUIDS-a5-n2-vpkyggtpzbqbecuq</span>
</pre></div>
</div>
</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span> <span class="o">=</span> <span class="n">testdata_newqreq</span><span class="p">(</span><span class="s1">&#39;NAUT_test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unique_species</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">NOT_QUIET</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sv_on&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;fg_on&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">new_ibeis_query_request</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">query_config2_</span><span class="o">.</span><span class="n">featweight_enabled</span> <span class="ow">is</span> <span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Featweight should be off because there is no Naut detector</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">query_cfgstr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">sv_on</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="s1">&#39;qreq_.qparams.sv_on = </span><span class="si">%r</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">sv_on</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_dbname</span><span class="p">()</span> <span class="o">+</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_data_hashid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">NAUT_test_DPCC_UUIDS-a5-n3-rtuyggvzpczvmjcw</span>
</pre></div>
</div>
</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.query_request</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span> <span class="o">=</span> <span class="n">testdata_newqreq</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unique_species</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">NOT_QUIET</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sv_on&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;query_rotation_heuristic&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">new_ibeis_query_request</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Featweight should be off because there is no Naut detector</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">query_cfgstr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">sv_on</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="s1">&#39;qreq_.qparams.sv_on = </span><span class="si">%r</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">sv_on</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_dbname</span><span class="p">()</span> <span class="o">+</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_data_hashid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">PZ_MTEST_DPCC_UUIDS-a5-n2-vpkyggtpzbqbecuq</span>
</pre></div>
</div>
</dd>
<dt>Ignore:</dt>
<dd><p class="first"># This is supposed to be the beginings of the code to transition the
# pipeline configuration into the new minimal dict based structure that
# supports different configs for query and database annotations.
dcfg = <a href="#id29"><span class="problematic" id="id30">qreq_</span></a>.extern_data_config2
qcfg = <a href="#id31"><span class="problematic" id="id32">qreq_</span></a>.extern_query_config2
ut.dict_intersection(qcfg.__dict__, dcfg.__dict__)
from ibeis.expt import cfghelpers
cfg_list = [qcfg.__dict__, dcfg.__dict__]
nonvaried_cfg, varied_cfg_list = ut.partition_varied_cfg_list(</p>
<blockquote>
<div>cfg_list, recursive=True)</div></blockquote>
<p class="last">qvaried, dvaried = varied_cfg_list</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.query_request.testdata_newqreq">
<code class="descclassname">ibeis.algo.hots.query_request.</code><code class="descname">testdata_newqreq</code><span class="sig-paren">(</span><em>defaultdb='testdb1'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/query_request.html#testdata_newqreq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.query_request.testdata_newqreq" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(ibeis.IBEISController, list, list)</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.requery_knn">
<span id="ibeis-algo-hots-requery-knn-module"></span><h2>ibeis.algo.hots.requery_knn module<a class="headerlink" href="#module-ibeis.algo.hots.requery_knn" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ibeis.algo.hots.requery_knn.FinalResults">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.requery_knn.</code><code class="descname">FinalResults</code><span class="sig-paren">(</span><em>shape</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/requery_knn.html#FinalResults"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.requery_knn.FinalResults" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code></p>
<dl class="method">
<dt id="ibeis.algo.hots.requery_knn.FinalResults.assign">
<code class="descname">assign</code><span class="sig-paren">(</span><em>index</em>, <em>idxs</em>, <em>dists</em>, <em>trueks</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/requery_knn.html#FinalResults.assign"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.requery_knn.FinalResults.assign" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ibeis.algo.hots.requery_knn.TempQuery">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.requery_knn.</code><code class="descname">TempQuery</code><span class="sig-paren">(</span><em>vecs</em>, <em>invalid_axs</em>, <em>get_neighbors</em>, <em>get_axs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/requery_knn.html#TempQuery"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.requery_knn.TempQuery" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code></p>
<p>queries that are incomplete</p>
<dl class="method">
<dt id="ibeis.algo.hots.requery_knn.TempQuery.compress_inplace">
<code class="descname">compress_inplace</code><span class="sig-paren">(</span><em>flags</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/requery_knn.html#TempQuery.compress_inplace"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.requery_knn.TempQuery.compress_inplace" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.requery_knn.TempQuery.neighbors">
<code class="descname">neighbors</code><span class="sig-paren">(</span><em>temp_K</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/requery_knn.html#TempQuery.neighbors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.requery_knn.TempQuery.neighbors" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ibeis.algo.hots.requery_knn.TempResults">
<em class="property">class </em><code class="descclassname">ibeis.algo.hots.requery_knn.</code><code class="descname">TempResults</code><span class="sig-paren">(</span><em>index</em>, <em>idxs</em>, <em>dists</em>, <em>validflags</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/requery_knn.html#TempResults"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.requery_knn.TempResults" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">utool.util_dev.NiceRepr</span></code></p>
<dl class="method">
<dt id="ibeis.algo.hots.requery_knn.TempResults.compress">
<code class="descname">compress</code><span class="sig-paren">(</span><em>flags</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/requery_knn.html#TempResults.compress"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.requery_knn.TempResults.compress" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.requery_knn.TempResults.done_flags">
<code class="descname">done_flags</code><span class="sig-paren">(</span><em>num_neighbs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/requery_knn.html#TempResults.done_flags"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.requery_knn.TempResults.done_flags" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.algo.hots.requery_knn.TempResults.done_part">
<code class="descname">done_part</code><span class="sig-paren">(</span><em>num_neighbs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/requery_knn.html#TempResults.done_part"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.requery_knn.TempResults.done_part" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.requery_knn.in1d_shape">
<code class="descclassname">ibeis.algo.hots.requery_knn.</code><code class="descname">in1d_shape</code><span class="sig-paren">(</span><em>arr1</em>, <em>arr2</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/requery_knn.html#in1d_shape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.requery_knn.in1d_shape" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.requery_knn.requery_knn">
<code class="descclassname">ibeis.algo.hots.requery_knn.</code><code class="descname">requery_knn</code><span class="sig-paren">(</span><em>get_neighbors</em>, <em>get_axs</em>, <em>qfx2_vec</em>, <em>num_neighbs</em>, <em>invalid_axs=[]</em>, <em>pad=2</em>, <em>limit=4</em>, <em>recover=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/requery_knn.html#requery_knn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.requery_knn.requery_knn" title="Permalink to this definition">¶</a></dt>
<dd><p>Searches for <cite>num_neighbs</cite>, while ignoring certain matches.  K is
increassed until enough valid neighbors are found or a limit is reached.</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">testdata_qreq_</span><span class="p">(</span><span class="n">defaultdb</span><span class="o">=</span><span class="s1">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">load_indexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">indexer</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">indexer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qannot</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">internal_qannots</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">qannot</span><span class="o">.</span><span class="n">vecs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qannot</span><span class="o">.</span><span class="n">aid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">impossible_aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_groundtruth</span><span class="p">(</span><span class="n">qaid</span><span class="p">,</span> <span class="n">noself</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">invalid_axs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">indexer</span><span class="o">.</span><span class="n">aid2_ax</span><span class="p">,</span> <span class="n">impossible_aids</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pad</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">limit</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_neighbs</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">get_neighbors</span><span class="p">(</span><span class="n">vecs</span><span class="p">,</span> <span class="n">temp_K</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">return</span> <span class="n">indexer</span><span class="o">.</span><span class="n">flann</span><span class="o">.</span><span class="n">nn_index</span><span class="p">(</span><span class="n">vecs</span><span class="p">,</span> <span class="n">temp_K</span><span class="p">,</span> <span class="n">checks</span><span class="o">=</span><span class="n">indexer</span><span class="o">.</span><span class="n">checks</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                  <span class="n">cores</span><span class="o">=</span><span class="n">indexer</span><span class="o">.</span><span class="n">cores</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_axs</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="n">get_nn_axs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">requery_knn</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">get_neighbors</span><span class="p">,</span> <span class="n">get_axs</span><span class="p">,</span> <span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">num_neighbs</span><span class="p">,</span> <span class="n">invalid_axs</span><span class="p">,</span> <span class="n">pad</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">limit</span><span class="p">,</span> <span class="n">recover</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span> <span class="o">=</span> <span class="n">res</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">qfx2_dist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.neighbor_index</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.requery_knn</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">max_k</span> <span class="o">=</span> <span class="mi">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n_pts</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_neighbs</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temp_K</span> <span class="o">=</span> <span class="n">num_neighbs</span> <span class="o">*</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create dummy data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tx2_idx_full</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_pts</span><span class="p">,</span> <span class="n">max_k</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tx2_idx_full</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tx2_dist_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">max_k</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_pts</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tx2_dist_full</span> <span class="o">+=</span> <span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n_pts</span><span class="p">,</span> <span class="n">max_k</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_pts</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vecs</span> <span class="o">=</span> <span class="n">qfx2_vec</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pad</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">limit</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">recover</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">invalid_axs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_axs</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">identity</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">get_neighbors</span><span class="p">(</span><span class="n">vecs</span><span class="p">,</span> <span class="n">temp_K</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># simulates finding k nearest neighbors</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">idxs</span> <span class="o">=</span> <span class="n">tx2_idx_full</span><span class="p">[</span><span class="n">vecs</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="mi">0</span><span class="p">:</span><span class="n">temp_K</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">dists</span> <span class="o">=</span> <span class="n">tx2_dist_full</span><span class="p">[</span><span class="n">vecs</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="mi">0</span><span class="p">:</span><span class="n">temp_K</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">return</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">dists</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">requery_knn</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">get_neighbors</span><span class="p">,</span> <span class="n">get_axs</span><span class="p">,</span> <span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">num_neighbs</span><span class="p">,</span> <span class="n">invalid_axs</span><span class="p">,</span> <span class="n">pad</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">limit</span><span class="p">,</span> <span class="n">recover</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span> <span class="o">=</span> <span class="n">res</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.scoring">
<span id="ibeis-algo-hots-scoring-module"></span><h2>ibeis.algo.hots.scoring module<a class="headerlink" href="#module-ibeis.algo.hots.scoring" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.algo.hots.scoring.get_name_shortlist_aids">
<code class="descclassname">ibeis.algo.hots.scoring.</code><code class="descname">get_name_shortlist_aids</code><span class="sig-paren">(</span><em>daid_list</em>, <em>dnid_list</em>, <em>annot_score_list</em>, <em>name_score_list</em>, <em>nid2_nidx</em>, <em>nNameShortList</em>, <em>nAnnotPerName</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/scoring.html#get_name_shortlist_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.scoring.get_name_shortlist_aids" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.scoring –test-get_name_shortlist_aids</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.scoring</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dnid_list</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">24</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">annot_score_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">6</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_score_list</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nid2_nidx</span>        <span class="o">=</span> <span class="p">{</span><span class="mi">21</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">23</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">24</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nNameShortList</span><span class="p">,</span> <span class="n">nAnnotPerName</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">dnid_list</span><span class="p">,</span> <span class="n">annot_score_list</span><span class="p">,</span> <span class="n">name_score_list</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">nid2_nidx</span><span class="p">,</span> <span class="n">nNameShortList</span><span class="p">,</span> <span class="n">nAnnotPerName</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_daids</span> <span class="o">=</span> <span class="n">get_name_shortlist_aids</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">top_daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">[15, 14, 11, 13, 16]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.scoring.make_chipmatch_shortlists">
<code class="descclassname">ibeis.algo.hots.scoring.</code><code class="descname">make_chipmatch_shortlists</code><span class="sig-paren">(</span><em>qreq_</em>, <em>cm_list</em>, <em>nNameShortList</em>, <em>nAnnotPerName</em>, <em>score_method='nsum'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/scoring.html#make_chipmatch_shortlists"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.scoring.make_chipmatch_shortlists" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes shortlists for reranking</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.scoring –test-make_chipmatch_shortlists –show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.scoring</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre_sver</span><span class="p">(</span><span class="s1">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_method</span>    <span class="o">=</span> <span class="s1">&#39;nsum&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nNameShortList</span>  <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nAnnotPerName</span>   <span class="o">=</span> <span class="mi">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># apply scores</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_chipmatch_list</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">,</span> <span class="n">score_method</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_input</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#assert cm_input.dnid_list.take(cm_input.argsort())[0] == cm_input.qnid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_shortlist</span> <span class="o">=</span> <span class="n">make_chipmatch_shortlists</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">,</span> <span class="n">nNameShortList</span><span class="p">,</span> <span class="n">nAnnotPerName</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm_input</span><span class="o">.</span><span class="n">print_rawinfostr</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_shortlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">print_rawinfostr</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># should be sorted already from the shortlist take</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_nid_list</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">dnid_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_aid_list</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">daid_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qnid</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">qnid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;top_aid_list = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">top_aid_list</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;top_nid_list = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">top_nid_list</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;qnid = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qnid</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rankx</span> <span class="o">=</span> <span class="n">top_nid_list</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">qnid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">rankx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;qnid=</span><span class="si">%r</span><span class="s1"> should be first rank, not rankx=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qnid</span><span class="p">,</span> <span class="n">rankx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">max_num_rerank</span> <span class="o">=</span> <span class="n">nNameShortList</span> <span class="o">*</span> <span class="n">nAnnotPerName</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">min_num_rerank</span> <span class="o">=</span> <span class="n">nNameShortList</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_nid_list</span><span class="p">),</span> <span class="n">min_num_rerank</span><span class="p">,</span> <span class="n">max_num_rerank</span><span class="p">,</span> <span class="s1">&#39;incorrect number in shortlist&#39;</span><span class="p">,</span> <span class="n">eq</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">show_single_annotmatch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid</span><span class="o">=</span><span class="n">top_aid_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.scoring.score_chipmatch_list">
<code class="descclassname">ibeis.algo.hots.scoring.</code><code class="descname">score_chipmatch_list</code><span class="sig-paren">(</span><em>qreq_</em>, <em>cm_list</em>, <em>score_method</em>, <em>progkw=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/scoring.html#score_chipmatch_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.scoring.score_chipmatch_list" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.algo.hots.scoring –test-score_chipmatch_list
python -m ibeis.algo.hots.scoring –test-score_chipmatch_list:1
python -m ibeis.algo.hots.scoring –test-score_chipmatch_list:0 –show</dd>
<dt>Example0:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># xdoctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># (IMPORTANT)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.scoring</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_pre_sver</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_method</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">prescore_method</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_chipmatch_list</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">,</span> <span class="n">score_method</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">cm</span><span class="o">.</span><span class="n">score_list</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">show_single_annotmatch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># (IMPORTANT)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.algo.hots.scoring</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testdata_post_sver</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span> <span class="o">=</span> <span class="n">cm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_method</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">score_method</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_chipmatch_list</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">cm_list</span><span class="p">,</span> <span class="n">score_method</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">cm</span><span class="o">.</span><span class="n">score_list</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">quit_if_noshow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cm</span><span class="o">.</span><span class="n">show_single_annotmatch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots.toy_nan_rf">
<span id="ibeis-algo-hots-toy-nan-rf-module"></span><h2>ibeis.algo.hots.toy_nan_rf module<a class="headerlink" href="#module-ibeis.algo.hots.toy_nan_rf" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.algo.hots.toy_nan_rf.get_toydata">
<code class="descclassname">ibeis.algo.hots.toy_nan_rf.</code><code class="descname">get_toydata</code><span class="sig-paren">(</span><em>rng</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/toy_nan_rf.html#get_toydata"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.toy_nan_rf.get_toydata" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.toy_nan_rf.main">
<code class="descclassname">ibeis.algo.hots.toy_nan_rf.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/toy_nan_rf.html#main"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.toy_nan_rf.main" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>SeeAlso:</dt>
<dd>python -m sklearn.ensemble.tests.test_forest test_multioutput</dd>
<dt>CommandLine:</dt>
<dd>python -m ibeis toy_classify_nans
python -m ibeis toy_classify_nans –toy1 –save “rf_nan_toy1.jpg” –figsize=10,10
python -m ibeis toy_classify_nans –toy2 –save “rf_nan_toy2.jpg” –figsize=10,10
python -m ibeis toy_classify_nans –toy2 –save “rf_nan_toy3.jpg” –figsize=10,10 –extra
python -m ibeis toy_classify_nans –toy2 –save “rf_nan_toy4.jpg” –figsize=10,10 –extra –nanrate=0
python -m ibeis toy_classify_nans –toy2 –save “rf_nan_toy5.jpg” –figsize=10,10 –nanrate=0</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">toy_classify_nans</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.toy_nan_rf.show_nan_decision_function_2d">
<code class="descclassname">ibeis.algo.hots.toy_nan_rf.</code><code class="descname">show_nan_decision_function_2d</code><span class="sig-paren">(</span><em>X</em>, <em>y</em>, <em>X_true</em>, <em>clf</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/toy_nan_rf.html#show_nan_decision_function_2d"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.toy_nan_rf.show_nan_decision_function_2d" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.toy_nan_rf.toydata1">
<code class="descclassname">ibeis.algo.hots.toy_nan_rf.</code><code class="descname">toydata1</code><span class="sig-paren">(</span><em>rng</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/toy_nan_rf.html#toydata1"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.toy_nan_rf.toydata1" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Description of Plot</strong></p>
<p>You’ll notice that there are 4 plots. This is necessary to visualize a grid
with nans. Each plot shows points in the 2-dimensional grid with corners at
(0, 0) and (40, 40). The top left plot has these coordinates labeled. The
other 3 plots correspond to the top left grid, but in these plots at least
one of the dimensions has been “nanned”. In the top right the x-dimension
is “nanned”. In the bottom left the y-dimension is “nanned”, and in the
bottom right both dimensions are “nanned”. Even though all plots are drawn
as a 2d-surface only the topleft plot is truly a surface with 2 degrees of
freedom. The top right and bottom left plots are really lines with 1 degree
of freedom, and the bottom right plot is actually just a single point with
0 degrees of freedom.</p>
<p>In this example I create 10 Gaussian blobs where the first 9 have their
means laid out in a 3x3 grid and the last one has its mean in the center,
but I gave it a high standard deviation. I’ll refer to the high std cluster
as 9, and label the other clusters at the grid means (to agree with the
demo code) like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">6</span>&#160;&#160; <span class="pre">7</span>&#160;&#160; <span class="pre">8</span>
<span class="pre">3</span>&#160;&#160; <span class="pre">4</span>&#160;&#160; <span class="pre">5</span>
<span class="pre">0</span>&#160;&#160; <span class="pre">1</span>&#160;&#160; <span class="pre">2</span>
<span class="pre">`</span></code></p>
<p>Looking at the top left plot you can see clusters 0, 1, 2, 4, 6, and 8. The
reason the other cluster do not appear in this grid is because I’ve set at
least one of their dimensions to be nan.  Specifically, cluster 3 had its y
dimension set to nan; cluster 5 and 7 had their x dimension set to nan; and
cluster 9 had both x and y dimensions set to nan.</p>
<p>For clusters 3, 5, and 7, I plot “nanned” points as lines along the nanned
dimension to show that only the non-nan dimensions can be used to
distinguish these points. I also plot the original position before I
“nanned” it for visualization purposes, but the learning algorithm never
sees this. For cluster 9, I only plot the original positions because all of
this data collapses to a single point [nan, nan].</p>
<p>Red points are of class 0, and blue points are of class 1. Points in each
plot represent the training data. The colored background of each plot
represents the classification surface.</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.toy_nan_rf.toydata2">
<code class="descclassname">ibeis.algo.hots.toy_nan_rf.</code><code class="descname">toydata2</code><span class="sig-paren">(</span><em>rng</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots/toy_nan_rf.html#toydata2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.toy_nan_rf.toydata2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-ibeis.algo.hots">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-ibeis.algo.hots" title="Permalink to this headline">¶</a></h2>
<dl class="data">
<dt id="ibeis.algo.hots.IMPORT_TUPLES">
<code class="descclassname">ibeis.algo.hots.</code><code class="descname">IMPORT_TUPLES</code><em class="property"> = [('_pipeline_helpers', None), ('chip_match', None), ('exceptions', None), ('hstypes', None), ('match_chips4', None), ('name_scoring', None), ('neighbor_index', None), ('neighbor_index_cache', None), ('nn_weights', None), ('old_chip_match', None), ('pipeline', None), ('query_params', None), ('query_request', None), ('scoring', None)]</em><a class="headerlink" href="#ibeis.algo.hots.IMPORT_TUPLES" title="Permalink to this definition">¶</a></dt>
<dd><p>cd /home/joncrall/code/ibeis/ibeis/algo/hots
makeinit.py –modname=ibeis.algo.hots</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">Regen Command</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.reassign_submodule_attributes">
<code class="descclassname">ibeis.algo.hots.</code><code class="descname">reassign_submodule_attributes</code><span class="sig-paren">(</span><em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots.html#reassign_submodule_attributes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.reassign_submodule_attributes" title="Permalink to this definition">¶</a></dt>
<dd><p>why reloading all the modules doesnt do this I don’t know</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.reload_subs">
<code class="descclassname">ibeis.algo.hots.</code><code class="descname">reload_subs</code><span class="sig-paren">(</span><em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ibeis/algo/hots.html#reload_subs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.algo.hots.reload_subs" title="Permalink to this definition">¶</a></dt>
<dd><p>Reloads ibeis.algo.hots and submodules</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.algo.hots.rrrr">
<code class="descclassname">ibeis.algo.hots.</code><code class="descname">rrrr</code><span class="sig-paren">(</span><em>verbose=True</em><span class="sig-paren">)</span><a class="headerlink" href="#ibeis.algo.hots.rrrr" title="Permalink to this definition">¶</a></dt>
<dd><p>Reloads ibeis.algo.hots and submodules</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ibeis.algo.preproc.html" class="btn btn-neutral float-right" title="ibeis.algo.preproc package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ibeis.algo.graph.tests.html" class="btn btn-neutral" title="ibeis.algo.graph.tests package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Wild Me

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>