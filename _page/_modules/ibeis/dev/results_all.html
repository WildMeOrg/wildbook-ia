<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ibeis.dev.results_all &mdash; ibeis 0.1.0.dev1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1.0.dev1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="ibeis 0.1.0.dev1 documentation" href="../../../index.html" />
    <link rel="up" title="ibeis.dev" href="../dev.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">ibeis 0.1.0.dev1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../ibeis.html" >ibeis</a> &raquo;</li>
          <li><a href="../dev.html" accesskey="U">ibeis.dev</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for ibeis.dev.results_all</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">not really used</span>
<span class="sd">most things in here can be depricated</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">utool</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">ibeis.dev</span> <span class="kn">import</span> <span class="n">results_organizer</span>
<span class="kn">from</span> <span class="nn">ibeis.dev</span> <span class="kn">import</span> <span class="n">results_analyzer</span>
<span class="k">print</span><span class="p">,</span> <span class="n">print_</span><span class="p">,</span> <span class="n">printDBG</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;[results_all]&#39;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<div class="viewcode-block" id="AllResults"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.AllResults">[docs]</a><span class="k">class</span> <span class="nc">AllResults</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">DynStruct</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Data container for all compiled results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">allres</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AllResults</span><span class="p">,</span> <span class="n">allres</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">child_exclude_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;qaid2_qres&#39;</span><span class="p">])</span>
        <span class="n">allres</span><span class="o">.</span><span class="n">ibs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">allres</span><span class="o">.</span><span class="n">qaid2_qres</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">allres</span><span class="o">.</span><span class="n">allorg</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">allres</span><span class="o">.</span><span class="n">cfgstr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">allres</span><span class="o">.</span><span class="n">dbname</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="AllResults.get_orgtype"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.AllResults.get_orgtype">[docs]</a>    <span class="k">def</span> <span class="nf">get_orgtype</span><span class="p">(</span><span class="n">allres</span><span class="p">,</span> <span class="n">orgtype</span><span class="p">):</span>
        <span class="n">orgres</span> <span class="o">=</span> <span class="n">allres</span><span class="o">.</span><span class="n">allorg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orgtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">orgres</span>
</div>
<div class="viewcode-block" id="AllResults.get_cfgstr"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.AllResults.get_cfgstr">[docs]</a>    <span class="k">def</span> <span class="nf">get_cfgstr</span><span class="p">(</span><span class="n">allres</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">allres</span><span class="o">.</span><span class="n">cfgstr</span>
</div>
<div class="viewcode-block" id="AllResults.make_title"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.AllResults.make_title">[docs]</a>    <span class="k">def</span> <span class="nf">make_title</span><span class="p">(</span><span class="n">allres</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">allres</span><span class="o">.</span><span class="n">dbname</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">packstr</span><span class="p">(</span><span class="n">allres</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">(),</span> <span class="n">textwidth</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">break_words</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">breakchars</span><span class="o">=</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="n">wordsep</span><span class="o">=</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AllResults.get_qres"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.AllResults.get_qres">[docs]</a>    <span class="k">def</span> <span class="nf">get_qres</span><span class="p">(</span><span class="n">allres</span><span class="p">,</span> <span class="n">qaid</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">allres</span><span class="o">.</span><span class="n">qaid2_qres</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="AllResults.get_orgres_desc_match_dists"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.AllResults.get_orgres_desc_match_dists">[docs]</a>    <span class="k">def</span> <span class="nf">get_orgres_desc_match_dists</span><span class="p">(</span><span class="n">allres</span><span class="p">,</span> <span class="n">orgtype_list</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">results_analyzer</span><span class="o">.</span><span class="n">get_orgres_desc_match_dists</span><span class="p">(</span><span class="n">allres</span><span class="p">,</span> <span class="n">orgtype_list</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AllResults.get_orgres_annotationmatch_scores"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.AllResults.get_orgres_annotationmatch_scores">[docs]</a>    <span class="k">def</span> <span class="nf">get_orgres_annotationmatch_scores</span><span class="p">(</span><span class="n">allres</span><span class="p">,</span> <span class="n">orgtype_list</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">results_analyzer</span><span class="o">.</span><span class="n">get_orgres_annotationmatch_scores</span><span class="p">(</span><span class="n">allres</span><span class="p">,</span> <span class="n">orgtype_list</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="init_allres"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.init_allres">[docs]</a><span class="k">def</span> <span class="nf">init_allres</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">qreq_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">allres_cfgstr</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">allres_cfgstr</span> <span class="o">=</span> <span class="s">&#39;???&#39;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Building allres&#39;</span><span class="p">)</span>
    <span class="n">allres</span> <span class="o">=</span> <span class="n">AllResults</span><span class="p">()</span>
    <span class="n">allres</span><span class="o">.</span><span class="n">qaid2_qres</span> <span class="o">=</span> <span class="n">qaid2_qres</span>
    <span class="n">allres</span><span class="o">.</span><span class="n">allorg</span> <span class="o">=</span> <span class="n">results_organizer</span><span class="o">.</span><span class="n">organize_results</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid2_qres</span><span class="p">)</span>
    <span class="n">allres</span><span class="o">.</span><span class="n">cfgstr</span> <span class="o">=</span> <span class="n">allres_cfgstr</span>
    <span class="n">allres</span><span class="o">.</span><span class="n">dbname</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_dbname</span><span class="p">()</span>
    <span class="n">allres</span><span class="o">.</span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibs</span>
    <span class="k">return</span> <span class="n">allres</span>

</div>
<div class="viewcode-block" id="learn_score_normalization"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.learn_score_normalization">[docs]</a><span class="k">def</span> <span class="nf">learn_score_normalization</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qres_list</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        qaid2_qres (int): query annotation id</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.dev.results_all import *   # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import plottool as pt  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.dev import results_all</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; #ibs = ibeis.opendb(&#39;PZ_MTEST&#39;)</span>
<span class="sd">        &gt;&gt;&gt; dbname = &#39;GZ_ALL&#39;</span>
<span class="sd">        &gt;&gt;&gt; #dbname = &#39;PZ_Master0&#39;</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(dbname)</span>
<span class="sd">        &gt;&gt;&gt; qaid_list = daid_list = ibs.get_valid_aids()</span>
<span class="sd">        &gt;&gt;&gt; hard_aids = ibs.get_hard_annot_rowids()</span>
<span class="sd">        &gt;&gt;&gt; easy_aids = ibs.get_easy_annot_rowids()</span>
<span class="sd">        &gt;&gt;&gt; qaid_list = hard_aids + easy_aids[::1]</span>
<span class="sd">        &gt;&gt;&gt; cfgdict = dict(codename=&#39;nsum&#39;)</span>
<span class="sd">        &gt;&gt;&gt; qaid2_qres, qreq_ = results_all.get_qres_and_qreq_(ibs, qaid_list, daid_list, cfgdict)</span>
<span class="sd">        &gt;&gt;&gt; qres_list = [qaid2_qres[aid] for aid in qaid_list]</span>
<span class="sd">        &gt;&gt;&gt; results_all.learn_score_normalization(ibs, qres_list, qaid_list)</span>
<span class="sd">        &gt;&gt;&gt; pt.present()</span>

<span class="sd">    References:</span>
<span class="sd">        http://en.wikipedia.org/wiki/Statistical_hypothesis_testing</span>
<span class="sd">        http://en.wikipedia.org/wiki/Type_I_and_type_II_errors</span>
<span class="sd">        http://en.wikipedia.org/wiki/P-value</span>
<span class="sd">        ftp://ftp.stat.duke.edu/pub/WorkingPapers/10-13.pdf</span>

<span class="sd">    Dev::</span>
<span class="sd">        valid_aids = ibs.get_valid_aids()</span>
<span class="sd">        hard_aids = ibs.get_hard_annot_rowids()</span>
<span class="sd">        qaid2_qres = ibs._query_chips4(hard_aids, daid_list, cfgdict=cfgdict)</span>
<span class="sd">        qres = qres_list[0]</span>
<span class="sd">        #sorted_nids, sorted_scores = qres.get_sorted_nids_and_scores(ibs)</span>
<span class="sd">        #data = sorted_scores</span>
<span class="sd">        #qaid_list = [aid for aid in six.iterkeys(qaid2_qres)]</span>
<span class="sd">        #qres_list = [qaid2_qres[qaid] for qaid in qaid_list]</span>
<span class="sd">        #for qres in qres_list:</span>
<span class="sd">        #    qres.rrr(verbose=False)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>  <span class="c"># NOQA</span>
    <span class="n">good_tp_nscores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">good_tn_nscores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">good_tp_ndiff</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">good_tn_ndiff</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">good_tp_nmatches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">good_tn_nmatches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">good_tp_aidnid_pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">good_tn_aidnid_pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">qx</span><span class="p">,</span> <span class="n">qres</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qres_list</span><span class="p">):</span>
        <span class="n">qaid</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_qaid</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">qres</span><span class="o">.</span><span class="n">is_nsum</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;must be nsum&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_has_groundtruth</span><span class="p">(</span><span class="n">qaid</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">qnid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_name_rowids</span><span class="p">(</span><span class="n">qres</span><span class="o">.</span><span class="n">get_qaid</span><span class="p">())</span>
        <span class="c">#sorted_nids, sorted_nscores = qres.get_sorted_nids_and_scores(ibs)</span>

        <span class="k">def</span> <span class="nf">get_num_nmatches</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">sorted_aids</span><span class="p">):</span>
            <span class="c"># returns number of matches to a name</span>
            <span class="n">sorted_nmatches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">aids</span> <span class="ow">in</span> <span class="n">sorted_aids</span><span class="p">:</span>
                <span class="n">fs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">qres</span><span class="o">.</span><span class="n">aid2_fs</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span> <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aids</span><span class="p">]</span>
                <span class="n">num_nmatches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([(</span><span class="n">fs</span> <span class="o">&gt;</span> <span class="mf">1E-6</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">fs_list</span><span class="p">])</span>
                <span class="n">sorted_nmatches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num_nmatches</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sorted_nmatches</span>

        <span class="n">nscoretup</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_nscoretup</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
        <span class="p">(</span><span class="n">sorted_nids</span><span class="p">,</span> <span class="n">sorted_nscores</span><span class="p">,</span> <span class="n">sorted_aids</span><span class="p">,</span> <span class="n">sorted_scores</span><span class="p">)</span>  <span class="o">=</span> <span class="n">nscoretup</span>
        <span class="n">sorted_nmatches</span> <span class="o">=</span> <span class="n">get_num_nmatches</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">sorted_aids</span><span class="p">)</span>

        <span class="n">sorted_ndiff</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sorted_nscores</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">sorted_nids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sorted_nids</span><span class="p">)</span>
        <span class="n">is_positive</span>  <span class="o">=</span> <span class="n">sorted_nids</span> <span class="o">==</span> <span class="n">qnid</span>
        <span class="n">is_negative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="o">~</span><span class="n">is_positive</span><span class="p">,</span> <span class="n">sorted_nids</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">is_positive</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">is_negative</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">gt_rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_positive</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">gf_rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">is_negative</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">gt_rank</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_nscores</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">gf_rank</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_ndiff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">gf_rank</span><span class="p">:</span>
                <span class="n">good_tp_nscores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sorted_nscores</span><span class="p">[</span><span class="n">gt_rank</span><span class="p">])</span>
                <span class="n">good_tn_nscores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sorted_nscores</span><span class="p">[</span><span class="n">gf_rank</span><span class="p">])</span>
                <span class="n">good_tp_ndiff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sorted_ndiff</span><span class="p">[</span><span class="n">gt_rank</span><span class="p">])</span>
                <span class="n">good_tn_ndiff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sorted_ndiff</span><span class="p">[</span><span class="n">gf_rank</span><span class="p">])</span>
                <span class="n">good_tp_nmatches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sorted_nmatches</span><span class="p">[</span><span class="n">gt_rank</span><span class="p">])</span>
                <span class="n">good_tn_nmatches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sorted_nmatches</span><span class="p">[</span><span class="n">gf_rank</span><span class="p">])</span>
                <span class="n">good_tp_aidnid_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">qaid</span><span class="p">,</span> <span class="n">sorted_nids</span><span class="p">[</span><span class="n">gt_rank</span><span class="p">]))</span>
                <span class="n">good_tn_aidnid_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">qaid</span><span class="p">,</span> <span class="n">sorted_nids</span><span class="p">[</span><span class="n">gf_rank</span><span class="p">]))</span>

    <span class="n">good_tp_nscores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">good_tp_nscores</span><span class="p">)</span>
    <span class="n">good_tn_nscores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">good_tn_nscores</span><span class="p">)</span>
    <span class="n">good_tp_ndiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">good_tp_ndiff</span><span class="p">)</span>
    <span class="n">good_tn_ndiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">good_tn_ndiff</span><span class="p">)</span>

    <span class="n">clip_score</span> <span class="o">=</span> <span class="mi">2000</span>
    <span class="c">#overshoot_factor = good_tp_nscores.max() / good_tn_nscores.max()</span>
    <span class="c">#if overshoot_factor &gt; 5:</span>
    <span class="c">#    clip_score = good_tp_nscores.mean() + good_tp_nscores.std() * 2</span>

    <span class="c">#pt.close_all_figures()</span>
    <span class="c">#import imp</span>
    <span class="c">#imp.reload(pt.plots)</span>
    <span class="c">#imp.reload(pt)</span>

    <span class="n">good_tp</span> <span class="o">=</span> <span class="n">good_tp_nscores</span>  <span class="c"># NOQA</span>
    <span class="n">good_tn</span> <span class="o">=</span> <span class="n">good_tn_nscores</span>  <span class="c"># NOQA</span>
    <span class="n">lbl</span> <span class="o">=</span> <span class="s">&#39;score&#39;</span>  <span class="c"># NOQA</span>
    <span class="n">inspect_pdfs</span><span class="p">(</span><span class="n">good_tp_nscores</span><span class="p">,</span> <span class="n">good_tn_nscores</span><span class="p">,</span> <span class="s">&#39;score&#39;</span><span class="p">,</span> <span class="n">clip_score</span><span class="p">)</span>
    <span class="c">#inspect_pdfs(good_tp_ndiff, good_tn_ndiff, &#39;diff&#39;, clip_score)</span>

    <span class="c">#posfeat_tup = (good_tp_nscores, good_tp_ndiff)</span>
    <span class="c">#negfeat_tup = (good_tn_nscores, good_tn_ndiff)</span>
    <span class="c">#lbltup = (&#39;nscores&#39;, &#39;ndiff&#39;)</span>

    <span class="c">#posfeat_tup = (good_tp_nscores, good_tp_ndiff, good_tp_nmatches)</span>
    <span class="c">#negfeat_tup = (good_tn_nscores, good_tn_ndiff, good_tn_nmatches)</span>

    <span class="c">#posfeat_tup = (good_tp_nscores, good_tp_nmatches)</span>
    <span class="c">#negfeat_tup = (good_tn_nscores, good_tn_nmatches)</span>
    <span class="c">#lbltup = (&#39;nscores&#39;, &#39;nmatches&#39;)</span>

    <span class="c">#posfeat_tup = (good_tp_ndiff, good_tp_nmatches)</span>
    <span class="c">#negfeat_tup = (good_tn_ndiff, good_tn_nmatches)</span>
    <span class="c">#lbltup = (&#39;ndiff&#39;, &#39;nmatches&#39;)</span>

    <span class="c">#inspect_svm_classifier(ibs, posfeat_tup, negfeat_tup, good_tp_aidnid_pairs,</span>
    <span class="c">#                       good_tn_aidnid_pairs, clip_score, lbltup)</span>
    <span class="c">#pt.present()</span>

</div>
<div class="viewcode-block" id="inspect_pdfs"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.inspect_pdfs">[docs]</a><span class="k">def</span> <span class="nf">inspect_pdfs</span><span class="p">(</span><span class="n">good_tp</span><span class="p">,</span> <span class="n">good_tn</span><span class="p">,</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">clip_score</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>  <span class="c"># NOQA</span>

    <span class="c">#good_all = np.hstack((good_tp, good_tn))</span>
    <span class="n">score_tp_pdf</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">estimate_pdf</span><span class="p">(</span><span class="n">good_tp</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">score_tn_pdf</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">estimate_pdf</span><span class="p">(</span><span class="n">good_tn</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="c">#score_pdf = ut.estimate_pdf(good_all, gridsize=512)</span>
    <span class="n">score_domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">clip_score</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>

    <span class="n">p_score_given_tp</span> <span class="o">=</span> <span class="n">score_tp_pdf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">score_domain</span><span class="p">)</span>
    <span class="n">p_score_given_tn</span> <span class="o">=</span> <span class="n">score_tn_pdf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">score_domain</span><span class="p">)</span>
    <span class="c">#p_score = score_pdf.evaluate(score_domain)</span>

    <span class="n">p_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_score_given_tp</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_score_given_tn</span><span class="p">)</span>

    <span class="c"># Apply bayes</span>
    <span class="n">p_tp</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span>
    <span class="n">p_tn</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">p_tp</span>
    <span class="n">p_tp_given_score</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">bayes_rule</span><span class="p">(</span><span class="n">p_score_given_tp</span><span class="p">,</span> <span class="n">p_score</span><span class="p">,</span> <span class="n">p_tp</span><span class="p">)</span>
    <span class="n">p_tn_given_score</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">bayes_rule</span><span class="p">(</span><span class="n">p_score_given_tn</span><span class="p">,</span> <span class="n">p_score</span><span class="p">,</span> <span class="n">p_tn</span><span class="p">)</span>

    <span class="n">pt</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_sorted_scores</span><span class="p">(</span>
        <span class="p">(</span><span class="n">good_tn</span><span class="p">,</span> <span class="n">good_tp</span><span class="p">),</span>
        <span class="p">(</span><span class="n">lbl</span> <span class="o">+</span> <span class="s">&#39; | tn&#39;</span><span class="p">,</span> <span class="n">lbl</span> <span class="o">+</span> <span class="s">&#39; | tp&#39;</span><span class="p">),</span>
        <span class="n">figtitle</span><span class="o">=</span><span class="s">&#39;sorted nscores&#39;</span><span class="p">)</span>

    <span class="n">pt</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_densities</span><span class="p">(</span>
        <span class="p">(</span><span class="n">p_score_given_tn</span><span class="p">,</span>  <span class="n">p_score_given_tp</span><span class="p">,</span> <span class="n">p_score</span><span class="p">),</span>
        <span class="p">(</span><span class="n">lbl</span> <span class="o">+</span> <span class="s">&#39; given tn&#39;</span><span class="p">,</span> <span class="n">lbl</span> <span class="o">+</span> <span class="s">&#39; given tp&#39;</span><span class="p">,</span> <span class="n">lbl</span><span class="p">),</span>
        <span class="n">figtitle</span><span class="o">=</span><span class="s">&#39;pre_bayes pdf &#39;</span> <span class="o">+</span> <span class="n">lbl</span><span class="p">,</span>
        <span class="n">xdata</span><span class="o">=</span><span class="n">score_domain</span><span class="p">)</span>

    <span class="n">pt</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_densities</span><span class="p">(</span>
        <span class="p">(</span><span class="n">p_tn_given_score</span><span class="p">,</span> <span class="n">p_tp_given_score</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;tn given &#39;</span> <span class="o">+</span> <span class="n">lbl</span><span class="p">,</span> <span class="s">&#39;tp given &#39;</span> <span class="o">+</span> <span class="n">lbl</span><span class="p">),</span>
        <span class="n">figtitle</span><span class="o">=</span><span class="s">&#39;post_bayes pdf &#39;</span> <span class="o">+</span> <span class="n">lbl</span><span class="p">,</span>
        <span class="n">xdata</span><span class="o">=</span><span class="n">score_domain</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="inspect_svm_classifier"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.inspect_svm_classifier">[docs]</a><span class="k">def</span> <span class="nf">inspect_svm_classifier</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">posfeat_tup</span><span class="p">,</span> <span class="n">negfeat_tup</span><span class="p">,</span> <span class="n">good_tp_aidnid_pairs</span><span class="p">,</span>
                           <span class="n">good_tn_aidnid_pairs</span><span class="p">,</span> <span class="n">clip_score</span><span class="p">,</span> <span class="n">lbltup</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c">#import sklearn</span>
    <span class="c">#assert sklearn.__version__ &gt;= &#39;0.15.2&#39;</span>
    <span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">svm</span>
    <span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>  <span class="c"># NOQA</span>
    <span class="c"># Build SVM Features and targets</span>

    <span class="k">if</span> <span class="n">lbltup</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">lbltup</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_varname_from_stack</span><span class="p">,</span> <span class="n">posfeat_tup</span><span class="p">))</span>

    <span class="n">positive_features</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">posfeat_tup</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">negative_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">negfeat_tup</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="n">nTrue</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">negative_features</span><span class="p">)</span>
    <span class="n">nFalse</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">negative_features</span><span class="p">)</span>
    <span class="c"># Pack svm features and targets</span>
    <span class="n">all_aidnid_pairs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">good_tp_aidnid_pairs</span><span class="p">,</span> <span class="n">good_tn_aidnid_pairs</span><span class="p">))</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">svm_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">positive_features</span><span class="p">,</span> <span class="n">negative_features</span><span class="p">))</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">svm_targets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nTrue</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nFalse</span><span class="p">)))</span>
    <span class="c"># Create support vector classifier</span>
    <span class="n">svc</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">LinearSVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dual</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#svc = svm.NuSVC(kernel=&#39;linear&#39;, probability=True)</span>
    <span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s">&#39;training SVM&#39;</span><span class="p">):</span>
        <span class="n">svc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">svm_features</span><span class="p">,</span> <span class="n">svm_targets</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="s">&#39;probability&#39;</span><span class="p">):</span>
        <span class="n">svc</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">svm_features</span><span class="p">)</span>

    <span class="c"># Evaluate performance on training set</span>
    <span class="n">is_falsepositive</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">negative_features</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span>  <span class="c"># type1 -- false positive</span>
    <span class="n">is_falsenegative</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">positive_features</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span>  <span class="c"># type2 -- false negative</span>
    <span class="n">nType1</span> <span class="o">=</span> <span class="n">is_falsepositive</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">nType2</span> <span class="o">=</span> <span class="n">is_falsenegative</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">nError</span> <span class="o">=</span> <span class="n">nType1</span> <span class="o">+</span> <span class="n">nType2</span>
    <span class="n">nTotal</span> <span class="o">=</span> <span class="n">nTrue</span> <span class="o">+</span> <span class="n">nFalse</span>
    <span class="n">nCorrect</span> <span class="o">=</span> <span class="n">nTotal</span> <span class="o">-</span> <span class="n">nError</span>
    <span class="n">percentCorrect</span> <span class="o">=</span>  <span class="mi">100</span> <span class="o">*</span> <span class="n">nCorrect</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nTotal</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;SVM made </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> correct decisions. </span><span class="si">%.2f%%</span><span class="s"> correct&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nCorrect</span><span class="p">,</span> <span class="n">nTotal</span><span class="p">,</span> <span class="n">percentCorrect</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;SVM made </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> type1 errors. (false positive)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nType1</span><span class="p">,</span> <span class="n">nFalse</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;SVM made </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> type1 errors. (false negative)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nType2</span><span class="p">,</span> <span class="n">nTrue</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">plot_2d_svc</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">clip_score</span><span class="p">):</span>
        <span class="c"># make grid for feature 1 and 2</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">f1_min</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">f2_min</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">f1_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">clip_score</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">f2_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">clip_score</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">f1xs</span><span class="p">,</span> <span class="n">f2xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">f1_min</span><span class="p">,</span> <span class="n">f1_max</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">f2_min</span><span class="p">,</span> <span class="n">f2_max</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
        <span class="n">zinput</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">f1xs</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">f2xs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">zinput</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">f1xs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="c"># Plot decision boundary</span>
        <span class="n">fnum</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">next_fnum</span><span class="p">()</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">get_binary_svm_cmap</span><span class="p">()</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">f1xs</span><span class="p">,</span> <span class="n">f2xs</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="c"># plot training points</span>
        <span class="n">valid_X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">clip_score</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">valid_X</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">valid_X</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">Y</span><span class="p">[</span><span class="n">valid_X</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">plot_nd_svc</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">clip_score</span><span class="p">):</span>

        <span class="n">h</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">feat_mins</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[:,</span> <span class="n">dimx</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">dimx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">))]</span>
        <span class="n">feat_maxs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="n">dimx</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">clip_score</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">dimx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">))]</span>
        <span class="n">feat_basis</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">fmax</span> <span class="o">-</span> <span class="n">fmin</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span>
                      <span class="k">for</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">feat_mins</span><span class="p">,</span> <span class="n">feat_maxs</span><span class="p">)]</span>

        <span class="n">feat_grids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">feat_basis</span><span class="p">)</span>
        <span class="n">cinput</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">fgrid</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">for</span> <span class="n">fgrid</span> <span class="ow">in</span> <span class="n">feat_grids</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">cinput</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">feat_grids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c"># make grid for feature 1 and 2</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">fnum</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">next_fnum</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">)</span>

            <span class="c"># Plot decision boundary</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">get_binary_svm_cmap</span><span class="p">()</span>
            <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">feat_grids</span> <span class="o">+</span> <span class="p">[</span><span class="n">C</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="c"># plot training points</span>
            <span class="n">valid_X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">clip_score</span>
            <span class="n">featiter</span> <span class="o">=</span> <span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">valid_X</span><span class="p">]</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">featiter</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">Y</span><span class="p">[</span><span class="n">valid_X</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbltup</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">lbltup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbltup</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">lbltup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbltup</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="n">lbltup</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">on_press</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="s">&#39;on button press we will see if the mouse is over us and store some data&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>  <span class="c"># NOQA</span>
                <span class="n">fx</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">nearest_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">qaid</span><span class="p">,</span> <span class="n">nid</span> <span class="o">=</span> <span class="n">all_aidnid_pairs</span><span class="p">[</span><span class="n">fx</span><span class="p">]</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;qaid = </span><span class="si">%r</span><span class="s">, nid = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qaid</span><span class="p">,</span> <span class="n">nid</span><span class="p">))</span>
                <span class="n">dbname</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_dbname</span><span class="p">()</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;python dev.py --cfg codename:nsum -t query --qaid </span><span class="si">%d</span><span class="s"> --db </span><span class="si">%s</span><span class="s"> -w&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qaid</span><span class="p">,</span> <span class="n">dbname</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;python dev.py --cfg codename:nsum --query-aid </span><span class="si">%d</span><span class="s"> --db </span><span class="si">%s</span><span class="s"> --gui&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qaid</span><span class="p">,</span> <span class="n">dbname</span><span class="p">))</span>
                <span class="c">#qaid = %r, nid = %r&#39; % (qaid, nid))</span>
                <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">DEBUG2</span><span class="p">:</span>
                    <span class="n">ut</span><span class="o">.</span><span class="n">embed</span><span class="p">()</span>
            <span class="n">pt</span><span class="o">.</span><span class="n">interact_helpers</span><span class="o">.</span><span class="n">connect_callback</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="n">on_press</span><span class="p">)</span>
            <span class="n">pt</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="c"># Pytinstaller should not user vtk</span>
        <span class="c">#else:</span>
        <span class="c">#    import vtk</span>
        <span class="c">#    data_matrix = (C + 2).astype(np.uint8)</span>
        <span class="c">#    #data_matrix = np.zeros([75, 75, 75], dtype=np.uint8)</span>
        <span class="c">#    #data_matrix[0:35, 0:35, 0:35] = 50</span>
        <span class="c">#    #data_matrix[25:55, 25:55, 25:55] = 100</span>
        <span class="c">#    #data_matrix[45:74, 45:74, 45:74] = 150</span>
        <span class="c">#    dataImporter = vtk.vtkImageImport()</span>
        <span class="c">#    data_string = data_matrix.tostring()</span>
        <span class="c">#    dataImporter.CopyImportVoidPointer(data_string, len(data_string))</span>
        <span class="c">#    dataImporter.SetDataScalarTypeToUnsignedChar()</span>
        <span class="c">#    dataImporter.SetNumberOfScalarComponents(1)</span>
        <span class="c">#    #data_extent = ut.flatten(zip(feat_mins, feat_maxs))</span>
        <span class="c">#    #de = data_extent</span>
        <span class="c">#    #dataImporter.SetDataExtent(de[0], de[1], de[2], de[3], de[4], de[5])</span>
        <span class="c">#    #dataImporter.SetWholeExtent(de[0], de[1], de[2], de[3], de[4], de[5])</span>
        <span class="c">#    dataImporter.SetDataExtent(0, 74, 0, 74, 0, 74)</span>
        <span class="c">#    dataImporter.SetWholeExtent(0, 74, 0, 74, 0, 74)</span>
        <span class="c">#    alphaChannelFunc = vtk.vtkPiecewiseFunction()</span>
        <span class="c">#    alphaChannelFunc.AddPoint(1, 0.05)</span>
        <span class="c">#    alphaChannelFunc.AddPoint(3, 0.1)</span>
        <span class="c">#    colorFunc = vtk.vtkColorTransferFunction()</span>
        <span class="c">#    colorFunc.AddRGBPoint(1, 1.0, 0.0, 0.0)</span>
        <span class="c">#    colorFunc.AddRGBPoint(3, 0.0, 0.0, 1.0)</span>
        <span class="c">#    volumeProperty = vtk.vtkVolumeProperty()</span>
        <span class="c">#    volumeProperty.SetColor(colorFunc)</span>
        <span class="c">#    volumeProperty.SetScalarOpacity(alphaChannelFunc)</span>
        <span class="c">#    volumeProperty.ShadeOn()</span>
        <span class="c">#    compositeFunction = vtk.vtkVolumeRayCastCompositeFunction()</span>
        <span class="c">#    volumeMapper = vtk.vtkVolumeRayCastMapper()</span>
        <span class="c">#    volumeMapper.SetVolumeRayCastFunction(compositeFunction)</span>
        <span class="c">#    volumeMapper.SetInputConnection(dataImporter.GetOutputPort())</span>

        <span class="c">#    volume = vtk.vtkVolume()</span>
        <span class="c">#    volume.SetMapper(volumeMapper)</span>
        <span class="c">#    volume.SetProperty(volumeProperty)</span>
        <span class="c">#    renderer = vtk.vtkRenderer()</span>
        <span class="c">#    renderWin = vtk.vtkRenderWindow()</span>
        <span class="c">#    renderWin.AddRenderer(renderer)</span>
        <span class="c">#    renderInteractor = vtk.vtkRenderWindowInteractor()</span>
        <span class="c">#    renderInteractor.SetRenderWindow(renderWin)</span>
        <span class="c">#    renderer.AddVolume(volume)</span>
        <span class="c">#    renderer.SetBackground(0, 0, 0)</span>
        <span class="c">#    renderWin.SetSize(400, 400)</span>
        <span class="c">#    def exitCheck(obj, event):</span>
        <span class="c">#        if obj.GetEventPending() != 0:</span>
        <span class="c">#            obj.SetAbortRender(1)</span>
        <span class="c">#    print(&#39;about to start vtk&#39;)</span>
        <span class="c">#    renderWin.AddObserver(&quot;AbortCheckEvent&quot;, exitCheck)</span>
        <span class="c">#    renderInteractor.Initialize()</span>
        <span class="c">#    renderWin.Render()</span>
        <span class="c">#    renderInteractor.Start()</span>

    <span class="n">plot_nd_svc</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">clip_score</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_stem_data"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.get_stem_data">[docs]</a><span class="k">def</span> <span class="nf">get_stem_data</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid2_qres</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns data for pt.plot_stems</span>

<span class="sd">    data is sorted by result ranks. nsum is taken into acount if it exists</span>

<span class="sd">    get_stem_data</span>

<span class="sd">    Args:</span>
<span class="sd">        qaid2_qres (int): query annotation id</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.dev.results_all import *   # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(&#39;testdb1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; qaid_list = qaid_list = ibs.get_valid_aids()</span>
<span class="sd">        &gt;&gt;&gt; qaid2_qres, qreq_ = results_all.get_qres_and_qreq_(ibs, qaid_list, daid_list)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#ut.embed()</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="c">#unflat_xdata = []</span>
    <span class="n">unflat_ydata</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">qx</span><span class="p">,</span> <span class="p">(</span><span class="n">qaid</span><span class="p">,</span> <span class="n">qres</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">qaid2_qres</span><span class="p">)):</span>
        <span class="c">#qres.rrr(verbose=False)</span>
        <span class="n">is_nsum</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">is_nsum</span><span class="p">()</span>
        <span class="n">worst_possible_rank</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_worse_possible_rank</span><span class="p">()</span>
        <span class="n">gt_ranks</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">qres</span><span class="o">.</span><span class="n">get_gt_ranks</span><span class="p">(</span><span class="n">ibs</span><span class="o">=</span><span class="n">ibs</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">worst_possible_rank</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gt_ranks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">is_nsum</span><span class="p">:</span>
            <span class="c">#gt_scores = np.array(qres.get_gt_scores(ibs=ibs))</span>
            <span class="n">argx</span> <span class="o">=</span> <span class="n">gt_ranks</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
            <span class="n">best_rank</span> <span class="o">=</span> <span class="n">gt_ranks</span><span class="p">[</span><span class="n">argx</span><span class="p">:</span><span class="n">argx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">qres_ydata</span> <span class="o">=</span> <span class="n">best_rank</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qres_ydata</span> <span class="o">=</span> <span class="n">gt_ranks</span>
        <span class="c">#qres_xdata  [qx] * len(qres_ydata)</span>
        <span class="c">#unflat_xdata.append(qres_xdata)</span>
        <span class="n">unflat_ydata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qres_ydata</span><span class="p">)</span>

    <span class="n">unflat_max_y</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">sorted</span><span class="p">,</span> <span class="n">unflat_ydata</span><span class="p">)</span>
    <span class="n">unflat_ydata2</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">sortedby2</span><span class="p">(</span><span class="n">unflat_ydata</span><span class="p">,</span> <span class="n">unflat_max_y</span><span class="p">)</span>
    <span class="n">unflat_xdata2</span> <span class="o">=</span> <span class="p">[[</span><span class="n">qx</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="k">for</span> <span class="n">qx</span><span class="p">,</span> <span class="n">ydata</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unflat_ydata2</span><span class="p">)]</span>
    <span class="n">y_data</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">unflat_ydata2</span><span class="p">)</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">unflat_xdata2</span><span class="p">)</span>
    <span class="c">#unflat_ydata2 = ut.sortedby2(unflat_ydata, unflat_max_y)</span>
    <span class="c">#x_data = ut.flatten(unflat_xdata)</span>
    <span class="c">#x_data = ut.sortedby2(x_data, y_data)</span>
    <span class="c">#y_data = ut.sortedby2(y_data, y_data)</span>
    <span class="k">return</span> <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span>


<span class="c"># ALL RESULTS CACHE</span>

</div>
<span class="n">__ALLRES_CACHE__</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">__QRESREQ_CACHE__</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="build_cache_key"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.build_cache_key">[docs]</a><span class="k">def</span> <span class="nf">build_cache_key</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">cfgdict</span><span class="p">):</span>
    <span class="c"># a little overconstrained</span>
    <span class="n">cfgstr</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">()</span>
    <span class="n">query_hashid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_hashid_semantic_uuid</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">)</span>
    <span class="n">data_hashid</span>  <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_hashid_semantic_uuid</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;D&#39;</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">query_hashid</span><span class="p">,</span> <span class="n">data_hashid</span><span class="p">,</span> <span class="n">cfgstr</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cfgdict</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">key</span>

</div>
<div class="viewcode-block" id="get_qres_and_qreq_"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.get_qres_and_qreq_">[docs]</a><span class="k">def</span> <span class="nf">get_qres_and_qreq_</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">daid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>

    <span class="n">qres_cache_key</span> <span class="o">=</span> <span class="n">build_cache_key</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">cfgdict</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="p">(</span><span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span> <span class="o">=</span> <span class="n">__QRESREQ_CACHE__</span><span class="p">[</span><span class="n">qres_cache_key</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_query_chips4</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span>
                                              <span class="n">return_request</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                              <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
        <span class="c"># Cache save</span>
        <span class="n">__QRESREQ_CACHE__</span><span class="p">[</span><span class="n">qres_cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_allres"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.get_allres">[docs]</a><span class="k">def</span> <span class="nf">get_allres</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get_allres</span>

<span class="sd">    Args:</span>
<span class="sd">        ibs (IBEISController):</span>
<span class="sd">        qaid_list (int): query annotation id</span>
<span class="sd">        daid_list (list):</span>

<span class="sd">    Returns:</span>
<span class="sd">        AllResults: allres</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from dev import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(&#39;testdb1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; qaid_list = ibs.get_valid_aids()</span>
<span class="sd">        &gt;&gt;&gt; daid_list = None</span>
<span class="sd">        &gt;&gt;&gt; allres = get_allres(ibs, qaid_list, daid_list)</span>
<span class="sd">        &gt;&gt;&gt; print(allres)</span>
<span class="sd">        &gt;&gt;&gt; allres.allorg[&#39;top_true&#39;].printme3()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[dev] get_allres&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">daid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
    <span class="n">allres_key</span> <span class="o">=</span> <span class="n">build_cache_key</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">cfgdict</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">allres</span> <span class="o">=</span> <span class="n">__ALLRES_CACHE__</span><span class="p">[</span><span class="n">allres_key</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_qres_and_qreq_</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">cfgdict</span><span class="p">)</span>
        <span class="n">allres</span> <span class="o">=</span> <span class="n">init_allres</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
        <span class="c"># Cache save</span>
        <span class="n">__ALLRES_CACHE__</span><span class="p">[</span><span class="n">allres_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">allres</span>
    <span class="k">return</span> <span class="n">allres</span>

</div>
<div class="viewcode-block" id="test_confidence_measures"><a class="viewcode-back" href="../../../ibeis.dev.html#ibeis.dev.results_all.test_confidence_measures">[docs]</a><span class="k">def</span> <span class="nf">test_confidence_measures</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qres_list</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">spstats</span>

    <span class="k">def</span> <span class="nf">find_tscore</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">):</span>
        <span class="c"># H0: null hypothesis nid_list[0] is not he same animal</span>
        <span class="c"># H1: alt hypothesis nid_list[0] is the same animal</span>
        <span class="c"># assuming the null hypothesis is true, how likely is it</span>
        <span class="c"># that we got the sample that we did.</span>
        <span class="n">sorted_nids</span><span class="p">,</span> <span class="n">sorted_nscores</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_sorted_nids_and_scores</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
        <span class="n">alt_score</span> <span class="o">=</span> <span class="n">sorted_nscores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sample_measurements</span> <span class="o">=</span> <span class="n">sorted_nscores</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_measurements</span><span class="p">)</span>
        <span class="n">sample_mean</span> <span class="o">=</span> <span class="n">sample_measurements</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sample_std</span>  <span class="o">=</span> <span class="n">sample_measurements</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

        <span class="n">population_mean</span> <span class="o">=</span> <span class="n">sample_mean</span>
        <span class="n">population_std</span> <span class="o">=</span> <span class="n">sample_std</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)</span>
        <span class="c"># t-score is like the z-score but for a sample</span>
        <span class="n">tscore</span> <span class="o">=</span> <span class="p">(</span><span class="n">alt_score</span> <span class="o">-</span> <span class="n">population_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">population_std</span>
        <span class="k">return</span> <span class="n">tscore</span>

    <span class="k">def</span> <span class="nf">find_prob_tscore</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">):</span>
        <span class="n">sorted_nids</span><span class="p">,</span> <span class="n">sorted_nscores</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_sorted_nids_and_scores</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
        <span class="n">alt_score</span> <span class="o">=</span> <span class="n">sorted_nscores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sample_measurements</span> <span class="o">=</span> <span class="n">sorted_nscores</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">tscore</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">spstats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">sample_measurements</span><span class="p">,</span> <span class="n">alt_score</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pval</span>

    <span class="k">def</span> <span class="nf">find_prob_tscore_next</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">):</span>
        <span class="n">sorted_nids</span><span class="p">,</span> <span class="n">sorted_nscores</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_sorted_nids_and_scores</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
        <span class="n">tscore</span><span class="p">,</span> <span class="n">pval1</span> <span class="o">=</span> <span class="n">spstats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">sorted_nscores</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">sorted_nscores</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">tscore</span><span class="p">,</span> <span class="n">pval2</span> <span class="o">=</span> <span class="n">spstats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">sorted_nscores</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">sorted_nscores</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">pval1</span> <span class="o">-</span> <span class="n">pval2</span>

    <span class="k">def</span> <span class="nf">find_prob_densitity</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">):</span>
        <span class="n">sorted_nids</span><span class="p">,</span> <span class="n">sorted_nscores</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_sorted_nids_and_scores</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
        <span class="n">alt_score</span> <span class="o">=</span> <span class="n">sorted_nscores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sample_measurements</span> <span class="o">=</span> <span class="n">sorted_nscores</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">data_pdf</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">estimate_pdf</span><span class="p">(</span><span class="n">sample_measurements</span><span class="p">)</span>
        <span class="n">density</span> <span class="o">=</span> <span class="n">data_pdf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">alt_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">prob_correct</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">density</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">prob_correct</span>

    <span class="k">def</span> <span class="nf">find_prob_normtest1</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">):</span>
        <span class="n">sorted_nids</span><span class="p">,</span> <span class="n">sorted_nscores</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_sorted_nids_and_scores</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
        <span class="n">sample_measurements</span> <span class="o">=</span> <span class="n">sorted_nscores</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">kurt</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">spstats</span><span class="o">.</span><span class="n">normaltest</span><span class="p">(</span><span class="n">sample_measurements</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">pval</span>

    <span class="k">def</span> <span class="nf">find_prob_normtest2</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">):</span>
        <span class="n">sorted_nids</span><span class="p">,</span> <span class="n">sorted_nscores</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_sorted_nids_and_scores</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
        <span class="n">kurt</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">spstats</span><span class="o">.</span><span class="n">normaltest</span><span class="p">(</span><span class="n">sorted_nscores</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">pval</span>

    <span class="k">def</span> <span class="nf">find_scorediff</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">):</span>
        <span class="n">sorted_nids</span><span class="p">,</span> <span class="n">sorted_nscores</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_sorted_nids_and_scores</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sorted_nscores</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">find_prob_scorediff</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">):</span>
        <span class="n">sorted_nids</span><span class="p">,</span> <span class="n">sorted_nscores</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_sorted_nids_and_scores</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
        <span class="n">diff_scores</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sorted_nscores</span><span class="p">)</span>
        <span class="n">tscore</span><span class="p">,</span> <span class="n">pval1</span> <span class="o">=</span> <span class="n">spstats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">diff_scores</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">diff_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">tscore</span><span class="p">,</span> <span class="n">pval2</span> <span class="o">=</span> <span class="n">spstats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">diff_scores</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">diff_scores</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%.2E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">pval1</span><span class="p">))</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pval2</span><span class="p">)))</span>

    <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">true_nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_name_rowids</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">)</span>
        <span class="c">#bestaidrank_list  = [qres.get_best_gt_rank(ibs=ibs) for qres in qres_list]</span>
        <span class="n">decision_tup_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">qres</span><span class="o">.</span><span class="n">get_name_decisiontup</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span> <span class="k">for</span> <span class="n">qres</span> <span class="ow">in</span> <span class="n">qres_list</span><span class="p">]</span>
        <span class="n">decision_nid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_list_column</span><span class="p">(</span><span class="n">decision_tup_list</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">decision_score_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_list_column</span><span class="p">(</span><span class="n">decision_tup_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">iscorrect_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">nid_target</span> <span class="o">==</span> <span class="n">nid_res</span>
                          <span class="k">for</span> <span class="n">nid_target</span><span class="p">,</span> <span class="n">nid_res</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">decision_nid_list</span><span class="p">,</span> <span class="n">true_nid_list</span><span class="p">)]</span>

        <span class="n">t_list</span>          <span class="o">=</span> <span class="p">[</span><span class="n">find_tscore</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">)</span> <span class="k">for</span> <span class="n">qres</span> <span class="ow">in</span> <span class="n">qres_list</span><span class="p">]</span>
        <span class="n">pval_t_list</span>     <span class="o">=</span> <span class="p">[</span><span class="n">find_prob_tscore</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">)</span> <span class="k">for</span> <span class="n">qres</span> <span class="ow">in</span> <span class="n">qres_list</span><span class="p">]</span>
        <span class="n">pval_tnext_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">find_prob_tscore_next</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">)</span> <span class="k">for</span> <span class="n">qres</span> <span class="ow">in</span> <span class="n">qres_list</span><span class="p">]</span>
        <span class="n">norm1_list</span>      <span class="o">=</span> <span class="p">[</span><span class="n">find_prob_normtest1</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">)</span> <span class="k">for</span> <span class="n">qres</span> <span class="ow">in</span> <span class="n">qres_list</span><span class="p">]</span>
        <span class="n">norm2_list</span>      <span class="o">=</span> <span class="p">[</span><span class="n">find_prob_normtest2</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">)</span> <span class="k">for</span> <span class="n">qres</span> <span class="ow">in</span> <span class="n">qres_list</span><span class="p">]</span>
        <span class="n">pden_list</span>       <span class="o">=</span> <span class="p">[</span><span class="n">find_prob_densitity</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">)</span> <span class="k">for</span> <span class="n">qres</span> <span class="ow">in</span> <span class="n">qres_list</span><span class="p">]</span>
        <span class="n">scorediff</span>       <span class="o">=</span> <span class="p">[</span><span class="n">find_scorediff</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">)</span> <span class="k">for</span> <span class="n">qres</span> <span class="ow">in</span> <span class="n">qres_list</span><span class="p">]</span>
        <span class="n">prob_scorediffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">find_prob_scorediff</span><span class="p">(</span><span class="n">qres</span><span class="p">,</span> <span class="n">ibs</span><span class="p">)</span> <span class="k">for</span> <span class="n">qres</span> <span class="ow">in</span> <span class="n">qres_list</span><span class="p">]</span>

        <span class="n">column_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">iscorrect_list</span><span class="p">,</span> <span class="n">decision_score_list</span><span class="p">,</span> <span class="n">scorediff</span><span class="p">,</span> <span class="n">prob_scorediffs</span><span class="p">,</span> <span class="n">t_list</span><span class="p">,</span> <span class="n">pval_t_list</span><span class="p">,</span> <span class="n">pval_tnext_list</span><span class="p">,</span> <span class="n">pden_list</span><span class="p">,</span> <span class="n">norm1_list</span><span class="p">,</span> <span class="n">norm2_list</span><span class="p">]</span>
        <span class="n">column_labels</span>  <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Correct&#39;</span><span class="p">,</span> <span class="s">&#39;score_list&#39;</span><span class="p">,</span> <span class="s">&#39;scorediff&#39;</span><span class="p">,</span> <span class="s">&#39;pscorediff&#39;</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;pval_t&#39;</span><span class="p">,</span> <span class="s">&#39;pnext&#39;</span><span class="p">,</span> <span class="s">&#39;pden_list&#39;</span><span class="p">,</span> <span class="s">&#39;norm1&#39;</span><span class="p">,</span> <span class="s">&#39;norm2&#39;</span><span class="p">]</span>

        <span class="k">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">make_csv_table</span><span class="p">(</span><span class="n">column_list</span><span class="p">,</span> <span class="n">column_labels</span><span class="p">))</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -c &quot;import utool, ibeis.dev.results_all; utool.doctest_funcs(ibeis.dev.results_all, allexamples=True)&quot;</span>
<span class="sd">        python -c &quot;import utool, ibeis.dev.results_all; utool.doctest_funcs(ibeis.dev.results_all)&quot;</span>
<span class="sd">        python -m ibeis.dev.results_all --allexamples</span>
<span class="sd">        python -m ibeis.dev.results_all --test-learn_score_normalization --enableall</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>
    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>  <span class="c"># NOQA</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
    <span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>  <span class="c"># NOQA</span>
    <span class="k">exec</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">present</span><span class="p">())</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">ibeis 0.1.0.dev1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../ibeis.html" >ibeis</a> &raquo;</li>
          <li><a href="../dev.html" >ibeis.dev</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Jon Crall.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>